<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Class name="TCLEx.BI.KPI.AvgCountDayReceivingWeekDay">
<Description>
Таблица: строки-дни недели по дате доставки в лабораторию, 
столбцы-среднее количество эпизодов за календарный день, если есть фильтр по дням достаки, 
если такой фильтр не задан, то среднее за календарный день (период - от минимального до максимального фактического дня доставки, обе граничные даты дополнены до полного месяца) </Description>
<Super>TCLEx.BI.KPI.AvgCountDateReceivingTimeRange</Super>
<TimeCreated>63403,55767.911055</TimeCreated>

<Parameter name="DOMAIN">
</Parameter>

<Parameter name="RESOURCE">
</Parameter>

<Parameter name="CUBE">
<Default>EPVISITNUMBER</Default>
</Parameter>

<XData name="KPI">
<Description>
Этот блок XData содержит определение KPI</Description>
<XMLNamespace>http://www.intersystems.com/deepsee/kpi</XMLNamespace>
<Data><![CDATA[
<kpi xmlns="http://www.intersystems.com/deepsee/kpi"
 name="KPI/Поступление заявок в лабораторию (день недели даты доставки)" sourceType="mdx"
 caption="Поступление заявок в лабораторию (день недели даты доставки)"
 mdx='SELECT NON EMPTY {%LABEL({%KPI("%DeepSee.AverageDay","AVGDAY",1,"%measure","%COUNT","%dimension","DxReceivingDay","%CONTEXT")},"","#")} ON 0,  NON EMPTY [ReceivingDayOfWeek].[H1].[ReceivingDayOfWeek].Members ON 1  FROM [EPVisitNumber]'
>
<property name="Avg" displayName="Среднее да день" columnNo="1"/>
<!-- for testing : <property name="PatCount" displayName="Количество" columnNo="2"/>-->

<filter name="[RECEIVINGDATE].[H1].[RECEIVINGDAY]" displayName="Период"  filterProperty="Day" searchType="day" />
</kpi>
]]></Data>
</XData>

<Method name="%OnGetMDX">
<Description>
Implementation; can be overridden.</Description>
<FormalSpec><![CDATA[&pMDX:%String]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	 set qDays=0
	 set stringFilters=..FilterBuilder(.qDays)
	 if qDays>0 {
		 set mdx="SELECT NON EMPTY {%LABEL({[Measures].[%COUNT]/"_qDays_"},"""",""#""),[Measures].[%COUNT]} ON 0,  NON EMPTY [ReceivingDayOfWeek].[H1].[ReceivingDayOfWeek].Members ON 1  FROM [EPVisitNumber]"
	 } else {
		 set mdx="SELECT NON EMPTY {%LABEL({%KPI(""%DeepSee.AverageDay"",""AVGDAY"",1,""%measure"",""%COUNT"",""%dimension"",""DxReceivingDay"",""%CONTEXT"")},"""",""#""),[Measures].[%COUNT]} ON 0,  NON EMPTY [ReceivingDayOfWeek].[H1].[ReceivingDayOfWeek].Members ON 1  FROM [EPVisitNumber]"
	 }
	 set pMDX=mdx_stringFilters
	 set ^test("ds",777,$i(^test("ds",777)))=pMDX
	 quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
