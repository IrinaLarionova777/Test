<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Class name="TCBI.Cubes.EPVisitTestSet">
<Description>
</Description>
<ProcedureBlock>1</ProcedureBlock>
<Super>%DeepSee.CubeDefinition</Super>
<TimeCreated>62560,52629.79326</TimeCreated>
<DependsOn>EPVisitNumber</DependsOn>

<Parameter name="DOMAIN">
</Parameter>

<XData name="Cube">
<Description>
Cube definition from Architect.</Description>
<XMLNamespace>http://www.intersystems.com/deepsee</XMLNamespace>
<Data><![CDATA[
<cube xmlns="http://www.intersystems.com/deepsee" name="EPVisitTestSet" displayName="EPVisitTestSet" disabled="false" abstract="false" sourceClass="User.EPVisitTestSet" nullReplacement="No Data" countMeasureName="%COUNT" countMeasureCaption="# Наборов тестов" bucketSize="8" bitmapChunkInMemory="false" precompute="0">
  <dimension name="TestSets" displayName="Наборы тестов" disabled="false" hasAll="true" allCaption="Итого" allDisplayName="Все наборы тестов" type="data" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level sourceProperty="VISTSTestSetDR.CTTSCode" factName="DxTestSetCode" name="TestSetCode" displayName="Код набора тестов" disabled="false" list="false" useDisplayValue="true">
      </level>
      <level sourceProperty="VISTSTestSetDR.CTTSName" factName="DxTestSetDesc" name="TestSetDescription" displayName="Наименование набора тестов" disabled="false" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="Referrals" displayName="Аусорсинг" disabled="false" hasAll="false" allCaption="All VISTSMoveToReferralLabDR" allDisplayName="VISTSMoveToReferralLabDR" type="data" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level sourceProperty="VISTSMoveToUserSiteDR.CTUSLDesc" factName="DxInternalReferral" name="InternalReferral" displayName="Внутренний аутсорсинг" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
    <hierarchy name="H2" disabled="false">
      <level sourceProperty="VISTSMoveToReferralLabDR.CTRLDescription" factName="DxSendAwayReferral" name="SendAwayReferral" displayName="Внешний аутсорсинг" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="TestSetDetails" displayName="Подробности по набору тестов" disabled="false" hasAll="true" allCaption="Все наборы тестов" allDisplayName="Все наборы тестов" type="data" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H2" displayName="Приоритет" disabled="false">
      <level sourceExpression="##class(TCBI.UtilsRu).GetPriorityTestSet(%source.VISTSPriorityDR,%source.%ID)" factName="DxPriority" name="TestPriority" displayName="Приоритет" disabled="false" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
    <hierarchy name="H1" disabled="false">
      <level sourceProperty="VISTSTestSetDR.CTTSDepartmentDR" factName="DxDepartmentCode" name="DepartmentCode" displayName="Код отдела" disabled="false" list="false" nullReplacement="Обычный" useDisplayValue="true">
        <property sourceProperty="VISTSTestSetDR.CTTSDepartmentDR.CTDEPName" name="DepartmentName" disabled="false" hidden="false" isName="true" isReference="true" useDisplayValue="false"></property>
      </level>
    </hierarchy>
  </dimension>
  <dimension name="UserDetails" displayName="Пользователь" disabled="false" hasAll="false" allCaption="All VISTSUserSiteDR" allDisplayName="VISTSUserSiteDR" type="data" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level sourceProperty="VISTSUserSiteDR" factName="DxTestUserSite" name="TestUserSite" displayName="Местоположение пользователя" disabled="false" list="false" nullReplacement="Не определено" useDisplayValue="true">
        <property sourceProperty="VISTSUserSiteDR.CTUSLDesc" name="TestUserSiteName" disabled="false" hidden="false" isName="true" isReference="true" useDisplayValue="false"></property>
      </level>
    </hierarchy>
  </dimension>
  <dimension name="CollectionDate" displayName="Дата забора материала" disabled="false" hasAll="false" allCaption="All VISTSDateOfCollection" allDisplayName="VISTSDateOfCollection" sourceProperty="VISTSDateOfCollection" type="time" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level factName="DxCollectionYear" name="CollectionYear" displayName="Год забора материала" disabled="false" timeFunction="Year" list="false" useDisplayValue="true">
      </level>
      <level factName="DxCollectionMonth" name="CollectionMonth" displayName="Месяц забора материала" disabled="false" timeFunction="MonthYear" list="false" useDisplayValue="true">
      </level>
      <level factName="DxCollectionDay" name="CollectionDay" displayName="День забора материала" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="CreationDate" displayName="Дата создания заявки" disabled="false" hasAll="false" allCaption="All VISTSDateOfCreation" allDisplayName="VISTSDateOfCreation" sourceProperty="VISTSDateOfCreation" type="time" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level factName="DxCreationYear" name="CreationYear" displayName="Год создания заявки" disabled="false" timeFunction="Year" list="false" useDisplayValue="true">
      </level>
      <level factName="DxCreationMonth" name="CreationMonth" displayName="Месяц создания заявки" disabled="false" timeFunction="MonthYear" list="false" useDisplayValue="true">
      </level>
      <level factName="DxCreationDay" name="CreationDay" displayName="День создания заявки" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="AuthorisationDate" displayName="Дата авторизации" disabled="false" hasAll="false" allCaption="All VISTSDateOfAuthorisation" allDisplayName="VISTSDateOfAuthorisation" sourceProperty="VISTSDateOfAuthorisation" type="time" iKnowType="entity" hidden="false" showHierarchies="false">
    <hierarchy name="H1" disabled="false">
      <level factName="DxAuthorisationYear" name="AuthorisationYear" displayName="Год авторизации" disabled="false" timeFunction="Year" list="false" useDisplayValue="true">
      </level>
      <level factName="DxAuthorisationMonth" name="AuthorisationMonth" displayName="Месяц авторизации" disabled="false" timeFunction="MonthYear" list="false" useDisplayValue="true">
      </level>
      <level factName="DxAuthorisationDay" name="AuthorisationDay" displayName="День авторизации" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="TurnAroundTimeDimension" disabled="false" hasAll="false" allCaption="All TurnAroundTimeDimension" allDisplayName="TurnAroundTimeDimension" type="data" hidden="false" showHierarchies="default">
    <hierarchy name="H1" disabled="false">
      <level sourceExpression="##class(TCBI.UtilsRu).GetTAT(%source.VISTSDateOfAuthorisation,%source.VISTSTimeOfAuthorisation,%source.VISTSDateOfCollection,%source.VISTSTimeOfCollection,%source.VISTSDateOfReceive,%source.VISTSTimeOfReceive,%source.VISTSDateOfCreation,%source.VISTSTimeOfCreation)" factName="DxTurnAroundTime" name="TurnAroundTimeDimension" displayName="TAT 2" disabled="false" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="Price" displayName="Цена" disabled="false" hasAll="false" allCaption="All Price" allDisplayName="Price" type="data" iKnowType="entity" hidden="false" showHierarchies="default">
    <hierarchy name="H1" disabled="false">
      <level sourceExpression="##class(TCBI.UtilsRu).GetPriceTestSet(%source.%ID,%source.VISTSSuperSetDR,%source.VISTSDateOfAuthorisation)" factName="DxPrice" name="Price" displayName="Цена" disabled="false" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="DateAuthorisationService" displayName="Дата авторизации услуги" disabled="false" hasAll="false" allCaption="All DateAuthorisationService" allDisplayName="DateAuthorisationService" sourceExpression="##class(TCBI.UtilsRu).GetDateOfAuthorisationService(%source.%ID,%source.VISTSSuperSetDR,%source.VISTSDateOfAuthorisation)" type="time" iKnowType="entity" hidden="false" showHierarchies="default">
    <hierarchy name="H1" disabled="false">
      <level factName="DxDateAuthorisationServiceYear" name="DateAuthorisationServiceYear" displayName="Дата авторизации услуги (год)" disabled="false" timeFunction="Year" list="false" useDisplayValue="true">
      </level>
      <level factName="DxDateAuthorisationServiceMonth" name="DateAuthorisationServiceMonth" displayName="Дата авторизации услуги (месяц)" disabled="false" timeFunction="MonthYear" list="false" useDisplayValue="true">
      </level>
      <level factName="DxDateAuthorisationServiceDay" name="DateAuthorisationServiceDay" displayName="Дата авторизации услуги (день)" disabled="false" timeFunction="DayMonthYear" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="Services" displayName="Услуги" disabled="false" hasAll="true" allCaption="All Services" allDisplayName="Все услуги" type="data" iKnowType="entity" hidden="false" showHierarchies="default">
    <hierarchy name="H1" disabled="false">
      <level sourceExpression="##class(TCBI.UtilsRu).GetServiceCode(%source.VISTSTestSetDR.CTTSCode,%source.VISTSSuperSetDR.CTSSCode)" factName="DxServiceCode" name="ServiceCode" displayName="Код услуги" disabled="false" list="false" useDisplayValue="true">
      </level>
      <level sourceExpression="##class(TCBI.UtilsRu).GetServiceDescription(%source.VISTSTestSetDR.CTTSCode,%source.VISTSSuperSetDR.CTSSCode)" factName="DxServiceDescription" name="ServiceDescription" displayName="Наименование услуги" disabled="false" list="false" useDisplayValue="true">
      </level>
    </hierarchy>
  </dimension>
  <dimension name="DoctorAuth" displayName="Доктор, авторизовавший результат" disabled="false" hasAll="true" allCaption="По всем врачам" allDisplayName="По всем врачам" type="data" iKnowType="entity" hidden="false" showHierarchies="default">
    <hierarchy name="H1" disabled="false">
      <level sourceProperty="VISTSUserAuthorisedDR" factName="DxUserAuthorization" name="DoctorAuth" displayName="Доктор, авторизовавший результат" disabled="false" timeFunction="Year" list="false" useDisplayValue="true">
        <property sourceProperty="VISTSUserAuthorisedDR.SSUSRName" name="DoctorAuthorizationName" disabled="false" hidden="false" isName="true" isReference="true" useDisplayValue="false"></property>
      </level>
    </hierarchy>
  </dimension>
  <measure sourceExpression="%source.VISTSMoveToUserSiteDR&apos;=&quot;&quot;" factName="MxInternalReferral" name="NumberInternalReferrals" displayName="# Внутренний аутсорсинг" disabled="false" aggregate="SUM" type="number" hidden="false" searchable="true" iKnowSource="string"></measure>
  <measure sourceExpression="%source.VISTSMoveToReferralLabDR&apos;=&quot;&quot;" factName="MxSendAwayReferral" name="NumberSendAwayReferrals" displayName="# Внешний аутсорсинг" disabled="false" aggregate="SUM" type="number" hidden="false" searchable="true" iKnowSource="string"></measure>
  <measure sourceExpression="%cube.GetNotReferred(%source.%ID)" factName="MxInHouseReferral" name="NumberInHouse" displayName="# Лаборатория" disabled="false" aggregate="SUM" type="number" hidden="false" searchable="true" iKnowSource="string"></measure>
  <measure sourceExpression="##class(TCBI.UtilsRu).GetTAT(%source.%ID,%source.VISTSDateOfAuthorisation,%source.VISTSTimeOfAuthorisation,%source.VISTSDateOfCollection,%source.VISTSTimeOfCollection,%source.VISTSDateOfReceive,%source.VISTSTimeOfReceive,%source.VISTSDateOfCreation,%source.VISTSTimeOfCreation)" factName="MxTurnAroundTime" name="TurnAroundTime" displayName="ТАТ" disabled="false" aggregate="AVG" type="number" hidden="false" searchable="false" iKnowSource="string"></measure>
  <measure sourceExpression="##class(TCBI.UtilsRu).GetPortionEpisode(%source.%ID)" factName="MxPortionEpisode" name="PortionEpisode" displayName="Кол-во заявок" disabled="false" aggregate="SUM" type="number" scale="12" hidden="false" searchable="false" iKnowSource="string"></measure>
  <measure sourceExpression="##class(TCBI.UtilsRu).GetPriceService(%source.%ID,%source.VISTSSuperSetDR,%source.VISTSDateOfAuthorisation)" factName="MxPrice" name="Price" displayName="Сумма услуг" disabled="false" aggregate="SUM" type="number" hidden="false" searchable="false" iKnowSource="string"></measure>
  <measure sourceExpression="##class(TCBI.UtilsRu).GetKolService(%source.%ID,%source.VISTSSuperSetDR)" factName="MxQServices" name="QServices" displayName="Количество услуг" disabled="false" aggregate="SUM" type="number" hidden="false" searchable="false" iKnowSource="string"></measure>
  <relationship sourceProperty="VISTSParRef" name="EPVisitNumber" displayName="Данные по заявке" disabled="false" relatedCube="EPVisitNumber" inverse="EPVisitTestSet" cardinality="one"></relationship>
  <calculatedMember name="TATPercentile90" displayName="Центиль 90%" disabled="false" dimension="Measures" valueExpression="%KPI(&quot;%DeepSee.Percentile&quot;,&quot;PERCENTILE&quot;,1,&quot;%measure&quot;,&quot;TurnAroundTime&quot;,&quot;%percentile&quot;,&quot;90&quot;,&quot;%CONTEXT&quot;)" hidden="false"></calculatedMember>
  <calculatedMember name="TATPercentile75" displayName="Центиль 75%" disabled="false" dimension="Measures" valueExpression="%KPI(&quot;%DeepSee.Percentile&quot;,&quot;PERCENTILE&quot;,1,&quot;%measure&quot;,&quot;TurnAroundTime&quot;,&quot;%percentile&quot;,&quot;75&quot;,&quot;%CONTEXT&quot;)" hidden="false"></calculatedMember>
  <calculatedMember name="TATMediana" displayName="Медиана" disabled="false" dimension="Measures" valueExpression="%KPI(&quot;%DeepSee.Median&quot;,&quot;MEDIAN&quot;,1,&quot;%measure&quot;,&quot;TurnAroundTime&quot;,&quot;%percentile&quot;,&quot;50&quot;,&quot;%CONTEXT&quot;)" hidden="false"></calculatedMember>
  <listing name="listEpisodes" displayName="Список заявок" disabled="false" listingType="table" fieldList="VISTSParRef-&gt;"></listing>
</cube>
]]></Data>
</XData>

<Method name="GetNotReferred">
<ClassMethod>1</ClassMethod>
<FormalSpec>id:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s returnVal=0
	s obj=##class(User.EPVisitTestSet).%OpenId(id,0)
	i obj d
	. i obj.VISTSMoveToReferralLabDR="",obj.VISTSMoveToUserSiteDR="" d
	. .s returnVal=1
	Quit returnVal
]]></Implementation>
</Method>
</Class>
</Export>
