<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="at42bion" type="MAC" languagemode="0"><![CDATA[
at42bion ; Triggers for SQLUser.EP_VisitNumber events
POFILINS() [%d] public {
	set epis=$Get(%d(2))
	
	Do ##class(TCLEx.Function.Episode).LogEvent("Insert",$Get(%d(2)),.%d)
	
	//Для расчета дополнительных данных (цена, код плательщика, флаги)
	set ok=##class(TCLEx.Task.ExtraCalcQueueManager).InsertInQueue(epis,0)
}

POFILUPD() [%d,%old] public 
{
	Set epis=$Get(%d(2))    			
	set hospitalold=$Get(%old(22))
	set hospital=$Get(%d(22))
	set payerold=$Get(%old(64))
	set payer=$Get(%d(64))

	//Для расчета дополнительных данных (цена, код плательщика, флаги)
	if (hospitalold'=hospital)||(payerold'=payer) {
		set ok=##class(TCLEx.Task.ExtraCalcQueueManager).InsertInQueue(epis,0)
	}
}
]]></Routine>
</Export>
