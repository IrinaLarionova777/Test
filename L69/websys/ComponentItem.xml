<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Class name="websys.ComponentItem">
<Description><![CDATA[
Component Item. An items which is included in a text box.<br>
Can be an Item or a TableItem.
Typically Find,Edit,Custom type components consist of a numner of Items, and List type components consist of TableItems]]></Description>
<Abstract>1</Abstract>
<ClassType/>
<CompileAfter>websys.Component</CompileAfter>
<IncludeCode>webutils</IncludeCode>
<ProcedureBlock>0</ProcedureBlock>
<Super>%Library.RegisteredObject,XML.Abstract</Super>
<TimeCreated>60218,47034.842154</TimeCreated>
<Inheritance>right</Inheritance>

<Parameter name="xmlidentifiedby">
<Description>
Used in conjunction with XMLId method to unqiuely identify a record.
By default ..%Id() is used unless other properties are specified. A comma separated list may be provided and processed by overridding XMLId method</Description>
<Final>0</Final>
</Parameter>

<Parameter name="xmltoclass">
<Description>
Mapping from XML to Class</Description>
<Final>0</Final>
<Default>componentitem</Default>
</Parameter>

<Parameter name="xmltypeCaptionStyle">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeIconProfile">
<Default>IGNORE</Default>
</Parameter>

<Parameter name="xmltypeItemIdGetExpression">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeLinkExpression">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeLookupProperties">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeNestedTransExpr">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeParRef">
<Final>0</Final>
<Default>IGNORE</Default>
</Parameter>

<Parameter name="xmltypeQuerySQLName">
<Final>0</Final>
<Default>IGNORE</Default>
</Parameter>

<Parameter name="xmltypeQuerySQLParsed">
<Final>0</Final>
<Default>IGNORE</Default>
</Parameter>

<Parameter name="xmltypeShowInNewWindow">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeStyle">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeValueGet">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Parameter name="xmltypeValueSet">
<Final>0</Final>
<Default>CDATA</Default>
</Parameter>

<Property name="AttachedFile">
<Description>
Input type is file.</Description>
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="Caption">
<Description>
Default caption - can be translated to foreign lanaguage through translation facilities.</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CaptionStyle">
<Description>
CSS style applied to caption.</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ClassMethod">
<Description><![CDATA[
A class method that is invoked on the server when the form is submitted, or a link is followed.<br>
The class method is invoked before any other processing.<br>
The format is a comma separared field with an optional number of parameters which must match the number and sequence ofparameters expected by the class method.<br>
The method must be defined as a class method in the method characteristic of the object architect.<br>
ClassName,Method,param1,param2,...<br>]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ClassMethodIfDirty">
<Description>
Only run the class method if something has changes on the component form.
Applies to edit components and update buttons mainly.</Description>
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="CustomExpression">
<Description>
Applies to custom component items.
Custom items are required to provide their own rendering via a method call</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CustomLookupBrokerMethod">
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CustomLookupClassName">
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CustomLookupProperties">
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="CustomLookupQueryName">
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="DataType">
<Description><![CDATA[
Data type of the item.<br>
Use to apply correct conversions from Logical to Html and vice versa.]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>"%String"</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="DefaultValueAlways">
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="DefaultValueExpression">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Description">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Disabled">
<Description>
Item is disabled.
Applies to text,textarea,checkbox and listbox.
Typically used when entire component is disable e.g. when record is locked.</Description>
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="DisplayOnly">
<Description>
The value item of the item is displayed as text rather then a data entry field (e.g. textbox).
Applies to TEXTBOX,TEXTAREA,LISTBOX,CHECKBOX type fields.</Description>
<Type>%Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>0</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="DisplayType">
<Description><![CDATA[
The type of Html field used to display the item on the page. For example text would typically be display in a text box, true/false value in CHECKBOX and long text in TEXTAREA.<br>
A BUTTON will submit an HTML form.<br>
A LINK will generate a clickable link to another page orpart of a page.<br>]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>"T"</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="DISPLAYLIST" value=",TEXTBOX,LISTBOX,CHECKBOX,TEXTAREA,LINK,BUTTON,COMPONENT,ICONPROFILE,CUSTOM,RTF,CUSTOMTEXTBOX"/>
<Parameter name="TRUNCATE" value="1"/>
<Parameter name="VALUELIST" value=",T,L,C,TA,A,B,CX,IP,S,R,CT"/>
</Property>

<Property name="HelpUrl">
<Description><![CDATA[
Url to context specific help.<br>
The URL may be:<br>
an absolute link e.g. http://myserver/Help/patientrego.html#patientname<br>
a relative link e.g. ../Help/patientrego.html#patientname<br>
In this case of relative links, the link is relative to the CSP folder.<br>
Help documentation may be in any 'browsable' document format.<br>
In the case of Html documentation a bookmark may be specified to jump to a specific section e.g #patientname.<br>]]></Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Hidden">
<Description>
Used to include data in an HTML form which is HIDDEN from the user, but required by the server side procssing.</Description>
<Type>%Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>0</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="IconProfile">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Image">
<Description><![CDATA[
An image to be displayed next to the item.<br>
Applies only to BUTTON, LINK items.<br>
The image path should be relative to the CSP page.<br>
e.g. ../images/update.gif<br>]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ItemIdGetExpression">
<Description>
Cache expression to get the value of the id for an item. Used only when the property is an object reference.
?? NOT USED ??</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LinkComponent">
<Description>
The next component used in conjunction with websysDefault.ASP.
If this property is set then LinkUrl is assumes to be websysDefault.asp</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LinkExpression">
<Description>
Cache Expression used to add add name value pairs to the LinkUrl</Description>
<Type>websys.Expression</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="LinkUrl">
<Description>
A url to link to. Typically this is another CSP page, but can be any valid server link.</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LinkWorkFlow">
<Description>
A workflow to link to. This is %String as it can be user defined.</Description>
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LinkWorkFlowDescription">
<Type>%String</Type>
<Collection/>
<Relationship>0</Relationship>
<Transient>1</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ListCellStyle">
<Description>
Style applied to cell in a list - for example to set background colour</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupBrokerMethod">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupClassName">
<Description><![CDATA[
Applies to TEXTBOX and LISTBOX display types.<br>
Specifies the class for the lookup.<br>
For TEXTBOX the lookup Properties are used to provide a browser side lookup capability.<br>
Properties are a comma separated list of form items.<br>
For LISTBOX the the lookup properties are used to populate the list box.<br>
Properties are a comma separated list of server side variables.<br>]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupCustomComponent">
<Description>
component to add to lookup to give extra searching in lookup</Description>
<Type>websys.Component</Type>
<Collection/>
<Relationship>0</Relationship>
</Property>

<Property name="LookupJavascriptFunction">
<Description><![CDATA[
Javascript function to be invoked on the browser when the user selects an item from the the lookup.<br>
For Example:<br>
If this is set to:<br>
MyPropertySelect<br>
then a javascript function  must be defined as follows:<br>
function MyPropertySelect(txt) {<br>
}<br>
All columns from the lookup are passed to the function in the txt paramters as a delimited string.<br>
Applies to TEXTBOX fields only]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupProperties">
<Description><![CDATA[
Applies to TEXTBOX and LISTBOX display types.<br>
For TEXTBOX this is a comma separated list of properties on the FORM.<br>
For LISTBOX this is a comma separated list of propties on the server.<br>
The list of properties must match the parameters and sequence required by the query.<br>]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupQueryName">
<Description><![CDATA[
Applies to TEXTBOX and LISTBOX display types.<br>
In conjunction with LookupClassName Specifies the object architect query for the lookup.]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="LookupUserDefined">
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="LookupUserDefinedValues">
<Description>
comma separated list if user defined values.
may be used in conjunction with LookupUserDefinedDisplays</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Name">
<Description>
The name used to identify the item.</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>"Item"_$I(^websys.Unique)</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="NestedComponent">
<Description>
Component nested from a list to implement a 'tree-like' structure.</Description>
<Type>websys.Component</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="NestedCondExpr">
<Description><![CDATA[
The expression used to determine wether to include the '+' and the assocaited DIV on a nested component
For example.
To skip the branch for male patient:<br>
s val=$s(sex="M":0,1:1)<br>
if val=0 the item will be skipped.<br>
if val=1 the item will be included.<br>
By default the '+' wil be included]]></Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="NestedTransExpr">
<Description>
Cache script transition expression.
Use to link nested components.
e.g.s %request.Data("PatientID",1)=rs.GetDataByName("ID")</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="OrderByAsc">
<Description>
Order By Clause for ascending sequence lists.
Used in dynamic queries directly appended as ORDER BY xyz.
Used in object queries as a flag.</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="OrderByDesc">
<Description>
Order By Clause for descending sequence lists.
Used in dynamic queries directly appended as ORDER BY xyz.
Used in object queries as a flag.</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Password">
<Description><![CDATA[
Applies to TEXTBOX.<br>
If true, textbox is displayed as HTML INOUT type=password<br>]]></Description>
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="PasswordKeepVal">
<Description>
Keep entered password value (default behaviour for passwords is o clear the value)</Description>
<Type>%Library.Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="ReferencedObject">
<Description>
An object reference which is used to derive default ValueGet,ValueSet expressions.
Examples are:
rs.GetDataByName("Desc")
obj.PAPMISexDR.SEXDesc</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Required">
<Description>
The field will be generated in HTML with HTMLCLASS 'clsRequired'. This style of this can be controlled though the style sheets.
For datainput fields javascript will be generated to ensure that the user must enter fields marked as required.
Applies only to data entry fields (TEXTBOX,LISTBOX,TEXTAREA,CHECKBOX).</Description>
<Type>%Boolean</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<InitialExpression>0</InitialExpression>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="SQLColumn">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SQLComment">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SQLExtendedReference">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SQLTable">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="SQLToVBCodeTable">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ShortcutKey">
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ShowInNewWindow">
<Description><![CDATA[
Parameters to control how the new window is display. If none are specified then next page will be displayed in the same window.<br>
Applies to LINK,display only TEXTBOX (with link properties).<br>
Typical values used to position the new window are:<br>
top=50,left=50,width=460,height=480<br>
<br>
Values provided by default (and therefore cannot be changed) are:<br>
toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes]]></Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE"/>
</Property>

<Property name="Style">
<Description>
CSS style applied to to item</Description>
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="TabSequence">
<Description>
Sequence followed when TAB key is used to navigate the screen.</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="Tooltip">
<Description>
Tooltip displayed on mouseover events. Typically applied to data entry fields, links and buttons.</Description>
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="MAXLEN"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ValueDefault">
<Type>%Library.String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="ValueGet">
<Description><![CDATA[
Cache expression to get the value of a property.<BR>
Typically for a List type component the expression will a data item from the list results set.<BR>
The query for the result set is dependant on the component definition (ClassName,QueryName, QuerySQL).<br>
The open result set instance is made available in the variable 'rs'.<br>
s val=rs.GetDataByName("PAPERAge")<br>
(get the data item from rhe result set called PAPERAge)
<br>
Typically for an Edit type component the expression will a data item from an object.<BR>
The open object instance is made available in the variable 'obj'.<br>
The object is dependant on the componebt definition (ClassName).
e.g. <br>
s val=$s(obj:obj.PAPERAge,1:"")<br>
(if obj is a valid object hen display age, esle display empty string).<br>]]></Description>
<Type>websys.Expression</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="ValueSet">
<Description><![CDATA[
Cache expression to set the value of a property. May use the ItemId value in the expression if the item is an object reference.<br>
Used in the generated websysSave as the exporession to set the value of an object.<br>
Typically may include data conversions.
e.g. <br>
s obj.PAPERGovernCardNo=$g(val)<br>
s:$l($g(val)) val=##Class(web.CTRelation).GetIdFromCodeOrDescription($g(val)) d obj.PAPERNokCTRLTDRSetObjectId($g(val))]]></Description>
<Type>websys.Expression</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>0</Transient>
</Property>

<Property name="pComponent">
<Type>websys.Component</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>1</Transient>
</Property>

<Property name="pId">
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>1</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>1</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="pValue">
<Type>%String</Type>
<Final>0</Final>
<Calculated>0</Calculated>
<Collection/>
<MultiDimensional>0</MultiDimensional>
<Private>0</Private>
<Relationship>0</Relationship>
<Required>0</Required>
<SqlComputed>0</SqlComputed>
<Transient>1</Transient>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Method name="%OnAfterSave">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>insert:%Library.String</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.Status</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 d ##Class(websys.ComponentXRef).MakeDirtyComponent(..ParRef.%Id())
 q $$$OK
]]></Implementation>
</Method>

<Method name="AddDefaults">
<Description>
Apply default settings to a property optinally based on the form type</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>ComponentType:%Library.String="E",collection:%Library.String=""</FormalSpec>
<Private>0</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i ..DisplayType="B" q  ; avoid defaults for these for now
 ;i ..DisplayType="L" q  ; avoid defaults for these for now
 ;i ..DisplayType="A" q  ; avoid defaults for these for now
 ;
 i ComponentType="F" d ..AddDefaultsFind(collection)
 i ComponentType="L" d ..AddDefaultsList(collection)
 i ComponentType="E" d ..AddDefaultsEdit(collection)
 ;
 ; nothing for custom
 q
]]></Implementation>
</Method>

<Method name="AddDefaultsEdit">
<Description>
Apply default typical for an editable item</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>collection:%Library.String</FormalSpec>
<Private>1</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ;
 n webclass,labclass,j
 ;
 ; If we are referencing a method it is likely we want to operate on the core class not the web class
 s (webclass,labclass)=..DataType i "web,lab"[$p(..DataType,".",1) s $p(labclass,".",1)="lab",$p(webclass,".",1)="web"
 ;
 i $e(..DataType)="%" d
 . s:..ValueGet="" ..ValueGet="s val=$s(obj:obj."_..Name_",1:""ERROR!"")"
 . s:..ValueSet="" ..ValueSet="s obj."_..Name_"=$g(val)"
 i $l(..DataType),$e(..DataType)'="%" d
 . ; Build up the ValueGet expression ( s val="" i obj,obj.ref1,obj.ref1.ref2 s val=obj.ref1.ref2.property
 . n tmp
 . s ref=..ReferencedObject,tmp="s val="""" i "
 . f j=1:1:$l(ref,".")-1 s tmp=tmp_$p(ref,".",1,j)_","
 . i $e(tmp,$l(tmp))="," s tmp=$e(tmp,1,$l(tmp)-1)
 . s tmp=tmp_" s val="_ref
 . s ..ValueGet=tmp
 . ;
 . ;s ..ValueSet="s:$l($g(val)) val=##Class("_webclass_").GetIdFromCodeOrDescription($g(val)) d "_$p(ref,".",1,$l(ref,".")-1)_"SetObjectId($g(val))"
 . s ..ValueSet="s:$l($g(val)) val=##Class("_webclass_").GetIdFromCodeOrDescription($g(val)) d "_ref_"SetObjectId($g(val))"
 . ;
 . ; set lookup defaults
 . s ..LookupClassName=webclass
 . s ..LookupQueryName="LookUp"
 . s ..LookupBrokerMethod="LookUpBroker"
 . s ..LookupProperties=..Name
 ;
 ; Some special formatting
 i ##Class(%Library.Collation).Upper(..DataType)["DATE" d
 . s ..ValueGet="s val=##Class(websys.Conversions).DateLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 . s ..ValueSet="s obj."_..Name_"=##Class(websys.Conversions).DateHtmlToLogical($g(val))"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["TIME" d
 . s ..ValueGet="s val=##Class(websys.Conversions).TimeLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 . s ..ValueSet="s obj."_..Name_"=##Class(websys.Conversions).TimeHtmlToLogical($g(val))"
 ;
 i "LIBRARY.NUMERIC,LIBRARY.CURRENCY,LIBRARY.FLOAT,LIBRARY.INTEGER"[$tr(##Class(%Library.Collation).Upper(..DataType),"%","") d
 . s ..Style="TEXT-ALIGN:right;"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["BOOLEAN" d
 . s ..DisplayType="C" ; Check box
 . s ..ValueGet="s val=##Class(websys.Conversions).BooleanLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 . s ..ValueSet="s obj."_..Name_"=##Class(websys.Conversions).BooleanHtmlToLogical($g(val))"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["STRING",collection="list" d  ; if it is a 'long text field'
 . n delim
 . s delim="$C(13,10)" i ..DisplayOnly s delim="""<BR>"""
 . s ..DisplayType="TA" ; Text Area
 . s ..ValueGet="s val=##Class(websys.Conversions).LongTextLogicalToHtml($s(obj:obj."_..Name_",1:""""),"_delim_")"
 . s ..ValueSet="d ##Class(websys.Conversions).LongTextHtmlToLogical(obj."_..Name_",$g(val),"_delim_")"
 ;
 ; If its a string and it's a check box then it's probably a Yes/No field
 i ##Class(%Library.Collation).Upper(..DataType)["STRING",..DisplayType="C" d
 . s ..ValueGet="s val=##Class(websys.Conversions).YesNoLogicalToHtml($s(obj:obj."_..Name_",1:""""))"
 . s ..ValueSet="s obj."_..Name_"=##Class(websys.Conversions).YesNoHtmlToLogical($g(val))"
 ;
 i ..Name="ID" d
 . s ..ValueGet="s val=$s(obj:obj.%Id(),1:""ERROR!"")"
 . s ..ValueSet=""
 . s ..Hidden=1
 . s ..DisplayOnly=0
 ;
 q
]]></Implementation>
</Method>

<Method name="AddDefaultsFind">
<Description>
Apply default typical for find search criteria</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>collection:%Library.String</FormalSpec>
<Private>0</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; Some special formatting
 i ##Class(%Library.Collation).Upper(..DataType)["DATE" d
 . s ..ValueGet="s val=##Class(websys.Conversions).DateLogicalToHtml("""")"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["TIME" d
 . s ..ValueGet="s val=##Class(websys.Conversions).TimeLogicalToHtml("""")"
 ;
 i "LIBRARY.NUMERIC,LIBRARY.CURRENCY,LIBRARY.FLOAT,LIBRARY.INTEGER"[$tr(##Class(%Library.Collation).Upper(..DataType),"%","") d
 . s ..Style="TEXT-ALIGN:right;"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["BOOLEAN" d
 . s ..DisplayType="C" ; Check box
 . s ..ValueGet="s val=##Class(websys.Conversions).BooleanLogicalToHtml("""")"
 q
]]></Implementation>
</Method>

<Method name="AddDefaultsList">
<Description>
Apply defaults typical for an items in a list</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>collection:%Library.String</FormalSpec>
<Private>1</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; We need to work out if it is a property from the object or from the result set
 n rsflag
 s rsflag=1 //assume it is from the result set 
 ;
 s ..DisplayOnly=1
 i rsflag s ..ValueGet="s val=rs.Data("""_..Name_""")" i 1
 e  s ..ValueGet="s val=$s(obj:obj."_..Name_",1:""ERROR!"")"
 s ..ValueSet=""
 ;
 ; Some special formatting
 i ##Class(%Library.Collation).Upper(..DataType)["DATE" d
 . i rsflag s ..ValueGet="s val=##Class(websys.Conversions).DateLogicalToHtml(rs.Data("""_..Name_"""))" i 1
 . e  s ..ValueGet="s val=##Class(websys.Conversions).DateLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["TIME" d
 . i rsflag s ..ValueGet="s val=##Class(websys.Conversions).TimeLogicalToHtml(rs.Data("""_..Name_"""))" i 1
 . e  s ..ValueGet="s val=##Class(websys.Conversions).TimeLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 ;
 i "LIBRARY.NUMERIC,LIBRARY.CURRENCY,LIBRARY.FLOAT,LIBRARY.INTEGER"[$tr(##Class(%Library.Collation).Upper(..DataType),"%","") d
 . s ..Style="TEXT-ALIGN:right;"
 ;
 i ##Class(%Library.Collation).Upper(..DataType)["BOOLEAN" d
 . s ..DisplayType="C" ; Check box
 . i rsflag s ..ValueGet="s val=##Class(websys.Conversions).BooleanLogicalToHtml(rs.Data("""_..Name_"""))" i 1
 . e  s ..ValueGet="s val=##Class(websys.Conversions).BooleanLogicalToHtml($s(obj:obj."_..Name_",1:""ERROR!""))"
 q
]]></Implementation>
</Method>

<Method name="CaptionGet">
<Description>
Return the caption, or the translation if it's defined.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(t(i%Name)):$p(t(i%Name),"^"),1:i%Caption)
]]></Implementation>
</Method>

<Method name="CaptionStyleGet">
<Description>
Return the caption style, or the context specific one if it's defined.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"CaptionStyle")):tc(i%Name,"CaptionStyle"),1:i%CaptionStyle)
]]></Implementation>
</Method>

<Method name="CustomLookupBrokerMethodGet">
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"CustomLookupBrokerMethod")):tc(i%Name,"CustomLookupBrokerMethod"),1:i%CustomLookupBrokerMethod)
]]></Implementation>
</Method>

<Method name="CustomLookupClassNameGet">
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"CustomLookupClassName")):tc(i%Name,"CustomLookupClassName"),1:i%CustomLookupClassName)
]]></Implementation>
</Method>

<Method name="CustomLookupPropertiesGet">
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"CustomLookupProperties")):tc(i%Name,"CustomLookupProperties"),1:i%CustomLookupProperties)
]]></Implementation>
</Method>

<Method name="CustomLookupQueryNameGet">
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"CustomLookupQueryName")):tc(i%Name,"CustomLookupQueryName"),1:i%CustomLookupQueryName)
]]></Implementation>
</Method>

<Method name="DefaultValueAlwaysGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.Binary</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"DefaultValueAlways")):tc(i%Name,"DefaultValueAlways"),1:i%DefaultValueAlways)
]]></Implementation>
</Method>

<Method name="DefaultValueExpressionGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"DefaultValueExpression")):tc(i%Name,"DefaultValueExpression"),1:i%DefaultValueExpression)
]]></Implementation>
</Method>

<Method name="DescriptionGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"Description")):tc(i%Name,"Description"),1:i%Description)
]]></Implementation>
</Method>

<Method name="DisplayOnlyGet">
<Description>
Return DisplayOnly, or the context specific one if it's defined.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"DisplayOnly")):tc(i%Name,"DisplayOnly"),1:i%DisplayOnly)
]]></Implementation>
</Method>

<Method name="GetSerial">
<Description>
Public wrapper for private method</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>force:%Library.Integer=0</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[ q %this.%GetSerial()
]]></Implementation>
</Method>

<Method name="HelpUrlGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"HelpUrl")):tc(i%Name,"HelpUrl"),1:i%HelpUrl)
]]></Implementation>
</Method>

<Method name="IconProfileGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"IconProfile")):tc(i%Name,"IconProfile"),1:i%IconProfile)
]]></Implementation>
</Method>

<Method name="ImageEx">
<Description><![CDATA[
Extended image.<br>
Treat image property as an expression to be evaluated.<br>
Formats include:<br>
Literal : webemr/rb.gif<br>
Function : $s(rs.GetDataByName("Type")="S":"webemr/super.gif",1:"webemr/other.gif")<br>
ClassMethod : ##Class(web.SomeClass).GetImage(rs.GetDataByName("Type"))<br>	]]></Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; To avoid conversion issues with user defined stuff, derive...
 i $e(i%Image)="$" q ##Class(websys.Conversions).expressionEvaluate(i%Image)
 i $e(i%Image,1,2)="##" q ##Class(websys.Conversions).expressionEvaluate(i%Image)
 q i%Image
]]></Implementation>
</Method>

<Method name="InvokeMethod">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; moved from HtmlEvent
 i ..ClassMethod="" q
 ;
 n class,method,PX,j,k,x,mon
 ;
 s x=""
 s class=$p(..ClassMethod,",",1)
 s method=$p(..ClassMethod,",",2)
 ;
 ; we can only practically save it (nowhere to display it)
 i $g(%session.Data("LOGON.PPMCAPTURE")) s mon=##Class(websys.Monitor).%New(class_":"_method)
 ;
 ; for non class methods we need to instantiate to get the oref
 ; thereore for now this will only work with class methods
 s oref=""
 ;
 s $zt="ztrapinvoke"
 f j=0:1 s p=$p(..ClassMethod,",",j+3) q:p=""  s PX(j+1)=##Class(websys.Conversions).QuotedCacheString(##Class(websys.Conversions).expressionEvaluate(p))
 ;
 ; Is there another way, is there a better way ? - yes build up a string and execute it
 ;
 ; put in the class and method explicitly to make the error mesage more meaningful
 ;s x="d InvokeMethod^%apiOBJ("""_class_""","""","""_method_""""
 s x="d $zobjclassmethod("""_class_""","""_method_""""
 ; put in the params explicitly to make the error message more meaningful
 f k=1:1:j s x=x_","""_PX(k)_""""
 s x=x_")"
 x x
 ;;
 i $g(%session.Data("LOGON.PPMCAPTURE")) d mon.Freeze(),mon.%Save(),mon.%Close()

 q
ztrapinvoke ;
 s e=$ze
 i $d(msg) d msg.AddItem("E","XINVOKE",e,..ParRef.%Id(),"")
 q
]]></Implementation>
</Method>

<Method name="LinkUrlSet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>val:%Library.String</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.Status</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i $zcvt(val,"L")[".csp" { //if its' a link to a csp page, store it as lowercase
 s i%LinkUrl=$zcvt(val,"L")
 } else {
 s i%LinkUrl=val
 }
]]></Implementation>
</Method>

<Method name="LinkWorkFlowDescriptionGet">
<Description>
Return the workflow Description</Description>
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
	i ..LinkWorkFlow'="" {
		q $lg(##Class(websys.WorkFlow).GetCodeDescriptionFromId(..LinkWorkFlow),1)
	} else {
		q ""
	}
]]></Implementation>
</Method>

<Method name="LinkWorkFlowDescriptionSet">
<CodeMode>code</CodeMode>
<FormalSpec>val:%String</FormalSpec>
<ReturnType>%Library.Status</ReturnType>
<Implementation><![CDATA[
	i val'="" {
		s i%LinkWorkFlow=##Class(websys.WorkFlow).GetIdFromCodeOrDescription(val)
	} else {
		s i%LinkWorkFlow=""
	}
	q $$$OK
]]></Implementation>
</Method>

<Method name="LinkWorkFlowGet">
<Description>
Return the workflow, or the context specific one if it's defined.</Description>
<CodeMode>code</CodeMode>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"LinkWorkFlow")):tc(i%Name,"LinkWorkFlow"),1:i%LinkWorkFlow)
]]></Implementation>
</Method>

<Method name="ListCellStyleEx">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; To avoid conversion issues with user defined stuff, derive...
 i $e(i%ListCellStyle)="$" q ##Class(websys.Conversions).expressionEvaluate(i%ListCellStyle)
 i $e(i%ListCellStyle,1,2)="##" q ##Class(websys.Conversions).expressionEvaluate(i%ListCellStyle)
 q i%ListCellStyle
]]></Implementation>
</Method>

<Method name="LookupBrokerList">
<Description>
general broker for LookupList query.
accepts same parameters as LookupList and returns the same data
differs from LookupListBroker which is used by LookupUserDefined items</Description>
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>itmjs:%Library.String="",itmjsex:%Library.String="",list:%Library.String="",val:%Library.String=""</FormalSpec>
<ReturnType>%Library.Boolean</ReturnType>
<Implementation><![CDATA[
 n ulist,uval,ok,retval
 s ulist=$zcvt(list,"U"),ulist=$tr(ulist," ","")
 s uval=$zcvt(val,"U"),uval=$tr(uval," ","")
 ;
 s ok=0 f j=1:1:$l(ulist,"^") i $p(ulist,"^",j)=uval s ok=1,val=$p(list,"^",j) q

 i ok d  q 1
 . s retval=itmjs_"('"_$ZCVT(val,"O","JS")_"');"
 . i itmjsex'="""" s retval=retval_itmjsex_"('"_$ZCVT(val,"O","JS")_"');"
 . &javascript<#(retval)#>
 ;
 q 0
]]></Implementation>
</Method>

<Method name="LookupListBroker">
<Final>0</Final>
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>itmjs:%Library.String="",itmjsex:%Library.String="",val:%Library.String="",list:%Library.String=""</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.Boolean</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n ulist,uval,ok,retval
 s uval=##Class(%Collation).Upper(val)
 s ulist=##Class(%Collation).Upper(list)
 ;
 s ok=0 f j=1:1:$l(ulist,"^") i $p(ulist,"^",j)=uval s ok=1,val=$p(list,"^",j) q

 i ok d  q 1
 . s retval=itmjs_"('"_$ZCVT(val,"O","JS")_"');"
 . i itmjsex'="""" s retval=retval_itmjsex_"('"_$ZCVT(val,"O","JS")_"^"_""_"^"_$ZCVT(val,"O","JS")_"');"
 . &javascript<#(retval)#>
 ;
 q 0
]]></Implementation>
</Method>

<Method name="LookupListClose">
<Final>0</Final>
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>QHandle:%Library.Binary</FormalSpec>
<PlaceAfter>LookupListFetch</PlaceAfter>
<Private>0</Private>
<ReturnType>%Library.Status</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; Retrieve the current status
 n user,work
 ;
 s AtEnd=$li(QHandle,1)
 s user=$li(QHandle,2)
 s work=$li(QHandle,3)
 ;
 s QHandle=""
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="LookupListExecute">
<Final>0</Final>
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec><![CDATA[&QHandle:%Library.Binary,list:%Library.String,val:%Library.String=""]]></FormalSpec>
<Private>0</Private>
<ReturnType>%Library.Status</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n user,work
 s user=$lb(list,$zcvt(val,"U"))
 s work=$lb(0)
 ;
 s QHandle=$lb(0,user,work)
 ; 
 QUIT $$$OK
]]></Implementation>
</Method>

<Method name="LookupListFetch">
<Final>0</Final>
<ClassMethod>1</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec><![CDATA[&QHandle:%Library.Binary,&Row:%Library.List,&AtEnd:%Library.Integer=0]]></FormalSpec>
<PlaceAfter>LookupListExecute</PlaceAfter>
<Private>0</Private>
<ReturnType>%Library.Status</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; Retrieve the current status
 n user,work,list,cnt,val,found
 ;
 s AtEnd=$li(QHandle,1)
 s user=$li(QHandle,2)
 s work=$li(QHandle,3)
 ;
 s list=$lg(user,1)
 s val=$lg(user,2)
 s cnt=$lg(work,1)+1
 ;
 i cnt>$l(list,"^") s AtEnd=1
 s Row=""
 s found=0
 while ('AtEnd)&('found) {
	i cnt>$l(list,"^") s AtEnd=1 q
	if (val'=""),$e($zcvt($p(list,"^",cnt),"U"),1,$l(val))=val s found=1 q
	if (val="")&($p(list,"^",cnt)'="") s found=1 q
	s cnt = cnt + 1
 }
 i 'AtEnd s Row=$lb($p(list,"^",cnt))
 ;
 s work=$lb(cnt)
 s QHandle=$lb(AtEnd,user,work)
 Quit $$$OK
]]></Implementation>
</Method>

<Method name="LookupUserDefinedValuesGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"LookupUserDefinedValues")):tc(i%Name,"LookupUserDefinedValues"),1:i%LookupUserDefinedValues)
]]></Implementation>
</Method>

<Method name="RequiredGet">
<Description>
Return required, or the context specific one if it's defined.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"Required")):tc(i%Name,"Required"),1:i%Required)
]]></Implementation>
</Method>

<Method name="ShortcutKeyGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"ShortcutKey")):tc(i%Name,"ShortcutKey"),1:i%ShortcutKey)
]]></Implementation>
</Method>

<Method name="Show">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>id:%String,cmp:websys.Component,disabled:%Library.Boolean</FormalSpec>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 new html,val
 ;
 set html=""
 s ..pId=id
 ;
 ; If the component has been set to disabled then override all items (?hidden)
 ; (keep hidden items active - for passing params around)
 i '..Hidden,cmp.Disabled s ..Disabled=1
 ;
 ;w "<HR>",..ValueGet,"<HR>"
 d ..ValueGetExecute(..ValueGet)
 i ..DisplayType="TA",..DisplayOnly s ..pValue=$g(val) i 1
 ; For foreign lang - go back to HtmlFriendly
 e  s ..pValue=##Class(%CSP.Page).EscapeHTML($g(val))
 ;e  s ..pValue=##Class(websys.Conversions).HtmlFriendly($g(val))
 s ..pComponent=cmp
 ;
 ;//Don't believe this is used any more since websys.ComponentXRef was introduced
 ;//and it always cause problems on import !
 ;s html=$case(..DisplayType,
 ;"T":	..ShowTextbox(),
 ;"C":	..ShowTextbox(),
 ;"TA":	..ShowTextArea(),
 ;"L":	..ShowListbox(),
 ;"A":	..ShowAnchor(),
 ;"B":	..ShowButton(),
 ;"CX":	..ShowNestedComponentStub(),
 ;:"")
 ;
 s ..pComponent=""
 quit html
]]></Implementation>
</Method>

<Method name="ShowAnchor">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,p
 n txt,url,url2,tpagid,TWKFL,TWKFLI
 n imageex
 ;
 ;
 s imageex=..ImageEx()
 i ..LinkUrl="NONE",imageex'="" q "<img SRC=""../images/"_imageex_""" BORDER=""0"">"_$c(13,10)
 i ..LinkUrl="NONE" q ""
 ;i 'islink,imageex="" q ""
 ;
 ;
 s TWKFL=%request.Get("TWKFL")
 s TWKFLI=%request.Get("TWKFLI")
 ;
 s tpagid=$$$tpagid
 s (url,url2)="websys.csp"
 s url=url_"?TFORM="_"FRED"_"&TEVENT="_$p(..pId,"z",1)_"&TNAVMARK="_$g(TNAVMARK)_"&TPAGID="_tpagid_$s(TWKFL'="":"&TWKFL="_TWKFL,1:"")_$s(TWKFLI'="":"&TWKFLI="_TWKFLI,1:"")_..LinkExpressionEvaluate(..LinkExpression)
 ;If show in new window don't include workflow info...
 s url2=url2_"?TFORM="_"FRED"_"&TEVENT="_$p(..pId,"z",1)_"&TNAVMARK="_$g(TNAVMARK)_"&TPAGID="_tpagid_..LinkExpressionEvaluate(..LinkExpression)
 ;
 if url="" s html="<A HREF=""#""  d="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_"" i 1
 e  i ..ShowInNewWindow'="" s html="<A id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" HREF=""#"" onClick=""websys_lu('"_url2_"',false,'"_..ShowInNewWindow_"');""" i 1
 e  i ..ShowInNewWindow="" s html="<A id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" HREF="""_url_""""
 ;
 ;i ..ShowInNewWindow s html="<A HREF=""#"" id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" onClick=""lookupwinShow('"_url_"',0);"""
 ;i '..ShowInNewWindow s html="<A HREF="""_url_""" id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)
 ;
 ;s html=html_" title="_..Name
 i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 i ..TooltipEx()'="" s html=html_" title="""_..TooltipEx()_""""
 ;
 ;i ..AccessKey'="" s html=html_" accesskey="_..AccessKey
 s:'..Style'="" html=html_" style="""_..Style_""""
 s html=html_">"_$c(13,10)
 ;
 i imageex'="" s html=html_"<img SRC=""../images/"_imageex_""" BORDER=""0"">"_$c(13,10)
 ;
 ; Show the translated caption else the default caption
 ; In a list show the description, else show the (translated) caption.
 ;;if ..pComponent.DisplayType="L" {
 ;;s txt=..pValue ;$s(..pValue'="":..pValue,1:"&nbsp;") ; avoid _ in blank links
 ;;} else {
 ;;s txt=..Caption
 ;;}
 s txt=..Caption
 if $e(..pId,1)="t" s txt=..pValue

 i $l(..ShortcutKey) d 
 . s p=$f(##Class(%Library.Collation).Upper(txt),..ShortcutKey)
 . i p s txt=$e(txt,1,p-2)_"<U>"_$e(txt,p-1)_"</U>"_$e(txt,p,999) i 1
 . e  s txt=txt_" ("_..ShortcutKey_")"
 ;i $l(txt,..AccessKey) s txt=$p(txt,..AccessKey,1)_"<U>"_..AccessKey_"</U>"_$p(txt,..AccessKey,2,999)
 //convert double quotes to single...
 s html=html_$tr(txt,"""","'")
 s html=html_"</A>"_$c(13,10)
 q html
]]></Implementation>
</Method>

<Method name="ShowButton">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,txt
 ;
 s html="<A HREF=""#"" id="_$p(..pId,"i",2,99)
 s html=html_" name="_$p(..pId,"i",2,99)
 ;i ..AccessKey'="" w " accesskey=",..AccessKey
 i '..Style'="" s html=html_" style="""_..Style_""""
 i '..TooltipEx()'="" s html=html_" title="""_..TooltipEx()_""""
 i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 s html=html_">"_$c(13,10)
 i ..ImageEx()'="" s html=html_"<img SRC=""../images/"_..ImageEx()_""" BORDER=""0"">"_$c(13,10)
 ;
 ; Show the translated caption else the default caption
 s txt="" i ..Caption'="" s txt=..Caption,txt=..Underline(txt,..ShortcutKey)
 ;i $l(..ShortcutKey) d 
 ;. s p=$f(##Class(%Library.Collation).Upper(txt),..ShortcutKey)
 ;. i p s txt=$e(txt,1,p-2)_"<U>"_$e(txt,p-1)_"</U>"_$e(txt,p,999) i 1
 ;. e  s txt=txt_" ("_..ShortcutKey_")"
 s html=html_txt
 s html=html_"</A>"_$c(13,10)
 ;
 q html
]]></Implementation>
</Method>

<Method name="ShowCaption">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>inheader:%String=""</FormalSpec>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,caption,cls,sckey
 ;
 s html=""
 i 'inheader,"B,A"[..DisplayType q "&nbsp;"
 i inheader,"B"[..DisplayType q "&nbsp;"
 ;
 ; Show the translated caption else the default caption
 i '..Hidden d
 . s caption=..Underline($tr(..Caption,"""","'"),..ShortcutKey)
 . s html=$s(caption="":"&nbsp;",1:caption)
 ;
 s cls="" i ..Required s cls=" CLASS=""clsRequired"""
 i 'inheader s html="<LABEL id=c"_..Name_" "_cls_$s(..CaptionStyle'="":" Style="""_..CaptionStyle_"""",1:"")_">"_html_"</LABEL>"
 q html
]]></Implementation>
</Method>

<Method name="ShowLayout">
<Description>
Generate HTML for layout manager</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>id:%String</FormalSpec>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 new html,desc,xref
 ;
 set html=""
 set desc=..Caption
 if desc="" set desc="["_..Name_"]"
 ;&html<<%=..Name%>>
 ;
 s cls="COMPONENTITEM"
 i ..Required s cls="COMPONENTITEMR"
 i ..Hidden s cls="COMPONENTITEMH"
 i ..DisplayOnly s cls="COMPONENTITEMD"
 ;
 i ..Hidden s ..Style="BACKGROUND-COLOR: #cccccc"
 ;
 i ..DisplayType="T" d  ; Textbox
 . s html=html_"<INPUT disabled CLASS="_cls_" id="""_id_""" name="""_id_""" value="""_$tr(desc,"""","'")_""" accesskey="""_..ShortcutKey_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" tlud="""_$zcvt(..LookupUserDefined,"O","HTML")_""" tvaluelist="""_$zcvt(..LookupUserDefinedValues,"O","HTML")_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"
 ;
 i ..DisplayType="L" d  ; Listbox (select box)
 . s html=html_"<SELECT disabled CLASS="_cls_" id="""_id_""" size=2 name="""_id_""" accesskey="""_..ShortcutKey_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_"""> <OPTION>"_$tr(desc,"""","'")_"</OPTION><OPTION>2</OPTION><OPTION>3</OPTION></SELECT>"
 ;
 i ..DisplayType="C" d  ; Checkbox
 . s html=html_"<INPUT disabled CLASS="_cls_" id="""_id_""" type=checkbox value="""_$tr(desc,"""","'")_""" name="""_id_""" accesskey="""_..ShortcutKey_"""  tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"
 ;
 i ..DisplayType="TA" d  ; Text Area
 . s html=html_"<TEXTAREA disabled CLASS="_cls_" id="""_id_""" name="""_id_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"_$tr(desc,"""","'")_"</TEXTAREA>"
 ;
 ; Show as a button - easy for drag/drop	
 i ..DisplayType="A" d  ; Anchor
 . s html=html_"<input TYPE=button CLASS="_cls_" HREF=""#"" id="""_id_""" name="""_id_""" value="""_$tr(desc,"""","'")_""" accesskey="""_..ShortcutKey_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" lwfl=""1"" linkworkflow="""_$zcvt(..LinkWorkFlow,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"
 ;
 i ..DisplayType="B" d  ; Button
 . s html=html_"<input TYPE=button CLASS="_cls_" HREF=""#"" id="""_id_""" name="""_id_"""  value="""_$tr(desc,"""","'")_""" accesskey="""_..ShortcutKey_""" lwfl=""1"" linkworkflow="""_$zcvt(..LinkWorkFlow,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"
 ;
 i ..DisplayType="IP" d  ; Icon Profile
 . ; this is not a proper oref - hence the swings and roundabouts
 . s ipdesc="" i ..IconProfile d
 . . s xref=##Class(epr.CTIconProfile).%OpenId(..IconProfile,0)
 . . i xref s ipdesc=xref.Description d xref.%Close()
 . s html=html_"<INPUT disabled CLASS=COMPONENTITEMIP id="""_id_""" name="""_id_""" value="""_$tr(desc,"""","'")_""" tabIndex="""_..TabSequence_""" ticonprofile="""_ipdesc_""">"
 ;
 i ..DisplayType="S" d  ; Custom
 . s html=html_"<input TYPE=button CLASS="_cls_" HREF=""#"" id="""_id_""" name="""_id_"""  value="""_$tr(desc,"""","'")_""" style="""_..Style_""">"
 ;
 i ..DisplayType="R" d  ; RTF - show as Text Area
 . s html=html_"<TEXTAREA disabled CLASS="_cls_" id="""_id_""" name="""_id_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_"""  tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"_$tr(desc,"""","'")_"</TEXTAREA>"
 ; 
 i ..DisplayType="CT" d  ; Custom Textbox
 . s html=html_"<INPUT disabled CLASS="_cls_" id="""_id_""" name="""_id_""" value="""_$tr(desc,"""","'")_""" accesskey="""_..ShortcutKey_""" tdefaultvalue="""_$zcvt(..DefaultValueExpression,"O","HTML")_""" tdefaultalways="""_$zcvt(..DefaultValueAlways,"O","HTML")_""" tabIndex="""_..TabSequence_""" style="""_..Style_""" clu=""1"" clucls="""_$zcvt(..CustomLookupClassName,"O","HTML")_""" cluqry="""_$zcvt(..CustomLookupQueryName,"O","HTML")_""" cluprp="""_$zcvt(..CustomLookupProperties,"O","HTML")_""" clubrk="""_$zcvt(..CustomLookupBrokerMethod,"O","HTML")_"""tvaluelist="""_$zcvt(..LookupUserDefinedValues,"O","HTML")_""" title="""_$zcvt(..Tooltip,"O","HTML")_""">"

 quit html
]]></Implementation>
</Method>

<Method name="ShowLayoutCaption">
<Description>
Genrate HTML for layout manager</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>id:%Library.String,inheader:%Library.String=""</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,caption,cls,dis
 ;
 s html=""
 ;i 'inheader,"B,A"[..DisplayType q "&nbsp;"
 ;i inheader,"B"[..DisplayType q "&nbsp;"
 ;
 ; Show the translated caption else the default caption
 ;i '..Hidden s caption=$s($d(t(..Name)):t(..Name),1:..Caption),html=$s(caption="":"&nbsp;",1:caption)
 ;
 ;s cls="" i ..Required s cls=" CLASS=""clsRequired"""
 ;i 'inheader s html="<LABEL CLASS=COMPONENTITEM id="_id_">"_html_"</LABEL>"
 ; Show as a button for easy drag/drop
 ;
 s cls="COMPONENTITEM"
 i ..Required s cls="COMPONENTITEMR"
 i ..Hidden s cls="COMPONENTITEMH"
 i ..DisplayOnly s cls="COMPONENTITEMD"
 s dis="" i inheader,..Hidden s dis=" disabled"
 s html="<input TYPE=button CLASS="_cls_dis_" HREF=""#"" id="""_id_""" name="""_id_""" value="""_$tr(..Caption,"""","'")_""" style="""_..CaptionStyle_""">"
 q html
]]></Implementation>
</Method>

<Method name="ShowLayoutDescription">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>id:%Library.String</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,caption,cls,dis
 ;
 s html=""
 s cls="COMPONENTITEMDESC"
 ;s html="<input TYPE=button CLASS="_cls_" HREF=""#"" id="""_id_""" name="""_id_""" value="""_..Description_""">"
 s html="<span CLASS="_cls_" id="""_id_""" name="""_id_""" >"_..Description_"</span>"

 q html
]]></Implementation>
</Method>

<Method name="ShowListbox">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n db,html
 s db=(..LookupClassName'="")&(..LookupQueryName'="")
 ; 
 ;i ..LookupClassName="" q
 ;i ..LookupQueryName="" q
 ;
 n rs,code,desc,PX,params,style,value
 i db s rs=##Class(%Library.ResultSet).%New(..LookupClassName_"."_..LookupQueryName)
 ;
 s value=","_..pValue_","
 ;
 i db,rs d
 . s params=rs.GetParamCount()
 . f j=1:1:params s PX(j)="" i $p(..LookupProperties,",",j)'="" s PX(j)=##Class(websys.Conversions).expressionEvaluate($p(..LookupProperties,",",j))
 . ; Is there another way ? Is There a better way
 . d:params=0 rs.Execute()
 . d:params=1 rs.Execute(PX(1))
 . d:params=2 rs.Execute(PX(1),PX(2))
 . d:params=3 rs.Execute(PX(1),PX(2),PX(3))
 . d:params=4 rs.Execute(PX(1),PX(2),PX(3),PX(4))
 . d:params=5 rs.Execute(PX(1),PX(2),PX(3),PX(4),PX(5))
 . d:params=6 rs.Execute(PX(1),PX(2),PX(3),PX(4),PX(5),PX(6))
 . d:params=7 rs.Execute(PX(1),PX(2),PX(3),PX(4),PX(5),PX(6),PX(7))
 . d:params=8 rs.Execute(PX(1),PX(2),PX(3),PX(4),PX(5),PX(6),PX(7),PX(8))
 . s code=1,desc=2
 . i rs.GetColumnCount()<2 s desc=1
 . ;
 . ; Column 1 of the query is used for Value, Column 2 for description (if there is more than one col)
 . ; 
 ;
 ; While this does have a title property it does seem to get ignored by IE5.5
 s html="<SELECT "_$s(..Disabled:"disabled ",1:"")_"id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" multiple size=5"
 i ..Style'="" s html=html_" style="""_..Style_""""
 i ..TooltipEx()'="" s html=html_" title="""_..TooltipEx()_""""
 i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 i ..ShortcutKey'="" s html=html_" accesskey="""_..ShortcutKey_""""
 s html=html_">"
 ;
 i db f  q:'rs.Next()  d
 . s html=html_"<OPTION "_$s(value[rs.GetData(code):"selected ",1:"")_" value="_rs.GetData(code)_">"_rs.GetData(desc)_"</OPTION>"
 . ;
 s html=html_"</SELECT>"
 ;
 i db,rs d rs.%Close()
 q html
]]></Implementation>
</Method>

<Method name="ShowNestedComponentBody">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>isnested:%Library.String=""</FormalSpec>
<Private>0</Private>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n x
 ; Evaluate the nested component transition expression
 d ##Class(websys.Conversions).expressionExecute(..NestedTransExpr)
 ;
 i ..NestedComponent d ..NestedComponent.Show(isnested+1)
 q
]]></Implementation>
</Method>

<Method name="ShowNestedComponentStub">
<Description>
Show a nested component - e.g. tree structure in a list</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ;s html="<A HREF=""#"" onclick=""websys_component(this,'r"_$e(..pId,2,999)_"');"">+</A>"
 n img
 s img=..ImageEx()
 i img="" s img="../images/websys/plus.gif"
 ;s html="<A HREF=""#"" onclick=""websys_component(this,'r"_$e(..pId,2,999)_"');""><IMG SRC="""_img_""" border=""0""></A>"
 s html="<IMG onclick=""websys_component(this,'r"_$e(..pId,2,999)_"');return false;"" SRC="""_img_""" border=""0"">"
 q html
]]></Implementation>
</Method>

<Method name="ShowTextArea">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html
 ;
 I ..DisplayOnly d  q html
 . s html=$s(..pValue'="":..pValue,1:"&nbsp;")
 ;
 s html="<TEXTAREA "_$s(..Disabled:"disabled ",1:"")_"CLASS=COMPONENTITEM id="""_$p(..pId,"i",2,99)_""" name="""_$p(..pId,"i",2,99)_""""
 i ..LookupClassName'="",..LookupBrokerMethod'="",'..Disabled d
 . ; encrypted method name uses the sessionid as part of the key - therefore do at runtime
 . s encmeth=##Class(%CSP.Page).EscapeURL(##Class(%CSP.Page).Encrypt(..LookupClassName_"."_..LookupBrokerMethod))
 . s html=html_" onkeydown="""_..Name_"_keydownhandler('"_encmeth_"');"""
 i ..Style'="" s html=html_" style="""_..Style_""""
 i ..TooltipEx()'="" s html=html_" title="""_..TooltipEx()_""""
 i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 i ..ShortcutKey'="" s html=html_" accesskey="""_..ShortcutKey_""""
 s html=html_">"_..pValue_"</TEXTAREA>"
 q html
]]></Implementation>
</Method>

<Method name="ShowTextbox">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 n html,tooltop,encmeth,checkbox
 ;
 s checkbox=##Class(%Collation).Upper(..DataType)["BOOLEAN"
 ;
 s tooltip=..TooltipEx()
 ;s html=html_"<INPUT CLASS=COMPONENTITEM id="""_id_""" name="""_id_""" value=""{"_..Name_"}"" type=text style=""WIDTH: 75px; HEIGHT: 94px"" size=75>"
 ;q html
 ;
 ; Only have a link for plain text ?
 I ..DisplayOnly,'checkbox d  q html
 . s cls="" i ..Required s cls=" CLASS=""clsRequired"""
 . s html="<LABEL id="_$p(..pId,"i",2,99) ;
 . s html=html_" name="_$p(..pId,"i",2,99)_cls_$s(..Style'="":" Style="""_..Style_"""",1:"")_">" ;..pId
 . s html=html_$s(..pValue'="":..pValue,1:"&nbsp;")
 . s html=html_"</LABEL>"
 . i ..LinkUrl="" q
 . n url
 . ;s %guid=$$NEWTOK^%wldutc(30,%sessid,%Page,"websys",%cacheno)
 . ;s url=$G(%KEY("MGWLIB"))_"?MGWLPN="_MGWLPN_"&wlapp="_%App_"&guid="_%guid
 . s url="websys.CSP"
 . s url=url_"?TFORM="_"FRED"_"&TEVENT="_$p(..pId,"i",2,99)_"&TNAVMARK="_$g(TNAVMARK)_"&TWKFL="_%request.Get("TWKFL")_"&TWKFLI="_%request.Get("TWKFLI")_..LinkExpressionEvaluate(..LinkExpression)
 . ;
 . ; There is some bug here for show in new window
 . ;i ..ShowInNewWindow'="" s html="<A id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" HREF=""#"" onClick=""websys_lu('"_url_"',false,'"_..ShowInNewWindow_"');"""_$s(tooltip'="":" title="""_tooltip_"""",1:"")_">"_html_"</A>"_$c(13,10)
 . i ..ShowInNewWindow'="" s html="<A id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" HREF=""#"" onClick=""websys_lu('"_url_"',false,'"_..ShowInNewWindow_"');"""_$s(tooltip'="":" title="""_tooltip_"""",1:"")_">"_html_"</A>"_$c(13,10)
 . i ..ShowInNewWindow="" s html="<A id="_$p(..pId,"i",2,99)_" name="_$p(..pId,"i",2,99)_" HREF="""_url_""">"_html_"</A>"_$c(13,10)
 . ;i ..ShowInNewWindow s html="<A HREF=""#"" onClick=""lookupwinShow('"_url_"',0);"">"_html_"</A>"_$c(13,10)
 . ;i '..ShowInNewWindow s html="<A HREF="""_url_""">"_html_"</A>"_$c(13,10)
 ;
 ;i ##Class(%Collation).Upper(..DataType)["BOOLEAN" d  q html
 i checkbox d  q html
 . s html="<INPUT "_$s(..Disabled:"disabled ",1:"")_"id="_$p(..pId,"i",2,99)
 . s html=html_" name="_$p(..pId,"i",2,99)
 . i ..Hidden s html=html_" type=""hidden"""
 . i ..Required s html=html_" CLASS=""clsRequired"""
 . s html=html_$s(..pValue="1":" CHECKED",..pValue="on":" CHECKED",..pValue="Y":" CHECKED",..pValue="YD":" CHECKED DISABLED",..pValue="D":" DISABLED",1:"")
 . i ..Style'="" s html=html_" style="""_..Style_""""
 . i tooltip'="" s html=html_" title="""_tooltip_""""
 . i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 . i ..ShortcutKey'="" s html=html_" accesskey="""_..ShortcutKey_""""
 . s html=html_" type=""checkbox"">" ;_$c(13,10)
 ;
 i ..DisplayType="C" d  q html
 . s html="<INPUT "_$s(..Disabled:"disabled ",1:"")_"id="_$p(..pId,"i",2,99)
 . s html=html_" name="_$p(..pId,"i",2,99)
 . i ..Hidden s html=html_" type=""hidden"""
 . i ..Required s html=html_" CLASS=""clsRequired"""
 . s html=html_$s(..pValue="1":" CHECKED",..pValue="on":" CHECKED",..pValue="Y":" CHECKED",..pValue="YD":" CHECKED DISABLED",..pValue="D":" DISABLED",1:"")
 . i ..Style'="" s html=html_" style="""_..Style_""""
 . i tooltip'="" s html=html_" title="""_tooltip_""""
 . i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 . i ..ShortcutKey'="" s html=html_" accesskey="""_..ShortcutKey_""""
 . s html=html_" type=""checkbox"">" ;_$c(13,10)
 ;
 n putindiv
 s putindiv=0,html=""
 ; Bit of a hack - for absolute positioning and lookups, keep the icon and the text box together by putting them both in a div !
 i ..Style["absolute",..LookupClassName'="" s putindiv=1
 ;
 i putindiv s html="<div nowrap" s:..Style'="" html=html_" style="""_..Style_"""" s html=html_">"
 s html=html_"<input "_$s(..Disabled:"disabled ",1:"")_"id="_$p(..pId,"i",2,99)
 s html=html_" name="_$p(..pId,"i",2,99)
 ; In theory we should only get one of these...
 i ..Hidden s html=html_" type=""hidden"""
 i ..Password s html=html_" type=""password"""
 i ..AttachedFile s html=html_" type=""file"""
 i ..Required s html=html_" CLASS=""clsRequired"""
 s html=html_" value="""_..pValue_""""
 ;w:..Length " size=""",..Length,""""
 ; Put the style in the div
 i 'putindiv i '..Hidden,..Style'="" s html=html_" style="""_..Style_""""
 i '..Hidden d
 . i tooltip'="" s html=html_" title="""_tooltip_""""
 . i +..TabSequence'="" s html=html_" tabIndex="""_+..TabSequence_""""
 . i ..ShortcutKey'="" s html=html_" accesskey="""_..ShortcutKey_""""
 ;SP NS6;i ..LookupClassName'="",..LookupQueryName'="" d
 ;SP NS6;. s html=html_" onkeydown="""_..Name_"_lookuphandler(1);"""
 i ..LookupClassName'="",..LookupBrokerMethod'="",'..Disabled d
 . ; encrypted method name uses the sessionid as part of the key - therefore do at runtime
 . s encmeth=##Class(%CSP.Page).EscapeURL(##Class(%CSP.Page).Encrypt(..LookupClassName_"."_..LookupBrokerMethod))
 . s html=html_" onchange="""_..Name_"_changehandler('"_encmeth_"');"""
 s html=html_">" ;_$c(13,10)
 ; If its a query lookup up or a list lookup
 i ..LookupClassName'="",..LookupQueryName'="",'..Disabled d
 . s html=html_"<IMG id=l"_..pId_" src=""../images/websys/lookup.gif"" >"_$c(13,10)
 . ;SP NS6;s html=html_"<IMG id=l"_..pId_" src="""_$G(TIMAGES)_"websys/lookup.gif"" onclick="""_..Name_"_lookuphandler(0);"">"_$c(13,10)
 i putindiv s html=html_"</div>" ;_$c(13,10)
 q html
]]></Implementation>
</Method>

<Method name="StyleGet">
<Description>
Return the caption style, or the context specific one if it's defined.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"Style")):tc(i%Name,"Style"),1:i%Style)
]]></Implementation>
</Method>

<Method name="TabSequenceGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"TabSequence")):tc(i%Name,"TabSequence"),1:i%TabSequence)
]]></Implementation>
</Method>

<Method name="TooltipEx">
<Description>
As for ImageEx()</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 ; To avoid conversion issues with user defined stuff, derive...
 n tooltip
 s tooltip=..TooltipGet()
 i $e(tooltip)="$" q ##Class(websys.Conversions).expressionEvaluate(tooltip)
 i $e(tooltip,1,2)="##" q ##Class(websys.Conversions).expressionEvaluate(tooltip)
 q tooltip
 ;i $e(i%Tooltip)="$" q ##Class(websys.Conversions).expressionEvaluate(i%Tooltip)
 ;i $e(i%Tooltip,1,2)="##" q ##Class(websys.Conversions).expressionEvaluate(i%Tooltip)
 ;q i%Tooltip
]]></Implementation>
</Method>

<Method name="TooltipGet">
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec/>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i i%Name="" q ""
 q $s($d(tc(i%Name,"Tooltip")):tc(i%Name,"Tooltip"),1:i%Tooltip)
]]></Implementation>
</Method>

<Method name="Underline">
<Description>
Substitute underline character if there is a shortcut key.</Description>
<Final>0</Final>
<ClassMethod>0</ClassMethod>
<CodeMode>code</CodeMode>
<FormalSpec>text:%Library.String,char:%Library.String</FormalSpec>
<Private>0</Private>
<ReturnType>%Library.String</ReturnType>
<SqlProc>0</SqlProc>
<Implementation><![CDATA[
 i text="" q ""
 i char="" q text
 ;
 n pos
 s pos=$f($ZCVT(text,"U"),$ZCVT(char,"U"))
 i 'pos q text_"(<u>"_char_"</u>)"
 q $e(text,1,pos-2)_"<u>"_$e(text,pos-1)_"</u>"_$e(text,pos,99999)
]]></Implementation>
</Method>

<Method name="XXXLookup">
<CodeMode>code</CodeMode>
<FormalSpec>PageCnt:%String</FormalSpec>
<Implementation><![CDATA[
 i ..LookupClassName="" q
 i ..LookupQueryName="" q
 ;
 #class %ResultSet rs
 n rs,j,jj,col1js,colalljs,rowcount,isnextpage,x
 ;
 s rs=##Class(%Library.ResultSet).%New(..LookupClassName_":"_..LookupQueryName)
 ;
 ; ~~
 i '##Class(websys.Conversions).IsValidResultSet(rs) d  q
 . w !,"Class or lookup query not found: "_..LookupClassName_":"_..LookupQueryName d %response.Flush()
 ;
 s x="i $$InvokeMethod^%apiOBJ(""%ResultSet"",rs,""Execute"""
 f j=1:1:rs.GetParamCount() s x=x_","""_$zcvt(%request.Get("P"_j),"I","URL")_""""
 s x=x_")"
 ;x x
 d ##Class(websys.Conversions).expressionExecute(x)
 ;
 i $d(e),e'="" d
 . s e=##Class(%CSP.Page).EscapeHTML(e)
 . &html<<BR><BR><STRONG><FONT Color=red><%=e%></FONT></STRONG>>
 ;
 ; Column heading have been removed to avoid translation issues.
 ; Column content is assumed to be clear from the context of the lookup
 ;&html<<TABLE style="LEFT: 0px; POSITION: absolute; TOP: 0px">>
 &html<<TABLE style="LEFT: 0px; TOP: 0px">>
 &html<<TR>>
 &html<<TD colSpan=2 valign=top>>
 ;
 &html<<TABLE id=tblLookup Name=tblLookup CELLSPACING=1>>
 ;
 ;
 ; Table body
 ;
 ; Brute force approach to pageing i.e. skip records prior to this page
 f j=1:1:PageCnt*18 q:'rs.Next()
 ;
 ; Build up strings for javascript arrays (first column, and all columns)
 ; (blank first entry for headings row) (no longer required)
 ;s col1js="var col1=new Array("""","
 ;s colalljs="var colall=new Array("""","
 s col1js="var col1=new Array("
 s colalljs="var colall=new Array("
 s rowcount=-1
 f j=1:1 q:'rs.Next()  d  q:j>18
 . n txt,fulltxt
 . s rowcount=rowcount+1
 . s txt=rs.GetData(1)
 . ;s col1js=col1js_""""_##Class(websys.Conversions).EscapeUrl(txt)_""""_","
 . s col1js=col1js_""""_$ZCVT(txt,"O","JS")_""""_","
 . ;s txt=##Class(websys.Conversions).HtmlFriendly(txt,1)
 . s txt=$ZCVT(txt,"O","HTML")
 . i ..LookupJavascriptFunction'="" d
 . . s fulltext=""
 . . f k=1:1:rs.GetColumnCount() d
 . . . s fulltext=fulltext_rs.GetData(k)_"^"
 . . ;s fulltext=##Class(websys.Conversions).EscapeUrl(fulltext)
 . . s fulltext=$ZCVT(fulltext,"O","JS")
 . . s colalljs=colalljs_""""_fulltext_""""_","
 . . ;
 . w "<TR onclick=""RowSelect(",rowcount,");"" onmousedown=""TR_OnMouseDown(",rowcount,");"">"
 . f k=1:1:rs.GetColumnCount() d
 . . s txt=rs.GetColumnName(k)
 . . i ##Class(%Library.Collation).Upper(txt)'="HIDDEN" d
 . . . ;w "<TD NOWRAP>",##Class(websys.Conversions).HtmlFriendly(rs.GetData(k)),"</TD>"
 . . . w "<TD NOWRAP>",$ZCVT(rs.GetData(k),"O","HTML"),"</TD>"
 . w "</TR>"
 w "</TABLE>"
 //Translate ME
 i rowcount=-1 w "<STRONG>No matches found</STRONG>"
 &html<</TD></TR>>
 ;
 ; Build up the url from the parameters
 &html<<TR><TD colspan=2><P>&nbsp;</P><TABLE><TR><TD width="20">>
 i PageCnt d
 . w "<img SRC=""../images/websys/pageprev.gif"" alt=""Previous Page"" BORDER=""0"" onclick=""PrevPage();"">"
 . i 1
 e  w "&nbsp;"
 &html<</TD><TD width="20">>
 s isnextpage=rs.Next()
 i isnextpage d
 . w "<img SRC=""../images/websys/pagenext.gif"" alt=""Next Page"" BORDER=""0"" onclick=""NextPage();"">"
 . i 1
 e  w "&nbsp;"
 &html<</TD></TR></TABLE></TD></TR></TABLE>>
 ;
 w "<SCRIPT>"
 ;.e.g.
 ;var col1=new Array("","one","two","three","sour","Five"); 
 ;var colall=new Array("","aone","atwo","athree","asour","aFive"); 
 ;
 i $e(col1js,$l(col1js))="," s col1js=$e(col1js,1,$l(col1js)-1)
 s col1js=col1js_");"
 w col1js,$c(13,10)
 i ..LookupJavascriptFunction'="" d
 . i $e(colalljs,$l(colalljs))="," s colalljs=$e(colalljs,1,$l(colalljs)-1)
 . s colalljs=colalljs_");"
 . w colalljs,$c(13,10)
 ;
 &html<var selectedrow=<%=$s(rowcount=0:-1,1:0)%>;>
 &html<var maxrows=<%=rowcount%>;>
 &html<var isSelected=0; >
 ;var IsFirstPage=true;
 ;var IsLastPage=true;
 i rowcount>-1 d
 . &html<RowHighlight(0);>
 ;
 &html<document.onkeydown=OnKeyDownHandler; >
 ;
 &html<function RowSelect(row) { >
 ;; 
 &html<	var par_win=window.opener; >
 &html<	par_win.<%=..Name%>_lookupsel(unescape(col1[row])); >
 i ..LookupJavascriptFunction'="" d
 . &html<	par_win.<%=..LookupJavascriptFunction%>(unescape(colall[row])); >
 &html<	isSelected=1; >
 &html<	window.close(); >
 &html<} >
 ;
 ; if there is a next page include code, else just empty function i.e. do nothing (but have dummy function)
 &html<function PrevPage() { >
 &html<	isSelected=1; >
 i PageCnt d
 . s url=..XXXpPageUrl(PageCnt-1)
 . &html<	window.location.href="<%=url%>"; >
 &html<} >
 ;
 ; if there is a next page include code, else just empty function i.e. do nothing (but have dummy function)
 &html<function NextPage() { >
 &html<	isSelected=1; >
 i isnextpage d
 . s url=..XXXpPageUrl(PageCnt+1)
 . &html<	window.location.href="<%=url%>"; >
 &html<} >
 ;
 ;if close window without selecting item, put focus back on same item
 &html<function RegainFocus() { >
 &html<	if (!isSelected) { >
 &html<		try { >
 &html<		var par_win=window.opener; >
 &html<		par_win.websys_setfocus('<%=..Name%>'); >
 &html<		} catch(e) {}; >
 &html<	} >
 &html<} >
 &html<document.body.onunload=RegainFocus; >
 w "</SCRIPT>" d %response.Flush()
 ;
 ;
 d rs.%Close()
 q
 #endclass rs
 ;
]]></Implementation>
</Method>

<Method name="XXXpPageUrl">
<CodeMode>code</CodeMode>
<FormalSpec>PageCnt:%Integer</FormalSpec>
<Private>1</Private>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 n j,url
 s url="websys.lookup.csp"
 s url=url_"?ID="_$g(%request.Data("ID",1))
 f j=1:1:rs.GetParamCount() d
 . s url=url_"&P"_j_"="_$g(%request.Data("P"_j,1))
 s url=url_"&TPAGCNT="_PageCnt
 ; Include 'find' component on sunsequent pages
 i $d(%request.Data("WEBSYS.TCOMPONENT",1)) s url=url_"&WEBSYS.TCOMPONENT="_$g(%request.Data("WEBSYS.TCOMPONENT",1))
 q url
]]></Implementation>
</Method>

<Query name="LookupList">
<Description>
Query to wrap a comma separated list. This is to simplify the logic in lookups.</Description>
<Type>%Library.Query</Type>
<FormalSpec>list:%Library.String,val:%Library.String=""</FormalSpec>
<SqlProc>0</SqlProc>
<SqlView>0</SqlView>
<Parameter name="CONTAINID" value="0"/>
<Parameter name="ROWSPEC" value="val1"/>
</Query>
</Class>
</Export>
