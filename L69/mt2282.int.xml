<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="mt2282" type="INT" languagemode="0"><![CDATA[
mt2282  ; Compiled December 23, 1999 10:04:07 for Cache for Windows
%mdiag(oper,sqlcode,class,subclass,field,cursor,%msg) ; diagnostics for sql operations
 i '$d(%mdiag) s $p(%mdiag,$c(1),2,3)="NO"_$c(1)_oper
 i ($p(%mdiag,$c(1))+1)>10 s $p(%mdiag,$c(1),2)="YES" q
 s $p(%mdiag,$c(1))=$p(%mdiag,$c(1))+1,%mdiag($p(%mdiag,$c(1)))=$g(sqlcode)_$c(1)_$g(class)_$c(1)_$g(subclass)_$c(1)_"BB_Request"_$c(1)_$g(field)_$c(1)_$g(cursor)_$c(1)_$g(%msg) q
etivalen s %irepi=0 f %irep=1:1:$g(%data(%icol)) i $d(%data(%icol,%irep)) s %irepi=%irepi+1,%data(%icol,%irepi)=%data(%icol,%irep)
 i '$g(%data(%icol))!%irepi s %data(%icol)=%irepi q
 k %data(%icol) q:'$d(%edit(%icol))
 f %irep=1:1:%edit(%icol) s %data(%icol,%irep)=%edit(%icol,%irep)
 s %data(%icol)=%edit(%icol) k %edit(%icol) q
fdv15 ; DO validation and additional validation code
 i %val'=+%val s %ok=0,%msg=$$setmsg^%qarzst("DTTimIn")
 q
fdv16 ; DO validation and additional validation code
 i %val'="Y",%val'="N" s %ok=0,%msg=$$setmsg^%qarzst("DTYesIn")
 q
fdv17 ; DO validation and additional validation code
 n nval s nval=%val d %0Vo
  i SQLCODE'=0 s %ok=0
 q
%0DAr1 n num s num=$$numint^%qarzdt(%val,1,"","",1) s:(num="")&(%val'="") %ok=0 s %val=num
 q  
%0DBs6 i %val'=+%val s %val=""
 e  s %val=$fn(%val,"")
 q
%0Vo n %mmmsqlc,%mmmsqld,%mmmsqle,%mmmsqlE,%mmmsqlf,%mmmsqll,%mmmsqlL,%mmmsqlm,%mmmsqln,%mmmsqlp,%mmmsqlr,%mmmsqlR,%mmmsqls,%mmmsqlt,%val
 s %mmmsqlE=$zt,$zt="%0Verr^"_$zn,%mmmsqlf=0 s $ze=""
 s %mmmsqld(2)=$P(nval,$C(1))
 i %mmmsqld(2)="",$L(nval)>1 s %val=$E(nval,2,999) d %0DAr1 s %mmmsqld(2)=%val
 s SQLCODE=100
   ;  init
 ; asl MOD# 2
 s $P(%mmmsqld(1),$C(1))=$g(%mmmsqld(2))
 i $P(%mmmsqld(1),$C(1))'="",$d(^CT("TE",$P(%mmmsqld(1),$C(1))))
 i '$t
 e  i 1>$P(%mmmsqld(1),$C(1)),$P(%mmmsqld(1),$C(1))=+$P(%mmmsqld(1),$C(1))
 i  g %0VBdun
 
 s %val=$P(%mmmsqld(1),$C(1)) d %0DBs6:%val'="" s $P(%mmmsqld(1),$C(1),2)=%val
 s SQLCODE=0 s:SQLCODE=0 %mmmsqlf=%mmmsqlf+1 g %0Vc
%0VBdun 
%0VAdun 
%0Vc q
%0Verr ; Non Cursor-Based Error Trap Module...
 s $zt=$g(%mmmsqlE),SQLCODE=-20603,%msg=$ze s $ze="" g %0VAdun
rowiderr s %ok=0 q
valok i %ok s $p(%data(%icol),$c(1))=%val q
 s %data(%icol)=%edit(%icol),%ok=1 k %edit(%icol) q
valokrp i %ok s $p(%data(%icol,%irep),$c(1))=%val q
 k %data(%icol,%irep) s %ok=1 q
continue ; entry point to continue all the validation code for all fields
 i $d(%edit(15)),%data(15)'=%edit(15) s %icol=15 s %val=$p(%data(15),$c(1)) i %val'="" d  g:'%ok rowiderr:'iform d valok
 . s %msg="" d fdv15 d:'%ok %mdiag(%oper,-104,"Fld Oprs","Val","RQ_GroupHoldTime","",$g(%msg))
 i $d(%edit(16)),%data(16)'=%edit(16) s %icol=16 s %val=$p(%data(16),$c(1)) i %val'="" d  g:'%ok rowiderr:'iform d valok
 . s %msg="" d fdv16 d:'%ok %mdiag(%oper,-104,"Fld Oprs","Val","RQ_Exclude","",$g(%msg))
 i $d(%edit(17)),%data(17)'=%edit(17) s %icol=17 s %val=$p(%data(17),$c(1)) i %val'="" d  g:'%ok rowiderr:'iform d valok
 . s %msg="" d fdv17 d:'%ok %mdiag(%oper,-104,"Fld Oprs","Val","RQ_TransfusionEvents_DR","",$g(%msg))
 q
fdi1 s %val=$s(%val'=+%val:"",1:$fn(%val,""))
 q
fdi15 s %val=$$timeext^%qarzdt(%val,2)
 q
fdi16 s %val=$s("Yy"[$e(%val):"Yes","Nn"[$e(%val):"No",1:"")
 q
fdi17 i %val'=+%val s %val=""
 e  s %val=$fn(%val,"")
 q
fdi5 s %val=+$g(%val) s:%val<1 %val="" q:%val=""  s %val=$ZDATE(%val,1,-1,2)
 q
fdi6 s %val=+$g(%val) s:%val<1 %val="" q:%val=""  s %val=$ZDATE(%val,4,-1,4)
 q
intext ; entry point to do all internal to external conversion code
 i $d(%data(1)),$p(%data(1),$c(1))'="" s %val=$p(%data(1),$c(1)) d fdi1 s $p(%data(1),$c(1),2)=%val
 i $d(%data(2)),%data(2)[$c(1) s %data(2)=$s($p(%data(2),$c(1))'="":$p(%data(2),$c(1)),1:$p(%data(2),$c(1),2))
 i $d(%data(3)),%data(3)[$c(1) s %data(3)=$s($p(%data(3),$c(1))'="":$p(%data(3),$c(1)),1:$p(%data(3),$c(1),2))
 i $d(%data(4)),$p(%data(4),$c(1))'="" s %val=$p(%data(4),$c(1)) d fdi1 s $p(%data(4),$c(1),2)=%val
 i $d(%data(5)),$p(%data(5),$c(1))'="" s %val=$p(%data(5),$c(1)) d fdi5 s $p(%data(5),$c(1),2)=%val
 i $d(%data(6)),$p(%data(6),$c(1))'="" s %val=$p(%data(6),$c(1)) d fdi6 s $p(%data(6),$c(1),2)=%val
 i $d(%data(7)),%data(7)[$c(1) s %data(7)=$s($p(%data(7),$c(1))'="":$p(%data(7),$c(1)),1:$p(%data(7),$c(1),2))
 i $d(%data(8)),%data(8)[$c(1) s %data(8)=$s($p(%data(8),$c(1))'="":$p(%data(8),$c(1)),1:$p(%data(8),$c(1),2))
 i $d(%data(9)),%data(9)[$c(1) s %data(9)=$s($p(%data(9),$c(1))'="":$p(%data(9),$c(1)),1:$p(%data(9),$c(1),2))
 i $d(%data(10)),%data(10)[$c(1) s %data(10)=$s($p(%data(10),$c(1))'="":$p(%data(10),$c(1)),1:$p(%data(10),$c(1),2))
 f %irep=1:1:$g(%data(11)) i $d(%data(11,%irep)),%data(11,%irep)[$c(1) s %data(11,%irep)=$s($p(%data(11,%irep),$c(1))'="":$p(%data(11,%irep),$c(1)),1:$p(%data(11,%irep),$c(1),2))
 i $d(%data(12)),$p(%data(12),$c(1))'="" s %val=$p(%data(12),$c(1)) d fdi5 s $p(%data(12),$c(1),2)=%val
 i $d(%data(13)),%data(13)[$c(1) s %data(13)=$s($p(%data(13),$c(1))'="":$p(%data(13),$c(1)),1:$p(%data(13),$c(1),2))
 i $d(%data(14)),$p(%data(14),$c(1))'="" s %val=$p(%data(14),$c(1)) d fdi6 s $p(%data(14),$c(1),2)=%val
 i $d(%data(15)),$p(%data(15),$c(1))'="" s %val=$p(%data(15),$c(1)) d fdi15 s $p(%data(15),$c(1),2)=%val
 i $d(%data(16)),$p(%data(16),$c(1))'="" s %val=$p(%data(16),$c(1)) d fdi16 s $p(%data(16),$c(1),2)=%val
 i $d(%data(17)),$p(%data(17),$c(1))'="" s %val=$p(%data(17),$c(1)) d fdi17 s $p(%data(17),$c(1),2)=%val
 q
updatenw(%check,iform) n %i,%icol,%irep,%irepi,%oldval,%oper,%val,db s %ok=1,db=$c(1),%check=+$g(%check),iform=+$g(iform),%oper="UPDATE" k %mdiag
 d:%check'=2 extint^mt2281 g:'%ok rowiderr:'iform i %check=1 d validate^mt2281 g:'%ok rowiderr:'iform
 d:%check'=2 intext^mt2282 q:'%ok
 d comp2^mt2281 d comp7^mt2281 d comp3^mt2281 d comp4^mt2281 d comp6^mt2281 d comp8^mt2281
 q
 g ^mt2283
UPPER(val) d:'$d(%trans) %trans^%qarztrm q $tr(val,%trans(3),%trans(4))
ALPHAUP(val,remove) d:'$d(%trans) %trans^%qarztrm q:'$d(remove) $tr(val,%trans(1),%trans(2)) q $tr(val,$tr(%trans(1),remove),%trans(2))
]]></Routine>
</Export>
