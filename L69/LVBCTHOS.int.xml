<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="LVBCTHOS" type="INT" languagemode="0" generated="1"><![CDATA[
LVBCTHOS ; IG 30/4/98 ; MVB Control code access for CT_Hospital
 ;
 ; supported calls:
 ;
 ; $$select^LVBCTHOS(ROWID,skip,user)
 ; $$seldata^LVBCTHOS(ROWID,data)
 ; $$select1^LVBCTHOS(ROWID,skip,user)
 ; $$select2^LVBCTHOS(ROWID,skip,user)
 ; $$open^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetch^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetchbuffer^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetchall^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$close^LVBCTHOS()
 ; $$insert^LVBCTHOS()
 ; $$update^LVBCTHOS(ROWID)
 ; $$delete^LVBCTHOS(ROWID,Comments)
 ; $$getall^LVBCTHOS(par,user,active,site,Continue,content,strCode,nextLevel)
 ; $$getall1^LVBCTHOS(user,active,site,content,strCode,nextLevel)
 ; $$ValUser^LVBCTHOS(user,hosp)
 ; $$check^LVBCTHOS(list,user)
 ; $$unique^LVBCTHOS(code,rowid)
 ; $$expand^LVBCTHOS(code)
 ; FIX^LVBCTHOS
 ;
  ;---&SQL(DECLARE CTHOS1 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) %STARTSWITH :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) %STARTSWITH :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL) OR (CTHOS_StructuredCode is NULL))
   ;---         ORDER BY CTHOS_DisplaySequence)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode
  ;---&SQL(DECLARE CTHOS2 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) [ :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) [ :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL) OR (CTHOS_StructuredCode is NULL))
   ;---         ORDER BY CTHOS_DisplaySequence)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode
  ;---&SQL(DECLARE CTHOS3 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) %STARTSWITH :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) %STARTSWITH :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL))
   ;---         AND (CTHOS_StructuredCode  is NOT NULL)
   ;---         AND (CTHOS_StructuredCodeLength = :strCodeLength)
   ;---         ORDER BY CTHOS_StructuredCodeLength,CTHOS_StructuredCode)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode, strCodeLength
  ;---&SQL(DECLARE CTHOS4 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) [ :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) [ :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL))
   ;---         AND (CTHOS_StructuredCode  is NOT NULL)
   ;---         AND (CTHOS_StructuredCodeLength = :strCodeLength)
   ;---         ORDER BY CTHOS_StructuredCodeLength,CTHOS_StructuredCode)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode, strCodeLength
 ;
FIX k ^TTABi("RH") s a="" f  s a=$o(^TTAB("RH",a)) q:a=""  d
 .i '$$select(a,"Y") s PLIST(25)="Y",PLIST(26)=99999,err=$$update(a) i err w !,a," ",err
 d ##class(User.CTHospital).%BuildIndices()
 q
 ;
 ; insert the data
insert() d pre("N") k PLIST(1)
  ;---&SQL(insert INTO CT_Hospital VALUES :PLIST())
   ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 Do %0Mo
 i 'SQLCODE d chhos(%ROWID,1) q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ; update the data
update(ROWID) d pre("Y") s ROWID=$g(ROWID)
  ;---&SQL(UPDATE CT_Hospital VALUES :PLIST() WHERE CTHOS_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %0Oo
 i 'SQLCODE d chhos(%ROWID,1) q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ; delete the data
delete(ROWID,Comments) s ROWID=$g(ROWID),^TMP("Comments",$j)=$g(Comments)
  ;---&SQL(DELETE FROM CT_Hospital WHERE CTHOS_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: ROWID, SQLCODE
 Do %0Qo
 k ^TMP("Comments",$j)
 q SQLCODE
 ; open the cursor
open(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) 
 s code=$$ALPHAUP^SSUTIL4($g(code)),desc=$$ALPHAUP^SSUTIL4($g(desc))
 s skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i nextLevel="" d
 . ;---i '$l(content) &SQL(OPEN CTHOS1)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i '$l(content) Do %CTHOS10o
 . ;---i $l(content) &SQL(OPEN CTHOS2)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i $l(content) Do %CTHOS20o
 i nextLevel="Y" d
 .s strCodeLength=$o(^TTABi("RH-2",$l(strCode)))
 . ;---i '$l(content) &SQL(OPEN CTHOS3)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i '$l(content) Do %CTHOS30o
 . ;---i $l(content) &SQL(OPEN CTHOS4)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i $l(content) Do %CTHOS40o
 q 0
 ; fetch the data
fetch(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) k PLIST
 s code=$$ALPHAUP^SSUTIL4($g(code)),desc=$$ALPHAUP^SSUTIL4($g(desc))
 s skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 f  d  q:SQLCODE  s ValUser=$$ValUser(user,$p(PLIST(1),$c(1))) q:ValUser'=60
 .i nextLevel="" d
 .. ;---i '$l(content) &SQL(FETCH CTHOS1 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i '$l(content) Do %0Wo
 .. ;---i $l(content) &SQL(FETCH CTHOS2 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i $l(content) Do %0Xo
 .i nextLevel="Y" d
 ..s strCodeLength=$o(^TTABi("RH-2",$l(strCode)))
 .. ;---i '$l(content) &SQL(FETCH CTHOS3 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i '$l(content) Do %0Yo
 .. ;---i $l(content) &SQL(FETCH CTHOS4 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i $l(content) Do %0Zo
 S PLIST=$o(PLIST(""),-1)
 i 'SQLCODE d adjust
 q SQLCODE
 ; fetch all data
fetchbuffer(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) k ^TMP($zn,$j)
 s code=$g(code),desc=$g(desc),skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 s max=$s($g(PLIST(1)):PLIST(1),1:100) i max>100 s max=100
 f xxx=1:1:max s SQLCODE=$$fetch(code,desc,skip,user,active,site,content,strCode,nextLevel) q:SQLCODE  d
 .s cnt=$o(^TMP($zn,$j,""),-1)+1 f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 k PLIST m PLIST=^TMP($zn,$j) k ^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 q SQLCODE
fetchall(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) n (code,desc,skip,user,active,site,content,strCode,nextLevel,PLIST) k ^TMP($zn,$j)
 s code=$g(code),desc=$g(desc),skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i $$open(code,desc,skip,user,active,site,content,strCode,nextLevel)
 f cnt=1:1 q:$$fetch(code,desc,skip,user,active,site,content,strCode,nextLevel)  s ^TMP($zn,$j,cnt)="" f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 i $$close()
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ; close the cursor
close()  ;---&SQL(CLOSE CTHOS1)
  ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS10c
  ;---&SQL(CLOSE CTHOS2)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS20c
  ;---&SQL(CLOSE CTHOS3)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS30c
  ;---&SQL(CLOSE CTHOS4)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS40c
 q 0
 ; select data by code
select(ROWID,skip,user) k PLIST s ROWID=$g(ROWID),skip=$g(skip),user=$g(user)
  ;---&SQL(SELECT * INTO :PLIST() FROM CT_Hospital WHERE CTHOS_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %04o
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE s SQLCODE=$$ValUser(user,$p(PLIST(1),$c(1))) i 'SQLCODE d adjust
 q SQLCODE
 ; select data by code and field No
seldata(ROWID,data) n (ROWID,data) s ROWID=$g(ROWID),data=$g(data),result=""
 i $l(ROWID) d  q result
 .i data=3 s result=$p($g(^TTAB("RH",ROWID)),"\",1) q
 .i data=12 s result=$p($g(^TTAB("RH",ROWID)),"\",10) q
 .i data=17 s result=$p($g(^TTAB("RH",ROWID)),"\",15) q
 .i data=19 s result=$p($g(^TTAB("RH",ROWID)),"\",16) q
 .i data=22 s result=$p($g(^TTAB("RH",ROWID)),"\",20) q
 .i data=23 s result=$p($g(^TTAB("RH",ROWID)),"\",21) q
 .i data=24 s result=$p($g(^TTAB("RH",ROWID)),"\",19) q
 .i data=28 s result=$p($g(^TTAB("RH",ROWID)),"\",25) q
 .i data=30 s result=$p($g(^TTAB("RH",ROWID)),"\",27) q
 .i data=35 s result=$p($g(^TTAB("RH",ROWID)),"\",31) q
 .i data=37 s result=$p($g(^TTAB("RH",ROWID)),"\",33) q
 .i '$$select(ROWID,"Y") s result=$g(PLIST(data))
 q result
select1(ROWID,skip,user) k PLIST s ROWID=$g(ROWID),skip=$g(skip),user=$g(user)
  ;---&SQL(SELECT * INTO :PLIST() FROM CT_Hospital WHERE CTHOS_PMIHospitalCode=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %07o
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE s SQLCODE=$$ValUser(user,$p(PLIST(1),$c(1))) i 'SQLCODE d adjust
 q SQLCODE
select2(ROWID,skip,user) k PLIST s ROWID=$g(ROWID),skip=$g(skip),user=$g(user)
  ;---&SQL(SELECT * INTO :PLIST() FROM CT_Hospital WHERE CTHOS_StructuredCode=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %09o
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE s SQLCODE=$$ValUser(user,$p(PLIST(1),$c(1))) i 'SQLCODE d adjust
 q SQLCODE
 ; pre-filing adjustments
pre(xUpdate) d PreSQL^SSUTIL4("34","111")
 s (PLIST(1),PLIST(2))=$$ALPHAUP^SSUTIL4(PLIST(2))
 i '$g(PLIST(26)) s PLIST(26)=99999
 i $l($g(PLIST(13))) s PLIST(13)=$tr(PLIST(13)," ()-")
 q
 ; post-filing adjustments
adjust N plist,I,J,SQLCODE,X d PostSQL^SSUTIL4("34")
 i $g(skip)="Y" q
 i $g(PLIST(12))'="" d
 .k plist m plist=PLIST k PLIST
 .s SQLCODE=$$select^LVBCTPF(plist(12),"Y")
 .s X="" i 'SQLCODE s X=PLIST(2)_$c(1)_PLIST(3)
 .k PLIST m PLIST=plist s PLIST(12)=X k plist
 i $g(PLIST(14))'="" d
 .k plist m plist=PLIST k PLIST
 .s SQLCODE=$$select^LVBCTCR(plist(14),"Y")
 .s X="" i 'SQLCODE s X=PLIST(2)_$c(1)_PLIST(3)
 .k PLIST m PLIST=plist s PLIST(14)=X k plist
 i $g(PLIST(28))'="" d
 .k plist m plist=PLIST k PLIST
 .s SQLCODE=$$select^LVBCTCLN(plist(28),"Y")
 .s X="" i 'SQLCODE s X=PLIST(2)_$c(1)_PLIST(3)
 .k PLIST m PLIST=plist s PLIST(28)=X k plist
 i $g(PLIST(35))'="" d
 .k plist m plist=PLIST k PLIST
 .s SQLCODE=$$select^MVBSSLAN(plist(35),"Y")
 .s X="" i 'SQLCODE s X=PLIST(1)_$c(1)_PLIST(15)
 .k PLIST m PLIST=plist s PLIST(35)=X k plist
 i $g(PLIST(38))'="" d
 .k plist m plist=PLIST k PLIST
 .s start=1
 .s X="" f j=1:1:$l(plist(38)) s x=$o(^TTABi("RH-2",$l($e(plist(38),1,j)),$e(plist(38),1,j),"")) i $l(x) s X=X_$s($l(X):".",1:"")_$e(plist(38),start,j),start=$l($e(plist(38),1,j))+1
 .k PLIST m PLIST=plist s PLIST(38)=plist(38)_$c(1)_X k plist
 ;
 q
 ;
getall(par,user,active,site,Continue,content,strCode,nextLevel) n (par,user,active,site,Continue,content,strCode,nextLevel,PLIST)
 s par=$g(par),user=$g(user),active=$g(active),site=$g(site),Continue=$g(Continue),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i Continue="" k ^TMP($zn,$j) d
 .s code=$p(par,"^"),desc=$p(par,"^",2)
 .i $$open(code,desc,"Y",user,active,site,content,strCode,nextLevel)
 .f cnt=1:1 q:$$fetch(code,desc,"Y",user,active,site,content,strCode,nextLevel)  d
 ..s str="" f j=4:1:PLIST s $p(str,$c(28),j)=PLIST(j)
 ..s str=str_$c(29)_$g(ValUser)
 ..s ^TMP($zn,$j,cnt)=$p(PLIST(1),$c(1))_$c(2)_$p(PLIST(3),$c(1))_$c(2)_$p(PLIST(2),$c(1))_$c(2)_str
 .i $$close()
 k PLIST
 s (x,cnt,sum)="" f  s x=$o(^TMP($zn,$j,x)) q:x=""  q:(sum+$l(^TMP($zn,$j,x)))>15000  s cnt=cnt+1,PLIST(cnt)=^(x),sum=sum+$l(^(x)) k ^(x)
 s PLIST=$o(PLIST(""),-1)
 q $s($d(^TMP($zn,$j)):0,1:100)
getall1(user,active,site,content,strCode,nextLevel) n (user,active,site,content,strCode,nextLevel,PLIST) k ^TMP($zn,$j)
 s user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i $$open(,,"Y",user,active,site,content,strCode,nextLevel)
 s cnt=0 f  q:$$fetch(,,"Y",user,active,site,content,strCode,nextLevel)  i $d(^TRPT("WARD",$p(PLIST(1),$c(1)))) d
 .s cnt=cnt+1
 .s str="" f j=1:1:PLIST s $p(str,$c(28),j)=PLIST(j)
 .s str=str_$c(29)_$$ValUser(user,$p(PLIST(1),$c(1)))
 .s ^TMP($zn,$j,cnt)=$p(PLIST(1),$c(1))_$c(2)_$p(PLIST(3),$c(1))_$c(2)_$p(PLIST(2),$c(1))_$c(2)_str
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 i $$close()
 k ^TMP($zn,$j)
 q 0
 ; check user - Hospital
ValUser(user,code) n (user,code) s user=$g(user),code=$g(code),ok=0
 i $l(user),$l(code) d
 .s SecurityType=$$seldata^MVBSSUSR(user,10)
 .i '$l(SecurityType) s SecurityType=$$seldata^MVBCFLAB(1,66)
 .i $l(SecurityType),SecurityType'=1,$d(^TTAB("UA",user,2)) s ok=$s(SecurityType=3:60,SecurityType=2:50,1:0) i ok,$d(^TTAB("UA",user,2,code)) s ok=0
 q ok
 ; check default location for doctor
 ; flag : 1.(CTHOS) from hospital
 ;        2.(CTHOA) from hospital specialty
chhos(hos,flag,rowid) n (hos,flag,rowid) s hos=$g(hos),flag=$g(flag),rowid=$g(rowid)
 i flag=2 d
 .i '$$select(hos,"Y") d  s flag=1
 ..s spec=$p(PLIST(27),$c(1))
 ..i '$$select^LVBCTHOA(rowid,"Y") d  q
 ... ; set current specialty as default
 ...i PLIST(3)="Y" d  q
 ....s $p(^TTAB("RH",hos),"\",24)=PLIST(2),spec=PLIST(2)
 ....i $$open^LVBCTHOA(hos,"Y")
 ....f  q:$$fetch^LVBCTHOA(hos,"Y")  d
 .....f j=1:1:PLIST s PLIST(j)=$p(PLIST(j),$c(1))
 .....i PLIST(2)'=spec,PLIST(3)="Y" s ^TTAB("RH",hos,"SPECIALTY",PLIST(2))="N"
 ....i $$close^LVBCTHOA()
 ... ; find default specialty
 ...i PLIST(3)'="Y" d  q
 ....s spec=""
 ....i $$open^LVBCTHOA(hos,"Y")
 ....f  q:$$fetch^LVBCTHOA(hos,"Y")  i PLIST(3)="Y" s spec=PLIST(2) q
 ....i $$close^LVBCTHOA()
 ....s $p(^TTAB("RH",hos),"\",24)=spec
 ..i $$select^LVBCTHOA(rowid,"Y") d  q
 ...s spec=""
 ...i $$open^LVBCTHOA(hos,"Y")
 ...f  q:$$fetch^LVBCTHOA(hos,"Y")  i PLIST(3)="Y" s spec=PLIST(2) q
 ...i $$close^LVBCTHOA()
 ...s $p(^TTAB("RH",hos),"\",24)=spec
 i flag=1 d
 .i '$$select(hos,"Y") d
 ..s spec=$p(PLIST(27),$c(1))
 ..i $l(spec),'$$select^LVBCTHOA(hos_"||"_spec,"Y") s ^TTAB("RH",hos,"SPECIALTY",spec)="Y"
 ..i $$open^LVBCTHOA(hos,"Y")
 ..f  q:$$fetch^LVBCTHOA(hos,"Y")  d
 ...f j=1:1:PLIST s PLIST(j)=$p(PLIST(j),$c(1))
 ...i PLIST(2)=spec,PLIST(3)'="Y" s ^TTAB("RH",hos,"SPECIALTY",spec)="Y"
 ...i PLIST(2)'=spec,PLIST(3)="Y" s ^TTAB("RH",hos,"SPECIALTY",PLIST(2))="N"
 ..i $$close^LVBCTHOA()
 q
 ; check list of entered patient locations
check(list,user) n (list,user) s list=$g(list),user=$g(user),result=""
 f j2=1:1:$l(list,",") s (x,xx)=$p(list,",",j2) i $l(x) d
 .i xx[" " s x=$p(xx," ",2)
 .i '$$select(x,,user) s result=result_$s($l(result):",",1:"")_xx q
 .s result=result_$s($l(result):",",1:"")_"<"_x_">"
 q result
 ; check unique structured code is entered
unique(code,rowid) n (code,rowid) s code=$g(code),rowid=$g(rowid) s result=0
 i $l(code),$d(^TTABi("RH-1",code)),$o(^TTABi("RH-1",code,""))'=rowid s result=100
 q result
 ; expand structured code
expand(code) n (code) s code=$g(code) s result=""
 i $l(code),$d(^TTABi("RH-2",$l(code))) d
 .f j=1:1:$l(code) s x=$o(^TTABi("RH-2",$l($e(code,1,j)),$e(code,1,j),"")) i $l(x) s result=result_$s($l(result):"-->",1:"")_$$seldata(x,3)
 q result
%0ABr1 n cnt s cnt=0
 s %CTHOS10d(17)=""
 i $g(%CTHOS10d(3))'="" s cnt=cnt+1,$p(%CTHOS10d(17),"|",cnt)=$g(%CTHOS10d(3))
 i $g(%CTHOS10d(4))'="" s cnt=cnt+1,$p(%CTHOS10d(17),"|",cnt)=$g(%CTHOS10d(4))
 i $g(%CTHOS10d(5))'="" s cnt=cnt+1,$p(%CTHOS10d(17),"|",cnt)=$g(%CTHOS10d(5))
 i $g(%CTHOS10d(6))'="" s cnt=cnt+1,$p(%CTHOS10d(17),"|",cnt)=$g(%CTHOS10d(6))
 i $g(%CTHOS10d(7))'="" s cnt=cnt+1,$p(%CTHOS10d(17),"|",cnt)=$g(%CTHOS10d(7))
 k cnt q
%CTHOS10o s $zt="%CTHOS10E" s SQLCODE=$s($g(%CTHOS10c):-101,1:0) q:SQLCODE'=0  s %CTHOS10d(56)=0 s %CTHOS10d(57)=0,%CTHOS10d(58)=""
 s %CTHOS10d(42)=$g(code),%CTHOS10d(43)=$g(code),%CTHOS10d(45)=$g(desc),%CTHOS10d(46)=$g(desc),%CTHOS10d(47)=$g(active),%CTHOS10d(48)=$g(active),%CTHOS10d(49)=$g(site),%CTHOS10d(50)=$g(site),%CTHOS10d(51)=$g(strCode),%CTHOS10d(52)=$g(strCode)
 s %CTHOS10t(1)=$i(^||%sql.temp)
 s %CTHOS10d(55)=$zu(28,%CTHOS10d(47),7)
 s %CTHOS10c=1 q
%CTHOS10E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS10c,%CTHOS10d,%CTHOS10E,%CTHOS10l,%CTHOS10n,%CTHOS10R,%CTHOS10s,%CTHOS10t,%CTHOS10Z q
%0Afirst 
 k ^||%sql.temp(%CTHOS10t(1),0) s ^||%sql.temp(%CTHOS10t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%CTHOS10t(1),0))
 ; asl MOD# 3
 d %0ABMod
 i $sortend(^||%sql.temp(%CTHOS10t(1),0))
 s %CTHOS10s(25)=""
%0ACk1 s %CTHOS10s(25)=$o(^||%sql.temp(%CTHOS10t(1),0,%CTHOS10s(25)))
 i %CTHOS10s(25)="" g %0ACdun
 s %CTHOS10d(25)=$s(%CTHOS10s(25)=-1E14:"",1:%CTHOS10s(25))
 s %CTHOS10s(1)=""
%0ACk2 s %CTHOS10s(1)=$o(^||%sql.temp(%CTHOS10t(1),0,%CTHOS10s(25),%CTHOS10s(1)))
 i %CTHOS10s(1)="" g %0ACk1
 s %CTHOS10d(1)=$s(%CTHOS10s(1)=-1E14:"",1:%CTHOS10s(1))
 i %CTHOS10d(1)'="",$d(^TTAB("RH",%CTHOS10d(1)))
 e  g %0ACk2
 s %CTHOS10d(69)=$g(^TTAB("RH",%CTHOS10d(1)))
 s %CTHOS10d(2)=$p(%CTHOS10d(69),"\",1) s %CTHOS10d(3)=$p(%CTHOS10d(69),"\",2) s %CTHOS10d(4)=$p(%CTHOS10d(69),"\",3) s %CTHOS10d(5)=$p(%CTHOS10d(69),"\",4) s %CTHOS10d(6)=$p(%CTHOS10d(69),"\",5) s %CTHOS10d(7)=$p(%CTHOS10d(69),"\",6) s %CTHOS10d(8)=$p(%CTHOS10d(69),"\",7) s %CTHOS10d(9)=$p(%CTHOS10d(69),"\",8) s %CTHOS10d(10)=$p(%CTHOS10d(69),"\",9) s %CTHOS10d(11)=$p(%CTHOS10d(69),"\",10) s %CTHOS10d(12)=$p(%CTHOS10d(69),"\",11) s %CTHOS10d(13)=$p(%CTHOS10d(69),"\",12) s %CTHOS10d(14)=$p(%CTHOS10d(69),"\",13) s %CTHOS10d(15)=$p(%CTHOS10d(69),"\",14) s %CTHOS10d(16)=$p(%CTHOS10d(69),"\",15) s %CTHOS10d(18)=$p(%CTHOS10d(69),"\",16) s %CTHOS10d(19)=$p(%CTHOS10d(69),"\",17) s %CTHOS10d(20)=$p(%CTHOS10d(69),"\",18) s %CTHOS10d(21)=$p(%CTHOS10d(69),"\",20) s %CTHOS10d(22)=$p(%CTHOS10d(69),"\",21) s %CTHOS10d(23)=$p(%CTHOS10d(69),"\",19) s %CTHOS10d(24)=$p(%CTHOS10d(69),"\",22) s %CTHOS10d(26)=$p(%CTHOS10d(69),"\",24) s %CTHOS10d(27)=$p(%CTHOS10d(69),"\",25) s %CTHOS10d(28)=$p(%CTHOS10d(69),"\",26) s %CTHOS10d(29)=$p(%CTHOS10d(69),"\",27) s %CTHOS10d(30)=$p(%CTHOS10d(69),"\",28) s %CTHOS10d(31)=$p(%CTHOS10d(69),"\",29) s %CTHOS10d(32)=$p(%CTHOS10d(69),"\",30) s %CTHOS10d(34)=$p(%CTHOS10d(69),"\",31) s %CTHOS10d(35)=$p(%CTHOS10d(69),"\",32) s %CTHOS10d(36)=$p(%CTHOS10d(69),"\",33) s %CTHOS10d(37)=$p(%CTHOS10d(69),"\",34) s %CTHOS10d(39)=$p(%CTHOS10d(69),"\",35) s %CTHOS10d(40)=$p(%CTHOS10d(69),"\",36)
 s %CTHOS10d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS10d(1),"REM",0)) s $li(%CTHOS10d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS10d(38)=$l($g(%CTHOS10d(37))) s %CTHOS10d(54)=$zu(28,%CTHOS10d(24),7) s %CTHOS10d(44)=$zu(28,%CTHOS10d(2),6) s %CTHOS10d(41)=$zu(28,%CTHOS10d(1),6)
 g:$zu(115,2)=0 %0ACuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS10d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS10d(57)=1,%CTHOS10d(58)=$name(^TTAB("RH",$p(%CTHOS10d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS10d(1) ztrap "LOCK"  }
 ; asl MOD# 4
 i %CTHOS10d(1)'="",$d(^TTAB("RH",%CTHOS10d(1)))
 e  g %0ADdun
 s %CTHOS10d(74)=$g(^TTAB("RH",%CTHOS10d(1)))
 s %CTHOS10d(28)=$p(%CTHOS10d(74),"\",26)
 g:'((((%CTHOS10d(28)'="")&&(%CTHOS10d(28)=%CTHOS10d(49)))||(%CTHOS10d(50)=""))||(%CTHOS10d(28)="")) %0ADdun
 s %CTHOS10d(37)=$p(%CTHOS10d(74),"\",34)
 g:'((((%CTHOS10d(37)'="")&&(($c(0)[%CTHOS10d(51))||(%CTHOS10d(51)=$c(32,0)&&($e(%CTHOS10d(37))=$c(32)))||(%CTHOS10d(51)=$e(%CTHOS10d(37),1,$l(%CTHOS10d(51))))))||(%CTHOS10d(52)=""))||(%CTHOS10d(37)="")) %0ADdun
 s %CTHOS10d(2)=$p(%CTHOS10d(74),"\",1) s %CTHOS10d(3)=$p(%CTHOS10d(74),"\",2) s %CTHOS10d(4)=$p(%CTHOS10d(74),"\",3) s %CTHOS10d(5)=$p(%CTHOS10d(74),"\",4) s %CTHOS10d(6)=$p(%CTHOS10d(74),"\",5) s %CTHOS10d(7)=$p(%CTHOS10d(74),"\",6) s %CTHOS10d(8)=$p(%CTHOS10d(74),"\",7) s %CTHOS10d(9)=$p(%CTHOS10d(74),"\",8) s %CTHOS10d(10)=$p(%CTHOS10d(74),"\",9) s %CTHOS10d(11)=$p(%CTHOS10d(74),"\",10) s %CTHOS10d(12)=$p(%CTHOS10d(74),"\",11) s %CTHOS10d(13)=$p(%CTHOS10d(74),"\",12) s %CTHOS10d(14)=$p(%CTHOS10d(74),"\",13) s %CTHOS10d(15)=$p(%CTHOS10d(74),"\",14) s %CTHOS10d(16)=$p(%CTHOS10d(74),"\",15) s %CTHOS10d(18)=$p(%CTHOS10d(74),"\",16) s %CTHOS10d(19)=$p(%CTHOS10d(74),"\",17) s %CTHOS10d(20)=$p(%CTHOS10d(74),"\",18) s %CTHOS10d(21)=$p(%CTHOS10d(74),"\",20) s %CTHOS10d(22)=$p(%CTHOS10d(74),"\",21) s %CTHOS10d(23)=$p(%CTHOS10d(74),"\",19) s %CTHOS10d(24)=$p(%CTHOS10d(74),"\",22) s %CTHOS10d(25)=$p(%CTHOS10d(74),"\",23) s %CTHOS10d(26)=$p(%CTHOS10d(74),"\",24) s %CTHOS10d(27)=$p(%CTHOS10d(74),"\",25) s %CTHOS10d(29)=$p(%CTHOS10d(74),"\",27) s %CTHOS10d(30)=$p(%CTHOS10d(74),"\",28) s %CTHOS10d(31)=$p(%CTHOS10d(74),"\",29) s %CTHOS10d(32)=$p(%CTHOS10d(74),"\",30) s %CTHOS10d(34)=$p(%CTHOS10d(74),"\",31) s %CTHOS10d(35)=$p(%CTHOS10d(74),"\",32) s %CTHOS10d(36)=$p(%CTHOS10d(74),"\",33) s %CTHOS10d(39)=$p(%CTHOS10d(74),"\",35) s %CTHOS10d(40)=$p(%CTHOS10d(74),"\",36)
 s %CTHOS10d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS10d(1),"REM",0)) s $li(%CTHOS10d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS10d(38)=$l($g(%CTHOS10d(37))) s %CTHOS10d(54)=$zu(28,%CTHOS10d(24),7) s %CTHOS10d(44)=$zu(28,%CTHOS10d(2),6) s %CTHOS10d(41)=$zu(28,%CTHOS10d(1),6)
 g:'((($c(0)[%CTHOS10d(42))||(%CTHOS10d(42)=$c(32,0)&&($e(%CTHOS10d(41))=$c(32)))||(%CTHOS10d(42)=$e(%CTHOS10d(41),1,$l(%CTHOS10d(42)))))||(%CTHOS10d(43)="")) %0ADdun
 g:'(((%CTHOS10d(44)'="")&&(($c(0)[%CTHOS10d(45))||(%CTHOS10d(45)=$c(32,0)&&($e(%CTHOS10d(44))=$c(32)))||(%CTHOS10d(45)=$e(%CTHOS10d(44),1,$l(%CTHOS10d(45))))))||(%CTHOS10d(46)="")) %0ADdun
 g:'(((%CTHOS10d(54)'=" ")&&(%CTHOS10d(54)=%CTHOS10d(55)))||(%CTHOS10d(48)="")) %0ADdun
%0ACuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS10d(56)=%CTHOS10d(56)+1,%ROWCOUNT=%CTHOS10d(56),%ROWID=%CTHOS10d(1),%CTHOS10c=10 q
%CTHOS10f i '$g(%CTHOS10c) { s SQLCODE=-102 q  } i %CTHOS10c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Aerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS10d(56))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS10d(56),%CTHOS10c=100 q  } g %0Afirst:%CTHOS10c=1
%0ADdun i $zu(115,2)=1,$g(%CTHOS10d(57))=1 { l -@%CTHOS10d(58) s %CTHOS10d(57)=0 }
 g %0ACk2
%0ACdun 
%0AAdun 
 s %ROWCOUNT=%CTHOS10d(56),SQLCODE=100,%CTHOS10c=100 q
%CTHOS10c i '$g(%CTHOS10c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS10d(56)),1:0) f %CTHOS10d(59)=1 { i $sortend(^||%sql.temp(%CTHOS10t(%CTHOS10d(59)),0),0) } k ^||%sql.temp(%CTHOS10t(1))
 i $zu(115,2)=1,$g(%CTHOS10d(57))=1 { l -@%CTHOS10d(58) } k %CTHOS10c,%CTHOS10d,%CTHOS10E,%CTHOS10l,%CTHOS10n,%CTHOS10R,%CTHOS10s,%CTHOS10t,%CTHOS10Z s SQLCODE=0 q
%0Aerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS10c=100
 f %CTHOS10d(59)=1 i $sortend(^||%sql.temp(%CTHOS10t(%CTHOS10d(59)),0),0)
 q
%0ABMod ; asl MOD# 2
 s %CTHOS10d(1)=""
%0ABk1 s %CTHOS10d(1)=$o(^TTAB("RH",%CTHOS10d(1)))
 i %CTHOS10d(1)="" g %0ABdun
 s %CTHOS10d(64)=$g(^TTAB("RH",%CTHOS10d(1)))
 s %CTHOS10d(28)=$p(%CTHOS10d(64),"\",26)
 g:'((((%CTHOS10d(28)'="")&&(%CTHOS10d(28)=%CTHOS10d(49)))||(%CTHOS10d(50)=""))||(%CTHOS10d(28)="")) %0ABk1
 s %CTHOS10d(37)=$p(%CTHOS10d(64),"\",34)
 g:'((((%CTHOS10d(37)'="")&&(($c(0)[%CTHOS10d(51))||(%CTHOS10d(51)=$c(32,0)&&($e(%CTHOS10d(37))=$c(32)))||(%CTHOS10d(51)=$e(%CTHOS10d(37),1,$l(%CTHOS10d(51))))))||(%CTHOS10d(52)=""))||(%CTHOS10d(37)="")) %0ABk1
 s %CTHOS10d(2)=$p(%CTHOS10d(64),"\",1) s %CTHOS10d(3)=$p(%CTHOS10d(64),"\",2) s %CTHOS10d(4)=$p(%CTHOS10d(64),"\",3) s %CTHOS10d(5)=$p(%CTHOS10d(64),"\",4) s %CTHOS10d(6)=$p(%CTHOS10d(64),"\",5) s %CTHOS10d(7)=$p(%CTHOS10d(64),"\",6) s %CTHOS10d(8)=$p(%CTHOS10d(64),"\",7) s %CTHOS10d(9)=$p(%CTHOS10d(64),"\",8) s %CTHOS10d(10)=$p(%CTHOS10d(64),"\",9) s %CTHOS10d(11)=$p(%CTHOS10d(64),"\",10) s %CTHOS10d(12)=$p(%CTHOS10d(64),"\",11) s %CTHOS10d(13)=$p(%CTHOS10d(64),"\",12) s %CTHOS10d(14)=$p(%CTHOS10d(64),"\",13) s %CTHOS10d(15)=$p(%CTHOS10d(64),"\",14) s %CTHOS10d(16)=$p(%CTHOS10d(64),"\",15) s %CTHOS10d(18)=$p(%CTHOS10d(64),"\",16) s %CTHOS10d(19)=$p(%CTHOS10d(64),"\",17) s %CTHOS10d(20)=$p(%CTHOS10d(64),"\",18) s %CTHOS10d(21)=$p(%CTHOS10d(64),"\",20) s %CTHOS10d(22)=$p(%CTHOS10d(64),"\",21) s %CTHOS10d(23)=$p(%CTHOS10d(64),"\",19) s %CTHOS10d(24)=$p(%CTHOS10d(64),"\",22) s %CTHOS10d(25)=$p(%CTHOS10d(64),"\",23) s %CTHOS10d(26)=$p(%CTHOS10d(64),"\",24) s %CTHOS10d(27)=$p(%CTHOS10d(64),"\",25) s %CTHOS10d(29)=$p(%CTHOS10d(64),"\",27) s %CTHOS10d(30)=$p(%CTHOS10d(64),"\",28) s %CTHOS10d(31)=$p(%CTHOS10d(64),"\",29) s %CTHOS10d(32)=$p(%CTHOS10d(64),"\",30) s %CTHOS10d(34)=$p(%CTHOS10d(64),"\",31) s %CTHOS10d(35)=$p(%CTHOS10d(64),"\",32) s %CTHOS10d(36)=$p(%CTHOS10d(64),"\",33) s %CTHOS10d(39)=$p(%CTHOS10d(64),"\",35) s %CTHOS10d(40)=$p(%CTHOS10d(64),"\",36)
 s %CTHOS10d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS10d(1),"REM",0)) s $li(%CTHOS10d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS10d(38)=$l($g(%CTHOS10d(37))) s %CTHOS10d(54)=$zu(28,%CTHOS10d(24),7) s %CTHOS10d(44)=$zu(28,%CTHOS10d(2),6) s %CTHOS10d(41)=$zu(28,%CTHOS10d(1),6)
 g:'((($c(0)[%CTHOS10d(42))||(%CTHOS10d(42)=$c(32,0)&&($e(%CTHOS10d(41))=$c(32)))||(%CTHOS10d(42)=$e(%CTHOS10d(41),1,$l(%CTHOS10d(42)))))||(%CTHOS10d(43)="")) %0ABk1
 g:'(((%CTHOS10d(44)'="")&&(($c(0)[%CTHOS10d(45))||(%CTHOS10d(45)=$c(32,0)&&($e(%CTHOS10d(44))=$c(32)))||(%CTHOS10d(45)=$e(%CTHOS10d(44),1,$l(%CTHOS10d(45))))))||(%CTHOS10d(46)="")) %0ABk1
 g:'(((%CTHOS10d(54)'=" ")&&(%CTHOS10d(54)=%CTHOS10d(55)))||(%CTHOS10d(48)="")) %0ABk1
 s %CTHOS10s(25)=$s(%CTHOS10d(25)'="":%CTHOS10d(25),1:-1E14),%CTHOS10s(1)=$s(%CTHOS10d(1)'="":%CTHOS10d(1),1:-1E14),^||%sql.temp(%CTHOS10t(1),0,%CTHOS10s(25),%CTHOS10s(1))=""
 g %0ABk1
%0ABdun 
 q
%0DBr1 n cnt s cnt=0
 s %CTHOS20d(17)=""
 i $g(%CTHOS20d(3))'="" s cnt=cnt+1,$p(%CTHOS20d(17),"|",cnt)=$g(%CTHOS20d(3))
 i $g(%CTHOS20d(4))'="" s cnt=cnt+1,$p(%CTHOS20d(17),"|",cnt)=$g(%CTHOS20d(4))
 i $g(%CTHOS20d(5))'="" s cnt=cnt+1,$p(%CTHOS20d(17),"|",cnt)=$g(%CTHOS20d(5))
 i $g(%CTHOS20d(6))'="" s cnt=cnt+1,$p(%CTHOS20d(17),"|",cnt)=$g(%CTHOS20d(6))
 i $g(%CTHOS20d(7))'="" s cnt=cnt+1,$p(%CTHOS20d(17),"|",cnt)=$g(%CTHOS20d(7))
 k cnt q
%CTHOS20o s $zt="%CTHOS20E" s SQLCODE=$s($g(%CTHOS20c):-101,1:0) q:SQLCODE'=0  s %CTHOS20d(56)=0 s %CTHOS20d(57)=0,%CTHOS20d(58)=""
 s %CTHOS20d(42)=$g(code),%CTHOS20d(43)=$g(code),%CTHOS20d(45)=$g(desc),%CTHOS20d(46)=$g(desc),%CTHOS20d(47)=$g(active),%CTHOS20d(48)=$g(active),%CTHOS20d(49)=$g(site),%CTHOS20d(50)=$g(site),%CTHOS20d(51)=$g(strCode),%CTHOS20d(52)=$g(strCode)
 s %CTHOS20t(1)=$i(^||%sql.temp)
 s %CTHOS20d(55)=$zu(28,%CTHOS20d(47),7)
 s %CTHOS20c=1 q
%CTHOS20E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS20c,%CTHOS20d,%CTHOS20E,%CTHOS20l,%CTHOS20n,%CTHOS20R,%CTHOS20s,%CTHOS20t,%CTHOS20Z q
%0Dfirst 
 k ^||%sql.temp(%CTHOS20t(1),0) s ^||%sql.temp(%CTHOS20t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%CTHOS20t(1),0))
 ; asl MOD# 3
 d %0DBMod
 i $sortend(^||%sql.temp(%CTHOS20t(1),0))
 s %CTHOS20s(25)=""
%0DCk1 s %CTHOS20s(25)=$o(^||%sql.temp(%CTHOS20t(1),0,%CTHOS20s(25)))
 i %CTHOS20s(25)="" g %0DCdun
 s %CTHOS20d(25)=$s(%CTHOS20s(25)=-1E14:"",1:%CTHOS20s(25))
 s %CTHOS20s(1)=""
%0DCk2 s %CTHOS20s(1)=$o(^||%sql.temp(%CTHOS20t(1),0,%CTHOS20s(25),%CTHOS20s(1)))
 i %CTHOS20s(1)="" g %0DCk1
 s %CTHOS20d(1)=$s(%CTHOS20s(1)=-1E14:"",1:%CTHOS20s(1))
 i %CTHOS20d(1)'="",$d(^TTAB("RH",%CTHOS20d(1)))
 e  g %0DCk2
 s %CTHOS20d(69)=$g(^TTAB("RH",%CTHOS20d(1)))
 s %CTHOS20d(2)=$p(%CTHOS20d(69),"\",1) s %CTHOS20d(3)=$p(%CTHOS20d(69),"\",2) s %CTHOS20d(4)=$p(%CTHOS20d(69),"\",3) s %CTHOS20d(5)=$p(%CTHOS20d(69),"\",4) s %CTHOS20d(6)=$p(%CTHOS20d(69),"\",5) s %CTHOS20d(7)=$p(%CTHOS20d(69),"\",6) s %CTHOS20d(8)=$p(%CTHOS20d(69),"\",7) s %CTHOS20d(9)=$p(%CTHOS20d(69),"\",8) s %CTHOS20d(10)=$p(%CTHOS20d(69),"\",9) s %CTHOS20d(11)=$p(%CTHOS20d(69),"\",10) s %CTHOS20d(12)=$p(%CTHOS20d(69),"\",11) s %CTHOS20d(13)=$p(%CTHOS20d(69),"\",12) s %CTHOS20d(14)=$p(%CTHOS20d(69),"\",13) s %CTHOS20d(15)=$p(%CTHOS20d(69),"\",14) s %CTHOS20d(16)=$p(%CTHOS20d(69),"\",15) s %CTHOS20d(18)=$p(%CTHOS20d(69),"\",16) s %CTHOS20d(19)=$p(%CTHOS20d(69),"\",17) s %CTHOS20d(20)=$p(%CTHOS20d(69),"\",18) s %CTHOS20d(21)=$p(%CTHOS20d(69),"\",20) s %CTHOS20d(22)=$p(%CTHOS20d(69),"\",21) s %CTHOS20d(23)=$p(%CTHOS20d(69),"\",19) s %CTHOS20d(24)=$p(%CTHOS20d(69),"\",22) s %CTHOS20d(26)=$p(%CTHOS20d(69),"\",24) s %CTHOS20d(27)=$p(%CTHOS20d(69),"\",25) s %CTHOS20d(28)=$p(%CTHOS20d(69),"\",26) s %CTHOS20d(29)=$p(%CTHOS20d(69),"\",27) s %CTHOS20d(30)=$p(%CTHOS20d(69),"\",28) s %CTHOS20d(31)=$p(%CTHOS20d(69),"\",29) s %CTHOS20d(32)=$p(%CTHOS20d(69),"\",30) s %CTHOS20d(34)=$p(%CTHOS20d(69),"\",31) s %CTHOS20d(35)=$p(%CTHOS20d(69),"\",32) s %CTHOS20d(36)=$p(%CTHOS20d(69),"\",33) s %CTHOS20d(37)=$p(%CTHOS20d(69),"\",34) s %CTHOS20d(39)=$p(%CTHOS20d(69),"\",35) s %CTHOS20d(40)=$p(%CTHOS20d(69),"\",36)
 s %CTHOS20d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS20d(1),"REM",0)) s $li(%CTHOS20d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS20d(38)=$l($g(%CTHOS20d(37))) s %CTHOS20d(54)=$zu(28,%CTHOS20d(24),7) s %CTHOS20d(44)=$zu(28,%CTHOS20d(2),6) s %CTHOS20d(41)=$zu(28,%CTHOS20d(1),6)
 g:$zu(115,2)=0 %0DCuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS20d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS20d(57)=1,%CTHOS20d(58)=$name(^TTAB("RH",$p(%CTHOS20d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS20d(1) ztrap "LOCK"  }
 ; asl MOD# 4
 i %CTHOS20d(1)'="",$d(^TTAB("RH",%CTHOS20d(1)))
 e  g %0DDdun
 s %CTHOS20d(74)=$g(^TTAB("RH",%CTHOS20d(1)))
 s %CTHOS20d(28)=$p(%CTHOS20d(74),"\",26)
 g:'((((%CTHOS20d(28)'="")&&(%CTHOS20d(28)=%CTHOS20d(49)))||(%CTHOS20d(50)=""))||(%CTHOS20d(28)="")) %0DDdun
 s %CTHOS20d(37)=$p(%CTHOS20d(74),"\",34)
 g:'((((%CTHOS20d(37)'="")&&(($c(0)[%CTHOS20d(51))||(%CTHOS20d(51)=$c(32,0)&&($e(%CTHOS20d(37))=$c(32)))||(%CTHOS20d(51)=$e(%CTHOS20d(37),1,$l(%CTHOS20d(51))))))||(%CTHOS20d(52)=""))||(%CTHOS20d(37)="")) %0DDdun
 s %CTHOS20d(2)=$p(%CTHOS20d(74),"\",1) s %CTHOS20d(3)=$p(%CTHOS20d(74),"\",2) s %CTHOS20d(4)=$p(%CTHOS20d(74),"\",3) s %CTHOS20d(5)=$p(%CTHOS20d(74),"\",4) s %CTHOS20d(6)=$p(%CTHOS20d(74),"\",5) s %CTHOS20d(7)=$p(%CTHOS20d(74),"\",6) s %CTHOS20d(8)=$p(%CTHOS20d(74),"\",7) s %CTHOS20d(9)=$p(%CTHOS20d(74),"\",8) s %CTHOS20d(10)=$p(%CTHOS20d(74),"\",9) s %CTHOS20d(11)=$p(%CTHOS20d(74),"\",10) s %CTHOS20d(12)=$p(%CTHOS20d(74),"\",11) s %CTHOS20d(13)=$p(%CTHOS20d(74),"\",12) s %CTHOS20d(14)=$p(%CTHOS20d(74),"\",13) s %CTHOS20d(15)=$p(%CTHOS20d(74),"\",14) s %CTHOS20d(16)=$p(%CTHOS20d(74),"\",15) s %CTHOS20d(18)=$p(%CTHOS20d(74),"\",16) s %CTHOS20d(19)=$p(%CTHOS20d(74),"\",17) s %CTHOS20d(20)=$p(%CTHOS20d(74),"\",18) s %CTHOS20d(21)=$p(%CTHOS20d(74),"\",20) s %CTHOS20d(22)=$p(%CTHOS20d(74),"\",21) s %CTHOS20d(23)=$p(%CTHOS20d(74),"\",19) s %CTHOS20d(24)=$p(%CTHOS20d(74),"\",22) s %CTHOS20d(25)=$p(%CTHOS20d(74),"\",23) s %CTHOS20d(26)=$p(%CTHOS20d(74),"\",24) s %CTHOS20d(27)=$p(%CTHOS20d(74),"\",25) s %CTHOS20d(29)=$p(%CTHOS20d(74),"\",27) s %CTHOS20d(30)=$p(%CTHOS20d(74),"\",28) s %CTHOS20d(31)=$p(%CTHOS20d(74),"\",29) s %CTHOS20d(32)=$p(%CTHOS20d(74),"\",30) s %CTHOS20d(34)=$p(%CTHOS20d(74),"\",31) s %CTHOS20d(35)=$p(%CTHOS20d(74),"\",32) s %CTHOS20d(36)=$p(%CTHOS20d(74),"\",33) s %CTHOS20d(39)=$p(%CTHOS20d(74),"\",35) s %CTHOS20d(40)=$p(%CTHOS20d(74),"\",36)
 s %CTHOS20d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS20d(1),"REM",0)) s $li(%CTHOS20d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS20d(38)=$l($g(%CTHOS20d(37))) s %CTHOS20d(54)=$zu(28,%CTHOS20d(24),7) s %CTHOS20d(44)=$zu(28,%CTHOS20d(2),6) s %CTHOS20d(41)=$zu(28,%CTHOS20d(1),6)
 g:'(((%CTHOS20d(42)'="")&&(%CTHOS20d(41)[%CTHOS20d(42)))||(%CTHOS20d(43)="")) %0DDdun
 g:'(((%CTHOS20d(45)'="")&&((%CTHOS20d(44)'="")&&(%CTHOS20d(44)[%CTHOS20d(45))))||(%CTHOS20d(46)="")) %0DDdun
 g:'(((%CTHOS20d(54)'=" ")&&(%CTHOS20d(54)=%CTHOS20d(55)))||(%CTHOS20d(48)="")) %0DDdun
%0DCuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS20d(56)=%CTHOS20d(56)+1,%ROWCOUNT=%CTHOS20d(56),%ROWID=%CTHOS20d(1),%CTHOS20c=10 q
%CTHOS20f i '$g(%CTHOS20c) { s SQLCODE=-102 q  } i %CTHOS20c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Derr" i $d(%0CacheRowLimit)#2,$g(%CTHOS20d(56))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS20d(56),%CTHOS20c=100 q  } g %0Dfirst:%CTHOS20c=1
%0DDdun i $zu(115,2)=1,$g(%CTHOS20d(57))=1 { l -@%CTHOS20d(58) s %CTHOS20d(57)=0 }
 g %0DCk2
%0DCdun 
%0DAdun 
 s %ROWCOUNT=%CTHOS20d(56),SQLCODE=100,%CTHOS20c=100 q
%CTHOS20c i '$g(%CTHOS20c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS20d(56)),1:0) f %CTHOS20d(59)=1 { i $sortend(^||%sql.temp(%CTHOS20t(%CTHOS20d(59)),0),0) } k ^||%sql.temp(%CTHOS20t(1))
 i $zu(115,2)=1,$g(%CTHOS20d(57))=1 { l -@%CTHOS20d(58) } k %CTHOS20c,%CTHOS20d,%CTHOS20E,%CTHOS20l,%CTHOS20n,%CTHOS20R,%CTHOS20s,%CTHOS20t,%CTHOS20Z s SQLCODE=0 q
%0Derr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS20c=100
 f %CTHOS20d(59)=1 i $sortend(^||%sql.temp(%CTHOS20t(%CTHOS20d(59)),0),0)
 q
%0DBMod ; asl MOD# 2
 s %CTHOS20d(1)=""
%0DBk1 s %CTHOS20d(1)=$o(^TTAB("RH",%CTHOS20d(1)))
 i %CTHOS20d(1)="" g %0DBdun
 s %CTHOS20d(64)=$g(^TTAB("RH",%CTHOS20d(1)))
 s %CTHOS20d(28)=$p(%CTHOS20d(64),"\",26)
 g:'((((%CTHOS20d(28)'="")&&(%CTHOS20d(28)=%CTHOS20d(49)))||(%CTHOS20d(50)=""))||(%CTHOS20d(28)="")) %0DBk1
 s %CTHOS20d(37)=$p(%CTHOS20d(64),"\",34)
 g:'((((%CTHOS20d(37)'="")&&(($c(0)[%CTHOS20d(51))||(%CTHOS20d(51)=$c(32,0)&&($e(%CTHOS20d(37))=$c(32)))||(%CTHOS20d(51)=$e(%CTHOS20d(37),1,$l(%CTHOS20d(51))))))||(%CTHOS20d(52)=""))||(%CTHOS20d(37)="")) %0DBk1
 s %CTHOS20d(2)=$p(%CTHOS20d(64),"\",1) s %CTHOS20d(3)=$p(%CTHOS20d(64),"\",2) s %CTHOS20d(4)=$p(%CTHOS20d(64),"\",3) s %CTHOS20d(5)=$p(%CTHOS20d(64),"\",4) s %CTHOS20d(6)=$p(%CTHOS20d(64),"\",5) s %CTHOS20d(7)=$p(%CTHOS20d(64),"\",6) s %CTHOS20d(8)=$p(%CTHOS20d(64),"\",7) s %CTHOS20d(9)=$p(%CTHOS20d(64),"\",8) s %CTHOS20d(10)=$p(%CTHOS20d(64),"\",9) s %CTHOS20d(11)=$p(%CTHOS20d(64),"\",10) s %CTHOS20d(12)=$p(%CTHOS20d(64),"\",11) s %CTHOS20d(13)=$p(%CTHOS20d(64),"\",12) s %CTHOS20d(14)=$p(%CTHOS20d(64),"\",13) s %CTHOS20d(15)=$p(%CTHOS20d(64),"\",14) s %CTHOS20d(16)=$p(%CTHOS20d(64),"\",15) s %CTHOS20d(18)=$p(%CTHOS20d(64),"\",16) s %CTHOS20d(19)=$p(%CTHOS20d(64),"\",17) s %CTHOS20d(20)=$p(%CTHOS20d(64),"\",18) s %CTHOS20d(21)=$p(%CTHOS20d(64),"\",20) s %CTHOS20d(22)=$p(%CTHOS20d(64),"\",21) s %CTHOS20d(23)=$p(%CTHOS20d(64),"\",19) s %CTHOS20d(24)=$p(%CTHOS20d(64),"\",22) s %CTHOS20d(25)=$p(%CTHOS20d(64),"\",23) s %CTHOS20d(26)=$p(%CTHOS20d(64),"\",24) s %CTHOS20d(27)=$p(%CTHOS20d(64),"\",25) s %CTHOS20d(29)=$p(%CTHOS20d(64),"\",27) s %CTHOS20d(30)=$p(%CTHOS20d(64),"\",28) s %CTHOS20d(31)=$p(%CTHOS20d(64),"\",29) s %CTHOS20d(32)=$p(%CTHOS20d(64),"\",30) s %CTHOS20d(34)=$p(%CTHOS20d(64),"\",31) s %CTHOS20d(35)=$p(%CTHOS20d(64),"\",32) s %CTHOS20d(36)=$p(%CTHOS20d(64),"\",33) s %CTHOS20d(39)=$p(%CTHOS20d(64),"\",35) s %CTHOS20d(40)=$p(%CTHOS20d(64),"\",36)
 s %CTHOS20d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS20d(1),"REM",0)) s $li(%CTHOS20d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS20d(38)=$l($g(%CTHOS20d(37))) s %CTHOS20d(54)=$zu(28,%CTHOS20d(24),7) s %CTHOS20d(44)=$zu(28,%CTHOS20d(2),6) s %CTHOS20d(41)=$zu(28,%CTHOS20d(1),6)
 g:'(((%CTHOS20d(42)'="")&&(%CTHOS20d(41)[%CTHOS20d(42)))||(%CTHOS20d(43)="")) %0DBk1
 g:'(((%CTHOS20d(45)'="")&&((%CTHOS20d(44)'="")&&(%CTHOS20d(44)[%CTHOS20d(45))))||(%CTHOS20d(46)="")) %0DBk1
 g:'(((%CTHOS20d(54)'=" ")&&(%CTHOS20d(54)=%CTHOS20d(55)))||(%CTHOS20d(48)="")) %0DBk1
 s %CTHOS20s(25)=$s(%CTHOS20d(25)'="":%CTHOS20d(25),1:-1E14),%CTHOS20s(1)=$s(%CTHOS20d(1)'="":%CTHOS20d(1),1:-1E14),^||%sql.temp(%CTHOS20t(1),0,%CTHOS20s(25),%CTHOS20s(1))=""
 g %0DBk1
%0DBdun 
 q
%0GBr1 n cnt s cnt=0
 s %CTHOS30d(17)=""
 i $g(%CTHOS30d(3))'="" s cnt=cnt+1,$p(%CTHOS30d(17),"|",cnt)=$g(%CTHOS30d(3))
 i $g(%CTHOS30d(4))'="" s cnt=cnt+1,$p(%CTHOS30d(17),"|",cnt)=$g(%CTHOS30d(4))
 i $g(%CTHOS30d(5))'="" s cnt=cnt+1,$p(%CTHOS30d(17),"|",cnt)=$g(%CTHOS30d(5))
 i $g(%CTHOS30d(6))'="" s cnt=cnt+1,$p(%CTHOS30d(17),"|",cnt)=$g(%CTHOS30d(6))
 i $g(%CTHOS30d(7))'="" s cnt=cnt+1,$p(%CTHOS30d(17),"|",cnt)=$g(%CTHOS30d(7))
 k cnt q
%CTHOS30o s $zt="%CTHOS30E" s SQLCODE=$s($g(%CTHOS30c):-101,1:0) q:SQLCODE'=0  s %CTHOS30d(59)=0 s %CTHOS30d(60)=0,%CTHOS30d(61)=""
 s %CTHOS30d(42)=$g(code),%CTHOS30d(43)=$g(code),%CTHOS30d(45)=$g(desc),%CTHOS30d(46)=$g(desc),%CTHOS30d(47)=$g(active),%CTHOS30d(48)=$g(active),%CTHOS30d(49)=$g(site),%CTHOS30d(50)=$g(site),%CTHOS30d(51)=$g(strCode),%CTHOS30d(52)=$g(strCode),%CTHOS30d(53)=$g(strCodeLength)
 s %CTHOS30d(56)=$zu(28,%CTHOS30d(47),7)
 s %CTHOS30c=1 q
%CTHOS30E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS30c,%CTHOS30d,%CTHOS30E,%CTHOS30l,%CTHOS30n,%CTHOS30R,%CTHOS30Z q
%0Gfirst 
 ; asl MOD# 2
 s %CTHOS30d(38)=%CTHOS30d(53)
 i %CTHOS30d(38)="" g %0GBdun
 i '(%CTHOS30d(38)'="") g %0GBdun
 s %CTHOS30d(37)=""
%0GBk1 s %CTHOS30d(37)=$o(^TTABi("RH-2",%CTHOS30d(38),%CTHOS30d(37)))
 i %CTHOS30d(37)="" g %0GBdun
 i '((($c(0)[%CTHOS30d(51))||(%CTHOS30d(51)=$c(32,0)&&($e(%CTHOS30d(37))=$c(32)))||(%CTHOS30d(51)=$e(%CTHOS30d(37),1,$l(%CTHOS30d(51)))))||(%CTHOS30d(52)="")) g %0GBk1
 i '(%CTHOS30d(37)'="") g %0GBk1
 s %CTHOS30d(1)=""
%0GBk2 s %CTHOS30d(1)=$o(^TTABi("RH-2",%CTHOS30d(38),%CTHOS30d(37),%CTHOS30d(1)))
 i %CTHOS30d(1)="" g %0GBk1
 s %CTHOS30d(41)=$zu(28,%CTHOS30d(1),6)
 g:'((($c(0)[%CTHOS30d(42))||(%CTHOS30d(42)=$c(32,0)&&($e(%CTHOS30d(41))=$c(32)))||(%CTHOS30d(42)=$e(%CTHOS30d(41),1,$l(%CTHOS30d(42)))))||(%CTHOS30d(43)="")) %0GBk2
 i %CTHOS30d(1)'="",$d(^TTAB("RH",%CTHOS30d(1)))
 e  g %0GBk2
 s %CTHOS30d(72)=$g(^TTAB("RH",%CTHOS30d(1)))
 s %CTHOS30d(28)=$p(%CTHOS30d(72),"\",26)
 g:'((((%CTHOS30d(28)'="")&&(%CTHOS30d(28)=%CTHOS30d(49)))||(%CTHOS30d(50)=""))||(%CTHOS30d(28)="")) %0GBk2
 s %CTHOS30d(2)=$p(%CTHOS30d(72),"\",1) s %CTHOS30d(3)=$p(%CTHOS30d(72),"\",2) s %CTHOS30d(4)=$p(%CTHOS30d(72),"\",3) s %CTHOS30d(5)=$p(%CTHOS30d(72),"\",4) s %CTHOS30d(6)=$p(%CTHOS30d(72),"\",5) s %CTHOS30d(7)=$p(%CTHOS30d(72),"\",6) s %CTHOS30d(8)=$p(%CTHOS30d(72),"\",7) s %CTHOS30d(9)=$p(%CTHOS30d(72),"\",8) s %CTHOS30d(10)=$p(%CTHOS30d(72),"\",9) s %CTHOS30d(11)=$p(%CTHOS30d(72),"\",10) s %CTHOS30d(12)=$p(%CTHOS30d(72),"\",11) s %CTHOS30d(13)=$p(%CTHOS30d(72),"\",12) s %CTHOS30d(14)=$p(%CTHOS30d(72),"\",13) s %CTHOS30d(15)=$p(%CTHOS30d(72),"\",14) s %CTHOS30d(16)=$p(%CTHOS30d(72),"\",15) s %CTHOS30d(18)=$p(%CTHOS30d(72),"\",16) s %CTHOS30d(19)=$p(%CTHOS30d(72),"\",17) s %CTHOS30d(20)=$p(%CTHOS30d(72),"\",18) s %CTHOS30d(21)=$p(%CTHOS30d(72),"\",20) s %CTHOS30d(22)=$p(%CTHOS30d(72),"\",21) s %CTHOS30d(23)=$p(%CTHOS30d(72),"\",19) s %CTHOS30d(24)=$p(%CTHOS30d(72),"\",22) s %CTHOS30d(25)=$p(%CTHOS30d(72),"\",23) s %CTHOS30d(26)=$p(%CTHOS30d(72),"\",24) s %CTHOS30d(27)=$p(%CTHOS30d(72),"\",25) s %CTHOS30d(29)=$p(%CTHOS30d(72),"\",27) s %CTHOS30d(30)=$p(%CTHOS30d(72),"\",28) s %CTHOS30d(31)=$p(%CTHOS30d(72),"\",29) s %CTHOS30d(32)=$p(%CTHOS30d(72),"\",30) s %CTHOS30d(34)=$p(%CTHOS30d(72),"\",31) s %CTHOS30d(35)=$p(%CTHOS30d(72),"\",32) s %CTHOS30d(36)=$p(%CTHOS30d(72),"\",33) s %CTHOS30d(39)=$p(%CTHOS30d(72),"\",35) s %CTHOS30d(40)=$p(%CTHOS30d(72),"\",36)
 s %CTHOS30d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS30d(1),"REM",0)) s $li(%CTHOS30d(33),%irep)=$g(^(%irep))
 d %0GBr1 s %CTHOS30d(55)=$zu(28,%CTHOS30d(24),7) s %CTHOS30d(44)=$zu(28,%CTHOS30d(2),6)
 g:'(((%CTHOS30d(44)'="")&&(($c(0)[%CTHOS30d(45))||(%CTHOS30d(45)=$c(32,0)&&($e(%CTHOS30d(44))=$c(32)))||(%CTHOS30d(45)=$e(%CTHOS30d(44),1,$l(%CTHOS30d(45))))))||(%CTHOS30d(46)="")) %0GBk2
 g:'(((%CTHOS30d(55)'=" ")&&(%CTHOS30d(55)=%CTHOS30d(56)))||(%CTHOS30d(48)="")) %0GBk2
 g:$zu(115,2)=0 %0GBuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS30d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS30d(60)=1,%CTHOS30d(61)=$name(^TTAB("RH",$p(%CTHOS30d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS30d(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %CTHOS30d(57)=$lb(""_%CTHOS30d(38),""_%CTHOS30d(41),""_%CTHOS30d(44),""_%CTHOS30d(55),""_%CTHOS30d(28),""_%CTHOS30d(37))
 i %CTHOS30d(1)'="",$d(^TTAB("RH",%CTHOS30d(1)))
 e  g %0GCdun
 s %CTHOS30d(77)=$g(^TTAB("RH",%CTHOS30d(1)))
 s %CTHOS30d(2)=$p(%CTHOS30d(77),"\",1) s %CTHOS30d(3)=$p(%CTHOS30d(77),"\",2) s %CTHOS30d(4)=$p(%CTHOS30d(77),"\",3) s %CTHOS30d(5)=$p(%CTHOS30d(77),"\",4) s %CTHOS30d(6)=$p(%CTHOS30d(77),"\",5) s %CTHOS30d(7)=$p(%CTHOS30d(77),"\",6) s %CTHOS30d(8)=$p(%CTHOS30d(77),"\",7) s %CTHOS30d(9)=$p(%CTHOS30d(77),"\",8) s %CTHOS30d(10)=$p(%CTHOS30d(77),"\",9) s %CTHOS30d(11)=$p(%CTHOS30d(77),"\",10) s %CTHOS30d(12)=$p(%CTHOS30d(77),"\",11) s %CTHOS30d(13)=$p(%CTHOS30d(77),"\",12) s %CTHOS30d(14)=$p(%CTHOS30d(77),"\",13) s %CTHOS30d(15)=$p(%CTHOS30d(77),"\",14) s %CTHOS30d(16)=$p(%CTHOS30d(77),"\",15) s %CTHOS30d(18)=$p(%CTHOS30d(77),"\",16) s %CTHOS30d(19)=$p(%CTHOS30d(77),"\",17) s %CTHOS30d(20)=$p(%CTHOS30d(77),"\",18) s %CTHOS30d(21)=$p(%CTHOS30d(77),"\",20) s %CTHOS30d(22)=$p(%CTHOS30d(77),"\",21) s %CTHOS30d(23)=$p(%CTHOS30d(77),"\",19) s %CTHOS30d(24)=$p(%CTHOS30d(77),"\",22) s %CTHOS30d(25)=$p(%CTHOS30d(77),"\",23) s %CTHOS30d(26)=$p(%CTHOS30d(77),"\",24) s %CTHOS30d(27)=$p(%CTHOS30d(77),"\",25) s %CTHOS30d(28)=$p(%CTHOS30d(77),"\",26) s %CTHOS30d(29)=$p(%CTHOS30d(77),"\",27) s %CTHOS30d(30)=$p(%CTHOS30d(77),"\",28) s %CTHOS30d(31)=$p(%CTHOS30d(77),"\",29) s %CTHOS30d(32)=$p(%CTHOS30d(77),"\",30) s %CTHOS30d(34)=$p(%CTHOS30d(77),"\",31) s %CTHOS30d(35)=$p(%CTHOS30d(77),"\",32) s %CTHOS30d(36)=$p(%CTHOS30d(77),"\",33) s %CTHOS30d(37)=$p(%CTHOS30d(77),"\",34) s %CTHOS30d(39)=$p(%CTHOS30d(77),"\",35) s %CTHOS30d(40)=$p(%CTHOS30d(77),"\",36)
 s %CTHOS30d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS30d(1),"REM",0)) s $li(%CTHOS30d(33),%irep)=$g(^(%irep))
 d %0GBr1 s %CTHOS30d(38)=$l($g(%CTHOS30d(37))) s %CTHOS30d(55)=$zu(28,%CTHOS30d(24),7) s %CTHOS30d(44)=$zu(28,%CTHOS30d(2),6) s %CTHOS30d(41)=$zu(28,%CTHOS30d(1),6)
 s %CTHOS30d(58)=$lb(""_%CTHOS30d(38),""_%CTHOS30d(41),""_%CTHOS30d(44),""_%CTHOS30d(55),""_%CTHOS30d(28),""_%CTHOS30d(37))
 g:%CTHOS30d(57)'=%CTHOS30d(58) %0GCdun
%0GBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS30d(59)=%CTHOS30d(59)+1,%ROWCOUNT=%CTHOS30d(59),%ROWID=%CTHOS30d(1),%CTHOS30c=10 q
%CTHOS30f i '$g(%CTHOS30c) { s SQLCODE=-102 q  } i %CTHOS30c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Gerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS30d(59))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS30d(59),%CTHOS30c=100 q  } g %0Gfirst:%CTHOS30c=1
%0GCdun i $zu(115,2)=1,$g(%CTHOS30d(60))=1 { l -@%CTHOS30d(61) s %CTHOS30d(60)=0 }
 g %0GBk2
%0GBdun 
%0GAdun 
 s %ROWCOUNT=%CTHOS30d(59),SQLCODE=100,%CTHOS30c=100 q
%CTHOS30c i '$g(%CTHOS30c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS30d(59)),1:0)
 i $zu(115,2)=1,$g(%CTHOS30d(60))=1 { l -@%CTHOS30d(61) } k %CTHOS30c,%CTHOS30d,%CTHOS30E,%CTHOS30l,%CTHOS30n,%CTHOS30R,%CTHOS30Z s SQLCODE=0 q
%0Gerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS30c=100 q
%0JBr1 n cnt s cnt=0
 s %CTHOS40d(17)=""
 i $g(%CTHOS40d(3))'="" s cnt=cnt+1,$p(%CTHOS40d(17),"|",cnt)=$g(%CTHOS40d(3))
 i $g(%CTHOS40d(4))'="" s cnt=cnt+1,$p(%CTHOS40d(17),"|",cnt)=$g(%CTHOS40d(4))
 i $g(%CTHOS40d(5))'="" s cnt=cnt+1,$p(%CTHOS40d(17),"|",cnt)=$g(%CTHOS40d(5))
 i $g(%CTHOS40d(6))'="" s cnt=cnt+1,$p(%CTHOS40d(17),"|",cnt)=$g(%CTHOS40d(6))
 i $g(%CTHOS40d(7))'="" s cnt=cnt+1,$p(%CTHOS40d(17),"|",cnt)=$g(%CTHOS40d(7))
 k cnt q
%CTHOS40o s $zt="%CTHOS40E" s SQLCODE=$s($g(%CTHOS40c):-101,1:0) q:SQLCODE'=0  s %CTHOS40d(59)=0 s %CTHOS40d(60)=0,%CTHOS40d(61)=""
 s %CTHOS40d(42)=$g(code),%CTHOS40d(43)=$g(code),%CTHOS40d(45)=$g(desc),%CTHOS40d(46)=$g(desc),%CTHOS40d(47)=$g(active),%CTHOS40d(48)=$g(active),%CTHOS40d(49)=$g(site),%CTHOS40d(50)=$g(site),%CTHOS40d(51)=$g(strCode),%CTHOS40d(52)=$g(strCode),%CTHOS40d(53)=$g(strCodeLength)
 s %CTHOS40d(56)=$zu(28,%CTHOS40d(47),7)
 s %CTHOS40c=1 q
%CTHOS40E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS40c,%CTHOS40d,%CTHOS40E,%CTHOS40l,%CTHOS40n,%CTHOS40R,%CTHOS40Z q
%0Jfirst 
 ; asl MOD# 2
 s %CTHOS40d(38)=%CTHOS40d(53)
 i %CTHOS40d(38)="" g %0JBdun
 i '(%CTHOS40d(38)'="") g %0JBdun
 s %CTHOS40d(37)=""
%0JBk1 s %CTHOS40d(37)=$o(^TTABi("RH-2",%CTHOS40d(38),%CTHOS40d(37)))
 i %CTHOS40d(37)="" g %0JBdun
 i '((($c(0)[%CTHOS40d(51))||(%CTHOS40d(51)=$c(32,0)&&($e(%CTHOS40d(37))=$c(32)))||(%CTHOS40d(51)=$e(%CTHOS40d(37),1,$l(%CTHOS40d(51)))))||(%CTHOS40d(52)="")) g %0JBk1
 i '(%CTHOS40d(37)'="") g %0JBk1
 s %CTHOS40d(1)=""
%0JBk2 s %CTHOS40d(1)=$o(^TTABi("RH-2",%CTHOS40d(38),%CTHOS40d(37),%CTHOS40d(1)))
 i %CTHOS40d(1)="" g %0JBk1
 s %CTHOS40d(41)=$zu(28,%CTHOS40d(1),6)
 g:'(((%CTHOS40d(42)'="")&&(%CTHOS40d(41)[%CTHOS40d(42)))||(%CTHOS40d(43)="")) %0JBk2
 i %CTHOS40d(1)'="",$d(^TTAB("RH",%CTHOS40d(1)))
 e  g %0JBk2
 s %CTHOS40d(72)=$g(^TTAB("RH",%CTHOS40d(1)))
 s %CTHOS40d(28)=$p(%CTHOS40d(72),"\",26)
 g:'((((%CTHOS40d(28)'="")&&(%CTHOS40d(28)=%CTHOS40d(49)))||(%CTHOS40d(50)=""))||(%CTHOS40d(28)="")) %0JBk2
 s %CTHOS40d(2)=$p(%CTHOS40d(72),"\",1) s %CTHOS40d(3)=$p(%CTHOS40d(72),"\",2) s %CTHOS40d(4)=$p(%CTHOS40d(72),"\",3) s %CTHOS40d(5)=$p(%CTHOS40d(72),"\",4) s %CTHOS40d(6)=$p(%CTHOS40d(72),"\",5) s %CTHOS40d(7)=$p(%CTHOS40d(72),"\",6) s %CTHOS40d(8)=$p(%CTHOS40d(72),"\",7) s %CTHOS40d(9)=$p(%CTHOS40d(72),"\",8) s %CTHOS40d(10)=$p(%CTHOS40d(72),"\",9) s %CTHOS40d(11)=$p(%CTHOS40d(72),"\",10) s %CTHOS40d(12)=$p(%CTHOS40d(72),"\",11) s %CTHOS40d(13)=$p(%CTHOS40d(72),"\",12) s %CTHOS40d(14)=$p(%CTHOS40d(72),"\",13) s %CTHOS40d(15)=$p(%CTHOS40d(72),"\",14) s %CTHOS40d(16)=$p(%CTHOS40d(72),"\",15) s %CTHOS40d(18)=$p(%CTHOS40d(72),"\",16) s %CTHOS40d(19)=$p(%CTHOS40d(72),"\",17) s %CTHOS40d(20)=$p(%CTHOS40d(72),"\",18) s %CTHOS40d(21)=$p(%CTHOS40d(72),"\",20) s %CTHOS40d(22)=$p(%CTHOS40d(72),"\",21) s %CTHOS40d(23)=$p(%CTHOS40d(72),"\",19) s %CTHOS40d(24)=$p(%CTHOS40d(72),"\",22) s %CTHOS40d(25)=$p(%CTHOS40d(72),"\",23) s %CTHOS40d(26)=$p(%CTHOS40d(72),"\",24) s %CTHOS40d(27)=$p(%CTHOS40d(72),"\",25) s %CTHOS40d(29)=$p(%CTHOS40d(72),"\",27) s %CTHOS40d(30)=$p(%CTHOS40d(72),"\",28) s %CTHOS40d(31)=$p(%CTHOS40d(72),"\",29) s %CTHOS40d(32)=$p(%CTHOS40d(72),"\",30) s %CTHOS40d(34)=$p(%CTHOS40d(72),"\",31) s %CTHOS40d(35)=$p(%CTHOS40d(72),"\",32) s %CTHOS40d(36)=$p(%CTHOS40d(72),"\",33) s %CTHOS40d(39)=$p(%CTHOS40d(72),"\",35) s %CTHOS40d(40)=$p(%CTHOS40d(72),"\",36)
 s %CTHOS40d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS40d(1),"REM",0)) s $li(%CTHOS40d(33),%irep)=$g(^(%irep))
 d %0JBr1 s %CTHOS40d(55)=$zu(28,%CTHOS40d(24),7) s %CTHOS40d(44)=$zu(28,%CTHOS40d(2),6)
 g:'(((%CTHOS40d(45)'="")&&((%CTHOS40d(44)'="")&&(%CTHOS40d(44)[%CTHOS40d(45))))||(%CTHOS40d(46)="")) %0JBk2
 g:'(((%CTHOS40d(55)'=" ")&&(%CTHOS40d(55)=%CTHOS40d(56)))||(%CTHOS40d(48)="")) %0JBk2
 g:$zu(115,2)=0 %0JBuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS40d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS40d(60)=1,%CTHOS40d(61)=$name(^TTAB("RH",$p(%CTHOS40d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS40d(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %CTHOS40d(57)=$lb(""_%CTHOS40d(38),""_%CTHOS40d(41),""_%CTHOS40d(44),""_%CTHOS40d(55),""_%CTHOS40d(28),""_%CTHOS40d(37))
 i %CTHOS40d(1)'="",$d(^TTAB("RH",%CTHOS40d(1)))
 e  g %0JCdun
 s %CTHOS40d(77)=$g(^TTAB("RH",%CTHOS40d(1)))
 s %CTHOS40d(2)=$p(%CTHOS40d(77),"\",1) s %CTHOS40d(3)=$p(%CTHOS40d(77),"\",2) s %CTHOS40d(4)=$p(%CTHOS40d(77),"\",3) s %CTHOS40d(5)=$p(%CTHOS40d(77),"\",4) s %CTHOS40d(6)=$p(%CTHOS40d(77),"\",5) s %CTHOS40d(7)=$p(%CTHOS40d(77),"\",6) s %CTHOS40d(8)=$p(%CTHOS40d(77),"\",7) s %CTHOS40d(9)=$p(%CTHOS40d(77),"\",8) s %CTHOS40d(10)=$p(%CTHOS40d(77),"\",9) s %CTHOS40d(11)=$p(%CTHOS40d(77),"\",10) s %CTHOS40d(12)=$p(%CTHOS40d(77),"\",11) s %CTHOS40d(13)=$p(%CTHOS40d(77),"\",12) s %CTHOS40d(14)=$p(%CTHOS40d(77),"\",13) s %CTHOS40d(15)=$p(%CTHOS40d(77),"\",14) s %CTHOS40d(16)=$p(%CTHOS40d(77),"\",15) s %CTHOS40d(18)=$p(%CTHOS40d(77),"\",16) s %CTHOS40d(19)=$p(%CTHOS40d(77),"\",17) s %CTHOS40d(20)=$p(%CTHOS40d(77),"\",18) s %CTHOS40d(21)=$p(%CTHOS40d(77),"\",20) s %CTHOS40d(22)=$p(%CTHOS40d(77),"\",21) s %CTHOS40d(23)=$p(%CTHOS40d(77),"\",19) s %CTHOS40d(24)=$p(%CTHOS40d(77),"\",22) s %CTHOS40d(25)=$p(%CTHOS40d(77),"\",23) s %CTHOS40d(26)=$p(%CTHOS40d(77),"\",24) s %CTHOS40d(27)=$p(%CTHOS40d(77),"\",25) s %CTHOS40d(28)=$p(%CTHOS40d(77),"\",26) s %CTHOS40d(29)=$p(%CTHOS40d(77),"\",27) s %CTHOS40d(30)=$p(%CTHOS40d(77),"\",28) s %CTHOS40d(31)=$p(%CTHOS40d(77),"\",29) s %CTHOS40d(32)=$p(%CTHOS40d(77),"\",30) s %CTHOS40d(34)=$p(%CTHOS40d(77),"\",31) s %CTHOS40d(35)=$p(%CTHOS40d(77),"\",32) s %CTHOS40d(36)=$p(%CTHOS40d(77),"\",33) s %CTHOS40d(37)=$p(%CTHOS40d(77),"\",34) s %CTHOS40d(39)=$p(%CTHOS40d(77),"\",35) s %CTHOS40d(40)=$p(%CTHOS40d(77),"\",36)
 s %CTHOS40d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS40d(1),"REM",0)) s $li(%CTHOS40d(33),%irep)=$g(^(%irep))
 d %0JBr1 s %CTHOS40d(38)=$l($g(%CTHOS40d(37))) s %CTHOS40d(55)=$zu(28,%CTHOS40d(24),7) s %CTHOS40d(44)=$zu(28,%CTHOS40d(2),6) s %CTHOS40d(41)=$zu(28,%CTHOS40d(1),6)
 s %CTHOS40d(58)=$lb(""_%CTHOS40d(38),""_%CTHOS40d(41),""_%CTHOS40d(44),""_%CTHOS40d(55),""_%CTHOS40d(28),""_%CTHOS40d(37))
 g:%CTHOS40d(57)'=%CTHOS40d(58) %0JCdun
%0JBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS40d(59)=%CTHOS40d(59)+1,%ROWCOUNT=%CTHOS40d(59),%ROWID=%CTHOS40d(1),%CTHOS40c=10 q
%CTHOS40f i '$g(%CTHOS40c) { s SQLCODE=-102 q  } i %CTHOS40c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Jerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS40d(59))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS40d(59),%CTHOS40c=100 q  } g %0Jfirst:%CTHOS40c=1
%0JCdun i $zu(115,2)=1,$g(%CTHOS40d(60))=1 { l -@%CTHOS40d(61) s %CTHOS40d(60)=0 }
 g %0JBk2
%0JBdun 
%0JAdun 
 s %ROWCOUNT=%CTHOS40d(59),SQLCODE=100,%CTHOS40c=100 q
%CTHOS40c i '$g(%CTHOS40c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS40d(59)),1:0)
 i $zu(115,2)=1,$g(%CTHOS40d(60))=1 { l -@%CTHOS40d(61) } k %CTHOS40c,%CTHOS40d,%CTHOS40E,%CTHOS40l,%CTHOS40n,%CTHOS40R,%CTHOS40Z s SQLCODE=0 q
%0Jerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS40c=100 q
%0Mo n %i,icol,ir
 f icol=0:1:41 i $d(PLIST(icol)) s %i(icol)=PLIST(icol)
 s %ROWID=$$%insert^User.CTHospital.T1(.%i,$c(0,0,0,0)),%ROWCOUNT='SQLCODE
 q  // From %0Mo
%0Oo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Oerr" s %mmmsqld(4)=0 s %mmmsqld(5)=""
 s %mmmsqld(3)=$g(ROWID)
 n %data,icol,ir
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(2)=%mmmsqld(3)
 i %mmmsqld(2)'="",$d(^TTAB("RH",%mmmsqld(2)))
 e  g %0OBdun
 s %mmmsqld(10)=$$%getlock^User.CTHospital.T1(%mmmsqld(2)) i '%mmmsqld(10) s SQLCODE=-110 g %0Oc
 ; asl MOD# 3
 i %mmmsqld(2)'="",$d(^TTAB("RH",%mmmsqld(2)))
 e  g %0OCdun
 k %data
 f icol=0:1:41 i $d(PLIST(icol)) s %data(icol)=PLIST(icol)
 d %update^User.CTHospital.T1(%mmmsqld(2),$c(0,2,0,0),.%data,,'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(4))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(10)=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(2)) g %0Oc
%0OCdun 
 d:%mmmsqld(10)=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(2)) g:SQLCODE<0 %0Oc
%0OBdun 
%0OAdun 
%0Oc s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(4)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Oerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(10))=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(2)) g %0Oc
%0Qo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Qerr" s %mmmsqld(3)=0 s %mmmsqld(4)=""
 s %mmmsqld(2)=$g(ROWID)
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(1)=%mmmsqld(2)
 i %mmmsqld(1)'="",$d(^TTAB("RH",%mmmsqld(1)))
 e  g %0QBdun
 s %mmmsqld(9)=$$%getlock^User.CTHospital.T1(%mmmsqld(1)) i '%mmmsqld(9) s SQLCODE=-110 g %0Qc
 ; asl MOD# 3
 i %mmmsqld(1)'="",$d(^TTAB("RH",%mmmsqld(1)))
 e  g %0QCdun
 d %delete^User.CTHospital.T1(%mmmsqld(1),$c(0,2,0,0),'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(3))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(9)=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(1)) g %0Qc
%0QCdun 
 d:%mmmsqld(9)=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(1)) g:SQLCODE<0 %0Qc
%0QBdun 
%0QAdun 
%0Qc s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(3)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Qerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(9))=1 %ReleaseLock^User.CTHospital.T1(%mmmsqld(1)) g %0Qc
%0Wo d %CTHOS10f q:SQLCODE'=0
 s PLIST(1)=%CTHOS10d(1),PLIST(2)=%CTHOS10d(1),PLIST(3)=%CTHOS10d(2),PLIST(4)=%CTHOS10d(3),PLIST(5)=%CTHOS10d(4),PLIST(6)=%CTHOS10d(5),PLIST(7)=%CTHOS10d(6),PLIST(8)=%CTHOS10d(7),PLIST(9)=%CTHOS10d(8),PLIST(10)=%CTHOS10d(9),PLIST(11)=%CTHOS10d(10),PLIST(12)=%CTHOS10d(11),PLIST(13)=%CTHOS10d(12),PLIST(14)=%CTHOS10d(13),PLIST(15)=%CTHOS10d(14),PLIST(16)=%CTHOS10d(15),PLIST(17)=%CTHOS10d(16),PLIST(18)=%CTHOS10d(17),PLIST(19)=%CTHOS10d(18),PLIST(20)=%CTHOS10d(19),PLIST(21)=%CTHOS10d(20),PLIST(22)=%CTHOS10d(21),PLIST(23)=%CTHOS10d(22),PLIST(24)=%CTHOS10d(23),PLIST(25)=%CTHOS10d(24),PLIST(26)=%CTHOS10d(25),PLIST(27)=%CTHOS10d(26),PLIST(28)=%CTHOS10d(27),PLIST(29)=%CTHOS10d(28),PLIST(30)=%CTHOS10d(29),PLIST(31)=%CTHOS10d(30),PLIST(32)=%CTHOS10d(31),PLIST(33)=%CTHOS10d(32),PLIST(34)=%CTHOS10d(33),PLIST(35)=%CTHOS10d(34),PLIST(36)=%CTHOS10d(35),PLIST(37)=%CTHOS10d(36),PLIST(38)=%CTHOS10d(37),PLIST(39)=%CTHOS10d(38),PLIST(40)=%CTHOS10d(39),PLIST(41)=%CTHOS10d(40)
 q
%0Xo d %CTHOS20f q:SQLCODE'=0
 s PLIST(1)=%CTHOS20d(1),PLIST(2)=%CTHOS20d(1),PLIST(3)=%CTHOS20d(2),PLIST(4)=%CTHOS20d(3),PLIST(5)=%CTHOS20d(4),PLIST(6)=%CTHOS20d(5),PLIST(7)=%CTHOS20d(6),PLIST(8)=%CTHOS20d(7),PLIST(9)=%CTHOS20d(8),PLIST(10)=%CTHOS20d(9),PLIST(11)=%CTHOS20d(10),PLIST(12)=%CTHOS20d(11),PLIST(13)=%CTHOS20d(12),PLIST(14)=%CTHOS20d(13),PLIST(15)=%CTHOS20d(14),PLIST(16)=%CTHOS20d(15),PLIST(17)=%CTHOS20d(16),PLIST(18)=%CTHOS20d(17),PLIST(19)=%CTHOS20d(18),PLIST(20)=%CTHOS20d(19),PLIST(21)=%CTHOS20d(20),PLIST(22)=%CTHOS20d(21),PLIST(23)=%CTHOS20d(22),PLIST(24)=%CTHOS20d(23),PLIST(25)=%CTHOS20d(24),PLIST(26)=%CTHOS20d(25),PLIST(27)=%CTHOS20d(26),PLIST(28)=%CTHOS20d(27),PLIST(29)=%CTHOS20d(28),PLIST(30)=%CTHOS20d(29),PLIST(31)=%CTHOS20d(30),PLIST(32)=%CTHOS20d(31),PLIST(33)=%CTHOS20d(32),PLIST(34)=%CTHOS20d(33),PLIST(35)=%CTHOS20d(34),PLIST(36)=%CTHOS20d(35),PLIST(37)=%CTHOS20d(36),PLIST(38)=%CTHOS20d(37),PLIST(39)=%CTHOS20d(38),PLIST(40)=%CTHOS20d(39),PLIST(41)=%CTHOS20d(40)
 q
%0Yo d %CTHOS30f q:SQLCODE'=0
 s PLIST(1)=%CTHOS30d(1),PLIST(2)=%CTHOS30d(1),PLIST(3)=%CTHOS30d(2),PLIST(4)=%CTHOS30d(3),PLIST(5)=%CTHOS30d(4),PLIST(6)=%CTHOS30d(5),PLIST(7)=%CTHOS30d(6),PLIST(8)=%CTHOS30d(7),PLIST(9)=%CTHOS30d(8),PLIST(10)=%CTHOS30d(9),PLIST(11)=%CTHOS30d(10),PLIST(12)=%CTHOS30d(11),PLIST(13)=%CTHOS30d(12),PLIST(14)=%CTHOS30d(13),PLIST(15)=%CTHOS30d(14),PLIST(16)=%CTHOS30d(15),PLIST(17)=%CTHOS30d(16),PLIST(18)=%CTHOS30d(17),PLIST(19)=%CTHOS30d(18),PLIST(20)=%CTHOS30d(19),PLIST(21)=%CTHOS30d(20),PLIST(22)=%CTHOS30d(21),PLIST(23)=%CTHOS30d(22),PLIST(24)=%CTHOS30d(23),PLIST(25)=%CTHOS30d(24),PLIST(26)=%CTHOS30d(25),PLIST(27)=%CTHOS30d(26),PLIST(28)=%CTHOS30d(27),PLIST(29)=%CTHOS30d(28),PLIST(30)=%CTHOS30d(29),PLIST(31)=%CTHOS30d(30),PLIST(32)=%CTHOS30d(31),PLIST(33)=%CTHOS30d(32),PLIST(34)=%CTHOS30d(33),PLIST(35)=%CTHOS30d(34),PLIST(36)=%CTHOS30d(35),PLIST(37)=%CTHOS30d(36),PLIST(38)=%CTHOS30d(37),PLIST(39)=%CTHOS30d(38),PLIST(40)=%CTHOS30d(39),PLIST(41)=%CTHOS30d(40)
 q
%0Zo d %CTHOS40f q:SQLCODE'=0
 s PLIST(1)=%CTHOS40d(1),PLIST(2)=%CTHOS40d(1),PLIST(3)=%CTHOS40d(2),PLIST(4)=%CTHOS40d(3),PLIST(5)=%CTHOS40d(4),PLIST(6)=%CTHOS40d(5),PLIST(7)=%CTHOS40d(6),PLIST(8)=%CTHOS40d(7),PLIST(9)=%CTHOS40d(8),PLIST(10)=%CTHOS40d(9),PLIST(11)=%CTHOS40d(10),PLIST(12)=%CTHOS40d(11),PLIST(13)=%CTHOS40d(12),PLIST(14)=%CTHOS40d(13),PLIST(15)=%CTHOS40d(14),PLIST(16)=%CTHOS40d(15),PLIST(17)=%CTHOS40d(16),PLIST(18)=%CTHOS40d(17),PLIST(19)=%CTHOS40d(18),PLIST(20)=%CTHOS40d(19),PLIST(21)=%CTHOS40d(20),PLIST(22)=%CTHOS40d(21),PLIST(23)=%CTHOS40d(22),PLIST(24)=%CTHOS40d(23),PLIST(25)=%CTHOS40d(24),PLIST(26)=%CTHOS40d(25),PLIST(27)=%CTHOS40d(26),PLIST(28)=%CTHOS40d(27),PLIST(29)=%CTHOS40d(28),PLIST(30)=%CTHOS40d(29),PLIST(31)=%CTHOS40d(30),PLIST(32)=%CTHOS40d(31),PLIST(33)=%CTHOS40d(32),PLIST(34)=%CTHOS40d(33),PLIST(35)=%CTHOS40d(34),PLIST(36)=%CTHOS40d(35),PLIST(37)=%CTHOS40d(36),PLIST(38)=%CTHOS40d(37),PLIST(39)=%CTHOS40d(38),PLIST(40)=%CTHOS40d(39),PLIST(41)=%CTHOS40d(40)
 q
%04Br1 n cnt s cnt=0
 s PLIST(18)=""
 i $g(PLIST(4))'="" s cnt=cnt+1,$p(PLIST(18),"|",cnt)=$g(PLIST(4))
 i $g(PLIST(5))'="" s cnt=cnt+1,$p(PLIST(18),"|",cnt)=$g(PLIST(5))
 i $g(PLIST(6))'="" s cnt=cnt+1,$p(PLIST(18),"|",cnt)=$g(PLIST(6))
 i $g(PLIST(7))'="" s cnt=cnt+1,$p(PLIST(18),"|",cnt)=$g(PLIST(7))
 i $g(PLIST(8))'="" s cnt=cnt+1,$p(PLIST(18),"|",cnt)=$g(PLIST(8))
 k cnt q
%04o n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%04err" s %mmmsqld(44)=0,%mmmsqld(45)=""
 s %mmmsqld(42)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(2)=%mmmsqld(42)
 i PLIST(2)'="",$d(^TTAB("RH",PLIST(2)))
 e  g %04Bdun
 s %mmmsqld(50)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(50),"\",1) s PLIST(4)=$p(%mmmsqld(50),"\",2) s PLIST(5)=$p(%mmmsqld(50),"\",3) s PLIST(6)=$p(%mmmsqld(50),"\",4) s PLIST(7)=$p(%mmmsqld(50),"\",5) s PLIST(8)=$p(%mmmsqld(50),"\",6) s PLIST(9)=$p(%mmmsqld(50),"\",7) s PLIST(10)=$p(%mmmsqld(50),"\",8) s PLIST(11)=$p(%mmmsqld(50),"\",9) s PLIST(12)=$p(%mmmsqld(50),"\",10) s PLIST(13)=$p(%mmmsqld(50),"\",11) s PLIST(14)=$p(%mmmsqld(50),"\",12) s PLIST(15)=$p(%mmmsqld(50),"\",13) s PLIST(16)=$p(%mmmsqld(50),"\",14) s PLIST(17)=$p(%mmmsqld(50),"\",15) s PLIST(19)=$p(%mmmsqld(50),"\",16) s PLIST(20)=$p(%mmmsqld(50),"\",17) s PLIST(21)=$p(%mmmsqld(50),"\",18) s PLIST(22)=$p(%mmmsqld(50),"\",20) s PLIST(23)=$p(%mmmsqld(50),"\",21) s PLIST(24)=$p(%mmmsqld(50),"\",19) s PLIST(25)=$p(%mmmsqld(50),"\",22) s PLIST(26)=$p(%mmmsqld(50),"\",23) s PLIST(27)=$p(%mmmsqld(50),"\",24) s PLIST(28)=$p(%mmmsqld(50),"\",25) s PLIST(29)=$p(%mmmsqld(50),"\",26) s PLIST(30)=$p(%mmmsqld(50),"\",27) s PLIST(31)=$p(%mmmsqld(50),"\",28) s PLIST(32)=$p(%mmmsqld(50),"\",29) s PLIST(33)=$p(%mmmsqld(50),"\",30) s PLIST(35)=$p(%mmmsqld(50),"\",31) s PLIST(36)=$p(%mmmsqld(50),"\",32) s PLIST(37)=$p(%mmmsqld(50),"\",33) s PLIST(38)=$p(%mmmsqld(50),"\",34) s PLIST(40)=$p(%mmmsqld(50),"\",35) s PLIST(41)=$p(%mmmsqld(50),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
 g:$zu(115,2)=0 %04Buncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(PLIST(2),"||",1))#"S":$zu(115,4) i $t { s %mmmsqld(44)=1,%mmmsqld(45)=$name(^TTAB("RH",$p(PLIST(2),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_PLIST(2) ztrap "LOCK"  }
 ; asl MOD# 3
 i PLIST(2)'="",$d(^TTAB("RH",PLIST(2)))
 e  g %04Cdun
 s %mmmsqld(55)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(55),"\",1) s PLIST(4)=$p(%mmmsqld(55),"\",2) s PLIST(5)=$p(%mmmsqld(55),"\",3) s PLIST(6)=$p(%mmmsqld(55),"\",4) s PLIST(7)=$p(%mmmsqld(55),"\",5) s PLIST(8)=$p(%mmmsqld(55),"\",6) s PLIST(9)=$p(%mmmsqld(55),"\",7) s PLIST(10)=$p(%mmmsqld(55),"\",8) s PLIST(11)=$p(%mmmsqld(55),"\",9) s PLIST(12)=$p(%mmmsqld(55),"\",10) s PLIST(13)=$p(%mmmsqld(55),"\",11) s PLIST(14)=$p(%mmmsqld(55),"\",12) s PLIST(15)=$p(%mmmsqld(55),"\",13) s PLIST(16)=$p(%mmmsqld(55),"\",14) s PLIST(17)=$p(%mmmsqld(55),"\",15) s PLIST(19)=$p(%mmmsqld(55),"\",16) s PLIST(20)=$p(%mmmsqld(55),"\",17) s PLIST(21)=$p(%mmmsqld(55),"\",18) s PLIST(22)=$p(%mmmsqld(55),"\",20) s PLIST(23)=$p(%mmmsqld(55),"\",21) s PLIST(24)=$p(%mmmsqld(55),"\",19) s PLIST(25)=$p(%mmmsqld(55),"\",22) s PLIST(26)=$p(%mmmsqld(55),"\",23) s PLIST(27)=$p(%mmmsqld(55),"\",24) s PLIST(28)=$p(%mmmsqld(55),"\",25) s PLIST(29)=$p(%mmmsqld(55),"\",26) s PLIST(30)=$p(%mmmsqld(55),"\",27) s PLIST(31)=$p(%mmmsqld(55),"\",28) s PLIST(32)=$p(%mmmsqld(55),"\",29) s PLIST(33)=$p(%mmmsqld(55),"\",30) s PLIST(35)=$p(%mmmsqld(55),"\",31) s PLIST(36)=$p(%mmmsqld(55),"\",32) s PLIST(37)=$p(%mmmsqld(55),"\",33) s PLIST(38)=$p(%mmmsqld(55),"\",34) s PLIST(40)=$p(%mmmsqld(55),"\",35) s PLIST(41)=$p(%mmmsqld(55),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
%04Buncommitted ;
 s PLIST(1)=PLIST(2)
 s SQLCODE=0 g %04c
%04Cdun i $zu(115,2)=1,$g(%mmmsqld(44))=1 { l -@%mmmsqld(45) s %mmmsqld(44)=0 }
%04Bdun 
%04Adun 
%04c s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(44))=1 { l -@%mmmsqld(45) } q
%04err s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %04c
%07o n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%07err" s %mmmsqld(46)=0,%mmmsqld(47)=""
 s %mmmsqld(42)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(2)=""
%07Bk1 s PLIST(2)=$o(^TTAB("RH",PLIST(2)))
 i PLIST(2)="" g %07Bdun
 s %mmmsqld(52)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(16)=$p(%mmmsqld(52),"\",14)
 g:'(PLIST(16)=%mmmsqld(42)) %07Bk1
 g:'(PLIST(16)'="") %07Bk1
 s PLIST(3)=$p(%mmmsqld(52),"\",1) s PLIST(4)=$p(%mmmsqld(52),"\",2) s PLIST(5)=$p(%mmmsqld(52),"\",3) s PLIST(6)=$p(%mmmsqld(52),"\",4) s PLIST(7)=$p(%mmmsqld(52),"\",5) s PLIST(8)=$p(%mmmsqld(52),"\",6) s PLIST(9)=$p(%mmmsqld(52),"\",7) s PLIST(10)=$p(%mmmsqld(52),"\",8) s PLIST(11)=$p(%mmmsqld(52),"\",9) s PLIST(12)=$p(%mmmsqld(52),"\",10) s PLIST(13)=$p(%mmmsqld(52),"\",11) s PLIST(14)=$p(%mmmsqld(52),"\",12) s PLIST(15)=$p(%mmmsqld(52),"\",13) s PLIST(17)=$p(%mmmsqld(52),"\",15) s PLIST(19)=$p(%mmmsqld(52),"\",16) s PLIST(20)=$p(%mmmsqld(52),"\",17) s PLIST(21)=$p(%mmmsqld(52),"\",18) s PLIST(22)=$p(%mmmsqld(52),"\",20) s PLIST(23)=$p(%mmmsqld(52),"\",21) s PLIST(24)=$p(%mmmsqld(52),"\",19) s PLIST(25)=$p(%mmmsqld(52),"\",22) s PLIST(26)=$p(%mmmsqld(52),"\",23) s PLIST(27)=$p(%mmmsqld(52),"\",24) s PLIST(28)=$p(%mmmsqld(52),"\",25) s PLIST(29)=$p(%mmmsqld(52),"\",26) s PLIST(30)=$p(%mmmsqld(52),"\",27) s PLIST(31)=$p(%mmmsqld(52),"\",28) s PLIST(32)=$p(%mmmsqld(52),"\",29) s PLIST(33)=$p(%mmmsqld(52),"\",30) s PLIST(35)=$p(%mmmsqld(52),"\",31) s PLIST(36)=$p(%mmmsqld(52),"\",32) s PLIST(37)=$p(%mmmsqld(52),"\",33) s PLIST(38)=$p(%mmmsqld(52),"\",34) s PLIST(40)=$p(%mmmsqld(52),"\",35) s PLIST(41)=$p(%mmmsqld(52),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
 g:$zu(115,2)=0 %07Buncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(PLIST(2),"||",1))#"S":$zu(115,4) i $t { s %mmmsqld(46)=1,%mmmsqld(47)=$name(^TTAB("RH",$p(PLIST(2),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_PLIST(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %mmmsqld(44)=$lb(""_PLIST(16))
 i PLIST(2)'="",$d(^TTAB("RH",PLIST(2)))
 e  g %07Cdun
 s %mmmsqld(57)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(57),"\",1) s PLIST(4)=$p(%mmmsqld(57),"\",2) s PLIST(5)=$p(%mmmsqld(57),"\",3) s PLIST(6)=$p(%mmmsqld(57),"\",4) s PLIST(7)=$p(%mmmsqld(57),"\",5) s PLIST(8)=$p(%mmmsqld(57),"\",6) s PLIST(9)=$p(%mmmsqld(57),"\",7) s PLIST(10)=$p(%mmmsqld(57),"\",8) s PLIST(11)=$p(%mmmsqld(57),"\",9) s PLIST(12)=$p(%mmmsqld(57),"\",10) s PLIST(13)=$p(%mmmsqld(57),"\",11) s PLIST(14)=$p(%mmmsqld(57),"\",12) s PLIST(15)=$p(%mmmsqld(57),"\",13) s PLIST(16)=$p(%mmmsqld(57),"\",14) s PLIST(17)=$p(%mmmsqld(57),"\",15) s PLIST(19)=$p(%mmmsqld(57),"\",16) s PLIST(20)=$p(%mmmsqld(57),"\",17) s PLIST(21)=$p(%mmmsqld(57),"\",18) s PLIST(22)=$p(%mmmsqld(57),"\",20) s PLIST(23)=$p(%mmmsqld(57),"\",21) s PLIST(24)=$p(%mmmsqld(57),"\",19) s PLIST(25)=$p(%mmmsqld(57),"\",22) s PLIST(26)=$p(%mmmsqld(57),"\",23) s PLIST(27)=$p(%mmmsqld(57),"\",24) s PLIST(28)=$p(%mmmsqld(57),"\",25) s PLIST(29)=$p(%mmmsqld(57),"\",26) s PLIST(30)=$p(%mmmsqld(57),"\",27) s PLIST(31)=$p(%mmmsqld(57),"\",28) s PLIST(32)=$p(%mmmsqld(57),"\",29) s PLIST(33)=$p(%mmmsqld(57),"\",30) s PLIST(35)=$p(%mmmsqld(57),"\",31) s PLIST(36)=$p(%mmmsqld(57),"\",32) s PLIST(37)=$p(%mmmsqld(57),"\",33) s PLIST(38)=$p(%mmmsqld(57),"\",34) s PLIST(40)=$p(%mmmsqld(57),"\",35) s PLIST(41)=$p(%mmmsqld(57),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
 s %mmmsqld(45)=$lb(""_PLIST(16))
 g:%mmmsqld(44)'=%mmmsqld(45) %07Cdun
%07Buncommitted ;
 s PLIST(1)=PLIST(2)
 s SQLCODE=0 g %07c
%07Cdun i $zu(115,2)=1,$g(%mmmsqld(46))=1 { l -@%mmmsqld(47) s %mmmsqld(46)=0 }
 g %07Bk1
%07Bdun 
%07Adun 
%07c s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(46))=1 { l -@%mmmsqld(47) } q
%07err s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %07c
%09o n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%09err" s %mmmsqld(46)=0,%mmmsqld(47)=""
 s %mmmsqld(42)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(38)=%mmmsqld(42)
 i PLIST(38)="" g %09Bdun
 i '(PLIST(38)'="") g %09Bdun
 s PLIST(2)=""
%09Bk1 s PLIST(2)=$o(^TTABi("RH-1",PLIST(38),PLIST(2)))
 i PLIST(2)="" g %09Bdun
 i PLIST(2)'="",$d(^TTAB("RH",PLIST(2)))
 e  g %09Bk1
 s %mmmsqld(57)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(57),"\",1) s PLIST(4)=$p(%mmmsqld(57),"\",2) s PLIST(5)=$p(%mmmsqld(57),"\",3) s PLIST(6)=$p(%mmmsqld(57),"\",4) s PLIST(7)=$p(%mmmsqld(57),"\",5) s PLIST(8)=$p(%mmmsqld(57),"\",6) s PLIST(9)=$p(%mmmsqld(57),"\",7) s PLIST(10)=$p(%mmmsqld(57),"\",8) s PLIST(11)=$p(%mmmsqld(57),"\",9) s PLIST(12)=$p(%mmmsqld(57),"\",10) s PLIST(13)=$p(%mmmsqld(57),"\",11) s PLIST(14)=$p(%mmmsqld(57),"\",12) s PLIST(15)=$p(%mmmsqld(57),"\",13) s PLIST(16)=$p(%mmmsqld(57),"\",14) s PLIST(17)=$p(%mmmsqld(57),"\",15) s PLIST(19)=$p(%mmmsqld(57),"\",16) s PLIST(20)=$p(%mmmsqld(57),"\",17) s PLIST(21)=$p(%mmmsqld(57),"\",18) s PLIST(22)=$p(%mmmsqld(57),"\",20) s PLIST(23)=$p(%mmmsqld(57),"\",21) s PLIST(24)=$p(%mmmsqld(57),"\",19) s PLIST(25)=$p(%mmmsqld(57),"\",22) s PLIST(26)=$p(%mmmsqld(57),"\",23) s PLIST(27)=$p(%mmmsqld(57),"\",24) s PLIST(28)=$p(%mmmsqld(57),"\",25) s PLIST(29)=$p(%mmmsqld(57),"\",26) s PLIST(30)=$p(%mmmsqld(57),"\",27) s PLIST(31)=$p(%mmmsqld(57),"\",28) s PLIST(32)=$p(%mmmsqld(57),"\",29) s PLIST(33)=$p(%mmmsqld(57),"\",30) s PLIST(35)=$p(%mmmsqld(57),"\",31) s PLIST(36)=$p(%mmmsqld(57),"\",32) s PLIST(37)=$p(%mmmsqld(57),"\",33) s PLIST(38)=$p(%mmmsqld(57),"\",34) s PLIST(40)=$p(%mmmsqld(57),"\",35) s PLIST(41)=$p(%mmmsqld(57),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
 g:$zu(115,2)=0 %09Buncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(PLIST(2),"||",1))#"S":$zu(115,4) i $t { s %mmmsqld(46)=1,%mmmsqld(47)=$name(^TTAB("RH",$p(PLIST(2),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_PLIST(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %mmmsqld(44)=$lb(""_PLIST(38))
 i PLIST(2)'="",$d(^TTAB("RH",PLIST(2)))
 e  g %09Cdun
 s %mmmsqld(62)=$g(^TTAB("RH",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(62),"\",1) s PLIST(4)=$p(%mmmsqld(62),"\",2) s PLIST(5)=$p(%mmmsqld(62),"\",3) s PLIST(6)=$p(%mmmsqld(62),"\",4) s PLIST(7)=$p(%mmmsqld(62),"\",5) s PLIST(8)=$p(%mmmsqld(62),"\",6) s PLIST(9)=$p(%mmmsqld(62),"\",7) s PLIST(10)=$p(%mmmsqld(62),"\",8) s PLIST(11)=$p(%mmmsqld(62),"\",9) s PLIST(12)=$p(%mmmsqld(62),"\",10) s PLIST(13)=$p(%mmmsqld(62),"\",11) s PLIST(14)=$p(%mmmsqld(62),"\",12) s PLIST(15)=$p(%mmmsqld(62),"\",13) s PLIST(16)=$p(%mmmsqld(62),"\",14) s PLIST(17)=$p(%mmmsqld(62),"\",15) s PLIST(19)=$p(%mmmsqld(62),"\",16) s PLIST(20)=$p(%mmmsqld(62),"\",17) s PLIST(21)=$p(%mmmsqld(62),"\",18) s PLIST(22)=$p(%mmmsqld(62),"\",20) s PLIST(23)=$p(%mmmsqld(62),"\",21) s PLIST(24)=$p(%mmmsqld(62),"\",19) s PLIST(25)=$p(%mmmsqld(62),"\",22) s PLIST(26)=$p(%mmmsqld(62),"\",23) s PLIST(27)=$p(%mmmsqld(62),"\",24) s PLIST(28)=$p(%mmmsqld(62),"\",25) s PLIST(29)=$p(%mmmsqld(62),"\",26) s PLIST(30)=$p(%mmmsqld(62),"\",27) s PLIST(31)=$p(%mmmsqld(62),"\",28) s PLIST(32)=$p(%mmmsqld(62),"\",29) s PLIST(33)=$p(%mmmsqld(62),"\",30) s PLIST(35)=$p(%mmmsqld(62),"\",31) s PLIST(36)=$p(%mmmsqld(62),"\",32) s PLIST(37)=$p(%mmmsqld(62),"\",33) s PLIST(38)=$p(%mmmsqld(62),"\",34) s PLIST(40)=$p(%mmmsqld(62),"\",35) s PLIST(41)=$p(%mmmsqld(62),"\",36)
 s PLIST(34)="" f %irep=1:1:$g(^TTAB("RH",PLIST(2),"REM",0)) s $li(PLIST(34),%irep)=$g(^(%irep))
 d %04Br1 s PLIST(39)=$l($g(PLIST(38)))
 s %mmmsqld(45)=$lb(""_PLIST(38))
 g:%mmmsqld(44)'=%mmmsqld(45) %09Cdun
%09Buncommitted ;
 s PLIST(1)=PLIST(2)
 s SQLCODE=0 g %09c
%09Cdun i $zu(115,2)=1,$g(%mmmsqld(46))=1 { l -@%mmmsqld(47) s %mmmsqld(46)=0 }
 g %09Bk1
%09Bdun 
%09Adun 
%09c s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(46))=1 { l -@%mmmsqld(47) } q
%09err s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %09c
]]></Routine>
</Export>
