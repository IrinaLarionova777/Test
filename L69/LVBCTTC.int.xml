<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="LVBCTTC" type="INT" languagemode="0" generated="1"><![CDATA[
LVBCTTC ; IG 30/4/98 ;MVB Control code access for CT_TestCode
 ;
 ; supported calls:
 ;
 ; $$select^LVBCTTC(ROWID,skip,user)
 ; $$selskip^LVBCTTC(ROWID)
 ; $$seldata^LVBCTTC(ROWID,data)
 ; $$open^LVBCTTC(par,code,syn,skip,user,type,active,sort,NN,p9)
 ; $$fetch^LVBCTTC(par,code,syn,skip,user,type,active,sort,NN,p9)
 ; $$fetchbuffer^LVBCTTC(par,code,syn,skip,user,type,active,sort,NN,p9)
 ; $$fetchall^LVBCTTC(par,code,syn,skip,user,type,active,sort,NN,p9)
 ; $$close^LVBCTTC()
 ; $$insert^LVBCTTC()
 ; $$update^LVBCTTC(ROWID)
 ; $$delete^LVBCTTC(ROWID,Comments)
 ; $$getall^LVBCTTC(type)
 ; $$getall1^LVBCTTC(ts,report,exclude,include,short)
 ; $$getall2^LVBCTTC(ts)
 ; $$copy1^LVBCTTC(tcfrom,tcto)
 ; $$copy2^LVBCTTC(tcfrom,tcto,delete)
 ; $$ValUser^LVBCTTC(user,tc)
 ;
  ;---&SQL(DECLARE CTTC0 CURSOR FOR SELECT * FROM CT_TestCode
   ;---         WHERE ((%ALPHAUP(CTTC_Desc) %STARTSWITH %ALPHAUP(:par)) OR (:par IS NULL))
   ;---         AND ((%ALPHAUP(CTTC_Code) %STARTSWITH %ALPHAUP(:code)) OR (:code IS NULL))
   ;---         AND ((%ALPHAUP(CTTC_Synonym) %STARTSWITH %ALPHAUP(:syn)) OR (:syn IS NULL))
   ;---         AND ((%ALPHAUP(CTTC_NationalNameLong) %STARTSWITH %ALPHAUP(:NNLong)) OR (:NNLong IS NULL))
   ;---         AND ((%ALPHAUP(CTTC_NationalNameShort) %STARTSWITH %ALPHAUP(:NNShort)) OR (:NNShort IS NULL))
   ;---         AND ((CTTC_ResultFormat = :type) or (:type IS NULL))
   ;---         AND ((CTTC_ActiveFlag = :active) OR (:active is NULL)))
   ;--- ** SQL PUBLIC Variables: NNLong, NNShort, SQLCODE, active, code, par, syn, type
  ;---&SQL(DECLARE CTTC1 CURSOR FOR SELECT * FROM CT_TestCode
   ;---         ORDER BY CTTC_Desc)
   ;--- ** SQL PUBLIC Variables: SQLCODE
FIX s a="" f  s a=$o(^TTAB("SY",a)) q:a=""  k ^TTAB("SY",a,"TC")
 k ^TTABi("TC")
 s a="" f  s a=$o(^TTAB("TC",a)) q:a=""  i '$$select(a,"Y") d
 .i " Y N "'[(" "_PLIST(53)_" ") s PLIST(53)=""
 .s PLIST(3)=$tr(PLIST(3),"^\|",$c(16,17,18)),PLIST(4)=$tr(PLIST(4),"^\|"_$c(20),$c(16,17,18,16)) s:PLIST(54)="" PLIST(54)="Y"
 .s err=$$update(a) i err w !,a," ",err
 .s ts="" f  s ts=$o(^TTAB("TC",a,3,ts)) q:ts=""  d
 ..i '$d(^TTAB("TC",a,1,ts)) k ^TTAB("TC",a,3,ts)
 d ##class(User.CTTestCode).%BuildIndices()
 q
 ; insert the data
insert() d pre("N") k PLIST(1)
  ;---&SQL(insert INTO CT_TestCode VALUES :PLIST())
   ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 Do %0Eo
 i 'SQLCODE q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ; update the data
update(ROWID) d pre("Y") s ROWID=$g(ROWID)
  ;---&SQL(UPDATE CT_TestCode VALUES :PLIST() WHERE CTTC_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %0Go
 I 'SQLCODE Q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ; delete the data
delete(ROWID,Comments) s ROWID=$g(ROWID),^TMP("Comments",$j)=$g(Comments)
  ;---&SQL(DELETE FROM CT_TestCode WHERE CTTC_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: ROWID, SQLCODE
 Do %0Io
 k ^TMP("Comments",$j)
 q SQLCODE
 ; open the cursor
open(par,code,syn,skip,user,type,active,sort,NN,p9) 
 s par=$g(par),code=$g(code),syn=$g(syn),skip=$g(skip),user=$g(user),type=$g(type),active=$g(active),sort=$g(sort),NN=$g(NN)
 s NNLong=$p(NN,$c(1),1),NNShort=$p(NN,$c(1),2)
  ;---i sort'="Y" &SQL(OPEN CTTC0)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i sort'="Y" Do %CTTC00o
  ;---i sort="Y" &SQL(OPEN CTTC1)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i sort="Y" Do %CTTC10o
 q 0
 ; fetch the data
fetch(par,code,syn,skip,user,type,active,sort,NN,p9) k PLIST
 s par=$g(par),code=$g(code),syn=$g(syn),skip=$g(skip),user=$g(user),type=$g(type),active=$g(active),sort=$g(sort),NN=$g(NN)
 s NNLong=$p(NN,$c(1),1),NNShort=$p(NN,$c(1),2)
  ;---i sort'="Y" f  &SQL(FETCH CTTC0 INTO :PLIST()) q:SQLCODE  q:$$ValUser(user,$p(PLIST(1),$c(1)))'=60
   ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 i sort'="Y" f  Do %0Mo q:SQLCODE  q:$$ValUser(user,$p(PLIST(1),$c(1)))'=60
  ;---i sort="Y" f  &SQL(FETCH CTTC1 INTO :PLIST()) q:SQLCODE  q:$$ValUser(user,$p(PLIST(1),$c(1)))'=60
   ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 i sort="Y" f  Do %0No q:SQLCODE  q:$$ValUser(user,$p(PLIST(1),$c(1)))'=60
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE d adjust
 q SQLCODE
 ; fetch all data
fetchbuffer(par,code,syn,skip,user,type,active,sort,NN,p9) k ^TMP($zn,$j)
 s par=$g(par),code=$g(code),syn=$g(syn),skip=$g(skip),user=$g(user),type=$g(type),active=$g(active),sort=$g(sort),NN=$g(NN)
 s max=$s($g(PLIST(1)):PLIST(1),1:100) i max>100 s max=100
 f xxx=1:1:max s SQLCODE=$$fetch(par,code,syn,skip,user,type,active,sort,NN) q:SQLCODE  d
 .s cnt=$o(^TMP($zn,$j,""),-1)+1 f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 k PLIST m PLIST=^TMP($zn,$j) k ^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 q SQLCODE
fetchall(par,code,syn,skip,user,type,active,sort,NN,p9) n (par,code,syn,skip,user,type,active,sort,NN,PLIST) k ^TMP($zn,$j)
 s par=$g(par),code=$g(code),syn=$g(syn),skip=$g(skip),user=$g(user),type=$g(type),active=$g(active),sort=$g(sort),NN=$g(NN)
 i $$open(par,code,syn,skip,user,type,active,sort,NN)
 f cnt=1:1 q:$$fetch(par,code,syn,skip,user,type,active,sort,NN)  s ^TMP($zn,$j,cnt)="" f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 i $$close()
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ; close the cursor
close() 
  ;---&SQL(CLOSE CTTC0)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTTC00c
  ;---&SQL(CLOSE CTTC1)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTTC10c
 q 0
 ; select data by code
select(ROWID,skip,user) k PLIST s ROWID=$$ALPHAUP^SSUTIL4(ROWID),skip=$g(skip),user=$g(user)
 ; check synonym
 i $l(ROWID),'$d(^TTAB("TC",ROWID)) s xx=$$select^LVBCTSY(ROWID,"TC") i $l(xx) s ROWID=xx
  ;---&SQL(SELECT * INTO :PLIST() FROM CT_TestCode WHERE CTTC_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %0Qo
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE s SQLCODE=$$ValUser(user,$p(PLIST(1),$c(1))) i 'SQLCODE d adjust
 q SQLCODE
 ; select data by code
selskip(ROWID) n (ROWID,PLIST) k PLIST s skip="Y"
 f j=2,3,5,14 s PLIST(j)=$$seldata(ROWID,j)
 s PLIST=$o(PLIST(""),-1)
 d adjust
 q 0
 ; select data by code and field No
seldata(ROWID,data) n (ROWID,data) s ROWID=$g(ROWID),data=$g(data),result=""
 i $l(ROWID) d  q result
 .i data=2 s result=ROWID q
 .i data=3 s result=$p($g(^TTAB("TC",ROWID)),"\",1) q
 .i data=4 s result=$p($g(^TTAB("TC",ROWID)),"\",2) q
 .i data=5 s result=$p($g(^TTAB("TC",ROWID)),"\",3) q
 .i data=6 s result=$p($g(^TTAB("TC",ROWID)),"\",4) q
 .i data=9 s result=$p($g(^TTAB("TC",ROWID)),"\",7) q
 .i data=11 s result=$p($g(^TTAB("TC",ROWID)),"\",25) q
 .i data=12 s result=$p($g(^TTAB("TC",ROWID)),"\",10) q
 .i data=14 s result=$p($g(^TTAB("TC",ROWID)),"\",12) q
 .i data=15 s result=$p($g(^TTAB("TC",ROWID)),"\",13) q
 .i data=16 s result=$p($g(^TTAB("TC",ROWID)),"\",14) q
 .i data=17 s result=$e(ROWID) q
 .i data=19 s result=$p($g(^TTAB("TC",ROWID)),"\",28) q
 .i data=20 s result=$p($g(^TTAB("TC",ROWID)),"\",29) q
 .i data=35 s result=$p($g(^TTAB("TC",ROWID)),"\",9) q
 .i data=42 s result=$p($g(^TTAB("TC",ROWID)),"\",15) q
 .i data=53 s result=$p($g(^TTAB("TC",ROWID)),"\",5) q
 .i data=55 s result=$p($g(^TTAB("TC",ROWID)),"\",6) q
 .i '$$select(ROWID,"Y") s result=$g(PLIST(data))
 q result
 ; pre-filing adjustments
pre(xUpdate) d PreSQL^SSUTIL4("8","")
 s (PLIST(1),PLIST(2))=$$ALPHAUP^SSUTIL4(PLIST(2))
 q
 ; post-filing adjustments
adjust N plist,I,J,SQLCODE,X d PostSQL^SSUTIL4("8")
 i $g(skip)="Y" q
 I $G(PLIST(15))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTA(plist(15),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(15)=X K plist
 I $G(PLIST(43))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTTM(plist(43),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(43)=X K plist
 q
getall(type,user,active) N (type,user,active,PLIST) K ^TMP($ZN,$J) s type=$g(type),user=$g(user),active=$g(active)
 I $$open(,,,"Y",user,type,active)
 F cnt=1:1 Q:$$fetch(,,,"Y",user,type,active)  d
 .s ^TMP($ZN,$J,cnt)=$p(PLIST(1),$c(1))_$c(2)_$P(PLIST(3),$c(1))_$c(2)_$P(PLIST(2),$c(1))_$c(2)
 I $$close()
 K PLIST M PLIST=^TMP($ZN,$J)
 S PLIST=$o(PLIST(""),-1)
 K ^TMP($ZN,$J)
 Q 0
 ; get list of TestCodes for TestSet
getall1(ts,report,exclude,include,short) n (ts,report,exclude,include,short,PLIST) s ts=$g(ts),report=$g(report),exclude=$g(exclude),include=$g(include),short=$g(short),cnt=0 k PLIST
 k ^TMP($zn,$j)
 s fld="" f  s fld=$o(^TTAB("TS",ts,0,fld)) q:fld=""  s s=^(fld) d
 .i report="Y",$p(s,"\",13)'="Y" q
 .s tc=$p(s,"\",8) i $l(tc),'$$select(tc,"Y") d
 ..i $l(exclude),","_exclude_","[(","_PLIST(5)_",") q
 ..i $l(include),","_include_","'[(","_PLIST(5)_",") q
 ..s str1="" i short'="Y" f j=1:1:PLIST s $p(str1,$c(28),j)=PLIST(j)
 ..s str2="" i short'="Y",'$$select^LVBCTTSF(ts_"||0||"_fld,"Y") f j=1:1:PLIST s $p(str2,$c(28),j)=PLIST(j)
 ..s cnt=cnt+1,^TMP($zn,$j,cnt)=tc_$c(2)_$$seldata(tc,3)_$c(2)_tc_$c(2)_str1_$c(2)_str2
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ; get list of TestCodes for TestSet
getall2(ts) n (ts,PLIST) s ts=$g(ts),cnt=0 k PLIST
 s fld="" f  s fld=$o(^TTAB("TS",ts,0,fld)) q:fld=""  s s=^(fld) d
 .s tc=$p(s,"\",8) i $l(tc),'$$select(tc,"Y") d
 ..s cnt=cnt+1,plist(cnt)=tc_$c(2)_PLIST(3)_$c(2)_tc_$c(2)_PLIST(14)_$c(28)_PLIST(5)_$c(28)_$p(s,"\",6)_$c(28)_PLIST(7)_$c(28)_PLIST(8)
 k PLIST m PLIST=plist k plist
 s PLIST=$o(PLIST(""),-1)
 q 0
 ; copy test code ranges from 1 testcode to another
copy1(tcfrom,tcto) n (tcfrom,tcto)
 i $l(tcfrom),$l(tcto) d
 .s date="" f   s date=$o(^TTAB("TC",tcfrom,4,date)) q:date=""  d
 ..i $$delall^LVBCTTCR(tcto,date,"Copy from "_tcfrom)
 ..f j=0,"0-IN" m ^TTAB("TC",tcto,4,date,j)=^TTAB("TC",tcfrom,4,date,j)
 q 0
 ; copy test code standard comments from 1 testcode to another
copy2(tcfrom,tcto,delete) n (tcfrom,tcto,delete)
 i $l(tcfrom),$l(tcto) d
 .i $g(delete)="Y",$$delall^LVBCTTCT(tcto,"Copy from "_tcfrom)
 .s x="" f  s x=$o(^TTAB("TC",tcfrom,2,x)) q:x=""  d
 ..i $$delete^LVBCTTCT(tcto_"||"_x,"Copy from "_tcfrom)
 ..m ^TTAB("TC",tcto,2,x)=^TTAB("TC",tcfrom,2,x)
 ..m ^TTAB("TC",tcto,"2L",x)=^TTAB("TC",tcfrom,"2L",x)
 q 0
 ; check user - department
ValUser(user,tc) n (user,tc) s user=$g(user),tc=$g(tc),ok=0
 i $l(user) s dep=$$seldata(tc,17),ok=$$ValUser^LVBCTDEP(user,dep)
 q ok
%CTTC00o s $zt="%CTTC00E" s SQLCODE=$s($g(%CTTC00c):-101,1:0) q:SQLCODE'=0  s %CTTC00d(90)=0 s %CTTC00d(91)=0,%CTTC00d(92)=""
 s %CTTC00d(60)=$g(par),%CTTC00d(62)=$g(par),%CTTC00d(64)=$g(code),%CTTC00d(66)=$g(code),%CTTC00d(68)=$g(syn),%CTTC00d(70)=$g(syn),%CTTC00d(72)=$g(NNLong),%CTTC00d(74)=$g(NNLong),%CTTC00d(76)=$g(NNShort),%CTTC00d(78)=$g(NNShort),%CTTC00d(79)=$g(type),%CTTC00d(80)=$g(type),%CTTC00d(81)=$g(active),%CTTC00d(82)=$g(active)
 s %CTTC00d(87)=$zu(28,%CTTC00d(81),7)
 s %CTTC00d(85)=$zu(28,%CTTC00d(79),7)
 s %CTTC00d(77)=$zu(28,%CTTC00d(76),6)
 s %CTTC00d(73)=$zu(28,%CTTC00d(72),6)
 s %CTTC00d(69)=$zu(28,%CTTC00d(68),6)
 s %CTTC00d(65)=$zu(28,%CTTC00d(64),6)
 s %CTTC00d(61)=$zu(28,%CTTC00d(60),6)
 s %CTTC00c=1 q
%CTTC00E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTTC00c,%CTTC00d,%CTTC00E,%CTTC00l,%CTTC00n,%CTTC00R,%CTTC00Z q
%0Afirst 
 ; asl MOD# 2
 s %CTTC00d(1)=""
%0ABk1 s %CTTC00d(1)=$o(^TTAB("TC",%CTTC00d(1)))
 i %CTTC00d(1)="" g %0ABdun
 s %CTTC00d(97)=$g(^TTAB("TC",%CTTC00d(1)))
 s %CTTC00d(2)=$p(%CTTC00d(97),"\",1) s %CTTC00d(3)=$p(%CTTC00d(97),"\",2) s %CTTC00d(4)=$p(%CTTC00d(97),"\",3) s %CTTC00d(5)=$p(%CTTC00d(97),"\",4) s %CTTC00d(8)=$p(%CTTC00d(97),"\",7) s %CTTC00d(9)=$p(%CTTC00d(97),"\",24) s %CTTC00d(10)=$p(%CTTC00d(97),"\",25) s %CTTC00d(11)=$p(%CTTC00d(97),"\",10) s %CTTC00d(12)=$p(%CTTC00d(97),"\",26) s %CTTC00d(13)=$p(%CTTC00d(97),"\",12) s %CTTC00d(14)=$p(%CTTC00d(97),"\",13) s %CTTC00d(15)=$p(%CTTC00d(97),"\",14) s %CTTC00d(16)=$p(%CTTC00d(97),"\",8) s %CTTC00d(17)=$p(%CTTC00d(97),"\",27) s %CTTC00d(18)=$p(%CTTC00d(97),"\",28) s %CTTC00d(19)=$p(%CTTC00d(97),"\",29) s %CTTC00d(34)=$p(%CTTC00d(97),"\",9) s %CTTC00d(35)=$p(%CTTC00d(97),"\",16) s %CTTC00d(36)=$p(%CTTC00d(97),"\",17) s %CTTC00d(37)=$p(%CTTC00d(97),"\",18) s %CTTC00d(41)=$p(%CTTC00d(97),"\",15) s %CTTC00d(42)=$p(%CTTC00d(97),"\",11) s %CTTC00d(52)=$p(%CTTC00d(97),"\",5) s %CTTC00d(53)=$p(%CTTC00d(97),"\",19) s %CTTC00d(54)=$p(%CTTC00d(97),"\",6) s %CTTC00d(55)=$p(%CTTC00d(97),"\",22) s %CTTC00d(56)=$p(%CTTC00d(97),"\",23) s %CTTC00d(57)=$p(%CTTC00d(97),"\",20) s %CTTC00d(58)=$p(%CTTC00d(97),"\",21)
 s %CTTC00d(97)=$g(^TTAB("TC",%CTTC00d(1),"DELTA"))
 s %CTTC00d(20)=$p(%CTTC00d(97),"\",5) s %CTTC00d(21)=$p(%CTTC00d(97),"\",6) s %CTTC00d(22)=$p(%CTTC00d(97),"\",7) s %CTTC00d(23)=$p(%CTTC00d(97),"\",8) s %CTTC00d(24)=$p(%CTTC00d(97),"\",9) s %CTTC00d(25)=$p(%CTTC00d(97),"\",13) s %CTTC00d(26)=$p(%CTTC00d(97),"\",14) s %CTTC00d(27)=$p(%CTTC00d(97),"\",15) s %CTTC00d(28)=$p(%CTTC00d(97),"\",10) s %CTTC00d(29)=$p(%CTTC00d(97),"\",11) s %CTTC00d(30)=$p(%CTTC00d(97),"\",12) s %CTTC00d(31)=$p(%CTTC00d(97),"\",16) s %CTTC00d(32)=$p(%CTTC00d(97),"\",17) s %CTTC00d(33)=$p(%CTTC00d(97),"\",18) s %CTTC00d(38)=$p(%CTTC00d(97),"\",23) s %CTTC00d(39)=$p(%CTTC00d(97),"\",24) s %CTTC00d(40)=$p(%CTTC00d(97),"\",25) s %CTTC00d(43)=$p(%CTTC00d(97),"\",28) s %CTTC00d(44)=$p(%CTTC00d(97),"\",29) s %CTTC00d(45)=$p(%CTTC00d(97),"\",30) s %CTTC00d(46)=$p(%CTTC00d(97),"\",31) s %CTTC00d(47)=$p(%CTTC00d(97),"\",32) s %CTTC00d(48)=$p(%CTTC00d(97),"\",33) s %CTTC00d(49)=$p(%CTTC00d(97),"\",34) s %CTTC00d(50)=$p(%CTTC00d(97),"\",35) s %CTTC00d(51)=$p(%CTTC00d(97),"\",36)
 s %CTTC00d(6)=$g(^TTAB("TC",%CTTC00d(1),"MANUAL-1"))
 s %CTTC00d(7)="" f %irep=1:1:$g(^TTAB("TC",%CTTC00d(1),"MANUAL-2",0)) s $li(%CTTC00d(7),%irep)=$g(^(%irep))
 s %CTTC00d(71)=$zu(28,%CTTC00d(37),6) s %CTTC00d(75)=$zu(28,%CTTC00d(36),6) s %CTTC00d(86)=$zu(28,%CTTC00d(53),7) s %CTTC00d(84)=$zu(28,%CTTC00d(4),7) s %CTTC00d(63)=$zu(28,%CTTC00d(1),6) s %CTTC00d(67)=$zu(28,%CTTC00d(13),6) s %CTTC00d(59)=$zu(28,%CTTC00d(2),6)
 g:'(((%CTTC00d(59)'="")&&(($c(0)[%CTTC00d(61))||(%CTTC00d(61)=$c(32,0)&&($e(%CTTC00d(59))=$c(32)))||(%CTTC00d(61)=$e(%CTTC00d(59),1,$l(%CTTC00d(61))))))||(%CTTC00d(62)="")) %0ABk1
 g:'((($c(0)[%CTTC00d(65))||(%CTTC00d(65)=$c(32,0)&&($e(%CTTC00d(63))=$c(32)))||(%CTTC00d(65)=$e(%CTTC00d(63),1,$l(%CTTC00d(65)))))||(%CTTC00d(66)="")) %0ABk1
 g:'(((%CTTC00d(67)'="")&&(($c(0)[%CTTC00d(69))||(%CTTC00d(69)=$c(32,0)&&($e(%CTTC00d(67))=$c(32)))||(%CTTC00d(69)=$e(%CTTC00d(67),1,$l(%CTTC00d(69))))))||(%CTTC00d(70)="")) %0ABk1
 g:'(((%CTTC00d(71)'="")&&(($c(0)[%CTTC00d(73))||(%CTTC00d(73)=$c(32,0)&&($e(%CTTC00d(71))=$c(32)))||(%CTTC00d(73)=$e(%CTTC00d(71),1,$l(%CTTC00d(73))))))||(%CTTC00d(74)="")) %0ABk1
 g:'(((%CTTC00d(75)'="")&&(($c(0)[%CTTC00d(77))||(%CTTC00d(77)=$c(32,0)&&($e(%CTTC00d(75))=$c(32)))||(%CTTC00d(77)=$e(%CTTC00d(75),1,$l(%CTTC00d(77))))))||(%CTTC00d(78)="")) %0ABk1
 g:'(((%CTTC00d(84)'=" ")&&(%CTTC00d(84)=%CTTC00d(85)))||(%CTTC00d(80)="")) %0ABk1
 g:'(((%CTTC00d(86)'=" ")&&(%CTTC00d(86)=%CTTC00d(87)))||(%CTTC00d(82)="")) %0ABk1
 g:$zu(115,2)=0 %0ABuncommitted i $zu(115,2)=1 l +^TTAB("TC",$p(%CTTC00d(1),"||",1))#"S":$zu(115,4) i $t { s %CTTC00d(91)=1,%CTTC00d(92)=$name(^TTAB("TC",$p(%CTTC00d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_TestCode for RowID value: "_%CTTC00d(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %CTTC00d(88)=$lb(""_%CTTC00d(59),""_%CTTC00d(63),""_%CTTC00d(67),""_%CTTC00d(71),""_%CTTC00d(75),""_%CTTC00d(84),""_%CTTC00d(86))
 i %CTTC00d(1)'="",$d(^TTAB("TC",%CTTC00d(1)))
 e  g %0ACdun
 s %CTTC00d(102)=$g(^TTAB("TC",%CTTC00d(1)))
 s %CTTC00d(2)=$p(%CTTC00d(102),"\",1) s %CTTC00d(3)=$p(%CTTC00d(102),"\",2) s %CTTC00d(4)=$p(%CTTC00d(102),"\",3) s %CTTC00d(5)=$p(%CTTC00d(102),"\",4) s %CTTC00d(8)=$p(%CTTC00d(102),"\",7) s %CTTC00d(9)=$p(%CTTC00d(102),"\",24) s %CTTC00d(10)=$p(%CTTC00d(102),"\",25) s %CTTC00d(11)=$p(%CTTC00d(102),"\",10) s %CTTC00d(12)=$p(%CTTC00d(102),"\",26) s %CTTC00d(13)=$p(%CTTC00d(102),"\",12) s %CTTC00d(14)=$p(%CTTC00d(102),"\",13) s %CTTC00d(15)=$p(%CTTC00d(102),"\",14) s %CTTC00d(16)=$p(%CTTC00d(102),"\",8) s %CTTC00d(17)=$p(%CTTC00d(102),"\",27) s %CTTC00d(18)=$p(%CTTC00d(102),"\",28) s %CTTC00d(19)=$p(%CTTC00d(102),"\",29) s %CTTC00d(34)=$p(%CTTC00d(102),"\",9) s %CTTC00d(35)=$p(%CTTC00d(102),"\",16) s %CTTC00d(36)=$p(%CTTC00d(102),"\",17) s %CTTC00d(37)=$p(%CTTC00d(102),"\",18) s %CTTC00d(41)=$p(%CTTC00d(102),"\",15) s %CTTC00d(42)=$p(%CTTC00d(102),"\",11) s %CTTC00d(52)=$p(%CTTC00d(102),"\",5) s %CTTC00d(53)=$p(%CTTC00d(102),"\",19) s %CTTC00d(54)=$p(%CTTC00d(102),"\",6) s %CTTC00d(55)=$p(%CTTC00d(102),"\",22) s %CTTC00d(56)=$p(%CTTC00d(102),"\",23) s %CTTC00d(57)=$p(%CTTC00d(102),"\",20) s %CTTC00d(58)=$p(%CTTC00d(102),"\",21)
 s %CTTC00d(102)=$g(^TTAB("TC",%CTTC00d(1),"DELTA"))
 s %CTTC00d(20)=$p(%CTTC00d(102),"\",5) s %CTTC00d(21)=$p(%CTTC00d(102),"\",6) s %CTTC00d(22)=$p(%CTTC00d(102),"\",7) s %CTTC00d(23)=$p(%CTTC00d(102),"\",8) s %CTTC00d(24)=$p(%CTTC00d(102),"\",9) s %CTTC00d(25)=$p(%CTTC00d(102),"\",13) s %CTTC00d(26)=$p(%CTTC00d(102),"\",14) s %CTTC00d(27)=$p(%CTTC00d(102),"\",15) s %CTTC00d(28)=$p(%CTTC00d(102),"\",10) s %CTTC00d(29)=$p(%CTTC00d(102),"\",11) s %CTTC00d(30)=$p(%CTTC00d(102),"\",12) s %CTTC00d(31)=$p(%CTTC00d(102),"\",16) s %CTTC00d(32)=$p(%CTTC00d(102),"\",17) s %CTTC00d(33)=$p(%CTTC00d(102),"\",18) s %CTTC00d(38)=$p(%CTTC00d(102),"\",23) s %CTTC00d(39)=$p(%CTTC00d(102),"\",24) s %CTTC00d(40)=$p(%CTTC00d(102),"\",25) s %CTTC00d(43)=$p(%CTTC00d(102),"\",28) s %CTTC00d(44)=$p(%CTTC00d(102),"\",29) s %CTTC00d(45)=$p(%CTTC00d(102),"\",30) s %CTTC00d(46)=$p(%CTTC00d(102),"\",31) s %CTTC00d(47)=$p(%CTTC00d(102),"\",32) s %CTTC00d(48)=$p(%CTTC00d(102),"\",33) s %CTTC00d(49)=$p(%CTTC00d(102),"\",34) s %CTTC00d(50)=$p(%CTTC00d(102),"\",35) s %CTTC00d(51)=$p(%CTTC00d(102),"\",36)
 s %CTTC00d(6)=$g(^TTAB("TC",%CTTC00d(1),"MANUAL-1"))
 s %CTTC00d(7)="" f %irep=1:1:$g(^TTAB("TC",%CTTC00d(1),"MANUAL-2",0)) s $li(%CTTC00d(7),%irep)=$g(^(%irep))
 s %CTTC00d(71)=$zu(28,%CTTC00d(37),6) s %CTTC00d(75)=$zu(28,%CTTC00d(36),6) s %CTTC00d(86)=$zu(28,%CTTC00d(53),7) s %CTTC00d(84)=$zu(28,%CTTC00d(4),7) s %CTTC00d(63)=$zu(28,%CTTC00d(1),6) s %CTTC00d(67)=$zu(28,%CTTC00d(13),6) s %CTTC00d(59)=$zu(28,%CTTC00d(2),6)
 s %CTTC00d(89)=$lb(""_%CTTC00d(59),""_%CTTC00d(63),""_%CTTC00d(67),""_%CTTC00d(71),""_%CTTC00d(75),""_%CTTC00d(84),""_%CTTC00d(86))
 g:%CTTC00d(88)'=%CTTC00d(89) %0ACdun
%0ABuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTTC00d(90)=%CTTC00d(90)+1,%ROWCOUNT=%CTTC00d(90),%ROWID=%CTTC00d(1),%CTTC00c=10 q
%CTTC00f i '$g(%CTTC00c) { s SQLCODE=-102 q  } i %CTTC00c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Aerr" i $d(%0CacheRowLimit)#2,$g(%CTTC00d(90))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTTC00d(90),%CTTC00c=100 q  } g %0Afirst:%CTTC00c=1
%0ACdun i $zu(115,2)=1,$g(%CTTC00d(91))=1 { l -@%CTTC00d(92) s %CTTC00d(91)=0 }
 g %0ABk1
%0ABdun 
%0AAdun 
 s %ROWCOUNT=%CTTC00d(90),SQLCODE=100,%CTTC00c=100 q
%CTTC00c i '$g(%CTTC00c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTTC00d(90)),1:0)
 i $zu(115,2)=1,$g(%CTTC00d(91))=1 { l -@%CTTC00d(92) } k %CTTC00c,%CTTC00d,%CTTC00E,%CTTC00l,%CTTC00n,%CTTC00R,%CTTC00Z s SQLCODE=0 q
%0Aerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTTC00c=100 q
%CTTC10o s $zt="%CTTC10E" s SQLCODE=$s($g(%CTTC10c):-101,1:0) q:SQLCODE'=0  s %CTTC10d(61)=0 s %CTTC10d(62)=0,%CTTC10d(63)=""
 s %CTTC10t(1)=$i(^||%sql.temp)
 s %CTTC10c=1 q
%CTTC10E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTTC10c,%CTTC10d,%CTTC10E,%CTTC10l,%CTTC10n,%CTTC10R,%CTTC10s,%CTTC10t,%CTTC10Z q
%0Cfirst 
 k ^||%sql.temp(%CTTC10t(1),0) s ^||%sql.temp(%CTTC10t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%CTTC10t(1),0))
 ; asl MOD# 3
 d %0CBMod
 i $sortend(^||%sql.temp(%CTTC10t(1),0))
 s %CTTC10s(60)=""
%0CCk1 s %CTTC10s(60)=$o(^||%sql.temp(%CTTC10t(1),0,%CTTC10s(60)))
 i %CTTC10s(60)="" g %0CCdun
 s %CTTC10d(60)=$s(%CTTC10s(60)=-1E14:"",1:%CTTC10s(60))
 s %CTTC10s(1)=""
%0CCk2 s %CTTC10s(1)=$o(^||%sql.temp(%CTTC10t(1),0,%CTTC10s(60),%CTTC10s(1)))
 i %CTTC10s(1)="" g %0CCk1
 s %CTTC10d(1)=$s(%CTTC10s(1)=-1E14:"",1:%CTTC10s(1))
 i %CTTC10d(1)'="",$d(^TTAB("TC",%CTTC10d(1)))
 e  g %0CCk2
 s %CTTC10d(74)=$g(^TTAB("TC",%CTTC10d(1)))
 s %CTTC10d(2)=$p(%CTTC10d(74),"\",1) s %CTTC10d(3)=$p(%CTTC10d(74),"\",2) s %CTTC10d(4)=$p(%CTTC10d(74),"\",3) s %CTTC10d(5)=$p(%CTTC10d(74),"\",4) s %CTTC10d(8)=$p(%CTTC10d(74),"\",7) s %CTTC10d(9)=$p(%CTTC10d(74),"\",24) s %CTTC10d(10)=$p(%CTTC10d(74),"\",25) s %CTTC10d(11)=$p(%CTTC10d(74),"\",10) s %CTTC10d(12)=$p(%CTTC10d(74),"\",26) s %CTTC10d(13)=$p(%CTTC10d(74),"\",12) s %CTTC10d(14)=$p(%CTTC10d(74),"\",13) s %CTTC10d(15)=$p(%CTTC10d(74),"\",14) s %CTTC10d(16)=$p(%CTTC10d(74),"\",8) s %CTTC10d(17)=$p(%CTTC10d(74),"\",27) s %CTTC10d(18)=$p(%CTTC10d(74),"\",28) s %CTTC10d(19)=$p(%CTTC10d(74),"\",29) s %CTTC10d(34)=$p(%CTTC10d(74),"\",9) s %CTTC10d(35)=$p(%CTTC10d(74),"\",16) s %CTTC10d(36)=$p(%CTTC10d(74),"\",17) s %CTTC10d(37)=$p(%CTTC10d(74),"\",18) s %CTTC10d(41)=$p(%CTTC10d(74),"\",15) s %CTTC10d(42)=$p(%CTTC10d(74),"\",11) s %CTTC10d(52)=$p(%CTTC10d(74),"\",5) s %CTTC10d(53)=$p(%CTTC10d(74),"\",19) s %CTTC10d(54)=$p(%CTTC10d(74),"\",6) s %CTTC10d(55)=$p(%CTTC10d(74),"\",22) s %CTTC10d(56)=$p(%CTTC10d(74),"\",23) s %CTTC10d(57)=$p(%CTTC10d(74),"\",20) s %CTTC10d(58)=$p(%CTTC10d(74),"\",21)
 s %CTTC10d(74)=$g(^TTAB("TC",%CTTC10d(1),"DELTA"))
 s %CTTC10d(20)=$p(%CTTC10d(74),"\",5) s %CTTC10d(21)=$p(%CTTC10d(74),"\",6) s %CTTC10d(22)=$p(%CTTC10d(74),"\",7) s %CTTC10d(23)=$p(%CTTC10d(74),"\",8) s %CTTC10d(24)=$p(%CTTC10d(74),"\",9) s %CTTC10d(25)=$p(%CTTC10d(74),"\",13) s %CTTC10d(26)=$p(%CTTC10d(74),"\",14) s %CTTC10d(27)=$p(%CTTC10d(74),"\",15) s %CTTC10d(28)=$p(%CTTC10d(74),"\",10) s %CTTC10d(29)=$p(%CTTC10d(74),"\",11) s %CTTC10d(30)=$p(%CTTC10d(74),"\",12) s %CTTC10d(31)=$p(%CTTC10d(74),"\",16) s %CTTC10d(32)=$p(%CTTC10d(74),"\",17) s %CTTC10d(33)=$p(%CTTC10d(74),"\",18) s %CTTC10d(38)=$p(%CTTC10d(74),"\",23) s %CTTC10d(39)=$p(%CTTC10d(74),"\",24) s %CTTC10d(40)=$p(%CTTC10d(74),"\",25) s %CTTC10d(43)=$p(%CTTC10d(74),"\",28) s %CTTC10d(44)=$p(%CTTC10d(74),"\",29) s %CTTC10d(45)=$p(%CTTC10d(74),"\",30) s %CTTC10d(46)=$p(%CTTC10d(74),"\",31) s %CTTC10d(47)=$p(%CTTC10d(74),"\",32) s %CTTC10d(48)=$p(%CTTC10d(74),"\",33) s %CTTC10d(49)=$p(%CTTC10d(74),"\",34) s %CTTC10d(50)=$p(%CTTC10d(74),"\",35) s %CTTC10d(51)=$p(%CTTC10d(74),"\",36)
 s %CTTC10d(6)=$g(^TTAB("TC",%CTTC10d(1),"MANUAL-1"))
 s %CTTC10d(7)="" f %irep=1:1:$g(^TTAB("TC",%CTTC10d(1),"MANUAL-2",0)) s $li(%CTTC10d(7),%irep)=$g(^(%irep))
 g:$zu(115,2)=0 %0CCuncommitted i $zu(115,2)=1 l +^TTAB("TC",$p(%CTTC10d(1),"||",1))#"S":$zu(115,4) i $t { s %CTTC10d(62)=1,%CTTC10d(63)=$name(^TTAB("TC",$p(%CTTC10d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_TestCode for RowID value: "_%CTTC10d(1) ztrap "LOCK"  }
 ; asl MOD# 4
 i %CTTC10d(1)'="",$d(^TTAB("TC",%CTTC10d(1)))
 e  g %0CDdun
 s %CTTC10d(79)=$g(^TTAB("TC",%CTTC10d(1)))
 s %CTTC10d(2)=$p(%CTTC10d(79),"\",1) s %CTTC10d(3)=$p(%CTTC10d(79),"\",2) s %CTTC10d(4)=$p(%CTTC10d(79),"\",3) s %CTTC10d(5)=$p(%CTTC10d(79),"\",4) s %CTTC10d(8)=$p(%CTTC10d(79),"\",7) s %CTTC10d(9)=$p(%CTTC10d(79),"\",24) s %CTTC10d(10)=$p(%CTTC10d(79),"\",25) s %CTTC10d(11)=$p(%CTTC10d(79),"\",10) s %CTTC10d(12)=$p(%CTTC10d(79),"\",26) s %CTTC10d(13)=$p(%CTTC10d(79),"\",12) s %CTTC10d(14)=$p(%CTTC10d(79),"\",13) s %CTTC10d(15)=$p(%CTTC10d(79),"\",14) s %CTTC10d(16)=$p(%CTTC10d(79),"\",8) s %CTTC10d(17)=$p(%CTTC10d(79),"\",27) s %CTTC10d(18)=$p(%CTTC10d(79),"\",28) s %CTTC10d(19)=$p(%CTTC10d(79),"\",29) s %CTTC10d(34)=$p(%CTTC10d(79),"\",9) s %CTTC10d(35)=$p(%CTTC10d(79),"\",16) s %CTTC10d(36)=$p(%CTTC10d(79),"\",17) s %CTTC10d(37)=$p(%CTTC10d(79),"\",18) s %CTTC10d(41)=$p(%CTTC10d(79),"\",15) s %CTTC10d(42)=$p(%CTTC10d(79),"\",11) s %CTTC10d(52)=$p(%CTTC10d(79),"\",5) s %CTTC10d(53)=$p(%CTTC10d(79),"\",19) s %CTTC10d(54)=$p(%CTTC10d(79),"\",6) s %CTTC10d(55)=$p(%CTTC10d(79),"\",22) s %CTTC10d(56)=$p(%CTTC10d(79),"\",23) s %CTTC10d(57)=$p(%CTTC10d(79),"\",20) s %CTTC10d(58)=$p(%CTTC10d(79),"\",21)
 s %CTTC10d(79)=$g(^TTAB("TC",%CTTC10d(1),"DELTA"))
 s %CTTC10d(20)=$p(%CTTC10d(79),"\",5) s %CTTC10d(21)=$p(%CTTC10d(79),"\",6) s %CTTC10d(22)=$p(%CTTC10d(79),"\",7) s %CTTC10d(23)=$p(%CTTC10d(79),"\",8) s %CTTC10d(24)=$p(%CTTC10d(79),"\",9) s %CTTC10d(25)=$p(%CTTC10d(79),"\",13) s %CTTC10d(26)=$p(%CTTC10d(79),"\",14) s %CTTC10d(27)=$p(%CTTC10d(79),"\",15) s %CTTC10d(28)=$p(%CTTC10d(79),"\",10) s %CTTC10d(29)=$p(%CTTC10d(79),"\",11) s %CTTC10d(30)=$p(%CTTC10d(79),"\",12) s %CTTC10d(31)=$p(%CTTC10d(79),"\",16) s %CTTC10d(32)=$p(%CTTC10d(79),"\",17) s %CTTC10d(33)=$p(%CTTC10d(79),"\",18) s %CTTC10d(38)=$p(%CTTC10d(79),"\",23) s %CTTC10d(39)=$p(%CTTC10d(79),"\",24) s %CTTC10d(40)=$p(%CTTC10d(79),"\",25) s %CTTC10d(43)=$p(%CTTC10d(79),"\",28) s %CTTC10d(44)=$p(%CTTC10d(79),"\",29) s %CTTC10d(45)=$p(%CTTC10d(79),"\",30) s %CTTC10d(46)=$p(%CTTC10d(79),"\",31) s %CTTC10d(47)=$p(%CTTC10d(79),"\",32) s %CTTC10d(48)=$p(%CTTC10d(79),"\",33) s %CTTC10d(49)=$p(%CTTC10d(79),"\",34) s %CTTC10d(50)=$p(%CTTC10d(79),"\",35) s %CTTC10d(51)=$p(%CTTC10d(79),"\",36)
 s %CTTC10d(6)=$g(^TTAB("TC",%CTTC10d(1),"MANUAL-1"))
 s %CTTC10d(7)="" f %irep=1:1:$g(^TTAB("TC",%CTTC10d(1),"MANUAL-2",0)) s $li(%CTTC10d(7),%irep)=$g(^(%irep))
 s %CTTC10d(60)=$zu(28,%CTTC10d(2),6)
%0CCuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTTC10d(61)=%CTTC10d(61)+1,%ROWCOUNT=%CTTC10d(61),%ROWID=%CTTC10d(1),%CTTC10c=10 q
%CTTC10f i '$g(%CTTC10c) { s SQLCODE=-102 q  } i %CTTC10c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Cerr" i $d(%0CacheRowLimit)#2,$g(%CTTC10d(61))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTTC10d(61),%CTTC10c=100 q  } g %0Cfirst:%CTTC10c=1
%0CDdun i $zu(115,2)=1,$g(%CTTC10d(62))=1 { l -@%CTTC10d(63) s %CTTC10d(62)=0 }
 g %0CCk2
%0CCdun 
%0CAdun 
 s %ROWCOUNT=%CTTC10d(61),SQLCODE=100,%CTTC10c=100 q
%CTTC10c i '$g(%CTTC10c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTTC10d(61)),1:0) f %CTTC10d(64)=1 { i $sortend(^||%sql.temp(%CTTC10t(%CTTC10d(64)),0),0) } k ^||%sql.temp(%CTTC10t(1))
 i $zu(115,2)=1,$g(%CTTC10d(62))=1 { l -@%CTTC10d(63) } k %CTTC10c,%CTTC10d,%CTTC10E,%CTTC10l,%CTTC10n,%CTTC10R,%CTTC10s,%CTTC10t,%CTTC10Z s SQLCODE=0 q
%0Cerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTTC10c=100
 f %CTTC10d(64)=1 i $sortend(^||%sql.temp(%CTTC10t(%CTTC10d(64)),0),0)
 q
%0CBMod ; asl MOD# 2
 s %CTTC10d(1)=""
%0CBk1 s %CTTC10d(1)=$o(^TTAB("TC",%CTTC10d(1)))
 i %CTTC10d(1)="" g %0CBdun
 s %CTTC10d(69)=$g(^TTAB("TC",%CTTC10d(1)))
 s %CTTC10d(2)=$p(%CTTC10d(69),"\",1) s %CTTC10d(3)=$p(%CTTC10d(69),"\",2) s %CTTC10d(4)=$p(%CTTC10d(69),"\",3) s %CTTC10d(5)=$p(%CTTC10d(69),"\",4) s %CTTC10d(8)=$p(%CTTC10d(69),"\",7) s %CTTC10d(9)=$p(%CTTC10d(69),"\",24) s %CTTC10d(10)=$p(%CTTC10d(69),"\",25) s %CTTC10d(11)=$p(%CTTC10d(69),"\",10) s %CTTC10d(12)=$p(%CTTC10d(69),"\",26) s %CTTC10d(13)=$p(%CTTC10d(69),"\",12) s %CTTC10d(14)=$p(%CTTC10d(69),"\",13) s %CTTC10d(15)=$p(%CTTC10d(69),"\",14) s %CTTC10d(16)=$p(%CTTC10d(69),"\",8) s %CTTC10d(17)=$p(%CTTC10d(69),"\",27) s %CTTC10d(18)=$p(%CTTC10d(69),"\",28) s %CTTC10d(19)=$p(%CTTC10d(69),"\",29) s %CTTC10d(34)=$p(%CTTC10d(69),"\",9) s %CTTC10d(35)=$p(%CTTC10d(69),"\",16) s %CTTC10d(36)=$p(%CTTC10d(69),"\",17) s %CTTC10d(37)=$p(%CTTC10d(69),"\",18) s %CTTC10d(41)=$p(%CTTC10d(69),"\",15) s %CTTC10d(42)=$p(%CTTC10d(69),"\",11) s %CTTC10d(52)=$p(%CTTC10d(69),"\",5) s %CTTC10d(53)=$p(%CTTC10d(69),"\",19) s %CTTC10d(54)=$p(%CTTC10d(69),"\",6) s %CTTC10d(55)=$p(%CTTC10d(69),"\",22) s %CTTC10d(56)=$p(%CTTC10d(69),"\",23) s %CTTC10d(57)=$p(%CTTC10d(69),"\",20) s %CTTC10d(58)=$p(%CTTC10d(69),"\",21)
 s %CTTC10d(69)=$g(^TTAB("TC",%CTTC10d(1),"DELTA"))
 s %CTTC10d(20)=$p(%CTTC10d(69),"\",5) s %CTTC10d(21)=$p(%CTTC10d(69),"\",6) s %CTTC10d(22)=$p(%CTTC10d(69),"\",7) s %CTTC10d(23)=$p(%CTTC10d(69),"\",8) s %CTTC10d(24)=$p(%CTTC10d(69),"\",9) s %CTTC10d(25)=$p(%CTTC10d(69),"\",13) s %CTTC10d(26)=$p(%CTTC10d(69),"\",14) s %CTTC10d(27)=$p(%CTTC10d(69),"\",15) s %CTTC10d(28)=$p(%CTTC10d(69),"\",10) s %CTTC10d(29)=$p(%CTTC10d(69),"\",11) s %CTTC10d(30)=$p(%CTTC10d(69),"\",12) s %CTTC10d(31)=$p(%CTTC10d(69),"\",16) s %CTTC10d(32)=$p(%CTTC10d(69),"\",17) s %CTTC10d(33)=$p(%CTTC10d(69),"\",18) s %CTTC10d(38)=$p(%CTTC10d(69),"\",23) s %CTTC10d(39)=$p(%CTTC10d(69),"\",24) s %CTTC10d(40)=$p(%CTTC10d(69),"\",25) s %CTTC10d(43)=$p(%CTTC10d(69),"\",28) s %CTTC10d(44)=$p(%CTTC10d(69),"\",29) s %CTTC10d(45)=$p(%CTTC10d(69),"\",30) s %CTTC10d(46)=$p(%CTTC10d(69),"\",31) s %CTTC10d(47)=$p(%CTTC10d(69),"\",32) s %CTTC10d(48)=$p(%CTTC10d(69),"\",33) s %CTTC10d(49)=$p(%CTTC10d(69),"\",34) s %CTTC10d(50)=$p(%CTTC10d(69),"\",35) s %CTTC10d(51)=$p(%CTTC10d(69),"\",36)
 s %CTTC10d(6)=$g(^TTAB("TC",%CTTC10d(1),"MANUAL-1"))
 s %CTTC10d(7)="" f %irep=1:1:$g(^TTAB("TC",%CTTC10d(1),"MANUAL-2",0)) s $li(%CTTC10d(7),%irep)=$g(^(%irep))
 s %CTTC10d(60)=$zu(28,%CTTC10d(2),6)
 s %CTTC10s(60)=$s(%CTTC10d(60)'="":%CTTC10d(60),1:-1E14),%CTTC10s(1)=$s(%CTTC10d(1)'="":%CTTC10d(1),1:-1E14),^||%sql.temp(%CTTC10t(1),0,%CTTC10s(60),%CTTC10s(1))=""
 g %0CBk1
%0CBdun 
 q
%0Eo n %i,icol,ir
 f icol=0:1:59 i $d(PLIST(icol)) s %i(icol)=PLIST(icol)
 s %ROWID=$$%insert^User.CTTestCode.T1(.%i,$c(0,0,0,0)),%ROWCOUNT='SQLCODE
 q  // From %0Eo
%0Go n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Gerr" s %mmmsqld(4)=0 s %mmmsqld(5)=""
 s %mmmsqld(3)=$g(ROWID)
 n %data,icol,ir
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(2)=%mmmsqld(3)
 i %mmmsqld(2)'="",$d(^TTAB("TC",%mmmsqld(2)))
 e  g %0GBdun
 s %mmmsqld(10)=$$%getlock^User.CTTestCode.T1(%mmmsqld(2)) i '%mmmsqld(10) s SQLCODE=-110 g %0Gc
 ; asl MOD# 3
 i %mmmsqld(2)'="",$d(^TTAB("TC",%mmmsqld(2)))
 e  g %0GCdun
 k %data
 f icol=0:1:59 i $d(PLIST(icol)) s %data(icol)=PLIST(icol)
 d %update^User.CTTestCode.T1(%mmmsqld(2),$c(0,2,0,0),.%data,,'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(4))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(10)=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(2)) g %0Gc
%0GCdun 
 d:%mmmsqld(10)=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(2)) g:SQLCODE<0 %0Gc
%0GBdun 
%0GAdun 
%0Gc s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(4)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Gerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(10))=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(2)) g %0Gc
%0Io n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Ierr" s %mmmsqld(3)=0 s %mmmsqld(4)=""
 s %mmmsqld(2)=$g(ROWID)
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(1)=%mmmsqld(2)
 i %mmmsqld(1)'="",$d(^TTAB("TC",%mmmsqld(1)))
 e  g %0IBdun
 s %mmmsqld(9)=$$%getlock^User.CTTestCode.T1(%mmmsqld(1)) i '%mmmsqld(9) s SQLCODE=-110 g %0Ic
 ; asl MOD# 3
 i %mmmsqld(1)'="",$d(^TTAB("TC",%mmmsqld(1)))
 e  g %0ICdun
 d %delete^User.CTTestCode.T1(%mmmsqld(1),$c(0,2,0,0),'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(3))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(9)=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(1)) g %0Ic
%0ICdun 
 d:%mmmsqld(9)=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(1)) g:SQLCODE<0 %0Ic
%0IBdun 
%0IAdun 
%0Ic s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(3)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Ierr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(9))=1 %ReleaseLock^User.CTTestCode.T1(%mmmsqld(1)) g %0Ic
%0Mo d %CTTC00f q:SQLCODE'=0
 s PLIST(1)=%CTTC00d(1),PLIST(2)=%CTTC00d(1),PLIST(3)=%CTTC00d(2),PLIST(4)=%CTTC00d(3),PLIST(5)=%CTTC00d(4),PLIST(6)=%CTTC00d(5),PLIST(7)=%CTTC00d(6),PLIST(8)=%CTTC00d(7),PLIST(9)=%CTTC00d(8),PLIST(10)=%CTTC00d(9),PLIST(11)=%CTTC00d(10),PLIST(12)=%CTTC00d(11),PLIST(13)=%CTTC00d(12),PLIST(14)=%CTTC00d(13),PLIST(15)=%CTTC00d(14),PLIST(16)=%CTTC00d(15),PLIST(17)=%CTTC00d(16),PLIST(18)=%CTTC00d(17),PLIST(19)=%CTTC00d(18),PLIST(20)=%CTTC00d(19),PLIST(21)=%CTTC00d(20),PLIST(22)=%CTTC00d(21),PLIST(23)=%CTTC00d(22),PLIST(24)=%CTTC00d(23),PLIST(25)=%CTTC00d(24),PLIST(26)=%CTTC00d(25),PLIST(27)=%CTTC00d(26),PLIST(28)=%CTTC00d(27),PLIST(29)=%CTTC00d(28),PLIST(30)=%CTTC00d(29),PLIST(31)=%CTTC00d(30),PLIST(32)=%CTTC00d(31),PLIST(33)=%CTTC00d(32),PLIST(34)=%CTTC00d(33),PLIST(35)=%CTTC00d(34),PLIST(36)=%CTTC00d(35),PLIST(37)=%CTTC00d(36),PLIST(38)=%CTTC00d(37),PLIST(39)=%CTTC00d(38),PLIST(40)=%CTTC00d(39),PLIST(41)=%CTTC00d(40),PLIST(42)=%CTTC00d(41),PLIST(43)=%CTTC00d(42),PLIST(44)=%CTTC00d(43),PLIST(45)=%CTTC00d(44),PLIST(46)=%CTTC00d(45),PLIST(47)=%CTTC00d(46),PLIST(48)=%CTTC00d(47),PLIST(49)=%CTTC00d(48),PLIST(50)=%CTTC00d(49),PLIST(51)=%CTTC00d(50),PLIST(52)=%CTTC00d(51),PLIST(53)=%CTTC00d(52),PLIST(54)=%CTTC00d(53),PLIST(55)=%CTTC00d(54),PLIST(56)=%CTTC00d(55),PLIST(57)=%CTTC00d(56),PLIST(58)=%CTTC00d(57),PLIST(59)=%CTTC00d(58)
 q
%0No d %CTTC10f q:SQLCODE'=0
 s PLIST(1)=%CTTC10d(1),PLIST(2)=%CTTC10d(1),PLIST(3)=%CTTC10d(2),PLIST(4)=%CTTC10d(3),PLIST(5)=%CTTC10d(4),PLIST(6)=%CTTC10d(5),PLIST(7)=%CTTC10d(6),PLIST(8)=%CTTC10d(7),PLIST(9)=%CTTC10d(8),PLIST(10)=%CTTC10d(9),PLIST(11)=%CTTC10d(10),PLIST(12)=%CTTC10d(11),PLIST(13)=%CTTC10d(12),PLIST(14)=%CTTC10d(13),PLIST(15)=%CTTC10d(14),PLIST(16)=%CTTC10d(15),PLIST(17)=%CTTC10d(16),PLIST(18)=%CTTC10d(17),PLIST(19)=%CTTC10d(18),PLIST(20)=%CTTC10d(19),PLIST(21)=%CTTC10d(20),PLIST(22)=%CTTC10d(21),PLIST(23)=%CTTC10d(22),PLIST(24)=%CTTC10d(23),PLIST(25)=%CTTC10d(24),PLIST(26)=%CTTC10d(25),PLIST(27)=%CTTC10d(26),PLIST(28)=%CTTC10d(27),PLIST(29)=%CTTC10d(28),PLIST(30)=%CTTC10d(29),PLIST(31)=%CTTC10d(30),PLIST(32)=%CTTC10d(31),PLIST(33)=%CTTC10d(32),PLIST(34)=%CTTC10d(33),PLIST(35)=%CTTC10d(34),PLIST(36)=%CTTC10d(35),PLIST(37)=%CTTC10d(36),PLIST(38)=%CTTC10d(37),PLIST(39)=%CTTC10d(38),PLIST(40)=%CTTC10d(39),PLIST(41)=%CTTC10d(40),PLIST(42)=%CTTC10d(41),PLIST(43)=%CTTC10d(42),PLIST(44)=%CTTC10d(43),PLIST(45)=%CTTC10d(44),PLIST(46)=%CTTC10d(45),PLIST(47)=%CTTC10d(46),PLIST(48)=%CTTC10d(47),PLIST(49)=%CTTC10d(48),PLIST(50)=%CTTC10d(49),PLIST(51)=%CTTC10d(50),PLIST(52)=%CTTC10d(51),PLIST(53)=%CTTC10d(52),PLIST(54)=%CTTC10d(53),PLIST(55)=%CTTC10d(54),PLIST(56)=%CTTC10d(55),PLIST(57)=%CTTC10d(56),PLIST(58)=%CTTC10d(57),PLIST(59)=%CTTC10d(58)
 q
%0Qo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%0Qerr" s %mmmsqld(62)=0,%mmmsqld(63)=""
 s %mmmsqld(60)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(2)=%mmmsqld(60)
 i PLIST(2)'="",$d(^TTAB("TC",PLIST(2)))
 e  g %0QBdun
 s %mmmsqld(68)=$g(^TTAB("TC",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(68),"\",1) s PLIST(4)=$p(%mmmsqld(68),"\",2) s PLIST(5)=$p(%mmmsqld(68),"\",3) s PLIST(6)=$p(%mmmsqld(68),"\",4) s PLIST(9)=$p(%mmmsqld(68),"\",7) s PLIST(10)=$p(%mmmsqld(68),"\",24) s PLIST(11)=$p(%mmmsqld(68),"\",25) s PLIST(12)=$p(%mmmsqld(68),"\",10) s PLIST(13)=$p(%mmmsqld(68),"\",26) s PLIST(14)=$p(%mmmsqld(68),"\",12) s PLIST(15)=$p(%mmmsqld(68),"\",13) s PLIST(16)=$p(%mmmsqld(68),"\",14) s PLIST(17)=$p(%mmmsqld(68),"\",8) s PLIST(18)=$p(%mmmsqld(68),"\",27) s PLIST(19)=$p(%mmmsqld(68),"\",28) s PLIST(20)=$p(%mmmsqld(68),"\",29) s PLIST(35)=$p(%mmmsqld(68),"\",9) s PLIST(36)=$p(%mmmsqld(68),"\",16) s PLIST(37)=$p(%mmmsqld(68),"\",17) s PLIST(38)=$p(%mmmsqld(68),"\",18) s PLIST(42)=$p(%mmmsqld(68),"\",15) s PLIST(43)=$p(%mmmsqld(68),"\",11) s PLIST(53)=$p(%mmmsqld(68),"\",5) s PLIST(54)=$p(%mmmsqld(68),"\",19) s PLIST(55)=$p(%mmmsqld(68),"\",6) s PLIST(56)=$p(%mmmsqld(68),"\",22) s PLIST(57)=$p(%mmmsqld(68),"\",23) s PLIST(58)=$p(%mmmsqld(68),"\",20) s PLIST(59)=$p(%mmmsqld(68),"\",21)
 s %mmmsqld(68)=$g(^TTAB("TC",PLIST(2),"DELTA"))
 s PLIST(21)=$p(%mmmsqld(68),"\",5) s PLIST(22)=$p(%mmmsqld(68),"\",6) s PLIST(23)=$p(%mmmsqld(68),"\",7) s PLIST(24)=$p(%mmmsqld(68),"\",8) s PLIST(25)=$p(%mmmsqld(68),"\",9) s PLIST(26)=$p(%mmmsqld(68),"\",13) s PLIST(27)=$p(%mmmsqld(68),"\",14) s PLIST(28)=$p(%mmmsqld(68),"\",15) s PLIST(29)=$p(%mmmsqld(68),"\",10) s PLIST(30)=$p(%mmmsqld(68),"\",11) s PLIST(31)=$p(%mmmsqld(68),"\",12) s PLIST(32)=$p(%mmmsqld(68),"\",16) s PLIST(33)=$p(%mmmsqld(68),"\",17) s PLIST(34)=$p(%mmmsqld(68),"\",18) s PLIST(39)=$p(%mmmsqld(68),"\",23) s PLIST(40)=$p(%mmmsqld(68),"\",24) s PLIST(41)=$p(%mmmsqld(68),"\",25) s PLIST(44)=$p(%mmmsqld(68),"\",28) s PLIST(45)=$p(%mmmsqld(68),"\",29) s PLIST(46)=$p(%mmmsqld(68),"\",30) s PLIST(47)=$p(%mmmsqld(68),"\",31) s PLIST(48)=$p(%mmmsqld(68),"\",32) s PLIST(49)=$p(%mmmsqld(68),"\",33) s PLIST(50)=$p(%mmmsqld(68),"\",34) s PLIST(51)=$p(%mmmsqld(68),"\",35) s PLIST(52)=$p(%mmmsqld(68),"\",36)
 s PLIST(7)=$g(^TTAB("TC",PLIST(2),"MANUAL-1"))
 s PLIST(8)="" f %irep=1:1:$g(^TTAB("TC",PLIST(2),"MANUAL-2",0)) s $li(PLIST(8),%irep)=$g(^(%irep))
 g:$zu(115,2)=0 %0QBuncommitted i $zu(115,2)=1 l +^TTAB("TC",$p(PLIST(2),"||",1))#"S":$zu(115,4) i $t { s %mmmsqld(62)=1,%mmmsqld(63)=$name(^TTAB("TC",$p(PLIST(2),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_TestCode for RowID value: "_PLIST(2) ztrap "LOCK"  }
 ; asl MOD# 3
 i PLIST(2)'="",$d(^TTAB("TC",PLIST(2)))
 e  g %0QCdun
 s %mmmsqld(73)=$g(^TTAB("TC",PLIST(2)))
 s PLIST(3)=$p(%mmmsqld(73),"\",1) s PLIST(4)=$p(%mmmsqld(73),"\",2) s PLIST(5)=$p(%mmmsqld(73),"\",3) s PLIST(6)=$p(%mmmsqld(73),"\",4) s PLIST(9)=$p(%mmmsqld(73),"\",7) s PLIST(10)=$p(%mmmsqld(73),"\",24) s PLIST(11)=$p(%mmmsqld(73),"\",25) s PLIST(12)=$p(%mmmsqld(73),"\",10) s PLIST(13)=$p(%mmmsqld(73),"\",26) s PLIST(14)=$p(%mmmsqld(73),"\",12) s PLIST(15)=$p(%mmmsqld(73),"\",13) s PLIST(16)=$p(%mmmsqld(73),"\",14) s PLIST(17)=$p(%mmmsqld(73),"\",8) s PLIST(18)=$p(%mmmsqld(73),"\",27) s PLIST(19)=$p(%mmmsqld(73),"\",28) s PLIST(20)=$p(%mmmsqld(73),"\",29) s PLIST(35)=$p(%mmmsqld(73),"\",9) s PLIST(36)=$p(%mmmsqld(73),"\",16) s PLIST(37)=$p(%mmmsqld(73),"\",17) s PLIST(38)=$p(%mmmsqld(73),"\",18) s PLIST(42)=$p(%mmmsqld(73),"\",15) s PLIST(43)=$p(%mmmsqld(73),"\",11) s PLIST(53)=$p(%mmmsqld(73),"\",5) s PLIST(54)=$p(%mmmsqld(73),"\",19) s PLIST(55)=$p(%mmmsqld(73),"\",6) s PLIST(56)=$p(%mmmsqld(73),"\",22) s PLIST(57)=$p(%mmmsqld(73),"\",23) s PLIST(58)=$p(%mmmsqld(73),"\",20) s PLIST(59)=$p(%mmmsqld(73),"\",21)
 s %mmmsqld(73)=$g(^TTAB("TC",PLIST(2),"DELTA"))
 s PLIST(21)=$p(%mmmsqld(73),"\",5) s PLIST(22)=$p(%mmmsqld(73),"\",6) s PLIST(23)=$p(%mmmsqld(73),"\",7) s PLIST(24)=$p(%mmmsqld(73),"\",8) s PLIST(25)=$p(%mmmsqld(73),"\",9) s PLIST(26)=$p(%mmmsqld(73),"\",13) s PLIST(27)=$p(%mmmsqld(73),"\",14) s PLIST(28)=$p(%mmmsqld(73),"\",15) s PLIST(29)=$p(%mmmsqld(73),"\",10) s PLIST(30)=$p(%mmmsqld(73),"\",11) s PLIST(31)=$p(%mmmsqld(73),"\",12) s PLIST(32)=$p(%mmmsqld(73),"\",16) s PLIST(33)=$p(%mmmsqld(73),"\",17) s PLIST(34)=$p(%mmmsqld(73),"\",18) s PLIST(39)=$p(%mmmsqld(73),"\",23) s PLIST(40)=$p(%mmmsqld(73),"\",24) s PLIST(41)=$p(%mmmsqld(73),"\",25) s PLIST(44)=$p(%mmmsqld(73),"\",28) s PLIST(45)=$p(%mmmsqld(73),"\",29) s PLIST(46)=$p(%mmmsqld(73),"\",30) s PLIST(47)=$p(%mmmsqld(73),"\",31) s PLIST(48)=$p(%mmmsqld(73),"\",32) s PLIST(49)=$p(%mmmsqld(73),"\",33) s PLIST(50)=$p(%mmmsqld(73),"\",34) s PLIST(51)=$p(%mmmsqld(73),"\",35) s PLIST(52)=$p(%mmmsqld(73),"\",36)
 s PLIST(7)=$g(^TTAB("TC",PLIST(2),"MANUAL-1"))
 s PLIST(8)="" f %irep=1:1:$g(^TTAB("TC",PLIST(2),"MANUAL-2",0)) s $li(PLIST(8),%irep)=$g(^(%irep))
%0QBuncommitted ;
 s PLIST(1)=PLIST(2)
 s SQLCODE=0 g %0Qc
%0QCdun i $zu(115,2)=1,$g(%mmmsqld(62))=1 { l -@%mmmsqld(63) s %mmmsqld(62)=0 }
%0QBdun 
%0QAdun 
%0Qc s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(62))=1 { l -@%mmmsqld(63) } q
%0Qerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %0Qc
]]></Routine>
</Export>
