<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="LVBCTHOS1" type="INT" languagemode="0" generated="1"><![CDATA[
LVBCTHOS1 ; IG 30/4/98 ; MVB Control code access for CT_Hospital
 ;
 ; supported calls:
 ;
 ; $$open^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetch^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetchbuffer^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$fetchall^LVBCTHOS(code,desc,skip,user,active,site,content,strCode,nextLevel,p9)
 ; $$close^LVBCTHOS()
 ; $$getall^LVBCTHOS(par,user,active,site,Continue,content,strCode,nextLevel)
 ; $$getall1^LVBCTHOS(user,active,site,content,strCode,nextLevel)
 ;
  ;---&SQL(DECLARE CTHOS01 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) %STARTSWITH :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) %STARTSWITH :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL) OR (CTHOS_StructuredCode is NULL))
   ;---         ORDER BY CTHOS_DisplaySequence)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode
  ;---&SQL(DECLARE CTHOS02 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) [ :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) [ :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL) OR (CTHOS_StructuredCode is NULL))
   ;---         ORDER BY CTHOS_DisplaySequence)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode
  ;---&SQL(DECLARE CTHOS03 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) %STARTSWITH :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) %STARTSWITH :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL))
   ;---         AND (CTHOS_StructuredCode  is NOT NULL)
   ;---         AND (CTHOS_StructuredCodeLength = :strCodeLength)
   ;---         ORDER BY CTHOS_StructuredCodeLength,CTHOS_StructuredCode)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode, strCodeLength
  ;---&SQL(DECLARE CTHOS04 CURSOR FOR SELECT * FROM CT_Hospital
   ;---         WHERE ((%ALPHAUP(CTHOS_CODE) [ :code) OR (:code is NULL))
   ;---         AND ((%ALPHAUP(CTHOS_NAME) [ :desc) OR (:desc is NULL))
   ;---         AND ((CTHOS_ActiveFlag = :active) OR (:active is NULL))
   ;---         AND ((CTHOS_UserSite_DR = :site) OR (:site is NULL) OR (CTHOS_UserSite_DR is NULL))
   ;---         AND ((CTHOS_StructuredCode %STARTSWITH :strCode) OR (:strCode is NULL))
   ;---         AND (CTHOS_StructuredCode  is NOT NULL)
   ;---         AND (CTHOS_StructuredCodeLength = :strCodeLength)
   ;---         ORDER BY CTHOS_StructuredCodeLength,CTHOS_StructuredCode)
   ;--- ** SQL PUBLIC Variables: SQLCODE, active, code, desc, site, strCode, strCodeLength
 ; open the cursor
open(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) 
 s code=$$ALPHAUP^SSUTIL4($g(code)),desc=$$ALPHAUP^SSUTIL4($g(desc))
 s skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i nextLevel="" d
 . ;---i '$l(content) &SQL(OPEN CTHOS01)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i '$l(content) Do %CTHOS010o
 . ;---i $l(content) &SQL(OPEN CTHOS02)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i $l(content) Do %CTHOS020o
 i nextLevel="Y" d
 .s strCodeLength=$o(^TTABi("RH-2",$l(strCode)))
 . ;---i '$l(content) &SQL(OPEN CTHOS03)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i '$l(content) Do %CTHOS030o
 . ;---i $l(content) &SQL(OPEN CTHOS04)
  . ;--- ** SQL PUBLIC Variables: SQLCODE
 .i $l(content) Do %CTHOS040o
 q 0
 ; fetch the data
fetch(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) k PLIST
 s code=$$ALPHAUP^SSUTIL4($g(code)),desc=$$ALPHAUP^SSUTIL4($g(desc))
 s skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 f  d  q:SQLCODE  s ValUser=$$ValUser^LVBCTHOS(user,$p(PLIST(1),$c(1))) q:ValUser'=60
 .i nextLevel="" d
 .. ;---i '$l(content) &SQL(FETCH CTHOS01 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i '$l(content) Do %0Qo
 .. ;---i $l(content) &SQL(FETCH CTHOS02 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i $l(content) Do %0Ro
 .i nextLevel="Y" d
 ..s strCodeLength=$o(^TTABi("RH-2",$l(strCode)))
 .. ;---i '$l(content) &SQL(FETCH CTHOS03 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i '$l(content) Do %0So
 .. ;---i $l(content) &SQL(FETCH CTHOS04 INTO :PLIST())
  .. ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 ..i $l(content) Do %0To
 S PLIST=$o(PLIST(""),-1)
 i 'SQLCODE d adjust^LVBCTHOS
 q SQLCODE
 ; fetch all data
fetchbuffer(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) k ^TMP($zn,$j)
 s code=$g(code),desc=$g(desc),skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 s max=$s($g(PLIST(1)):PLIST(1),1:100) i max>100 s max=100
 f xxx=1:1:max s SQLCODE=$$fetch(code,desc,skip,user,active,site,content,strCode,nextLevel) q:SQLCODE  d
 .s cnt=$o(^TMP($zn,$j,""),-1)+1 f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 k PLIST m PLIST=^TMP($zn,$j) k ^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 q SQLCODE
fetchall(code,desc,skip,user,active,site,content,strCode,nextLevel,p9) n (code,desc,skip,user,active,site,content,strCode,nextLevel,PLIST) k ^TMP($zn,$j)
 s code=$g(code),desc=$g(desc),skip=$g(skip),user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i $$open(code,desc,skip,user,active,site,content,strCode,nextLevel)
 f cnt=1:1 q:$$fetch(code,desc,skip,user,active,site,content,strCode,nextLevel)  s ^TMP($zn,$j,cnt)="" f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 i $$close()
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ; close the cursor
close()  ;---&SQL(CLOSE CTHOS01)
  ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS010c
  ;---&SQL(CLOSE CTHOS02)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS020c
  ;---&SQL(CLOSE CTHOS03)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS030c
  ;---&SQL(CLOSE CTHOS04)
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %CTHOS040c
 q 0
 ;
getall(par,user,active,site,Continue,content,strCode,nextLevel) n (par,user,active,site,Continue,content,strCode,nextLevel,PLIST)
 s par=$g(par),user=$g(user),active=$g(active),site=$g(site),Continue=$g(Continue),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i Continue="" k ^TMP($zn,$j) d
 .s code=$p(par,"^"),desc=$p(par,"^",2)
 .i $$open(code,desc,"Y",user,active,site,content,strCode,nextLevel)
 .f cnt=1:1 q:$$fetch(code,desc,"Y",user,active,site,content,strCode,nextLevel)  d
 ..s str="" f j=4:1:PLIST s $p(str,$c(28),j)=PLIST(j)
 ..s str=str_$c(29)_$g(ValUser)
 ..s ^TMP($zn,$j,cnt)=$p(PLIST(1),$c(1))_$c(2)_$p(PLIST(3),$c(1))_$c(2)_$p(PLIST(2),$c(1))_$c(2)_str
 .i $$close()
 k PLIST
 s (x,cnt,sum)="" f  s x=$o(^TMP($zn,$j,x)) q:x=""  q:(sum+$l(^TMP($zn,$j,x)))>15000  s cnt=cnt+1,PLIST(cnt)=^(x),sum=sum+$l(^(x)) k ^(x)
 s PLIST=$o(PLIST(""),-1)
 q $s($d(^TMP($zn,$j)):0,1:100)
getall1(user,active,site,content,strCode,nextLevel) n (user,active,site,content,strCode,nextLevel,PLIST) k ^TMP($zn,$j)
 s user=$g(user),active=$g(active),site=$g(site),content=$g(content),strCode=$g(strCode),nextLevel=$g(nextLevel)
 i $$open(,,"Y",user,active,site,content,strCode,nextLevel)
 s cnt=0 f  q:$$fetch(,,"Y",user,active,site,content,strCode,nextLevel)  i $d(^TRPT("WARD",$p(PLIST(1),$c(1)))) d
 .s cnt=cnt+1
 .s str="" f j=1:1:PLIST s $p(str,$c(28),j)=PLIST(j)
 .s str=str_$c(29)_$$ValUser^LVBCTHOS(user,$p(PLIST(1),$c(1)))
 .s ^TMP($zn,$j,cnt)=$p(PLIST(1),$c(1))_$c(2)_$p(PLIST(3),$c(1))_$c(2)_$p(PLIST(2),$c(1))_$c(2)_str
 k PLIST m PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 i $$close()
 k ^TMP($zn,$j)
 q 0
%0ABr1 n cnt s cnt=0
 s %CTHOS010d(17)=""
 i $g(%CTHOS010d(3))'="" s cnt=cnt+1,$p(%CTHOS010d(17),"|",cnt)=$g(%CTHOS010d(3))
 i $g(%CTHOS010d(4))'="" s cnt=cnt+1,$p(%CTHOS010d(17),"|",cnt)=$g(%CTHOS010d(4))
 i $g(%CTHOS010d(5))'="" s cnt=cnt+1,$p(%CTHOS010d(17),"|",cnt)=$g(%CTHOS010d(5))
 i $g(%CTHOS010d(6))'="" s cnt=cnt+1,$p(%CTHOS010d(17),"|",cnt)=$g(%CTHOS010d(6))
 i $g(%CTHOS010d(7))'="" s cnt=cnt+1,$p(%CTHOS010d(17),"|",cnt)=$g(%CTHOS010d(7))
 k cnt q
%CTHOS010o s $zt="%CTHOS010E" s SQLCODE=$s($g(%CTHOS010c):-101,1:0) q:SQLCODE'=0  s %CTHOS010d(56)=0 s %CTHOS010d(57)=0,%CTHOS010d(58)=""
 s %CTHOS010d(42)=$g(code),%CTHOS010d(43)=$g(code),%CTHOS010d(45)=$g(desc),%CTHOS010d(46)=$g(desc),%CTHOS010d(47)=$g(active),%CTHOS010d(48)=$g(active),%CTHOS010d(49)=$g(site),%CTHOS010d(50)=$g(site),%CTHOS010d(51)=$g(strCode),%CTHOS010d(52)=$g(strCode)
 s %CTHOS010t(1)=$i(^||%sql.temp)
 s %CTHOS010d(55)=$zu(28,%CTHOS010d(47),7)
 s %CTHOS010c=1 q
%CTHOS010E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS010c,%CTHOS010d,%CTHOS010E,%CTHOS010l,%CTHOS010n,%CTHOS010R,%CTHOS010s,%CTHOS010t,%CTHOS010Z q
%0Afirst 
 k ^||%sql.temp(%CTHOS010t(1),0) s ^||%sql.temp(%CTHOS010t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%CTHOS010t(1),0))
 ; asl MOD# 3
 d %0ABMod
 i $sortend(^||%sql.temp(%CTHOS010t(1),0))
 s %CTHOS010s(25)=""
%0ACk1 s %CTHOS010s(25)=$o(^||%sql.temp(%CTHOS010t(1),0,%CTHOS010s(25)))
 i %CTHOS010s(25)="" g %0ACdun
 s %CTHOS010d(25)=$s(%CTHOS010s(25)=-1E14:"",1:%CTHOS010s(25))
 s %CTHOS010s(1)=""
%0ACk2 s %CTHOS010s(1)=$o(^||%sql.temp(%CTHOS010t(1),0,%CTHOS010s(25),%CTHOS010s(1)))
 i %CTHOS010s(1)="" g %0ACk1
 s %CTHOS010d(1)=$s(%CTHOS010s(1)=-1E14:"",1:%CTHOS010s(1))
 i %CTHOS010d(1)'="",$d(^TTAB("RH",%CTHOS010d(1)))
 e  g %0ACk2
 s %CTHOS010d(69)=$g(^TTAB("RH",%CTHOS010d(1)))
 s %CTHOS010d(2)=$p(%CTHOS010d(69),"\",1) s %CTHOS010d(3)=$p(%CTHOS010d(69),"\",2) s %CTHOS010d(4)=$p(%CTHOS010d(69),"\",3) s %CTHOS010d(5)=$p(%CTHOS010d(69),"\",4) s %CTHOS010d(6)=$p(%CTHOS010d(69),"\",5) s %CTHOS010d(7)=$p(%CTHOS010d(69),"\",6) s %CTHOS010d(8)=$p(%CTHOS010d(69),"\",7) s %CTHOS010d(9)=$p(%CTHOS010d(69),"\",8) s %CTHOS010d(10)=$p(%CTHOS010d(69),"\",9) s %CTHOS010d(11)=$p(%CTHOS010d(69),"\",10) s %CTHOS010d(12)=$p(%CTHOS010d(69),"\",11) s %CTHOS010d(13)=$p(%CTHOS010d(69),"\",12) s %CTHOS010d(14)=$p(%CTHOS010d(69),"\",13) s %CTHOS010d(15)=$p(%CTHOS010d(69),"\",14) s %CTHOS010d(16)=$p(%CTHOS010d(69),"\",15) s %CTHOS010d(18)=$p(%CTHOS010d(69),"\",16) s %CTHOS010d(19)=$p(%CTHOS010d(69),"\",17) s %CTHOS010d(20)=$p(%CTHOS010d(69),"\",18) s %CTHOS010d(21)=$p(%CTHOS010d(69),"\",20) s %CTHOS010d(22)=$p(%CTHOS010d(69),"\",21) s %CTHOS010d(23)=$p(%CTHOS010d(69),"\",19) s %CTHOS010d(24)=$p(%CTHOS010d(69),"\",22) s %CTHOS010d(26)=$p(%CTHOS010d(69),"\",24) s %CTHOS010d(27)=$p(%CTHOS010d(69),"\",25) s %CTHOS010d(28)=$p(%CTHOS010d(69),"\",26) s %CTHOS010d(29)=$p(%CTHOS010d(69),"\",27) s %CTHOS010d(30)=$p(%CTHOS010d(69),"\",28) s %CTHOS010d(31)=$p(%CTHOS010d(69),"\",29) s %CTHOS010d(32)=$p(%CTHOS010d(69),"\",30) s %CTHOS010d(34)=$p(%CTHOS010d(69),"\",31) s %CTHOS010d(35)=$p(%CTHOS010d(69),"\",32) s %CTHOS010d(36)=$p(%CTHOS010d(69),"\",33) s %CTHOS010d(37)=$p(%CTHOS010d(69),"\",34) s %CTHOS010d(39)=$p(%CTHOS010d(69),"\",35) s %CTHOS010d(40)=$p(%CTHOS010d(69),"\",36)
 s %CTHOS010d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS010d(1),"REM",0)) s $li(%CTHOS010d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS010d(38)=$l($g(%CTHOS010d(37))) s %CTHOS010d(54)=$zu(28,%CTHOS010d(24),7) s %CTHOS010d(44)=$zu(28,%CTHOS010d(2),6) s %CTHOS010d(41)=$zu(28,%CTHOS010d(1),6)
 g:$zu(115,2)=0 %0ACuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS010d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS010d(57)=1,%CTHOS010d(58)=$name(^TTAB("RH",$p(%CTHOS010d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS010d(1) ztrap "LOCK"  }
 ; asl MOD# 4
 i %CTHOS010d(1)'="",$d(^TTAB("RH",%CTHOS010d(1)))
 e  g %0ADdun
 s %CTHOS010d(74)=$g(^TTAB("RH",%CTHOS010d(1)))
 s %CTHOS010d(28)=$p(%CTHOS010d(74),"\",26)
 g:'((((%CTHOS010d(28)'="")&&(%CTHOS010d(28)=%CTHOS010d(49)))||(%CTHOS010d(50)=""))||(%CTHOS010d(28)="")) %0ADdun
 s %CTHOS010d(37)=$p(%CTHOS010d(74),"\",34)
 g:'((((%CTHOS010d(37)'="")&&(($c(0)[%CTHOS010d(51))||(%CTHOS010d(51)=$c(32,0)&&($e(%CTHOS010d(37))=$c(32)))||(%CTHOS010d(51)=$e(%CTHOS010d(37),1,$l(%CTHOS010d(51))))))||(%CTHOS010d(52)=""))||(%CTHOS010d(37)="")) %0ADdun
 s %CTHOS010d(2)=$p(%CTHOS010d(74),"\",1) s %CTHOS010d(3)=$p(%CTHOS010d(74),"\",2) s %CTHOS010d(4)=$p(%CTHOS010d(74),"\",3) s %CTHOS010d(5)=$p(%CTHOS010d(74),"\",4) s %CTHOS010d(6)=$p(%CTHOS010d(74),"\",5) s %CTHOS010d(7)=$p(%CTHOS010d(74),"\",6) s %CTHOS010d(8)=$p(%CTHOS010d(74),"\",7) s %CTHOS010d(9)=$p(%CTHOS010d(74),"\",8) s %CTHOS010d(10)=$p(%CTHOS010d(74),"\",9) s %CTHOS010d(11)=$p(%CTHOS010d(74),"\",10) s %CTHOS010d(12)=$p(%CTHOS010d(74),"\",11) s %CTHOS010d(13)=$p(%CTHOS010d(74),"\",12) s %CTHOS010d(14)=$p(%CTHOS010d(74),"\",13) s %CTHOS010d(15)=$p(%CTHOS010d(74),"\",14) s %CTHOS010d(16)=$p(%CTHOS010d(74),"\",15) s %CTHOS010d(18)=$p(%CTHOS010d(74),"\",16) s %CTHOS010d(19)=$p(%CTHOS010d(74),"\",17) s %CTHOS010d(20)=$p(%CTHOS010d(74),"\",18) s %CTHOS010d(21)=$p(%CTHOS010d(74),"\",20) s %CTHOS010d(22)=$p(%CTHOS010d(74),"\",21) s %CTHOS010d(23)=$p(%CTHOS010d(74),"\",19) s %CTHOS010d(24)=$p(%CTHOS010d(74),"\",22) s %CTHOS010d(25)=$p(%CTHOS010d(74),"\",23) s %CTHOS010d(26)=$p(%CTHOS010d(74),"\",24) s %CTHOS010d(27)=$p(%CTHOS010d(74),"\",25) s %CTHOS010d(29)=$p(%CTHOS010d(74),"\",27) s %CTHOS010d(30)=$p(%CTHOS010d(74),"\",28) s %CTHOS010d(31)=$p(%CTHOS010d(74),"\",29) s %CTHOS010d(32)=$p(%CTHOS010d(74),"\",30) s %CTHOS010d(34)=$p(%CTHOS010d(74),"\",31) s %CTHOS010d(35)=$p(%CTHOS010d(74),"\",32) s %CTHOS010d(36)=$p(%CTHOS010d(74),"\",33) s %CTHOS010d(39)=$p(%CTHOS010d(74),"\",35) s %CTHOS010d(40)=$p(%CTHOS010d(74),"\",36)
 s %CTHOS010d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS010d(1),"REM",0)) s $li(%CTHOS010d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS010d(38)=$l($g(%CTHOS010d(37))) s %CTHOS010d(54)=$zu(28,%CTHOS010d(24),7) s %CTHOS010d(44)=$zu(28,%CTHOS010d(2),6) s %CTHOS010d(41)=$zu(28,%CTHOS010d(1),6)
 g:'((($c(0)[%CTHOS010d(42))||(%CTHOS010d(42)=$c(32,0)&&($e(%CTHOS010d(41))=$c(32)))||(%CTHOS010d(42)=$e(%CTHOS010d(41),1,$l(%CTHOS010d(42)))))||(%CTHOS010d(43)="")) %0ADdun
 g:'(((%CTHOS010d(44)'="")&&(($c(0)[%CTHOS010d(45))||(%CTHOS010d(45)=$c(32,0)&&($e(%CTHOS010d(44))=$c(32)))||(%CTHOS010d(45)=$e(%CTHOS010d(44),1,$l(%CTHOS010d(45))))))||(%CTHOS010d(46)="")) %0ADdun
 g:'(((%CTHOS010d(54)'=" ")&&(%CTHOS010d(54)=%CTHOS010d(55)))||(%CTHOS010d(48)="")) %0ADdun
%0ACuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS010d(56)=%CTHOS010d(56)+1,%ROWCOUNT=%CTHOS010d(56),%ROWID=%CTHOS010d(1),%CTHOS010c=10 q
%CTHOS010f i '$g(%CTHOS010c) { s SQLCODE=-102 q  } i %CTHOS010c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Aerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS010d(56))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS010d(56),%CTHOS010c=100 q  } g %0Afirst:%CTHOS010c=1
%0ADdun i $zu(115,2)=1,$g(%CTHOS010d(57))=1 { l -@%CTHOS010d(58) s %CTHOS010d(57)=0 }
 g %0ACk2
%0ACdun 
%0AAdun 
 s %ROWCOUNT=%CTHOS010d(56),SQLCODE=100,%CTHOS010c=100 q
%CTHOS010c i '$g(%CTHOS010c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS010d(56)),1:0) f %CTHOS010d(59)=1 { i $sortend(^||%sql.temp(%CTHOS010t(%CTHOS010d(59)),0),0) } k ^||%sql.temp(%CTHOS010t(1))
 i $zu(115,2)=1,$g(%CTHOS010d(57))=1 { l -@%CTHOS010d(58) } k %CTHOS010c,%CTHOS010d,%CTHOS010E,%CTHOS010l,%CTHOS010n,%CTHOS010R,%CTHOS010s,%CTHOS010t,%CTHOS010Z s SQLCODE=0 q
%0Aerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS010c=100
 f %CTHOS010d(59)=1 i $sortend(^||%sql.temp(%CTHOS010t(%CTHOS010d(59)),0),0)
 q
%0ABMod ; asl MOD# 2
 s %CTHOS010d(1)=""
%0ABk1 s %CTHOS010d(1)=$o(^TTAB("RH",%CTHOS010d(1)))
 i %CTHOS010d(1)="" g %0ABdun
 s %CTHOS010d(64)=$g(^TTAB("RH",%CTHOS010d(1)))
 s %CTHOS010d(28)=$p(%CTHOS010d(64),"\",26)
 g:'((((%CTHOS010d(28)'="")&&(%CTHOS010d(28)=%CTHOS010d(49)))||(%CTHOS010d(50)=""))||(%CTHOS010d(28)="")) %0ABk1
 s %CTHOS010d(37)=$p(%CTHOS010d(64),"\",34)
 g:'((((%CTHOS010d(37)'="")&&(($c(0)[%CTHOS010d(51))||(%CTHOS010d(51)=$c(32,0)&&($e(%CTHOS010d(37))=$c(32)))||(%CTHOS010d(51)=$e(%CTHOS010d(37),1,$l(%CTHOS010d(51))))))||(%CTHOS010d(52)=""))||(%CTHOS010d(37)="")) %0ABk1
 s %CTHOS010d(2)=$p(%CTHOS010d(64),"\",1) s %CTHOS010d(3)=$p(%CTHOS010d(64),"\",2) s %CTHOS010d(4)=$p(%CTHOS010d(64),"\",3) s %CTHOS010d(5)=$p(%CTHOS010d(64),"\",4) s %CTHOS010d(6)=$p(%CTHOS010d(64),"\",5) s %CTHOS010d(7)=$p(%CTHOS010d(64),"\",6) s %CTHOS010d(8)=$p(%CTHOS010d(64),"\",7) s %CTHOS010d(9)=$p(%CTHOS010d(64),"\",8) s %CTHOS010d(10)=$p(%CTHOS010d(64),"\",9) s %CTHOS010d(11)=$p(%CTHOS010d(64),"\",10) s %CTHOS010d(12)=$p(%CTHOS010d(64),"\",11) s %CTHOS010d(13)=$p(%CTHOS010d(64),"\",12) s %CTHOS010d(14)=$p(%CTHOS010d(64),"\",13) s %CTHOS010d(15)=$p(%CTHOS010d(64),"\",14) s %CTHOS010d(16)=$p(%CTHOS010d(64),"\",15) s %CTHOS010d(18)=$p(%CTHOS010d(64),"\",16) s %CTHOS010d(19)=$p(%CTHOS010d(64),"\",17) s %CTHOS010d(20)=$p(%CTHOS010d(64),"\",18) s %CTHOS010d(21)=$p(%CTHOS010d(64),"\",20) s %CTHOS010d(22)=$p(%CTHOS010d(64),"\",21) s %CTHOS010d(23)=$p(%CTHOS010d(64),"\",19) s %CTHOS010d(24)=$p(%CTHOS010d(64),"\",22) s %CTHOS010d(25)=$p(%CTHOS010d(64),"\",23) s %CTHOS010d(26)=$p(%CTHOS010d(64),"\",24) s %CTHOS010d(27)=$p(%CTHOS010d(64),"\",25) s %CTHOS010d(29)=$p(%CTHOS010d(64),"\",27) s %CTHOS010d(30)=$p(%CTHOS010d(64),"\",28) s %CTHOS010d(31)=$p(%CTHOS010d(64),"\",29) s %CTHOS010d(32)=$p(%CTHOS010d(64),"\",30) s %CTHOS010d(34)=$p(%CTHOS010d(64),"\",31) s %CTHOS010d(35)=$p(%CTHOS010d(64),"\",32) s %CTHOS010d(36)=$p(%CTHOS010d(64),"\",33) s %CTHOS010d(39)=$p(%CTHOS010d(64),"\",35) s %CTHOS010d(40)=$p(%CTHOS010d(64),"\",36)
 s %CTHOS010d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS010d(1),"REM",0)) s $li(%CTHOS010d(33),%irep)=$g(^(%irep))
 d %0ABr1 s %CTHOS010d(38)=$l($g(%CTHOS010d(37))) s %CTHOS010d(54)=$zu(28,%CTHOS010d(24),7) s %CTHOS010d(44)=$zu(28,%CTHOS010d(2),6) s %CTHOS010d(41)=$zu(28,%CTHOS010d(1),6)
 g:'((($c(0)[%CTHOS010d(42))||(%CTHOS010d(42)=$c(32,0)&&($e(%CTHOS010d(41))=$c(32)))||(%CTHOS010d(42)=$e(%CTHOS010d(41),1,$l(%CTHOS010d(42)))))||(%CTHOS010d(43)="")) %0ABk1
 g:'(((%CTHOS010d(44)'="")&&(($c(0)[%CTHOS010d(45))||(%CTHOS010d(45)=$c(32,0)&&($e(%CTHOS010d(44))=$c(32)))||(%CTHOS010d(45)=$e(%CTHOS010d(44),1,$l(%CTHOS010d(45))))))||(%CTHOS010d(46)="")) %0ABk1
 g:'(((%CTHOS010d(54)'=" ")&&(%CTHOS010d(54)=%CTHOS010d(55)))||(%CTHOS010d(48)="")) %0ABk1
 s %CTHOS010s(25)=$s(%CTHOS010d(25)'="":%CTHOS010d(25),1:-1E14),%CTHOS010s(1)=$s(%CTHOS010d(1)'="":%CTHOS010d(1),1:-1E14),^||%sql.temp(%CTHOS010t(1),0,%CTHOS010s(25),%CTHOS010s(1))=""
 g %0ABk1
%0ABdun 
 q
%0DBr1 n cnt s cnt=0
 s %CTHOS020d(17)=""
 i $g(%CTHOS020d(3))'="" s cnt=cnt+1,$p(%CTHOS020d(17),"|",cnt)=$g(%CTHOS020d(3))
 i $g(%CTHOS020d(4))'="" s cnt=cnt+1,$p(%CTHOS020d(17),"|",cnt)=$g(%CTHOS020d(4))
 i $g(%CTHOS020d(5))'="" s cnt=cnt+1,$p(%CTHOS020d(17),"|",cnt)=$g(%CTHOS020d(5))
 i $g(%CTHOS020d(6))'="" s cnt=cnt+1,$p(%CTHOS020d(17),"|",cnt)=$g(%CTHOS020d(6))
 i $g(%CTHOS020d(7))'="" s cnt=cnt+1,$p(%CTHOS020d(17),"|",cnt)=$g(%CTHOS020d(7))
 k cnt q
%CTHOS020o s $zt="%CTHOS020E" s SQLCODE=$s($g(%CTHOS020c):-101,1:0) q:SQLCODE'=0  s %CTHOS020d(56)=0 s %CTHOS020d(57)=0,%CTHOS020d(58)=""
 s %CTHOS020d(42)=$g(code),%CTHOS020d(43)=$g(code),%CTHOS020d(45)=$g(desc),%CTHOS020d(46)=$g(desc),%CTHOS020d(47)=$g(active),%CTHOS020d(48)=$g(active),%CTHOS020d(49)=$g(site),%CTHOS020d(50)=$g(site),%CTHOS020d(51)=$g(strCode),%CTHOS020d(52)=$g(strCode)
 s %CTHOS020t(1)=$i(^||%sql.temp)
 s %CTHOS020d(55)=$zu(28,%CTHOS020d(47),7)
 s %CTHOS020c=1 q
%CTHOS020E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS020c,%CTHOS020d,%CTHOS020E,%CTHOS020l,%CTHOS020n,%CTHOS020R,%CTHOS020s,%CTHOS020t,%CTHOS020Z q
%0Dfirst 
 k ^||%sql.temp(%CTHOS020t(1),0) s ^||%sql.temp(%CTHOS020t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%CTHOS020t(1),0))
 ; asl MOD# 3
 d %0DBMod
 i $sortend(^||%sql.temp(%CTHOS020t(1),0))
 s %CTHOS020s(25)=""
%0DCk1 s %CTHOS020s(25)=$o(^||%sql.temp(%CTHOS020t(1),0,%CTHOS020s(25)))
 i %CTHOS020s(25)="" g %0DCdun
 s %CTHOS020d(25)=$s(%CTHOS020s(25)=-1E14:"",1:%CTHOS020s(25))
 s %CTHOS020s(1)=""
%0DCk2 s %CTHOS020s(1)=$o(^||%sql.temp(%CTHOS020t(1),0,%CTHOS020s(25),%CTHOS020s(1)))
 i %CTHOS020s(1)="" g %0DCk1
 s %CTHOS020d(1)=$s(%CTHOS020s(1)=-1E14:"",1:%CTHOS020s(1))
 i %CTHOS020d(1)'="",$d(^TTAB("RH",%CTHOS020d(1)))
 e  g %0DCk2
 s %CTHOS020d(69)=$g(^TTAB("RH",%CTHOS020d(1)))
 s %CTHOS020d(2)=$p(%CTHOS020d(69),"\",1) s %CTHOS020d(3)=$p(%CTHOS020d(69),"\",2) s %CTHOS020d(4)=$p(%CTHOS020d(69),"\",3) s %CTHOS020d(5)=$p(%CTHOS020d(69),"\",4) s %CTHOS020d(6)=$p(%CTHOS020d(69),"\",5) s %CTHOS020d(7)=$p(%CTHOS020d(69),"\",6) s %CTHOS020d(8)=$p(%CTHOS020d(69),"\",7) s %CTHOS020d(9)=$p(%CTHOS020d(69),"\",8) s %CTHOS020d(10)=$p(%CTHOS020d(69),"\",9) s %CTHOS020d(11)=$p(%CTHOS020d(69),"\",10) s %CTHOS020d(12)=$p(%CTHOS020d(69),"\",11) s %CTHOS020d(13)=$p(%CTHOS020d(69),"\",12) s %CTHOS020d(14)=$p(%CTHOS020d(69),"\",13) s %CTHOS020d(15)=$p(%CTHOS020d(69),"\",14) s %CTHOS020d(16)=$p(%CTHOS020d(69),"\",15) s %CTHOS020d(18)=$p(%CTHOS020d(69),"\",16) s %CTHOS020d(19)=$p(%CTHOS020d(69),"\",17) s %CTHOS020d(20)=$p(%CTHOS020d(69),"\",18) s %CTHOS020d(21)=$p(%CTHOS020d(69),"\",20) s %CTHOS020d(22)=$p(%CTHOS020d(69),"\",21) s %CTHOS020d(23)=$p(%CTHOS020d(69),"\",19) s %CTHOS020d(24)=$p(%CTHOS020d(69),"\",22) s %CTHOS020d(26)=$p(%CTHOS020d(69),"\",24) s %CTHOS020d(27)=$p(%CTHOS020d(69),"\",25) s %CTHOS020d(28)=$p(%CTHOS020d(69),"\",26) s %CTHOS020d(29)=$p(%CTHOS020d(69),"\",27) s %CTHOS020d(30)=$p(%CTHOS020d(69),"\",28) s %CTHOS020d(31)=$p(%CTHOS020d(69),"\",29) s %CTHOS020d(32)=$p(%CTHOS020d(69),"\",30) s %CTHOS020d(34)=$p(%CTHOS020d(69),"\",31) s %CTHOS020d(35)=$p(%CTHOS020d(69),"\",32) s %CTHOS020d(36)=$p(%CTHOS020d(69),"\",33) s %CTHOS020d(37)=$p(%CTHOS020d(69),"\",34) s %CTHOS020d(39)=$p(%CTHOS020d(69),"\",35) s %CTHOS020d(40)=$p(%CTHOS020d(69),"\",36)
 s %CTHOS020d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS020d(1),"REM",0)) s $li(%CTHOS020d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS020d(38)=$l($g(%CTHOS020d(37))) s %CTHOS020d(54)=$zu(28,%CTHOS020d(24),7) s %CTHOS020d(44)=$zu(28,%CTHOS020d(2),6) s %CTHOS020d(41)=$zu(28,%CTHOS020d(1),6)
 g:$zu(115,2)=0 %0DCuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS020d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS020d(57)=1,%CTHOS020d(58)=$name(^TTAB("RH",$p(%CTHOS020d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS020d(1) ztrap "LOCK"  }
 ; asl MOD# 4
 i %CTHOS020d(1)'="",$d(^TTAB("RH",%CTHOS020d(1)))
 e  g %0DDdun
 s %CTHOS020d(74)=$g(^TTAB("RH",%CTHOS020d(1)))
 s %CTHOS020d(28)=$p(%CTHOS020d(74),"\",26)
 g:'((((%CTHOS020d(28)'="")&&(%CTHOS020d(28)=%CTHOS020d(49)))||(%CTHOS020d(50)=""))||(%CTHOS020d(28)="")) %0DDdun
 s %CTHOS020d(37)=$p(%CTHOS020d(74),"\",34)
 g:'((((%CTHOS020d(37)'="")&&(($c(0)[%CTHOS020d(51))||(%CTHOS020d(51)=$c(32,0)&&($e(%CTHOS020d(37))=$c(32)))||(%CTHOS020d(51)=$e(%CTHOS020d(37),1,$l(%CTHOS020d(51))))))||(%CTHOS020d(52)=""))||(%CTHOS020d(37)="")) %0DDdun
 s %CTHOS020d(2)=$p(%CTHOS020d(74),"\",1) s %CTHOS020d(3)=$p(%CTHOS020d(74),"\",2) s %CTHOS020d(4)=$p(%CTHOS020d(74),"\",3) s %CTHOS020d(5)=$p(%CTHOS020d(74),"\",4) s %CTHOS020d(6)=$p(%CTHOS020d(74),"\",5) s %CTHOS020d(7)=$p(%CTHOS020d(74),"\",6) s %CTHOS020d(8)=$p(%CTHOS020d(74),"\",7) s %CTHOS020d(9)=$p(%CTHOS020d(74),"\",8) s %CTHOS020d(10)=$p(%CTHOS020d(74),"\",9) s %CTHOS020d(11)=$p(%CTHOS020d(74),"\",10) s %CTHOS020d(12)=$p(%CTHOS020d(74),"\",11) s %CTHOS020d(13)=$p(%CTHOS020d(74),"\",12) s %CTHOS020d(14)=$p(%CTHOS020d(74),"\",13) s %CTHOS020d(15)=$p(%CTHOS020d(74),"\",14) s %CTHOS020d(16)=$p(%CTHOS020d(74),"\",15) s %CTHOS020d(18)=$p(%CTHOS020d(74),"\",16) s %CTHOS020d(19)=$p(%CTHOS020d(74),"\",17) s %CTHOS020d(20)=$p(%CTHOS020d(74),"\",18) s %CTHOS020d(21)=$p(%CTHOS020d(74),"\",20) s %CTHOS020d(22)=$p(%CTHOS020d(74),"\",21) s %CTHOS020d(23)=$p(%CTHOS020d(74),"\",19) s %CTHOS020d(24)=$p(%CTHOS020d(74),"\",22) s %CTHOS020d(25)=$p(%CTHOS020d(74),"\",23) s %CTHOS020d(26)=$p(%CTHOS020d(74),"\",24) s %CTHOS020d(27)=$p(%CTHOS020d(74),"\",25) s %CTHOS020d(29)=$p(%CTHOS020d(74),"\",27) s %CTHOS020d(30)=$p(%CTHOS020d(74),"\",28) s %CTHOS020d(31)=$p(%CTHOS020d(74),"\",29) s %CTHOS020d(32)=$p(%CTHOS020d(74),"\",30) s %CTHOS020d(34)=$p(%CTHOS020d(74),"\",31) s %CTHOS020d(35)=$p(%CTHOS020d(74),"\",32) s %CTHOS020d(36)=$p(%CTHOS020d(74),"\",33) s %CTHOS020d(39)=$p(%CTHOS020d(74),"\",35) s %CTHOS020d(40)=$p(%CTHOS020d(74),"\",36)
 s %CTHOS020d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS020d(1),"REM",0)) s $li(%CTHOS020d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS020d(38)=$l($g(%CTHOS020d(37))) s %CTHOS020d(54)=$zu(28,%CTHOS020d(24),7) s %CTHOS020d(44)=$zu(28,%CTHOS020d(2),6) s %CTHOS020d(41)=$zu(28,%CTHOS020d(1),6)
 g:'(((%CTHOS020d(42)'="")&&(%CTHOS020d(41)[%CTHOS020d(42)))||(%CTHOS020d(43)="")) %0DDdun
 g:'(((%CTHOS020d(45)'="")&&((%CTHOS020d(44)'="")&&(%CTHOS020d(44)[%CTHOS020d(45))))||(%CTHOS020d(46)="")) %0DDdun
 g:'(((%CTHOS020d(54)'=" ")&&(%CTHOS020d(54)=%CTHOS020d(55)))||(%CTHOS020d(48)="")) %0DDdun
%0DCuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS020d(56)=%CTHOS020d(56)+1,%ROWCOUNT=%CTHOS020d(56),%ROWID=%CTHOS020d(1),%CTHOS020c=10 q
%CTHOS020f i '$g(%CTHOS020c) { s SQLCODE=-102 q  } i %CTHOS020c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Derr" i $d(%0CacheRowLimit)#2,$g(%CTHOS020d(56))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS020d(56),%CTHOS020c=100 q  } g %0Dfirst:%CTHOS020c=1
%0DDdun i $zu(115,2)=1,$g(%CTHOS020d(57))=1 { l -@%CTHOS020d(58) s %CTHOS020d(57)=0 }
 g %0DCk2
%0DCdun 
%0DAdun 
 s %ROWCOUNT=%CTHOS020d(56),SQLCODE=100,%CTHOS020c=100 q
%CTHOS020c i '$g(%CTHOS020c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS020d(56)),1:0) f %CTHOS020d(59)=1 { i $sortend(^||%sql.temp(%CTHOS020t(%CTHOS020d(59)),0),0) } k ^||%sql.temp(%CTHOS020t(1))
 i $zu(115,2)=1,$g(%CTHOS020d(57))=1 { l -@%CTHOS020d(58) } k %CTHOS020c,%CTHOS020d,%CTHOS020E,%CTHOS020l,%CTHOS020n,%CTHOS020R,%CTHOS020s,%CTHOS020t,%CTHOS020Z s SQLCODE=0 q
%0Derr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS020c=100
 f %CTHOS020d(59)=1 i $sortend(^||%sql.temp(%CTHOS020t(%CTHOS020d(59)),0),0)
 q
%0DBMod ; asl MOD# 2
 s %CTHOS020d(1)=""
%0DBk1 s %CTHOS020d(1)=$o(^TTAB("RH",%CTHOS020d(1)))
 i %CTHOS020d(1)="" g %0DBdun
 s %CTHOS020d(64)=$g(^TTAB("RH",%CTHOS020d(1)))
 s %CTHOS020d(28)=$p(%CTHOS020d(64),"\",26)
 g:'((((%CTHOS020d(28)'="")&&(%CTHOS020d(28)=%CTHOS020d(49)))||(%CTHOS020d(50)=""))||(%CTHOS020d(28)="")) %0DBk1
 s %CTHOS020d(37)=$p(%CTHOS020d(64),"\",34)
 g:'((((%CTHOS020d(37)'="")&&(($c(0)[%CTHOS020d(51))||(%CTHOS020d(51)=$c(32,0)&&($e(%CTHOS020d(37))=$c(32)))||(%CTHOS020d(51)=$e(%CTHOS020d(37),1,$l(%CTHOS020d(51))))))||(%CTHOS020d(52)=""))||(%CTHOS020d(37)="")) %0DBk1
 s %CTHOS020d(2)=$p(%CTHOS020d(64),"\",1) s %CTHOS020d(3)=$p(%CTHOS020d(64),"\",2) s %CTHOS020d(4)=$p(%CTHOS020d(64),"\",3) s %CTHOS020d(5)=$p(%CTHOS020d(64),"\",4) s %CTHOS020d(6)=$p(%CTHOS020d(64),"\",5) s %CTHOS020d(7)=$p(%CTHOS020d(64),"\",6) s %CTHOS020d(8)=$p(%CTHOS020d(64),"\",7) s %CTHOS020d(9)=$p(%CTHOS020d(64),"\",8) s %CTHOS020d(10)=$p(%CTHOS020d(64),"\",9) s %CTHOS020d(11)=$p(%CTHOS020d(64),"\",10) s %CTHOS020d(12)=$p(%CTHOS020d(64),"\",11) s %CTHOS020d(13)=$p(%CTHOS020d(64),"\",12) s %CTHOS020d(14)=$p(%CTHOS020d(64),"\",13) s %CTHOS020d(15)=$p(%CTHOS020d(64),"\",14) s %CTHOS020d(16)=$p(%CTHOS020d(64),"\",15) s %CTHOS020d(18)=$p(%CTHOS020d(64),"\",16) s %CTHOS020d(19)=$p(%CTHOS020d(64),"\",17) s %CTHOS020d(20)=$p(%CTHOS020d(64),"\",18) s %CTHOS020d(21)=$p(%CTHOS020d(64),"\",20) s %CTHOS020d(22)=$p(%CTHOS020d(64),"\",21) s %CTHOS020d(23)=$p(%CTHOS020d(64),"\",19) s %CTHOS020d(24)=$p(%CTHOS020d(64),"\",22) s %CTHOS020d(25)=$p(%CTHOS020d(64),"\",23) s %CTHOS020d(26)=$p(%CTHOS020d(64),"\",24) s %CTHOS020d(27)=$p(%CTHOS020d(64),"\",25) s %CTHOS020d(29)=$p(%CTHOS020d(64),"\",27) s %CTHOS020d(30)=$p(%CTHOS020d(64),"\",28) s %CTHOS020d(31)=$p(%CTHOS020d(64),"\",29) s %CTHOS020d(32)=$p(%CTHOS020d(64),"\",30) s %CTHOS020d(34)=$p(%CTHOS020d(64),"\",31) s %CTHOS020d(35)=$p(%CTHOS020d(64),"\",32) s %CTHOS020d(36)=$p(%CTHOS020d(64),"\",33) s %CTHOS020d(39)=$p(%CTHOS020d(64),"\",35) s %CTHOS020d(40)=$p(%CTHOS020d(64),"\",36)
 s %CTHOS020d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS020d(1),"REM",0)) s $li(%CTHOS020d(33),%irep)=$g(^(%irep))
 d %0DBr1 s %CTHOS020d(38)=$l($g(%CTHOS020d(37))) s %CTHOS020d(54)=$zu(28,%CTHOS020d(24),7) s %CTHOS020d(44)=$zu(28,%CTHOS020d(2),6) s %CTHOS020d(41)=$zu(28,%CTHOS020d(1),6)
 g:'(((%CTHOS020d(42)'="")&&(%CTHOS020d(41)[%CTHOS020d(42)))||(%CTHOS020d(43)="")) %0DBk1
 g:'(((%CTHOS020d(45)'="")&&((%CTHOS020d(44)'="")&&(%CTHOS020d(44)[%CTHOS020d(45))))||(%CTHOS020d(46)="")) %0DBk1
 g:'(((%CTHOS020d(54)'=" ")&&(%CTHOS020d(54)=%CTHOS020d(55)))||(%CTHOS020d(48)="")) %0DBk1
 s %CTHOS020s(25)=$s(%CTHOS020d(25)'="":%CTHOS020d(25),1:-1E14),%CTHOS020s(1)=$s(%CTHOS020d(1)'="":%CTHOS020d(1),1:-1E14),^||%sql.temp(%CTHOS020t(1),0,%CTHOS020s(25),%CTHOS020s(1))=""
 g %0DBk1
%0DBdun 
 q
%0GBr1 n cnt s cnt=0
 s %CTHOS030d(17)=""
 i $g(%CTHOS030d(3))'="" s cnt=cnt+1,$p(%CTHOS030d(17),"|",cnt)=$g(%CTHOS030d(3))
 i $g(%CTHOS030d(4))'="" s cnt=cnt+1,$p(%CTHOS030d(17),"|",cnt)=$g(%CTHOS030d(4))
 i $g(%CTHOS030d(5))'="" s cnt=cnt+1,$p(%CTHOS030d(17),"|",cnt)=$g(%CTHOS030d(5))
 i $g(%CTHOS030d(6))'="" s cnt=cnt+1,$p(%CTHOS030d(17),"|",cnt)=$g(%CTHOS030d(6))
 i $g(%CTHOS030d(7))'="" s cnt=cnt+1,$p(%CTHOS030d(17),"|",cnt)=$g(%CTHOS030d(7))
 k cnt q
%CTHOS030o s $zt="%CTHOS030E" s SQLCODE=$s($g(%CTHOS030c):-101,1:0) q:SQLCODE'=0  s %CTHOS030d(59)=0 s %CTHOS030d(60)=0,%CTHOS030d(61)=""
 s %CTHOS030d(42)=$g(code),%CTHOS030d(43)=$g(code),%CTHOS030d(45)=$g(desc),%CTHOS030d(46)=$g(desc),%CTHOS030d(47)=$g(active),%CTHOS030d(48)=$g(active),%CTHOS030d(49)=$g(site),%CTHOS030d(50)=$g(site),%CTHOS030d(51)=$g(strCode),%CTHOS030d(52)=$g(strCode),%CTHOS030d(53)=$g(strCodeLength)
 s %CTHOS030d(56)=$zu(28,%CTHOS030d(47),7)
 s %CTHOS030c=1 q
%CTHOS030E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS030c,%CTHOS030d,%CTHOS030E,%CTHOS030l,%CTHOS030n,%CTHOS030R,%CTHOS030Z q
%0Gfirst 
 ; asl MOD# 2
 s %CTHOS030d(38)=%CTHOS030d(53)
 i %CTHOS030d(38)="" g %0GBdun
 i '(%CTHOS030d(38)'="") g %0GBdun
 s %CTHOS030d(37)=""
%0GBk1 s %CTHOS030d(37)=$o(^TTABi("RH-2",%CTHOS030d(38),%CTHOS030d(37)))
 i %CTHOS030d(37)="" g %0GBdun
 i '((($c(0)[%CTHOS030d(51))||(%CTHOS030d(51)=$c(32,0)&&($e(%CTHOS030d(37))=$c(32)))||(%CTHOS030d(51)=$e(%CTHOS030d(37),1,$l(%CTHOS030d(51)))))||(%CTHOS030d(52)="")) g %0GBk1
 i '(%CTHOS030d(37)'="") g %0GBk1
 s %CTHOS030d(1)=""
%0GBk2 s %CTHOS030d(1)=$o(^TTABi("RH-2",%CTHOS030d(38),%CTHOS030d(37),%CTHOS030d(1)))
 i %CTHOS030d(1)="" g %0GBk1
 s %CTHOS030d(41)=$zu(28,%CTHOS030d(1),6)
 g:'((($c(0)[%CTHOS030d(42))||(%CTHOS030d(42)=$c(32,0)&&($e(%CTHOS030d(41))=$c(32)))||(%CTHOS030d(42)=$e(%CTHOS030d(41),1,$l(%CTHOS030d(42)))))||(%CTHOS030d(43)="")) %0GBk2
 i %CTHOS030d(1)'="",$d(^TTAB("RH",%CTHOS030d(1)))
 e  g %0GBk2
 s %CTHOS030d(72)=$g(^TTAB("RH",%CTHOS030d(1)))
 s %CTHOS030d(28)=$p(%CTHOS030d(72),"\",26)
 g:'((((%CTHOS030d(28)'="")&&(%CTHOS030d(28)=%CTHOS030d(49)))||(%CTHOS030d(50)=""))||(%CTHOS030d(28)="")) %0GBk2
 s %CTHOS030d(2)=$p(%CTHOS030d(72),"\",1) s %CTHOS030d(3)=$p(%CTHOS030d(72),"\",2) s %CTHOS030d(4)=$p(%CTHOS030d(72),"\",3) s %CTHOS030d(5)=$p(%CTHOS030d(72),"\",4) s %CTHOS030d(6)=$p(%CTHOS030d(72),"\",5) s %CTHOS030d(7)=$p(%CTHOS030d(72),"\",6) s %CTHOS030d(8)=$p(%CTHOS030d(72),"\",7) s %CTHOS030d(9)=$p(%CTHOS030d(72),"\",8) s %CTHOS030d(10)=$p(%CTHOS030d(72),"\",9) s %CTHOS030d(11)=$p(%CTHOS030d(72),"\",10) s %CTHOS030d(12)=$p(%CTHOS030d(72),"\",11) s %CTHOS030d(13)=$p(%CTHOS030d(72),"\",12) s %CTHOS030d(14)=$p(%CTHOS030d(72),"\",13) s %CTHOS030d(15)=$p(%CTHOS030d(72),"\",14) s %CTHOS030d(16)=$p(%CTHOS030d(72),"\",15) s %CTHOS030d(18)=$p(%CTHOS030d(72),"\",16) s %CTHOS030d(19)=$p(%CTHOS030d(72),"\",17) s %CTHOS030d(20)=$p(%CTHOS030d(72),"\",18) s %CTHOS030d(21)=$p(%CTHOS030d(72),"\",20) s %CTHOS030d(22)=$p(%CTHOS030d(72),"\",21) s %CTHOS030d(23)=$p(%CTHOS030d(72),"\",19) s %CTHOS030d(24)=$p(%CTHOS030d(72),"\",22) s %CTHOS030d(25)=$p(%CTHOS030d(72),"\",23) s %CTHOS030d(26)=$p(%CTHOS030d(72),"\",24) s %CTHOS030d(27)=$p(%CTHOS030d(72),"\",25) s %CTHOS030d(29)=$p(%CTHOS030d(72),"\",27) s %CTHOS030d(30)=$p(%CTHOS030d(72),"\",28) s %CTHOS030d(31)=$p(%CTHOS030d(72),"\",29) s %CTHOS030d(32)=$p(%CTHOS030d(72),"\",30) s %CTHOS030d(34)=$p(%CTHOS030d(72),"\",31) s %CTHOS030d(35)=$p(%CTHOS030d(72),"\",32) s %CTHOS030d(36)=$p(%CTHOS030d(72),"\",33) s %CTHOS030d(39)=$p(%CTHOS030d(72),"\",35) s %CTHOS030d(40)=$p(%CTHOS030d(72),"\",36)
 s %CTHOS030d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS030d(1),"REM",0)) s $li(%CTHOS030d(33),%irep)=$g(^(%irep))
 d %0GBr1 s %CTHOS030d(55)=$zu(28,%CTHOS030d(24),7) s %CTHOS030d(44)=$zu(28,%CTHOS030d(2),6)
 g:'(((%CTHOS030d(44)'="")&&(($c(0)[%CTHOS030d(45))||(%CTHOS030d(45)=$c(32,0)&&($e(%CTHOS030d(44))=$c(32)))||(%CTHOS030d(45)=$e(%CTHOS030d(44),1,$l(%CTHOS030d(45))))))||(%CTHOS030d(46)="")) %0GBk2
 g:'(((%CTHOS030d(55)'=" ")&&(%CTHOS030d(55)=%CTHOS030d(56)))||(%CTHOS030d(48)="")) %0GBk2
 g:$zu(115,2)=0 %0GBuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS030d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS030d(60)=1,%CTHOS030d(61)=$name(^TTAB("RH",$p(%CTHOS030d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS030d(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %CTHOS030d(57)=$lb(""_%CTHOS030d(38),""_%CTHOS030d(41),""_%CTHOS030d(44),""_%CTHOS030d(55),""_%CTHOS030d(28),""_%CTHOS030d(37))
 i %CTHOS030d(1)'="",$d(^TTAB("RH",%CTHOS030d(1)))
 e  g %0GCdun
 s %CTHOS030d(77)=$g(^TTAB("RH",%CTHOS030d(1)))
 s %CTHOS030d(2)=$p(%CTHOS030d(77),"\",1) s %CTHOS030d(3)=$p(%CTHOS030d(77),"\",2) s %CTHOS030d(4)=$p(%CTHOS030d(77),"\",3) s %CTHOS030d(5)=$p(%CTHOS030d(77),"\",4) s %CTHOS030d(6)=$p(%CTHOS030d(77),"\",5) s %CTHOS030d(7)=$p(%CTHOS030d(77),"\",6) s %CTHOS030d(8)=$p(%CTHOS030d(77),"\",7) s %CTHOS030d(9)=$p(%CTHOS030d(77),"\",8) s %CTHOS030d(10)=$p(%CTHOS030d(77),"\",9) s %CTHOS030d(11)=$p(%CTHOS030d(77),"\",10) s %CTHOS030d(12)=$p(%CTHOS030d(77),"\",11) s %CTHOS030d(13)=$p(%CTHOS030d(77),"\",12) s %CTHOS030d(14)=$p(%CTHOS030d(77),"\",13) s %CTHOS030d(15)=$p(%CTHOS030d(77),"\",14) s %CTHOS030d(16)=$p(%CTHOS030d(77),"\",15) s %CTHOS030d(18)=$p(%CTHOS030d(77),"\",16) s %CTHOS030d(19)=$p(%CTHOS030d(77),"\",17) s %CTHOS030d(20)=$p(%CTHOS030d(77),"\",18) s %CTHOS030d(21)=$p(%CTHOS030d(77),"\",20) s %CTHOS030d(22)=$p(%CTHOS030d(77),"\",21) s %CTHOS030d(23)=$p(%CTHOS030d(77),"\",19) s %CTHOS030d(24)=$p(%CTHOS030d(77),"\",22) s %CTHOS030d(25)=$p(%CTHOS030d(77),"\",23) s %CTHOS030d(26)=$p(%CTHOS030d(77),"\",24) s %CTHOS030d(27)=$p(%CTHOS030d(77),"\",25) s %CTHOS030d(28)=$p(%CTHOS030d(77),"\",26) s %CTHOS030d(29)=$p(%CTHOS030d(77),"\",27) s %CTHOS030d(30)=$p(%CTHOS030d(77),"\",28) s %CTHOS030d(31)=$p(%CTHOS030d(77),"\",29) s %CTHOS030d(32)=$p(%CTHOS030d(77),"\",30) s %CTHOS030d(34)=$p(%CTHOS030d(77),"\",31) s %CTHOS030d(35)=$p(%CTHOS030d(77),"\",32) s %CTHOS030d(36)=$p(%CTHOS030d(77),"\",33) s %CTHOS030d(37)=$p(%CTHOS030d(77),"\",34) s %CTHOS030d(39)=$p(%CTHOS030d(77),"\",35) s %CTHOS030d(40)=$p(%CTHOS030d(77),"\",36)
 s %CTHOS030d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS030d(1),"REM",0)) s $li(%CTHOS030d(33),%irep)=$g(^(%irep))
 d %0GBr1 s %CTHOS030d(38)=$l($g(%CTHOS030d(37))) s %CTHOS030d(55)=$zu(28,%CTHOS030d(24),7) s %CTHOS030d(44)=$zu(28,%CTHOS030d(2),6) s %CTHOS030d(41)=$zu(28,%CTHOS030d(1),6)
 s %CTHOS030d(58)=$lb(""_%CTHOS030d(38),""_%CTHOS030d(41),""_%CTHOS030d(44),""_%CTHOS030d(55),""_%CTHOS030d(28),""_%CTHOS030d(37))
 g:%CTHOS030d(57)'=%CTHOS030d(58) %0GCdun
%0GBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS030d(59)=%CTHOS030d(59)+1,%ROWCOUNT=%CTHOS030d(59),%ROWID=%CTHOS030d(1),%CTHOS030c=10 q
%CTHOS030f i '$g(%CTHOS030c) { s SQLCODE=-102 q  } i %CTHOS030c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Gerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS030d(59))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS030d(59),%CTHOS030c=100 q  } g %0Gfirst:%CTHOS030c=1
%0GCdun i $zu(115,2)=1,$g(%CTHOS030d(60))=1 { l -@%CTHOS030d(61) s %CTHOS030d(60)=0 }
 g %0GBk2
%0GBdun 
%0GAdun 
 s %ROWCOUNT=%CTHOS030d(59),SQLCODE=100,%CTHOS030c=100 q
%CTHOS030c i '$g(%CTHOS030c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS030d(59)),1:0)
 i $zu(115,2)=1,$g(%CTHOS030d(60))=1 { l -@%CTHOS030d(61) } k %CTHOS030c,%CTHOS030d,%CTHOS030E,%CTHOS030l,%CTHOS030n,%CTHOS030R,%CTHOS030Z s SQLCODE=0 q
%0Gerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS030c=100 q
%0JBr1 n cnt s cnt=0
 s %CTHOS040d(17)=""
 i $g(%CTHOS040d(3))'="" s cnt=cnt+1,$p(%CTHOS040d(17),"|",cnt)=$g(%CTHOS040d(3))
 i $g(%CTHOS040d(4))'="" s cnt=cnt+1,$p(%CTHOS040d(17),"|",cnt)=$g(%CTHOS040d(4))
 i $g(%CTHOS040d(5))'="" s cnt=cnt+1,$p(%CTHOS040d(17),"|",cnt)=$g(%CTHOS040d(5))
 i $g(%CTHOS040d(6))'="" s cnt=cnt+1,$p(%CTHOS040d(17),"|",cnt)=$g(%CTHOS040d(6))
 i $g(%CTHOS040d(7))'="" s cnt=cnt+1,$p(%CTHOS040d(17),"|",cnt)=$g(%CTHOS040d(7))
 k cnt q
%CTHOS040o s $zt="%CTHOS040E" s SQLCODE=$s($g(%CTHOS040c):-101,1:0) q:SQLCODE'=0  s %CTHOS040d(59)=0 s %CTHOS040d(60)=0,%CTHOS040d(61)=""
 s %CTHOS040d(42)=$g(code),%CTHOS040d(43)=$g(code),%CTHOS040d(45)=$g(desc),%CTHOS040d(46)=$g(desc),%CTHOS040d(47)=$g(active),%CTHOS040d(48)=$g(active),%CTHOS040d(49)=$g(site),%CTHOS040d(50)=$g(site),%CTHOS040d(51)=$g(strCode),%CTHOS040d(52)=$g(strCode),%CTHOS040d(53)=$g(strCodeLength)
 s %CTHOS040d(56)=$zu(28,%CTHOS040d(47),7)
 s %CTHOS040c=1 q
%CTHOS040E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %CTHOS040c,%CTHOS040d,%CTHOS040E,%CTHOS040l,%CTHOS040n,%CTHOS040R,%CTHOS040Z q
%0Jfirst 
 ; asl MOD# 2
 s %CTHOS040d(38)=%CTHOS040d(53)
 i %CTHOS040d(38)="" g %0JBdun
 i '(%CTHOS040d(38)'="") g %0JBdun
 s %CTHOS040d(37)=""
%0JBk1 s %CTHOS040d(37)=$o(^TTABi("RH-2",%CTHOS040d(38),%CTHOS040d(37)))
 i %CTHOS040d(37)="" g %0JBdun
 i '((($c(0)[%CTHOS040d(51))||(%CTHOS040d(51)=$c(32,0)&&($e(%CTHOS040d(37))=$c(32)))||(%CTHOS040d(51)=$e(%CTHOS040d(37),1,$l(%CTHOS040d(51)))))||(%CTHOS040d(52)="")) g %0JBk1
 i '(%CTHOS040d(37)'="") g %0JBk1
 s %CTHOS040d(1)=""
%0JBk2 s %CTHOS040d(1)=$o(^TTABi("RH-2",%CTHOS040d(38),%CTHOS040d(37),%CTHOS040d(1)))
 i %CTHOS040d(1)="" g %0JBk1
 s %CTHOS040d(41)=$zu(28,%CTHOS040d(1),6)
 g:'(((%CTHOS040d(42)'="")&&(%CTHOS040d(41)[%CTHOS040d(42)))||(%CTHOS040d(43)="")) %0JBk2
 i %CTHOS040d(1)'="",$d(^TTAB("RH",%CTHOS040d(1)))
 e  g %0JBk2
 s %CTHOS040d(72)=$g(^TTAB("RH",%CTHOS040d(1)))
 s %CTHOS040d(28)=$p(%CTHOS040d(72),"\",26)
 g:'((((%CTHOS040d(28)'="")&&(%CTHOS040d(28)=%CTHOS040d(49)))||(%CTHOS040d(50)=""))||(%CTHOS040d(28)="")) %0JBk2
 s %CTHOS040d(2)=$p(%CTHOS040d(72),"\",1) s %CTHOS040d(3)=$p(%CTHOS040d(72),"\",2) s %CTHOS040d(4)=$p(%CTHOS040d(72),"\",3) s %CTHOS040d(5)=$p(%CTHOS040d(72),"\",4) s %CTHOS040d(6)=$p(%CTHOS040d(72),"\",5) s %CTHOS040d(7)=$p(%CTHOS040d(72),"\",6) s %CTHOS040d(8)=$p(%CTHOS040d(72),"\",7) s %CTHOS040d(9)=$p(%CTHOS040d(72),"\",8) s %CTHOS040d(10)=$p(%CTHOS040d(72),"\",9) s %CTHOS040d(11)=$p(%CTHOS040d(72),"\",10) s %CTHOS040d(12)=$p(%CTHOS040d(72),"\",11) s %CTHOS040d(13)=$p(%CTHOS040d(72),"\",12) s %CTHOS040d(14)=$p(%CTHOS040d(72),"\",13) s %CTHOS040d(15)=$p(%CTHOS040d(72),"\",14) s %CTHOS040d(16)=$p(%CTHOS040d(72),"\",15) s %CTHOS040d(18)=$p(%CTHOS040d(72),"\",16) s %CTHOS040d(19)=$p(%CTHOS040d(72),"\",17) s %CTHOS040d(20)=$p(%CTHOS040d(72),"\",18) s %CTHOS040d(21)=$p(%CTHOS040d(72),"\",20) s %CTHOS040d(22)=$p(%CTHOS040d(72),"\",21) s %CTHOS040d(23)=$p(%CTHOS040d(72),"\",19) s %CTHOS040d(24)=$p(%CTHOS040d(72),"\",22) s %CTHOS040d(25)=$p(%CTHOS040d(72),"\",23) s %CTHOS040d(26)=$p(%CTHOS040d(72),"\",24) s %CTHOS040d(27)=$p(%CTHOS040d(72),"\",25) s %CTHOS040d(29)=$p(%CTHOS040d(72),"\",27) s %CTHOS040d(30)=$p(%CTHOS040d(72),"\",28) s %CTHOS040d(31)=$p(%CTHOS040d(72),"\",29) s %CTHOS040d(32)=$p(%CTHOS040d(72),"\",30) s %CTHOS040d(34)=$p(%CTHOS040d(72),"\",31) s %CTHOS040d(35)=$p(%CTHOS040d(72),"\",32) s %CTHOS040d(36)=$p(%CTHOS040d(72),"\",33) s %CTHOS040d(39)=$p(%CTHOS040d(72),"\",35) s %CTHOS040d(40)=$p(%CTHOS040d(72),"\",36)
 s %CTHOS040d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS040d(1),"REM",0)) s $li(%CTHOS040d(33),%irep)=$g(^(%irep))
 d %0JBr1 s %CTHOS040d(55)=$zu(28,%CTHOS040d(24),7) s %CTHOS040d(44)=$zu(28,%CTHOS040d(2),6)
 g:'(((%CTHOS040d(45)'="")&&((%CTHOS040d(44)'="")&&(%CTHOS040d(44)[%CTHOS040d(45))))||(%CTHOS040d(46)="")) %0JBk2
 g:'(((%CTHOS040d(55)'=" ")&&(%CTHOS040d(55)=%CTHOS040d(56)))||(%CTHOS040d(48)="")) %0JBk2
 g:$zu(115,2)=0 %0JBuncommitted i $zu(115,2)=1 l +^TTAB("RH",$p(%CTHOS040d(1),"||",1))#"S":$zu(115,4) i $t { s %CTHOS040d(60)=1,%CTHOS040d(61)=$name(^TTAB("RH",$p(%CTHOS040d(1),"||",1)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.CT_Hospital for RowID value: "_%CTHOS040d(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %CTHOS040d(57)=$lb(""_%CTHOS040d(38),""_%CTHOS040d(41),""_%CTHOS040d(44),""_%CTHOS040d(55),""_%CTHOS040d(28),""_%CTHOS040d(37))
 i %CTHOS040d(1)'="",$d(^TTAB("RH",%CTHOS040d(1)))
 e  g %0JCdun
 s %CTHOS040d(77)=$g(^TTAB("RH",%CTHOS040d(1)))
 s %CTHOS040d(2)=$p(%CTHOS040d(77),"\",1) s %CTHOS040d(3)=$p(%CTHOS040d(77),"\",2) s %CTHOS040d(4)=$p(%CTHOS040d(77),"\",3) s %CTHOS040d(5)=$p(%CTHOS040d(77),"\",4) s %CTHOS040d(6)=$p(%CTHOS040d(77),"\",5) s %CTHOS040d(7)=$p(%CTHOS040d(77),"\",6) s %CTHOS040d(8)=$p(%CTHOS040d(77),"\",7) s %CTHOS040d(9)=$p(%CTHOS040d(77),"\",8) s %CTHOS040d(10)=$p(%CTHOS040d(77),"\",9) s %CTHOS040d(11)=$p(%CTHOS040d(77),"\",10) s %CTHOS040d(12)=$p(%CTHOS040d(77),"\",11) s %CTHOS040d(13)=$p(%CTHOS040d(77),"\",12) s %CTHOS040d(14)=$p(%CTHOS040d(77),"\",13) s %CTHOS040d(15)=$p(%CTHOS040d(77),"\",14) s %CTHOS040d(16)=$p(%CTHOS040d(77),"\",15) s %CTHOS040d(18)=$p(%CTHOS040d(77),"\",16) s %CTHOS040d(19)=$p(%CTHOS040d(77),"\",17) s %CTHOS040d(20)=$p(%CTHOS040d(77),"\",18) s %CTHOS040d(21)=$p(%CTHOS040d(77),"\",20) s %CTHOS040d(22)=$p(%CTHOS040d(77),"\",21) s %CTHOS040d(23)=$p(%CTHOS040d(77),"\",19) s %CTHOS040d(24)=$p(%CTHOS040d(77),"\",22) s %CTHOS040d(25)=$p(%CTHOS040d(77),"\",23) s %CTHOS040d(26)=$p(%CTHOS040d(77),"\",24) s %CTHOS040d(27)=$p(%CTHOS040d(77),"\",25) s %CTHOS040d(28)=$p(%CTHOS040d(77),"\",26) s %CTHOS040d(29)=$p(%CTHOS040d(77),"\",27) s %CTHOS040d(30)=$p(%CTHOS040d(77),"\",28) s %CTHOS040d(31)=$p(%CTHOS040d(77),"\",29) s %CTHOS040d(32)=$p(%CTHOS040d(77),"\",30) s %CTHOS040d(34)=$p(%CTHOS040d(77),"\",31) s %CTHOS040d(35)=$p(%CTHOS040d(77),"\",32) s %CTHOS040d(36)=$p(%CTHOS040d(77),"\",33) s %CTHOS040d(37)=$p(%CTHOS040d(77),"\",34) s %CTHOS040d(39)=$p(%CTHOS040d(77),"\",35) s %CTHOS040d(40)=$p(%CTHOS040d(77),"\",36)
 s %CTHOS040d(33)="" f %irep=1:1:$g(^TTAB("RH",%CTHOS040d(1),"REM",0)) s $li(%CTHOS040d(33),%irep)=$g(^(%irep))
 d %0JBr1 s %CTHOS040d(38)=$l($g(%CTHOS040d(37))) s %CTHOS040d(55)=$zu(28,%CTHOS040d(24),7) s %CTHOS040d(44)=$zu(28,%CTHOS040d(2),6) s %CTHOS040d(41)=$zu(28,%CTHOS040d(1),6)
 s %CTHOS040d(58)=$lb(""_%CTHOS040d(38),""_%CTHOS040d(41),""_%CTHOS040d(44),""_%CTHOS040d(55),""_%CTHOS040d(28),""_%CTHOS040d(37))
 g:%CTHOS040d(57)'=%CTHOS040d(58) %0JCdun
%0JBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %CTHOS040d(59)=%CTHOS040d(59)+1,%ROWCOUNT=%CTHOS040d(59),%ROWID=%CTHOS040d(1),%CTHOS040c=10 q
%CTHOS040f i '$g(%CTHOS040c) { s SQLCODE=-102 q  } i %CTHOS040c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Jerr" i $d(%0CacheRowLimit)#2,$g(%CTHOS040d(59))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%CTHOS040d(59),%CTHOS040c=100 q  } g %0Jfirst:%CTHOS040c=1
%0JCdun i $zu(115,2)=1,$g(%CTHOS040d(60))=1 { l -@%CTHOS040d(61) s %CTHOS040d(60)=0 }
 g %0JBk2
%0JBdun 
%0JAdun 
 s %ROWCOUNT=%CTHOS040d(59),SQLCODE=100,%CTHOS040c=100 q
%CTHOS040c i '$g(%CTHOS040c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%CTHOS040d(59)),1:0)
 i $zu(115,2)=1,$g(%CTHOS040d(60))=1 { l -@%CTHOS040d(61) } k %CTHOS040c,%CTHOS040d,%CTHOS040E,%CTHOS040l,%CTHOS040n,%CTHOS040R,%CTHOS040Z s SQLCODE=0 q
%0Jerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %CTHOS040c=100 q
%0Qo d %CTHOS010f q:SQLCODE'=0
 s PLIST(1)=%CTHOS010d(1),PLIST(2)=%CTHOS010d(1),PLIST(3)=%CTHOS010d(2),PLIST(4)=%CTHOS010d(3),PLIST(5)=%CTHOS010d(4),PLIST(6)=%CTHOS010d(5),PLIST(7)=%CTHOS010d(6),PLIST(8)=%CTHOS010d(7),PLIST(9)=%CTHOS010d(8),PLIST(10)=%CTHOS010d(9),PLIST(11)=%CTHOS010d(10),PLIST(12)=%CTHOS010d(11),PLIST(13)=%CTHOS010d(12),PLIST(14)=%CTHOS010d(13),PLIST(15)=%CTHOS010d(14),PLIST(16)=%CTHOS010d(15),PLIST(17)=%CTHOS010d(16),PLIST(18)=%CTHOS010d(17),PLIST(19)=%CTHOS010d(18),PLIST(20)=%CTHOS010d(19),PLIST(21)=%CTHOS010d(20),PLIST(22)=%CTHOS010d(21),PLIST(23)=%CTHOS010d(22),PLIST(24)=%CTHOS010d(23),PLIST(25)=%CTHOS010d(24),PLIST(26)=%CTHOS010d(25),PLIST(27)=%CTHOS010d(26),PLIST(28)=%CTHOS010d(27),PLIST(29)=%CTHOS010d(28),PLIST(30)=%CTHOS010d(29),PLIST(31)=%CTHOS010d(30),PLIST(32)=%CTHOS010d(31),PLIST(33)=%CTHOS010d(32),PLIST(34)=%CTHOS010d(33),PLIST(35)=%CTHOS010d(34),PLIST(36)=%CTHOS010d(35),PLIST(37)=%CTHOS010d(36),PLIST(38)=%CTHOS010d(37),PLIST(39)=%CTHOS010d(38),PLIST(40)=%CTHOS010d(39),PLIST(41)=%CTHOS010d(40)
 q
%0Ro d %CTHOS020f q:SQLCODE'=0
 s PLIST(1)=%CTHOS020d(1),PLIST(2)=%CTHOS020d(1),PLIST(3)=%CTHOS020d(2),PLIST(4)=%CTHOS020d(3),PLIST(5)=%CTHOS020d(4),PLIST(6)=%CTHOS020d(5),PLIST(7)=%CTHOS020d(6),PLIST(8)=%CTHOS020d(7),PLIST(9)=%CTHOS020d(8),PLIST(10)=%CTHOS020d(9),PLIST(11)=%CTHOS020d(10),PLIST(12)=%CTHOS020d(11),PLIST(13)=%CTHOS020d(12),PLIST(14)=%CTHOS020d(13),PLIST(15)=%CTHOS020d(14),PLIST(16)=%CTHOS020d(15),PLIST(17)=%CTHOS020d(16),PLIST(18)=%CTHOS020d(17),PLIST(19)=%CTHOS020d(18),PLIST(20)=%CTHOS020d(19),PLIST(21)=%CTHOS020d(20),PLIST(22)=%CTHOS020d(21),PLIST(23)=%CTHOS020d(22),PLIST(24)=%CTHOS020d(23),PLIST(25)=%CTHOS020d(24),PLIST(26)=%CTHOS020d(25),PLIST(27)=%CTHOS020d(26),PLIST(28)=%CTHOS020d(27),PLIST(29)=%CTHOS020d(28),PLIST(30)=%CTHOS020d(29),PLIST(31)=%CTHOS020d(30),PLIST(32)=%CTHOS020d(31),PLIST(33)=%CTHOS020d(32),PLIST(34)=%CTHOS020d(33),PLIST(35)=%CTHOS020d(34),PLIST(36)=%CTHOS020d(35),PLIST(37)=%CTHOS020d(36),PLIST(38)=%CTHOS020d(37),PLIST(39)=%CTHOS020d(38),PLIST(40)=%CTHOS020d(39),PLIST(41)=%CTHOS020d(40)
 q
%0So d %CTHOS030f q:SQLCODE'=0
 s PLIST(1)=%CTHOS030d(1),PLIST(2)=%CTHOS030d(1),PLIST(3)=%CTHOS030d(2),PLIST(4)=%CTHOS030d(3),PLIST(5)=%CTHOS030d(4),PLIST(6)=%CTHOS030d(5),PLIST(7)=%CTHOS030d(6),PLIST(8)=%CTHOS030d(7),PLIST(9)=%CTHOS030d(8),PLIST(10)=%CTHOS030d(9),PLIST(11)=%CTHOS030d(10),PLIST(12)=%CTHOS030d(11),PLIST(13)=%CTHOS030d(12),PLIST(14)=%CTHOS030d(13),PLIST(15)=%CTHOS030d(14),PLIST(16)=%CTHOS030d(15),PLIST(17)=%CTHOS030d(16),PLIST(18)=%CTHOS030d(17),PLIST(19)=%CTHOS030d(18),PLIST(20)=%CTHOS030d(19),PLIST(21)=%CTHOS030d(20),PLIST(22)=%CTHOS030d(21),PLIST(23)=%CTHOS030d(22),PLIST(24)=%CTHOS030d(23),PLIST(25)=%CTHOS030d(24),PLIST(26)=%CTHOS030d(25),PLIST(27)=%CTHOS030d(26),PLIST(28)=%CTHOS030d(27),PLIST(29)=%CTHOS030d(28),PLIST(30)=%CTHOS030d(29),PLIST(31)=%CTHOS030d(30),PLIST(32)=%CTHOS030d(31),PLIST(33)=%CTHOS030d(32),PLIST(34)=%CTHOS030d(33),PLIST(35)=%CTHOS030d(34),PLIST(36)=%CTHOS030d(35),PLIST(37)=%CTHOS030d(36),PLIST(38)=%CTHOS030d(37),PLIST(39)=%CTHOS030d(38),PLIST(40)=%CTHOS030d(39),PLIST(41)=%CTHOS030d(40)
 q
%0To d %CTHOS040f q:SQLCODE'=0
 s PLIST(1)=%CTHOS040d(1),PLIST(2)=%CTHOS040d(1),PLIST(3)=%CTHOS040d(2),PLIST(4)=%CTHOS040d(3),PLIST(5)=%CTHOS040d(4),PLIST(6)=%CTHOS040d(5),PLIST(7)=%CTHOS040d(6),PLIST(8)=%CTHOS040d(7),PLIST(9)=%CTHOS040d(8),PLIST(10)=%CTHOS040d(9),PLIST(11)=%CTHOS040d(10),PLIST(12)=%CTHOS040d(11),PLIST(13)=%CTHOS040d(12),PLIST(14)=%CTHOS040d(13),PLIST(15)=%CTHOS040d(14),PLIST(16)=%CTHOS040d(15),PLIST(17)=%CTHOS040d(16),PLIST(18)=%CTHOS040d(17),PLIST(19)=%CTHOS040d(18),PLIST(20)=%CTHOS040d(19),PLIST(21)=%CTHOS040d(20),PLIST(22)=%CTHOS040d(21),PLIST(23)=%CTHOS040d(22),PLIST(24)=%CTHOS040d(23),PLIST(25)=%CTHOS040d(24),PLIST(26)=%CTHOS040d(25),PLIST(27)=%CTHOS040d(26),PLIST(28)=%CTHOS040d(27),PLIST(29)=%CTHOS040d(28),PLIST(30)=%CTHOS040d(29),PLIST(31)=%CTHOS040d(30),PLIST(32)=%CTHOS040d(31),PLIST(33)=%CTHOS040d(32),PLIST(34)=%CTHOS040d(33),PLIST(35)=%CTHOS040d(34),PLIST(36)=%CTHOS040d(35),PLIST(37)=%CTHOS040d(36),PLIST(38)=%CTHOS040d(37),PLIST(39)=%CTHOS040d(38),PLIST(40)=%CTHOS040d(39),PLIST(41)=%CTHOS040d(40)
 q
]]></Routine>
</Export>
