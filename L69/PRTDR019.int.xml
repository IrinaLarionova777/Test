<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="PRTDR019" type="INT" languagemode="0" generated="1"><![CDATA[
PRTDR019 ; ML 28/05/01 ; Doctor's Report HEADER - MedLab Australia
 q
 ; supported calls
 ;
 ; INIT^PRTDR019
 ; QDR^PRTDR019
 ; Header^PRTDR019(page,par1,par2)
 ; Footer^PRTDR019(page,par1,par2)
 ;
 ; client specific parameters
INIT s MaxLine=43
 q
Margin() i type="V" q 0
 q 4
BOX ;
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p5v0s3b4101T")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h4930VConsult")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5030VPathologist")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5180VNormal")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5280VFile")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5430VNotes")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5530VRequired")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5680VPatient")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5780VNotified")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h5930VPatient")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6030VWill Call")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6180VResult to")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6280VPatient")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6430VMake")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6530VAppointment")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6680VCollect")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6780VPrescription")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h6930VOn Correct")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h7030VTreatment")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h7180VCheck with")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5270h7280VDoctor")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h4860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h4860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5360V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5360V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5610V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5610V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h5860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6360V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6360V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6610V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6610V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h6860V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h7110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"*c480h210v10g2P")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5200h7110V")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1BSP1;PW0.15;PD;PR580,0;PR0,-290;PR-580,0;PR0,290")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"%1A")
 q
 ; print department header
PrintDepHeader i PrintDepHeader d  s PrintDepHeader=0
 .n (dep,page,PageLine,tsLM)
 .s print=$$seldata^LVBCTDEP(dep,7),name=$$seldata^LVBCTDEP(dep,3)
 .i print="Y" d
 ..s len=$l(name) s len=$s(len=8:670,len=9:630,len=10:590,len=11:550,len=12:510,len=13:470,1:400)
 ..s x=$o(^TMP("REPORT",$j,page,"TEXT",""),-1)+1
 ..s ^TMP("REPORT",$j,page,"TEXT",x)="!"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+1)=$c(27)_"&f0S"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+2)=$c(27)_"&a1800H"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+3)=$c(27)_"*c1840h215v2p20G"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+4)=$c(27)_"&f1S"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+5)=$c(27)_"&f0S"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+6)=$c(27)_"&a1800H"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+7)=$c(27)_"*c1840h215v2p20G"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+8)=$c(27)_"&f1S"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+9)=$c(27)_"&a1800H"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+10)=$c(27)_"%1BPW0.2;PD;PR2600,0;PR0,-300;PR-2600,0;PR0,300;PU;PR"_len_",-210;"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+11)=$c(27)_"%1A"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+12)=$c(27)_"(s1p12v0s4b4099T"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+13)=$$UPPER^SSUTIL4(name)
 ..s ^TMP("REPORT",$j,page,"TEXT",x+14)=$c(27)_"(s0p12h0s0b4099T"
 ..s ^TMP("REPORT",$j,page,"TEXT",x+15)="!"
 ..s PageLine=PageLine+5
 q
 ; print header
Header(page,par1,par2) n (page,par1,par2,VISIT,DOC,HOSP,REPID,CopyToDoctor)
 s RepPageType=$g(^TMP("REPORT",$j,page,"PageType")),BlnCopyTo="N"
 d QDR
 s (copyto,copyfrom,specimen)="",epis=$p(VISIT(2),$c(1))
 ; find copy-to only for DR's copies
 i $d(DOC),$p(VISIT(15),$c(1))=$p(DOC(2),$c(1)) d
 .i $$open^LVBVISDC(epis)
 .f  q:$$fetch^LVBVISDC(epis)  s copyto=copyto_$s($l(copyto):", ",1:"")_$p(PLIST(4),$c(1))
 .i $$close^LVBVISDC()
 ; find copy-from
 i $d(DOC),$p(VISIT(15),$c(1))'=$p(DOC(2),$c(1)) d
 .s BlnCopyTo="Y"
 .i '$$select^LVBCTDR($p(VISIT(15),$c(1)),"Y") s copyfrom=$$NameFormat^LVBCOM03("DR",PLIST(26),PLIST(4),PLIST(3))
 i $d(HOSP),$p(VISIT(22),$c(1))'=$p(HOSP(2),$c(1)) d
 .s BlnCopyTo="Y"
 .i '$$select^LVBCTDR($p(VISIT(15),$c(1)),"Y") s copyfrom=$$NameFormat^LVBCOM03("DR",PLIST(26),PLIST(4),PLIST(3))
 ; find specimens
 i $$open^LVBVISSP(epis)
 f  q:$$fetch^LVBVISSP(epis)  s specimen=specimen_$s($l(specimen):", ",1:"")_$p(PLIST(2),$c(1))
 i $$close^LVBVISSP()
 i $l(specimen)>20 f j=1:1 i $l($p(specimen,",",1,j))>20 s specimen=$p(specimen,",",1,j-1) q
 s coltime="" i $l(VISIT(13)) s coltime=$e(VISIT(13)\3600+100,2,3)_":"_$e(VISIT(13)\60#60+100,2,3)
 s coldate="" i $l(VISIT(12)) s coldate=$$extdate2^SSUTIL4(VISIT(12))
 s recdate="" i $l(VISIT(61)) s recdate=$$extdate2^SSUTIL4(VISIT(61))
 s reptime=$$exttime^SSUTIL4($p($h,",",2)),repdate=$$extdate2^SSUTIL4(+$h)
 ; format Doctor's address
 i $d(DOC) d Address(DOC(9),DOC(10),DOC(11),DOC(12),DOC(13),.dAddress,1)
 i $d(HOSP) d Address(HOSP(4),HOSP(5),HOSP(6),HOSP(7),HOSP(8),.hAddress,1)
 ; format Patient's address
 d Address(VISIT(32),VISIT(33),VISIT(34),VISIT(35),VISIT(36),.pAddress)
 i $g(pAddress(3))="" d
 .f j=43,44 s phone=VISIT(j) q:$l(phone)
 .i $l(phone) f j=1:1:3 i $g(pAddress(j))="" s pAddress(j)="Ph: "_phone q
 s dob="Unknown" i $l(VISIT(6)) s dob=$$extdate2^SSUTIL4(VISIT(6))
 s sex="Unknown" i $l(VISIT(5)) s sex=$p(VISIT(5),$c(1),2)
 ; patient details - A4 format
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p12v0s3b4101T")
 d ADD^PRTREP00(REPID,"PRT","~BOLD")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h950V"_$$NameFormat^LVBCOM03("PT","",VISIT(4),VISIT(3)))
 d ADD^PRTREP00(REPID,"PRT","~NORMAL")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p10v0s0b4101T")
 f j=1:1:3 i $l(pAddress(j)) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h"_(j*90+1010)_"V"_pAddress(j))
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p9v0s0b4101T")
 d ADD^PRTREP00(REPID,"PRT","~BOLD")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h1450V"_$p(VISIT(2),$c(1)))
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h1550V"_coldate)
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h1650V"_recdate)
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a3650h1750V"_$p(VISIT(16),$c(1)))
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a4650h1550V"_sex)
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a4650h1650V"_dob)
 d ADD^PRTREP00(REPID,"PRT","~NORMAL")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p12v0s3b4101T")
 i $d(DOC) d
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a700h1180V"_$$NameFormat^LVBCOM03("DR",DOC(26),DOC(4),DOC(3)))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p9v0s3b4101T")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a300h1180V"_$p(DOC(16),$c(1)))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p8v0s0b4101T")
 .f j=1:1:3 i $l(dAddress(j)) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a700h"_(11+$s(j=3:4,1:j))_"80V"_dAddress(j))
 i $d(HOSP) d
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a700h1180V"_HOSP(3))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p8v0s0b4101T")
 .f j=1:1:3 i $l(hAddress(j)) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a700h"_(11+$s(j=3:4,1:j))_"80V"_hAddress(j))
 i $l(copyto) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a300h1800VCopies to : "_copyto)
 i $l(copyfrom) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a300h1800VCopies from : "_copyfrom)
 ; clinical history
 i $o(^TMP("REPORT",$j,page),-1)="" d
 .i '$l(VISIT(53)) s VISIT(53)="Not provided"
 .s VISIT(53)=$tr(VISIT(53),"|"," "),Part2=""
 .i $l(VISIT(53))<81 s Part1=VISIT(53)
 .e  d  
 ..f j=1:1 s Part1=$p(VISIT(53)," ",1,j+1) i $l(Part1)>80 q
 ..s Part1=$p(VISIT(53)," ",1,j),Part2=$p(VISIT(53)," ",j+1,999)  
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s0p13h0s1b4148T")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a300h2000VCLINICAL NOTES : "_Part1)
 .i $l($tr(Part2," ")) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a300h2100V                 "_Part2)
 ; find if report is interim
 i RepPageType'="A00" d
 .i VISIT(29)'="F" d
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a50h7570V")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p7v0s3b4101T")
 ..d ADD^PRTREP00(REPID,"PRT",$$TTF(epis))
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a2350h7440V")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p9v0s0b4101T")
 ..d ADD^PRTREP00(REPID,"PRT","~BOLD")
 ..d ADD^PRTREP00(REPID,"PRT","*** INTERIM REPORT ***")
 ..d ADD^PRTREP00(REPID,"PRT","~NORMAL")
 .i VISIT(29)="F" d
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a1000h7440V")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p9v0s0b4101T")
 ..d ADD^PRTREP00(REPID,"PRT","~BOLD")
 ..d ADD^PRTREP00(REPID,"PRT","FINAL REPORT. Many thanks for referring this patient.")
 ..d ADD^PRTREP00(REPID,"PRT","~NORMAL")
 i page=1 s ^TMP("REPORT",$j)=0
 i ^TMP("REPORT",$j)=0,RepPageType'="A00" d BOX s ^TMP("REPORT",$j)=1
 ; list of test sets
 i RepPageType'="A00" d
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a5000h7400V")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p9v0s0b4101T")
 .d ADD^PRTREP00(REPID,"PRT","Page "_page_" / "_$o(^TMP("REPORT",$j,""),-1))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s1p7v0s0b4101T")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a250h7700VTest(s) Requested :")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a250h7830VRequested By :")
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a4500h7830VReport Date :")
 .i $l(VISIT(68)) d
 ..f  q:$l(VISIT(68))<105  s VISIT(68)=$p(VISIT(68),",",1,$l(VISIT(68),",")-1)
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a850h7700V"_VISIT(68))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a700h7830V"_$p(VISIT(15),$c(1),2))
 .d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a4900h7830V"_repdate_" "_reptime)
 i RepPageType="A00" d
 .s (xx,curRID)="" f  s curRID=$o(^TMP("REPORT",$j,page,"TEST",curRID)) q:curRID=""  d  q:xx
 ..f j=1:1:3 s @("x"_j)=$p(curRID,"||",j)
 ..i $l(x1),$l(x2),$l(x3),$p($g(^TEPI(x1,1,x2,x3,"DATA","G360")),"\")="NEG" s xx=1
 .i xx d
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s0p14h0s0b4099T")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a400h6200VDear "_$$NameFormat^LVBCOM03("PT","Ms",VISIT(4),VISIT(3))_",")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a400h6400VYour Pap smear was received from "_$p(VISIT(15),$c(1),2)_" on the "_$$extdate2^SSUTIL4(VISIT(61))_" for laboratory testing.")
 ..d ADD^PRTREP00(REPID,"PRT","~BOLD")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a400h6600VThe result was Normal.")
 ..d ADD^PRTREP00(REPID,"PRT","~NORMAL")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a400h6750VYour next pap smear is due in ________________________")
 ..d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a800h7000V"_$$NameFormat^LVBCOM03("PT","Ms",VISIT(4),VISIT(3))_",")
 ..f j=1:1:3 i $l(pAddress(j)) d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a800h"_(j*100+7000)_"V"_pAddress(j))
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"(s0p12h0s0b4099T")
 d ADD^PRTREP00(REPID,"PRT",$c(27)_"&a0h2100V")
 d ADD^PRTREP00(REPID,"PRT","!")
 q
 ; tests to follow
TTF(epis) n (epis) s epis=$g(epis),result=""
 s ts="" f  s ts=$o(^TEPI(epis,1,ts)) q:ts=""  d
 . ; do not look at empty tests
 .i '$d(^TTAB("TS",ts,0)) q
 . ; do not look at non printable tests
 .s (ok,x)="" f  s x=$o(^TTAB("TS",ts,0,x)) q:x=""  i $p(^(x),"\",8)'="",$p(^(x),"\",13)="Y" s ok=1 q
 .i ok s cnt="" f  s cnt=$o(^TEPI(epis,1,ts,cnt)) q:cnt=""  d
 ..s rowid=epis_"||"_ts_"||"_cnt,status=""
 ..s status=$$seldata^LVBVISTS(rowid,31),test=$$seldata^LVBCTTS($$seldata^LVBVISTS(rowid,3),4)
 ..i $p(status,$c(1))'="Y" s result=result_$s($l(result):" ",1:"")_test
 i $l(result) s result="Tests pending : "_result
 q result
dt(date,time) n (date,time) s date=$g(date),time=$g(time),result=""
 s result=$e(time\3600+100,2,3)_":"_$e(time\60#60+100,2,3)_" "_$$extdate2^SSUTIL4(date)
 q result
path(dep) n (dep) s dep=$g(dep),result=""
 i $l(dep),'$$select^LVBCTDEP(dep) s result=$p(PLIST(10),$c(1),2)
 q result
 ; print footer
Footer(page,par1,par2) 
 q
 ;
QDR s QDR="MLA"
 d ADD^PRTREP00(REPID,"PRT",^SS("QDR",QDR,1))
 i page=1 d
 .d ADD^PRTREP00(REPID,"PRT"," !R!JOBT;EXIT;")
 i (page=1),($o(^TMP("REPORT",$j,page))'="") d
 .d ADD^PRTREP00(REPID,"PRT"," !R!STPCM;STPL2;JOBS0,1,0,0;EXIT;")
 d
 .i RepPageType="A00" d ADD^PRTREP00(REPID,"PRT"," !R! PSRC 1; EXIT;") q
 .i VISIT(29)="F" d ADD^PRTREP00(REPID,"PRT"," !R! PSRC 3; EXIT;") q
 .d ADD^PRTREP00(REPID,"PRT"," !R! PSRC 2; EXIT;")
 s a=1 f  s a=$o(^SS("QDR",QDR,a)) q:a=""  d ADD^PRTREP00(REPID,"PRT",^(a))
 q
Address(x1,x2,x3,x4,x5,Address,dd) n (x1,x2,x3,x4,x5,Address,dd) k Address s cnt=0 f j=1:1:3 s Address(j)=""
 i $l(x1) s cnt=cnt+1,Address(cnt)=x1
 i $l(x2) s cnt=cnt+1,Address(cnt)=x2
 s cnt=cnt+1 i $g(dd) s cnt=3
 i $l(x3) s Address(cnt)=Address(cnt)_$s($l(Address(cnt)):",",1:"")_x3
 i $l(x4) s Address(cnt)=Address(cnt)_$s($l(Address(cnt)):",",1:"")_x4
 i $l(x5) d
 .i '$g(dd),cnt>1,'$l(Address(cnt)) s cnt=cnt-1
 .s Address(cnt)=Address(cnt)_$s($l(Address(cnt)):",",1:"")_x5
 q
 ; extra fields
 ; Extra fields : 1 - Interim/Final
 ;                2 - TTF
 ;                3 - Referred by/Copy to
 ;                4 - Courier code
 ;                5 - Doctor name
 ;                6 - Doctor address line 1
 ;                7 - Doctor address line 2
 ;                8 - Doctor address Suburb
 ;                9 - Doctor address State & PostCode
ExtraFields(vtsRID,episRID) n (episRID,vtsRID,DOC,EPVIS,PLIST) s vtsRID=$g(vtsRID),epis=$p(vtsRID,"||") k PLIST
 i epis="" s epis=$g(episRID)
 s xx=$$seldata^LVBEPVIS(epis,29)
 s PLIST(1)="EXTRA_1"_$c(1)_"**** "_$s(xx="F":"FINAL",1:"INTERIM")_" REPORT. Please File ****"
 s PLIST(2)=$$TTF(epis) i $l(PLIST(2)) s PLIST(2)="EXTRA_2"_$c(1)_PLIST(2)_" : To Follow"
 i $p($g(DOC(2)),$c(1))=$p($g(EPVIS(15)),$c(1)) s PLIST(3)="EXTRA_3"_$c(1)_"Copy to : "_$g(^TMP("LVBLTPT",$j,2,"PAT_COPYTO"))
 i $p($g(DOC(2)),$c(1))'=$p($g(EPVIS(15)),$c(1)) s PLIST(3)="EXTRA_3"_$c(1)_"Requested by : "_$p($g(EPVIS(15)),$c(1),2)
 i $p($g(DOC(16)),$c(1))'="" s PLIST(4)="EXTRA_4"_$c(1)_$p(DOC(16),$c(1))
 i $d(DOC),$p(EPVIS(15),$c(1))'=$p(DOC(2),$c(1)),$p(DOC(16),$c(1))="P" d
 .s PLIST(5)="EXTRA_5"_$c(1)_$$NameFormat^LVBCOM03("DR",DOC(26),DOC(4),DOC(3))
 .s PLIST(6)="EXTRA_6"_$c(1)_DOC(9)
 .s PLIST(7)="EXTRA_7"_$c(1)_DOC(10)
 .s PLIST(8)="EXTRA_8"_$c(1)_DOC(11)
 .s PLIST(9)="EXTRA_9"_$c(1)_DOC(12)_" "_DOC(13)
 s PLIST=$o(PLIST(""),-1)
 q
]]></Routine>
</Export>
