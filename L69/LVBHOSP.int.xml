<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="LVBHOSP" type="INT" languagemode="0" generated="1"><![CDATA[
LVBHOSP ; IG 29/4/98 ; MVB Control code access for HOS_HospitalPatients
 ;
 ; supported calls:
 ;
 ; $$select^LVBHOSP(ROWID)
 ; $$selorder^LVBHOSP(ROWID)
 ; $$open^LVBHOSP(par,gname,sname,dob,sex,debtor,param,p7,p8,p9)
 ; $$fetch^LVBHOSP(par,gname,sname,dob,sex,debtor,param,p7,p8,p9)
 ; $$fetchbuffer^LVBHOSP(par,gname,sname,dob,sex,debtor,param,p7,p8,p9)
 ; $$fetchall^LVBHOSP(par,gname,sname,dob,sex,debtor,param,p7,p8,p9)
 ; $$close^LVBHOSP()
 ; $$insert^LVBHOSP(par)
 ; $$update^LVBHOSP(ROWID)
 ; $$delete^LVBHOSP(ROWID)
 ;
  ;---&SQL(DECLARE HOSP0 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE ((HOSP_ParRef = :par) OR (:par IS NULL))
   ;---         ORDER BY HOSP_TransDate)
   ;--- ** SQL PUBLIC Variables: SQLCODE, par
  ;---&SQL(DECLARE HOSP1 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE ((HOSP_ParRef = :par) OR (:par IS NULL))
   ;---         AND ((%ALPHAUP(HOSP_Surname) %STARTSWITH :sname))
   ;---         AND ((%ALPHAUP(HOSP_GivenName) %STARTSWITH :gname))
   ;---         AND ((HOSP_DOB = :dob) OR (:dob IS NULL))
   ;---         AND ((HOSP_Sex_DR = :sex) OR (:sex IS NULL))
   ;---         ORDER BY HOSP_DebtorNumber,HOSP_AdmissionDate DESC)
   ;--- ** SQL PUBLIC Variables: SQLCODE, dob, gname, par, sex, sname
  ;---&SQL(DECLARE HOSP2 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE ((HOSP_ParRef = :par) OR (:par IS NULL))
   ;---         AND HOSP_DebtorNumber = :debtor
   ;---         ORDER BY HOSP_AdmissionDate DESC)
   ;--- ** SQL PUBLIC Variables: SQLCODE, debtor, par
 ;
 ; Insert the data
insert(par) d pre("N") K PLIST(1) s PLIST(0)=$g(par) 
  ;---&SQL(insert INTO HOS_HospitalPatients VALUES :PLIST())
   ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 Do %0Go
 I 'SQLCODE Q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ;
 ; Update the data
update(ROWID) D pre("Y")
  ;---&SQL(UPDATE HOS_HospitalPatients VALUES :PLIST() WHERE HOSP_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %0Io
 I 'SQLCODE Q $$select(%ROWID)
 q SQLCODE_$s('SQLCODE:"",SQLCODE'=100:" "_$g(%msg)_" "_$g(%mdiag(1)),1:"")
 ;
 ; Delete the data
delete(ROWID) n (ROWID)
  ;---&SQL(DELETE FROM HOS_HospitalPatients WHERE HOSP_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: ROWID, SQLCODE
 Do %0Ko
 Q SQLCODE
delall(ROWID) n (ROWID)
  ;---&SQL(DELETE FROM HOS_HospitalPatients WHERE HOSP_ParRef=:ROWID)
   ;--- ** SQL PUBLIC Variables: ROWID, SQLCODE
 Do %0Mo
 Q SQLCODE
 ;
 ; Open the cursor
open(par,gname,sname,dob,sex,debtor,param,p7,p8,p9) 
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),debtor=$g(debtor),param=$g(param)
  ;---i $l(debtor) &SQL(OPEN HOSP2) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i $l(debtor) Do %HOSP20o q 0
  ;---i $l(gname)!$l(sname)!$l(dob)!$l(sex) &SQL(OPEN HOSP1) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i $l(gname)!$l(sname)!$l(dob)!$l(sex) Do %HOSP10o q 0
  ;---i '($l(gname)!$l(sname)!$l(dob)!$l(sex)) &SQL(OPEN HOSP0) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i '($l(gname)!$l(sname)!$l(dob)!$l(sex)) Do %HOSP00o q 0
 q 0
 ;
 ; Fetch the data
fetch(par,gname,sname,dob,sex,debtor,param,p7,p8,p9) K PLIST 
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),debtor=$g(debtor),param=$g(param)
 d
 . ;---i $l(debtor) &SQL(FETCH HOSP2 INTO :PLIST()) q
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i $l(debtor) Do %0Ro q
 . ;---i $l(gname)!$l(sname)!$l(dob)!$l(sex) &SQL(FETCH HOSP1 INTO :PLIST()) q
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i $l(gname)!$l(sname)!$l(dob)!$l(sex) Do %0So q
 . ;---i '($l(gname)!$l(sname)!$l(dob)!$l(sex)) &SQL(FETCH HOSP0 INTO :PLIST()) q
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i '($l(gname)!$l(sname)!$l(dob)!$l(sex)) Do %0To q
 s PLIST=$o(PLIST(""),-1) 
 i 'SQLCODE,$$val(param,.PLIST) g fetch+1
 i 'SQLCODE d adjust 
 q SQLCODE 
 ; Fetch all data
fetchbuffer(par,gname,sname,dob,sex,debtor,param,p7,p8,p9) k ^TMP($zn,$j)
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),debtor=$g(debtor),param=$g(param)
 s max=$s($g(PLIST(1)):PLIST(1),1:100) i max>100 s max=100
 f xxx=1:1:max s SQLCODE=$$fetch(par,gname,sname,dob,sex,debtor,param) q:SQLCODE  d
 .s cnt=$o(^TMP($zn,$j,""),-1)+1 f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 k PLIST m PLIST=^TMP($zn,$j) k ^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 q SQLCODE
fetchall(par,gname,sname,dob,sex,debtor,param,p7,p8,p9) N (par,gname,sname,dob,sex,PLIST) K ^TMP($zn,$j)
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),debtor=$g(debtor),param=$g(param)
 i $$open(par,gname,sname,dob,sex,debtor,param)
 f cnt=1:1 Q:$$fetch(par,gname,sname,dob,sex,debtor,param)  s ^TMP($zn,$j,cnt)="" f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 i $$close()
 k PLIST M PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ;
 ; Close the cursor 
close()  ;---&SQL(CLOSE HOSP0)
  ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP00c
  ;---&SQL(CLOSE HOSP1) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP10c 
  ;---&SQL(CLOSE HOSP2) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP20c 
 q 0
 ;
 ; select data by code
select(ROWID) K PLIST
  ;---&SQL(SELECT * INTO :PLIST() FROM HOS_HospitalPatients WHERE HOSP_RowID=:ROWID)
   ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 Do %0Xo
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE D adjust
 q SQLCODE
 ;
selorder(ROWID) n (ROWID,PLIST) s ROWID=$g(ROWID),SQLCODE=100 K PLIST
 ; check client specific routine
 s %routine=$p($g(^TTAB("REPORT-GENERIC","DEB")),"\",1)
 i $l(%routine) s LineRoutine="selorder^"_%routine i $l($t(@LineRoutine)) x "d selorder^"_%routine q SQLCODE
 i $l(ROWID) s cnt=0,hos="" f  s hos=$o(^THOSi("VIS",ROWID,hos)) q:hos=""  d  i cnt>1 q
 .s ur="" f  s ur=$o(^THOSi("VIS",ROWID,hos,ur)) q:ur=""  s cnt=cnt+1 i cnt>1 s SQLCODE=61 q
 . ;---i cnt=1 &SQL(SELECT * INTO :PLIST() FROM HOS_HospitalPatients WHERE HOSP_Visit=:ROWID)
  . ;--- ** SQL PUBLIC Variables: PLIST, ROWID, SQLCODE
 .i cnt=1 Do %0Zo
 s PLIST=$o(PLIST(""),-1)
 i 'SQLCODE D adjust
 q SQLCODE
 ;
 ; Pre-filing adjustments
pre(xUpdate) d PreSQL^SSUTIL4("","")
 S PLIST(3)=$$ALPHAUP^SSUTIL4(PLIST(3))
 S PLIST(2)=$$UPPER^SSUTIL4(PLIST(2))
 q
 ;
 ; Post-filing adjustments
adjust N plist,I,J,SQLCODE,X d PostSQL^SSUTIL4("")
 ;
 F IX=17,18,20 I $G(PLIST(IX))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTDR(plist(IX),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_$$NameFormat^LVBCOM03("DR",PLIST(26),PLIST(4),PLIST(3),PLIST(49),PLIST(50),PLIST(51))
 .K PLIST M PLIST=plist S PLIST(IX)=X K plist
 I $G(PLIST(6))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTTL(plist(6),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(6)=X K plist
 I $G(PLIST(8))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTSP(plist(8),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(8)=X K plist
 I $G(PLIST(15))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTHOS(plist(15),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(15)=X K plist
 I $G(PLIST(25))'="" D
 .K plist M plist=PLIST K PLIST
 .S SQLCODE=$$select^LVBCTUR(plist(25),"Y")
 .S X="" I 'SQLCODE S X=PLIST(2)_$C(1)_PLIST(3)
 .K PLIST M PLIST=plist S PLIST(25)=X K plist
 ;
 Q
conv ;create index
 k ^THOSi
 s hos="" f  s hos=$o(^THOS(hos)) q:hos=""  d
 .k ^THOS(hos,"Date")
 .s ur="" f  s ur=$o(^THOS(hos,"PATIENT",ur)) q:ur=""  d
 ..s vis="" f  s vis=$o(^THOS(hos,"PATIENT",ur,vis)) q:vis=""  d
 ...s err=$$select(hos_"||"_ur_"||"_vis) q:err
 ...s err=$$update(hos_"||"_ur_"||"_vis)
 q
 ; param : 1-Surname
 ;         2-Given Name
 ;         3-Sex
 ;         4-DOB
 ;         5-MRN
 ;         6-Doctor
 ;         7-Doctor reference
 ;         8-Date From
 ;         9-Date To
 ;        10-Test Set
 ;        11-Hospital Location
 ;        12-Medicare No
 ;        13-VA No
 ;        14-Pensioner No
 ;        15-Last Only (Y/N)
 ;        16-Soundex   (Y/N)
 ;        17-Post Code
 ;        18-Patient Status
 ;        19-User Site
 ;        20-Episode
 ;        21-Worksheet Name
 ;        22-Worksheet No
 ;        23-Department
 ;        24-List of Episodes by $c(1)
 ;        25-Donor ID
 ;        26-DonorSearch (Y/N)
 ;        27-List of Hospital_Episodes by $c(1)
 ;        28-Search ALL names
 ;        29-Extra name 1
 ;        30-Extra name 2
 ;        31-Extra name 3
 ;        32-QC case
 ;        33-Study case
 ;        34-DB Accession number
 ;        35-Aerobic bottle
 ;        36-Anaerobic bottle
val(param,PLIST) n (param,PLIST) s param=$g(param),ok=""
 f j=1:1:$l(param,"\") s @("param"_j)=$p(param,"\",j)
 i 'ok,$l($g(param1)),$e($$ALPHAUP^SSUTIL4(PLIST(5)),1,$l(param1))'=$$ALPHAUP^SSUTIL4(param1) s ok=1
 i 'ok,$l($g(param2)),$e($$ALPHAUP^SSUTIL4(PLIST(4)),1,$l(param2))'=$$ALPHAUP^SSUTIL4(param2) s ok=2
 i 'ok,$l($g(param3)),PLIST(8)'=param3 s ok=3
 i 'ok,$l($g(param4)),PLIST(7)'=param4 s ok=4
 i 'ok,$l($g(param5)),PLIST(42)'=param5 s ok=5
 i 'ok,$l($g(param6)),PLIST(17)'=param6 s ok=6
 i 'ok,$l($g(param11)),PLIST(15)'=param11 s ok=11
 i 'ok,$l($g(param12)),PLIST(24)'=param12 s ok=12
 i 'ok,$l($g(param13)),PLIST(36)'=param13 s ok=13
 i 'ok,$l($g(param14)),PLIST(37)'=param14 s ok=14
 i 'ok,$l($g(param17)),$$ALPHAUP^SSUTIL4(PLIST(12))'=$$ALPHAUP^SSUTIL4(param17) s ok=17
 i 'ok,$l($g(param19)),PLIST(28)'=param19 s ok=19
 i 'ok,$l($g(param29)),$e($$ALPHAUP^SSUTIL4(PLIST(39)),1,$l(param29))'=$$ALPHAUP^SSUTIL4(param29) s ok=29
 i 'ok,$l($g(param30)),$e($$ALPHAUP^SSUTIL4(PLIST(40)),1,$l(param30))'=$$ALPHAUP^SSUTIL4(param30) s ok=30
 i 'ok,$l($g(param31)),$e($$ALPHAUP^SSUTIL4(PLIST(41)),1,$l(param31))'=$$ALPHAUP^SSUTIL4(param31) s ok=31
 q ok
%HOSP00o s $zt="%HOSP00E" s SQLCODE=$s($g(%HOSP00c):-101,1:0) q:SQLCODE'=0  s %HOSP00d(51)=0 s %HOSP00d(52)=0,%HOSP00d(53)=""
 s %HOSP00d(47)=$g(par),%HOSP00d(48)=$g(par)
 s %HOSP00t(1)=$i(^||%sql.temp,2) f %HOSP00d(54)=2:1:2 s %HOSP00t(%HOSP00d(54))=%HOSP00t(1)-%HOSP00d(54)+1
 s %HOSP00c=1 q
%HOSP00E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP00c,%HOSP00d,%HOSP00E,%HOSP00l,%HOSP00n,%HOSP00R,%HOSP00s,%HOSP00t,%HOSP00Z q
%0Afirst 
 f %HOSP00d(54)=1,2 k ^||%sql.temp(%HOSP00t(%HOSP00d(54)),0) s ^||%sql.temp(%HOSP00t(%HOSP00d(54)),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 f %HOSP00d(54)=1,2 i $sortbegin(^||%sql.temp(%HOSP00t(%HOSP00d(54)),0))
 ; asl MOD# 4
 d %0ABMod
 d %0ACMod
 i $sortend(^||%sql.temp(%HOSP00t(2),0))
 s %HOSP00s(27)=""
%0ADk1 s %HOSP00s(27)=$o(^||%sql.temp(%HOSP00t(2),0,%HOSP00s(27)))
 i %HOSP00s(27)="" g %0ADdun
 s %HOSP00d(27)=$s(%HOSP00s(27)=-1E14:"",1:%HOSP00s(27))
 s %HOSP00s(2)=""
%0ADk2 s %HOSP00s(2)=$o(^||%sql.temp(%HOSP00t(2),0,%HOSP00s(27),%HOSP00s(2)))
 i %HOSP00s(2)="" g %0ADk1
 s %HOSP00d(2)=$s(%HOSP00s(2)=-1E14:"",1:%HOSP00s(2))
 s %HOSP00d(50)=$p(%HOSP00d(2),"||"),%HOSP00d(3)=$p(%HOSP00d(2),"||",2),%HOSP00d(4)=$p(%HOSP00d(2),"||",3)
 i %HOSP00d(50)'="",%HOSP00d(3)'="",%HOSP00d(4)'="",$d(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 e  g %0ADk2
 s %HOSP00d(74)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 s %HOSP00d(5)=$p(%HOSP00d(74),"\",1) s %HOSP00d(6)=$p(%HOSP00d(74),"\",2) s %HOSP00d(7)=$p(%HOSP00d(74),"\",3) s %HOSP00d(8)=$p(%HOSP00d(74),"\",8) s %HOSP00d(9)=$p(%HOSP00d(74),"\",4) s %HOSP00d(15)=$p(%HOSP00d(74),"\",13) s %HOSP00d(16)=$p(%HOSP00d(74),"\",9) s %HOSP00d(17)=$p(%HOSP00d(74),"\",12) s %HOSP00d(18)=$p(%HOSP00d(74),"\",5) s %HOSP00d(19)=$p(%HOSP00d(74),"\",7) s %HOSP00d(20)=$p(%HOSP00d(74),"\",14) s %HOSP00d(21)=$p(%HOSP00d(74),"\",6) s %HOSP00d(22)=$p(%HOSP00d(74),"\",10) s %HOSP00d(23)=$p(%HOSP00d(74),"\",11) s %HOSP00d(25)=$p(%HOSP00d(74),"\",15) s %HOSP00d(28)=$p(%HOSP00d(74),"\",17) s %HOSP00d(29)=$p(%HOSP00d(74),"\",18) s %HOSP00d(33)=$p(%HOSP00d(74),"\",22) s %HOSP00d(34)=$p(%HOSP00d(74),"\",19) s %HOSP00d(35)=$p(%HOSP00d(74),"\",20) s %HOSP00d(36)=$p(%HOSP00d(74),"\",21) s %HOSP00d(37)=$p(%HOSP00d(74),"\",23) s %HOSP00d(38)=$p(%HOSP00d(74),"\",24) s %HOSP00d(39)=$p(%HOSP00d(74),"\",25) s %HOSP00d(40)=$p(%HOSP00d(74),"\",26) s %HOSP00d(41)=$p(%HOSP00d(74),"\",27) s %HOSP00d(42)=$p(%HOSP00d(74),"\",28) s %HOSP00d(43)=$p(%HOSP00d(74),"\",29) s %HOSP00d(44)=$p(%HOSP00d(74),"\",30) s %HOSP00d(45)=$p(%HOSP00d(74),"\",31) s %HOSP00d(46)=$p(%HOSP00d(74),"\",32)
 s %HOSP00d(74)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"ADDR"))
 s %HOSP00d(10)=$p(%HOSP00d(74),"\",1) s %HOSP00d(11)=$p(%HOSP00d(74),"\",2) s %HOSP00d(12)=$p(%HOSP00d(74),"\",3) s %HOSP00d(13)=$p(%HOSP00d(74),"\",4) s %HOSP00d(14)=$p(%HOSP00d(74),"\",5) s %HOSP00d(32)=$p(%HOSP00d(74),"\",6)
 s %HOSP00d(24)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"EXTRA"))
 s %HOSP00d(1)=$p(%HOSP00d(2),"||")
 s %HOSP00d(26)=$g(%HOSP00d(1)) s %HOSP00d(30)=$$CT029^at316($g(%HOSP00d(2))) s %HOSP00d(31)=$$CT030^at316($g(%HOSP00d(2)))
 g:$zu(115,2)=0 %0ADuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP00d(2),"||",1),"PATIENT",$p(%HOSP00d(2),"||",2),$p(%HOSP00d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP00d(52)=1,%HOSP00d(53)=$name(^THOS($p(%HOSP00d(2),"||",1),"PATIENT",$p(%HOSP00d(2),"||",2),$p(%HOSP00d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP00d(2) ztrap "LOCK"  }
 ; asl MOD# 5
 s %HOSP00d(50)=$p(%HOSP00d(2),"||"),%HOSP00d(3)=$p(%HOSP00d(2),"||",2),%HOSP00d(4)=$p(%HOSP00d(2),"||",3)
 i %HOSP00d(50)'="",%HOSP00d(3)'="",%HOSP00d(4)'="",$d(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 e  g %0AEdun
 s %HOSP00d(81)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 s %HOSP00d(5)=$p(%HOSP00d(81),"\",1) s %HOSP00d(6)=$p(%HOSP00d(81),"\",2) s %HOSP00d(7)=$p(%HOSP00d(81),"\",3) s %HOSP00d(8)=$p(%HOSP00d(81),"\",8) s %HOSP00d(9)=$p(%HOSP00d(81),"\",4) s %HOSP00d(15)=$p(%HOSP00d(81),"\",13) s %HOSP00d(16)=$p(%HOSP00d(81),"\",9) s %HOSP00d(17)=$p(%HOSP00d(81),"\",12) s %HOSP00d(18)=$p(%HOSP00d(81),"\",5) s %HOSP00d(19)=$p(%HOSP00d(81),"\",7) s %HOSP00d(20)=$p(%HOSP00d(81),"\",14) s %HOSP00d(21)=$p(%HOSP00d(81),"\",6) s %HOSP00d(22)=$p(%HOSP00d(81),"\",10) s %HOSP00d(23)=$p(%HOSP00d(81),"\",11) s %HOSP00d(25)=$p(%HOSP00d(81),"\",15) s %HOSP00d(27)=$p(%HOSP00d(81),"\",16) s %HOSP00d(28)=$p(%HOSP00d(81),"\",17) s %HOSP00d(29)=$p(%HOSP00d(81),"\",18) s %HOSP00d(33)=$p(%HOSP00d(81),"\",22) s %HOSP00d(34)=$p(%HOSP00d(81),"\",19) s %HOSP00d(35)=$p(%HOSP00d(81),"\",20) s %HOSP00d(36)=$p(%HOSP00d(81),"\",21) s %HOSP00d(37)=$p(%HOSP00d(81),"\",23) s %HOSP00d(38)=$p(%HOSP00d(81),"\",24) s %HOSP00d(39)=$p(%HOSP00d(81),"\",25) s %HOSP00d(40)=$p(%HOSP00d(81),"\",26) s %HOSP00d(41)=$p(%HOSP00d(81),"\",27) s %HOSP00d(42)=$p(%HOSP00d(81),"\",28) s %HOSP00d(43)=$p(%HOSP00d(81),"\",29) s %HOSP00d(44)=$p(%HOSP00d(81),"\",30) s %HOSP00d(45)=$p(%HOSP00d(81),"\",31) s %HOSP00d(46)=$p(%HOSP00d(81),"\",32)
 s %HOSP00d(81)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"ADDR"))
 s %HOSP00d(10)=$p(%HOSP00d(81),"\",1) s %HOSP00d(11)=$p(%HOSP00d(81),"\",2) s %HOSP00d(12)=$p(%HOSP00d(81),"\",3) s %HOSP00d(13)=$p(%HOSP00d(81),"\",4) s %HOSP00d(14)=$p(%HOSP00d(81),"\",5) s %HOSP00d(32)=$p(%HOSP00d(81),"\",6)
 s %HOSP00d(24)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"EXTRA"))
 s %HOSP00d(1)=$p(%HOSP00d(2),"||")
 s %HOSP00d(26)=$g(%HOSP00d(1)) s %HOSP00d(30)=$$CT029^at316($g(%HOSP00d(2))) s %HOSP00d(31)=$$CT030^at316($g(%HOSP00d(2)))
%0ADuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP00d(51)=%HOSP00d(51)+1,%ROWCOUNT=%HOSP00d(51),%ROWID=%HOSP00d(2),%HOSP00c=10 q
%HOSP00f i '$g(%HOSP00c) { s SQLCODE=-102 q  } i %HOSP00c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Aerr" i $d(%0CacheRowLimit)#2,$g(%HOSP00d(51))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP00d(51),%HOSP00c=100 q  } g %0Afirst:%HOSP00c=1
%0AEdun i $zu(115,2)=1,$g(%HOSP00d(52))=1 { l -@%HOSP00d(53) s %HOSP00d(52)=0 }
 g %0ADk2
%0ADdun 
%0AAdun 
 s %ROWCOUNT=%HOSP00d(51),SQLCODE=100,%HOSP00c=100 q
%HOSP00c i '$g(%HOSP00c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP00d(51)),1:0) f %HOSP00d(54)=1,2 { i $sortend(^||%sql.temp(%HOSP00t(%HOSP00d(54)),0),0) } f %HOSP00d(54)=1:1:2 { k ^||%sql.temp(%HOSP00t(%HOSP00d(54))) }
 i $zu(115,2)=1,$g(%HOSP00d(52))=1 { l -@%HOSP00d(53) } k %HOSP00c,%HOSP00d,%HOSP00E,%HOSP00l,%HOSP00n,%HOSP00R,%HOSP00s,%HOSP00t,%HOSP00Z s SQLCODE=0 q
%0Aerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP00c=100
 f %HOSP00d(54)=1,2 i $sortend(^||%sql.temp(%HOSP00t(%HOSP00d(54)),0),0)
 q
%0ABMod ; asl MOD# 2
 s %HOSP00d(4)=""
%0ABk1 s %HOSP00d(4)=$o(^THOSi("VIS",%HOSP00d(4)))
 i %HOSP00d(4)="" g %0ABdun
 s %HOSP00d(1)=""
%0ABk2 s %HOSP00d(1)=$o(^THOSi("VIS",%HOSP00d(4),%HOSP00d(1)))
 i %HOSP00d(1)="" g %0ABk1
 i '((%HOSP00d(1)=%HOSP00d(47))||(%HOSP00d(48)="")) g %0ABk2
 s %HOSP00d(3)=""
%0ABk3 s %HOSP00d(3)=$o(^THOSi("VIS",%HOSP00d(4),%HOSP00d(1),%HOSP00d(3)))
 i %HOSP00d(3)="" g %0ABk2
 s %HOSP00d(2)=(%HOSP00d(1))_"||"_(%HOSP00d(3))_"||"_(%HOSP00d(4))
 s %HOSP00s(2)=$s(%HOSP00d(2)'="":%HOSP00d(2),1:-1E14),^||%sql.temp(%HOSP00t(1),0,%HOSP00s(2))=""
 g %0ABk3
%0ABdun 
 q
%0ACMod ; asl MOD# 3
 i $sortend(^||%sql.temp(%HOSP00t(1),0))
 s %HOSP00s(2)=""
%0ACk1 s %HOSP00s(2)=$o(^||%sql.temp(%HOSP00t(1),0,%HOSP00s(2)))
 i %HOSP00s(2)="" g %0ACdun
 s %HOSP00d(2)=$s(%HOSP00s(2)=-1E14:"",1:%HOSP00s(2))
 s %HOSP00d(50)=$p(%HOSP00d(2),"||"),%HOSP00d(3)=$p(%HOSP00d(2),"||",2),%HOSP00d(4)=$p(%HOSP00d(2),"||",3)
 i %HOSP00d(50)'="",%HOSP00d(3)'="",%HOSP00d(4)'="",$d(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 e  g %0ACk1
 s %HOSP00d(67)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4)))
 s %HOSP00d(5)=$p(%HOSP00d(67),"\",1) s %HOSP00d(6)=$p(%HOSP00d(67),"\",2) s %HOSP00d(7)=$p(%HOSP00d(67),"\",3) s %HOSP00d(8)=$p(%HOSP00d(67),"\",8) s %HOSP00d(9)=$p(%HOSP00d(67),"\",4) s %HOSP00d(15)=$p(%HOSP00d(67),"\",13) s %HOSP00d(16)=$p(%HOSP00d(67),"\",9) s %HOSP00d(17)=$p(%HOSP00d(67),"\",12) s %HOSP00d(18)=$p(%HOSP00d(67),"\",5) s %HOSP00d(19)=$p(%HOSP00d(67),"\",7) s %HOSP00d(20)=$p(%HOSP00d(67),"\",14) s %HOSP00d(21)=$p(%HOSP00d(67),"\",6) s %HOSP00d(22)=$p(%HOSP00d(67),"\",10) s %HOSP00d(23)=$p(%HOSP00d(67),"\",11) s %HOSP00d(25)=$p(%HOSP00d(67),"\",15) s %HOSP00d(27)=$p(%HOSP00d(67),"\",16) s %HOSP00d(28)=$p(%HOSP00d(67),"\",17) s %HOSP00d(29)=$p(%HOSP00d(67),"\",18) s %HOSP00d(33)=$p(%HOSP00d(67),"\",22) s %HOSP00d(34)=$p(%HOSP00d(67),"\",19) s %HOSP00d(35)=$p(%HOSP00d(67),"\",20) s %HOSP00d(36)=$p(%HOSP00d(67),"\",21) s %HOSP00d(37)=$p(%HOSP00d(67),"\",23) s %HOSP00d(38)=$p(%HOSP00d(67),"\",24) s %HOSP00d(39)=$p(%HOSP00d(67),"\",25) s %HOSP00d(40)=$p(%HOSP00d(67),"\",26) s %HOSP00d(41)=$p(%HOSP00d(67),"\",27) s %HOSP00d(42)=$p(%HOSP00d(67),"\",28) s %HOSP00d(43)=$p(%HOSP00d(67),"\",29) s %HOSP00d(44)=$p(%HOSP00d(67),"\",30) s %HOSP00d(45)=$p(%HOSP00d(67),"\",31) s %HOSP00d(46)=$p(%HOSP00d(67),"\",32)
 s %HOSP00d(67)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"ADDR"))
 s %HOSP00d(10)=$p(%HOSP00d(67),"\",1) s %HOSP00d(11)=$p(%HOSP00d(67),"\",2) s %HOSP00d(12)=$p(%HOSP00d(67),"\",3) s %HOSP00d(13)=$p(%HOSP00d(67),"\",4) s %HOSP00d(14)=$p(%HOSP00d(67),"\",5) s %HOSP00d(32)=$p(%HOSP00d(67),"\",6)
 s %HOSP00d(24)=$g(^THOS(%HOSP00d(50),"PATIENT",%HOSP00d(3),%HOSP00d(4),"EXTRA"))
 s %HOSP00d(1)=$p(%HOSP00d(2),"||")
 s %HOSP00d(26)=$g(%HOSP00d(1)) s %HOSP00d(30)=$$CT029^at316($g(%HOSP00d(2))) s %HOSP00d(31)=$$CT030^at316($g(%HOSP00d(2)))
 s %HOSP00s(27)=$s(%HOSP00d(27)'="":%HOSP00d(27),1:-1E14),%HOSP00s(2)=$s(%HOSP00d(2)'="":%HOSP00d(2),1:-1E14),^||%sql.temp(%HOSP00t(2),0,%HOSP00s(27),%HOSP00s(2))=""
 g %0ACk1
%0ACdun 
 q
%HOSP10o s $zt="%HOSP10E" s SQLCODE=$s($g(%HOSP10c):-101,1:0) q:SQLCODE'=0  s %HOSP10d(60)=0 s %HOSP10d(61)=0,%HOSP10d(62)=""
 s %HOSP10d(47)=$g(par),%HOSP10d(48)=$g(par),%HOSP10d(50)=$g(sname),%HOSP10d(52)=$g(gname),%HOSP10d(53)=$g(dob),%HOSP10d(54)=$g(dob),%HOSP10d(55)=$g(sex),%HOSP10d(56)=$g(sex)
 s %HOSP10t(1)=$i(^||%sql.temp,2) f %HOSP10d(63)=2:1:2 s %HOSP10t(%HOSP10d(63))=%HOSP10t(1)-%HOSP10d(63)+1
 s %HOSP10c=1 q
%HOSP10E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP10c,%HOSP10d,%HOSP10E,%HOSP10l,%HOSP10n,%HOSP10R,%HOSP10s,%HOSP10t,%HOSP10Z q
%0Cfirst s %HOSP10d(59)=""
 f %HOSP10d(63)=1,2 k ^||%sql.temp(%HOSP10t(%HOSP10d(63)),0) s ^||%sql.temp(%HOSP10t(%HOSP10d(63)),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 f %HOSP10d(63)=1,2 i $sortbegin(^||%sql.temp(%HOSP10t(%HOSP10d(63)),0))
 d %0CCMod
 ; asl MOD# 5
 i $sortend(^||%sql.temp(%HOSP10t(2),0))
 s %HOSP10s(3)=""
%0CEk1 s %HOSP10s(3)=$o(^||%sql.temp(%HOSP10t(2),0,%HOSP10s(3)))
 i %HOSP10s(3)="" g %0CEdun
 s %HOSP10d(3)=$s(%HOSP10s(3)=-1E14:"",1:%HOSP10s(3))
 s %HOSP10s(22)=""
%0CEk2 s %HOSP10s(22)=$zp(^||%sql.temp(%HOSP10t(2),0,%HOSP10s(3),%HOSP10s(22)))
 i %HOSP10s(22)="" g %0CEk1
 s %HOSP10d(22)=$s(%HOSP10s(22)=-1E14:"",1:%HOSP10s(22))
 s %HOSP10s(59)=""
%0CEk3 s %HOSP10s(59)=$o(^||%sql.temp(%HOSP10t(2),0,%HOSP10s(3),%HOSP10s(22),%HOSP10s(59)))
 i %HOSP10s(59)="" g %0CEk2
 s %HOSP10d(59)=$s(%HOSP10s(59)=-1E14:"",1:%HOSP10s(59))
 s %HOSP10d(85)=$g(^||%sql.temp(%HOSP10t(2),0,%HOSP10s(3),%HOSP10s(22),%HOSP10d(59)))
 s %HOSP10d(1)=$lg(%HOSP10d(85),25) s %HOSP10d(2)=$lg(%HOSP10d(85),30) s %HOSP10d(4)=$lg(%HOSP10d(85),38) s %HOSP10d(5)=$lg(%HOSP10d(85),18) s %HOSP10d(6)=$lg(%HOSP10d(85),34) s %HOSP10d(7)=$lg(%HOSP10d(85),35) s %HOSP10d(8)=$lg(%HOSP10d(85),9) s %HOSP10d(9)=$lg(%HOSP10d(85),32) s %HOSP10d(10)=$lg(%HOSP10d(85),1) s %HOSP10d(11)=$lg(%HOSP10d(85),2) s %HOSP10d(12)=$lg(%HOSP10d(85),3) s %HOSP10d(13)=$lg(%HOSP10d(85),5) s %HOSP10d(14)=$lg(%HOSP10d(85),28) s %HOSP10d(15)=$lg(%HOSP10d(85),8) s %HOSP10d(16)=$lg(%HOSP10d(85),23) s %HOSP10d(17)=$lg(%HOSP10d(85),7) s %HOSP10d(18)=$lg(%HOSP10d(85),12) s %HOSP10d(19)=$lg(%HOSP10d(85),11) s %HOSP10d(20)=$lg(%HOSP10d(85),31) s %HOSP10d(21)=$lg(%HOSP10d(85),10) s %HOSP10d(23)=$lg(%HOSP10d(85),6) s %HOSP10d(24)=$lg(%HOSP10d(85),14) s %HOSP10d(25)=$lg(%HOSP10d(85),41) s %HOSP10d(26)=$lg(%HOSP10d(85),19) s %HOSP10d(27)=$lg(%HOSP10d(85),36) s %HOSP10d(28)=$lg(%HOSP10d(85),37) s %HOSP10d(29)=$lg(%HOSP10d(85),26) s %HOSP10d(30)=$lg(%HOSP10d(85),21) s %HOSP10d(31)=$lg(%HOSP10d(85),22) s %HOSP10d(32)=$lg(%HOSP10d(85),4) s %HOSP10d(33)=$lg(%HOSP10d(85),29) s %HOSP10d(34)=$lg(%HOSP10d(85),13) s %HOSP10d(35)=$lg(%HOSP10d(85),33) s %HOSP10d(36)=$lg(%HOSP10d(85),24) s %HOSP10d(37)=$lg(%HOSP10d(85),44) s %HOSP10d(38)=$lg(%HOSP10d(85),43) s %HOSP10d(39)=$lg(%HOSP10d(85),27) s %HOSP10d(40)=$lg(%HOSP10d(85),15) s %HOSP10d(41)=$lg(%HOSP10d(85),16) s %HOSP10d(42)=$lg(%HOSP10d(85),17) s %HOSP10d(43)=$lg(%HOSP10d(85),20) s %HOSP10d(44)=$lg(%HOSP10d(85),42) s %HOSP10d(45)=$lg(%HOSP10d(85),40) s %HOSP10d(46)=$lg(%HOSP10d(85),39)
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP10d(60)=%HOSP10d(60)+1,%ROWCOUNT=%HOSP10d(60),%ROWID=%HOSP10d(2),%HOSP10c=10 q
%HOSP10f i '$g(%HOSP10c) { s SQLCODE=-102 q  } i %HOSP10c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Cerr" i $d(%0CacheRowLimit)#2,$g(%HOSP10d(60))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP10d(60),%HOSP10c=100 q  } g %0Cfirst:%HOSP10c=1
 g %0CEk3
%0CEdun 
%0CAdun 
 s %ROWCOUNT=%HOSP10d(60),SQLCODE=100,%HOSP10c=100 q
%HOSP10c i '$g(%HOSP10c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP10d(60)),1:0) f %HOSP10d(63)=1,2 { i $sortend(^||%sql.temp(%HOSP10t(%HOSP10d(63)),0),0) } f %HOSP10d(63)=1:1:2 { k ^||%sql.temp(%HOSP10t(%HOSP10d(63))) }
 i $zu(115,2)=1,$g(%HOSP10d(61))=1 { l -@%HOSP10d(62) } k %HOSP10c,%HOSP10d,%HOSP10E,%HOSP10l,%HOSP10n,%HOSP10R,%HOSP10s,%HOSP10t,%HOSP10Z s SQLCODE=0 q
%0Cerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP10c=100
 f %HOSP10d(63)=1,2 i $sortend(^||%sql.temp(%HOSP10t(%HOSP10d(63)),0),0)
 q
%0CBMod ; asl MOD# 2
 s %HOSP10d(4)=""
%0CBk1 s %HOSP10d(4)=$o(^THOSi("VIS",%HOSP10d(4)))
 i %HOSP10d(4)="" g %0CBdun
 s %HOSP10d(1)=""
%0CBk2 s %HOSP10d(1)=$o(^THOSi("VIS",%HOSP10d(4),%HOSP10d(1)))
 i %HOSP10d(1)="" g %0CBk1
 i '((%HOSP10d(1)=%HOSP10d(47))||(%HOSP10d(48)="")) g %0CBk2
 s %HOSP10d(3)=""
%0CBk3 s %HOSP10d(3)=$o(^THOSi("VIS",%HOSP10d(4),%HOSP10d(1),%HOSP10d(3)))
 i %HOSP10d(3)="" g %0CBk2
 s %HOSP10d(2)=(%HOSP10d(1))_"||"_(%HOSP10d(3))_"||"_(%HOSP10d(4))
 s %HOSP10s(2)=$s(%HOSP10d(2)'="":%HOSP10d(2),1:-1E14),^||%sql.temp(%HOSP10t(1),0,%HOSP10s(2))=""
 g %0CBk3
%0CBdun 
 q
%0CCMod ; asl MOD# 3
 d %0CBMod
 i $sortend(^||%sql.temp(%HOSP10t(1),0))
 s %HOSP10s(2)=""
%0CCk1 s %HOSP10s(2)=$o(^||%sql.temp(%HOSP10t(1),0,%HOSP10s(2)))
 i %HOSP10s(2)="" g %0CCdun
 s %HOSP10d(2)=$s(%HOSP10s(2)=-1E14:"",1:%HOSP10s(2))
 s %HOSP10d(58)=$p(%HOSP10d(2),"||"),%HOSP10d(3)=$p(%HOSP10d(2),"||",2),%HOSP10d(4)=$p(%HOSP10d(2),"||",3)
 i %HOSP10d(58)'="",%HOSP10d(3)'="",%HOSP10d(4)'="",$d(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4)))
 e  g %0CCk1
 s %HOSP10d(76)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4)))
 s %HOSP10d(8)=$p(%HOSP10d(76),"\",8)
 g:'(((%HOSP10d(8)'="")&&(%HOSP10d(8)=%HOSP10d(53)))||(%HOSP10d(54)="")) %0CCk1
 s %HOSP10d(9)=$p(%HOSP10d(76),"\",4)
 g:'(((%HOSP10d(9)'="")&&(%HOSP10d(9)=%HOSP10d(55)))||(%HOSP10d(56)="")) %0CCk1
 s %HOSP10d(5)=$p(%HOSP10d(76),"\",1) s %HOSP10d(6)=$p(%HOSP10d(76),"\",2) s %HOSP10d(7)=$p(%HOSP10d(76),"\",3) s %HOSP10d(15)=$p(%HOSP10d(76),"\",13) s %HOSP10d(16)=$p(%HOSP10d(76),"\",9) s %HOSP10d(17)=$p(%HOSP10d(76),"\",12) s %HOSP10d(18)=$p(%HOSP10d(76),"\",5) s %HOSP10d(19)=$p(%HOSP10d(76),"\",7) s %HOSP10d(20)=$p(%HOSP10d(76),"\",14) s %HOSP10d(21)=$p(%HOSP10d(76),"\",6) s %HOSP10d(22)=$p(%HOSP10d(76),"\",10) s %HOSP10d(23)=$p(%HOSP10d(76),"\",11) s %HOSP10d(25)=$p(%HOSP10d(76),"\",15) s %HOSP10d(27)=$p(%HOSP10d(76),"\",16) s %HOSP10d(28)=$p(%HOSP10d(76),"\",17) s %HOSP10d(29)=$p(%HOSP10d(76),"\",18) s %HOSP10d(33)=$p(%HOSP10d(76),"\",22) s %HOSP10d(34)=$p(%HOSP10d(76),"\",19) s %HOSP10d(35)=$p(%HOSP10d(76),"\",20) s %HOSP10d(36)=$p(%HOSP10d(76),"\",21) s %HOSP10d(37)=$p(%HOSP10d(76),"\",23) s %HOSP10d(38)=$p(%HOSP10d(76),"\",24) s %HOSP10d(39)=$p(%HOSP10d(76),"\",25) s %HOSP10d(40)=$p(%HOSP10d(76),"\",26) s %HOSP10d(41)=$p(%HOSP10d(76),"\",27) s %HOSP10d(42)=$p(%HOSP10d(76),"\",28) s %HOSP10d(43)=$p(%HOSP10d(76),"\",29) s %HOSP10d(44)=$p(%HOSP10d(76),"\",30) s %HOSP10d(45)=$p(%HOSP10d(76),"\",31) s %HOSP10d(46)=$p(%HOSP10d(76),"\",32)
 s %HOSP10d(76)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4),"ADDR"))
 s %HOSP10d(10)=$p(%HOSP10d(76),"\",1) s %HOSP10d(11)=$p(%HOSP10d(76),"\",2) s %HOSP10d(12)=$p(%HOSP10d(76),"\",3) s %HOSP10d(13)=$p(%HOSP10d(76),"\",4) s %HOSP10d(14)=$p(%HOSP10d(76),"\",5) s %HOSP10d(32)=$p(%HOSP10d(76),"\",6)
 s %HOSP10d(24)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4),"EXTRA"))
 s %HOSP10d(1)=$p(%HOSP10d(2),"||")
 s %HOSP10d(26)=$g(%HOSP10d(1)) s %HOSP10d(30)=$$CT029^at316($g(%HOSP10d(2))) s %HOSP10d(31)=$$CT030^at316($g(%HOSP10d(2))) s %HOSP10d(51)=$zu(28,%HOSP10d(5),6) s %HOSP10d(49)=$zu(28,%HOSP10d(6),6)
 g:'(($c(0)[%HOSP10d(50))||(%HOSP10d(50)=$c(32,0)&&($e(%HOSP10d(49))=$c(32)))||(%HOSP10d(50)=$e(%HOSP10d(49),1,$l(%HOSP10d(50))))) %0CCk1
 g:'(($c(0)[%HOSP10d(52))||(%HOSP10d(52)=$c(32,0)&&($e(%HOSP10d(51))=$c(32)))||(%HOSP10d(52)=$e(%HOSP10d(51),1,$l(%HOSP10d(52))))) %0CCk1
 g:'(%HOSP10d(49)'="") %0CCk1
 g:'(%HOSP10d(51)'="") %0CCk1
 g:$zu(115,2)=0 %0CCuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP10d(2),"||",1),"PATIENT",$p(%HOSP10d(2),"||",2),$p(%HOSP10d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP10d(61)=1,%HOSP10d(62)=$name(^THOS($p(%HOSP10d(2),"||",1),"PATIENT",$p(%HOSP10d(2),"||",2),$p(%HOSP10d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP10d(2) ztrap "LOCK"  }
 ; asl MOD# 4
 s %HOSP10d(58)=$p(%HOSP10d(2),"||"),%HOSP10d(3)=$p(%HOSP10d(2),"||",2),%HOSP10d(4)=$p(%HOSP10d(2),"||",3)
 i %HOSP10d(58)'="",%HOSP10d(3)'="",%HOSP10d(4)'="",$d(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4)))
 e  g %0CDdun
 s %HOSP10d(83)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4)))
 s %HOSP10d(8)=$p(%HOSP10d(83),"\",8)
 g:'(((%HOSP10d(8)'="")&&(%HOSP10d(8)=%HOSP10d(53)))||(%HOSP10d(54)="")) %0CDdun
 s %HOSP10d(9)=$p(%HOSP10d(83),"\",4)
 g:'(((%HOSP10d(9)'="")&&(%HOSP10d(9)=%HOSP10d(55)))||(%HOSP10d(56)="")) %0CDdun
 s %HOSP10d(5)=$p(%HOSP10d(83),"\",1) s %HOSP10d(6)=$p(%HOSP10d(83),"\",2) s %HOSP10d(7)=$p(%HOSP10d(83),"\",3) s %HOSP10d(15)=$p(%HOSP10d(83),"\",13) s %HOSP10d(16)=$p(%HOSP10d(83),"\",9) s %HOSP10d(17)=$p(%HOSP10d(83),"\",12) s %HOSP10d(18)=$p(%HOSP10d(83),"\",5) s %HOSP10d(19)=$p(%HOSP10d(83),"\",7) s %HOSP10d(20)=$p(%HOSP10d(83),"\",14) s %HOSP10d(21)=$p(%HOSP10d(83),"\",6) s %HOSP10d(22)=$p(%HOSP10d(83),"\",10) s %HOSP10d(23)=$p(%HOSP10d(83),"\",11) s %HOSP10d(25)=$p(%HOSP10d(83),"\",15) s %HOSP10d(27)=$p(%HOSP10d(83),"\",16) s %HOSP10d(28)=$p(%HOSP10d(83),"\",17) s %HOSP10d(29)=$p(%HOSP10d(83),"\",18) s %HOSP10d(33)=$p(%HOSP10d(83),"\",22) s %HOSP10d(34)=$p(%HOSP10d(83),"\",19) s %HOSP10d(35)=$p(%HOSP10d(83),"\",20) s %HOSP10d(36)=$p(%HOSP10d(83),"\",21) s %HOSP10d(37)=$p(%HOSP10d(83),"\",23) s %HOSP10d(38)=$p(%HOSP10d(83),"\",24) s %HOSP10d(39)=$p(%HOSP10d(83),"\",25) s %HOSP10d(40)=$p(%HOSP10d(83),"\",26) s %HOSP10d(41)=$p(%HOSP10d(83),"\",27) s %HOSP10d(42)=$p(%HOSP10d(83),"\",28) s %HOSP10d(43)=$p(%HOSP10d(83),"\",29) s %HOSP10d(44)=$p(%HOSP10d(83),"\",30) s %HOSP10d(45)=$p(%HOSP10d(83),"\",31) s %HOSP10d(46)=$p(%HOSP10d(83),"\",32)
 s %HOSP10d(83)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4),"ADDR"))
 s %HOSP10d(10)=$p(%HOSP10d(83),"\",1) s %HOSP10d(11)=$p(%HOSP10d(83),"\",2) s %HOSP10d(12)=$p(%HOSP10d(83),"\",3) s %HOSP10d(13)=$p(%HOSP10d(83),"\",4) s %HOSP10d(14)=$p(%HOSP10d(83),"\",5) s %HOSP10d(32)=$p(%HOSP10d(83),"\",6)
 s %HOSP10d(24)=$g(^THOS(%HOSP10d(58),"PATIENT",%HOSP10d(3),%HOSP10d(4),"EXTRA"))
 s %HOSP10d(1)=$p(%HOSP10d(2),"||")
 s %HOSP10d(26)=$g(%HOSP10d(1)) s %HOSP10d(30)=$$CT029^at316($g(%HOSP10d(2))) s %HOSP10d(31)=$$CT030^at316($g(%HOSP10d(2))) s %HOSP10d(51)=$zu(28,%HOSP10d(5),6) s %HOSP10d(49)=$zu(28,%HOSP10d(6),6)
 g:'((%HOSP10d(1)=%HOSP10d(47))||(%HOSP10d(48)="")) %0CDdun
 g:'(($c(0)[%HOSP10d(50))||(%HOSP10d(50)=$c(32,0)&&($e(%HOSP10d(49))=$c(32)))||(%HOSP10d(50)=$e(%HOSP10d(49),1,$l(%HOSP10d(50))))) %0CDdun
 g:'(($c(0)[%HOSP10d(52))||(%HOSP10d(52)=$c(32,0)&&($e(%HOSP10d(51))=$c(32)))||(%HOSP10d(52)=$e(%HOSP10d(51),1,$l(%HOSP10d(52))))) %0CDdun
 g:'(%HOSP10d(49)'="") %0CDdun
 g:'(%HOSP10d(51)'="") %0CDdun
%0CCuncommitted ;
 s %HOSP10s(3)=$s(%HOSP10d(3)'="":%HOSP10d(3),1:-1E14),%HOSP10s(22)=$s(%HOSP10d(22)'="":%HOSP10d(22),1:-1E14),%HOSP10d(59)=%HOSP10d(59)+1,%HOSP10d(84)="",$li(%HOSP10d(84),25)=%HOSP10d(1),$li(%HOSP10d(84),30)=%HOSP10d(2),$li(%HOSP10d(84),38)=%HOSP10d(4),$li(%HOSP10d(84),18)=%HOSP10d(5),$li(%HOSP10d(84),34)=%HOSP10d(6),$li(%HOSP10d(84),35)=%HOSP10d(7),$li(%HOSP10d(84),9)=%HOSP10d(8),$li(%HOSP10d(84),32)=%HOSP10d(9),$li(%HOSP10d(84),1)=%HOSP10d(10),$li(%HOSP10d(84),2)=%HOSP10d(11),$li(%HOSP10d(84),3)=%HOSP10d(12),$li(%HOSP10d(84),5)=%HOSP10d(13),$li(%HOSP10d(84),28)=%HOSP10d(14),$li(%HOSP10d(84),8)=%HOSP10d(15),$li(%HOSP10d(84),23)=%HOSP10d(16),$li(%HOSP10d(84),7)=%HOSP10d(17),$li(%HOSP10d(84),12)=%HOSP10d(18),$li(%HOSP10d(84),11)=%HOSP10d(19),$li(%HOSP10d(84),31)=%HOSP10d(20),$li(%HOSP10d(84),10)=%HOSP10d(21),$li(%HOSP10d(84),6)=%HOSP10d(23),$li(%HOSP10d(84),14)=%HOSP10d(24),$li(%HOSP10d(84),41)=%HOSP10d(25),$li(%HOSP10d(84),19)=%HOSP10d(26),$li(%HOSP10d(84),36)=%HOSP10d(27),$li(%HOSP10d(84),37)=%HOSP10d(28),$li(%HOSP10d(84),26)=%HOSP10d(29),$li(%HOSP10d(84),21)=%HOSP10d(30),$li(%HOSP10d(84),22)=%HOSP10d(31),$li(%HOSP10d(84),4)=%HOSP10d(32),$li(%HOSP10d(84),29)=%HOSP10d(33),$li(%HOSP10d(84),13)=%HOSP10d(34),$li(%HOSP10d(84),33)=%HOSP10d(35),$li(%HOSP10d(84),24)=%HOSP10d(36),$li(%HOSP10d(84),44)=%HOSP10d(37),$li(%HOSP10d(84),43)=%HOSP10d(38),$li(%HOSP10d(84),27)=%HOSP10d(39),$li(%HOSP10d(84),15)=%HOSP10d(40),$li(%HOSP10d(84),16)=%HOSP10d(41),$li(%HOSP10d(84),17)=%HOSP10d(42),$li(%HOSP10d(84),20)=%HOSP10d(43),$li(%HOSP10d(84),42)=%HOSP10d(44),$li(%HOSP10d(84),40)=%HOSP10d(45),$li(%HOSP10d(84),39)=%HOSP10d(46),^||%sql.temp(%HOSP10t(2),0,%HOSP10s(3),%HOSP10s(22),%HOSP10d(59))=%HOSP10d(84)
%0CDdun i $zu(115,2)=1,$g(%HOSP10d(61))=1 { l -@%HOSP10d(62) s %HOSP10d(61)=0 }
 g %0CCk1
%0CCdun 
 q
%HOSP20o s $zt="%HOSP20E" s SQLCODE=$s($g(%HOSP20c):-101,1:0) q:SQLCODE'=0  s %HOSP20d(54)=0 s %HOSP20d(55)=0,%HOSP20d(56)=""
 s %HOSP20d(47)=$g(par),%HOSP20d(48)=$g(par),%HOSP20d(49)=$g(debtor)
 s %HOSP20t(1)=$i(^||%sql.temp)
 s %HOSP20d(52)=$zu(28,%HOSP20d(49),6)
 s %HOSP20c=1 q
%HOSP20E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP20c,%HOSP20d,%HOSP20E,%HOSP20l,%HOSP20n,%HOSP20R,%HOSP20s,%HOSP20t,%HOSP20Z q
%0Efirst 
 k ^||%sql.temp(%HOSP20t(1),0) s ^||%sql.temp(%HOSP20t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%HOSP20t(1),0))
 ; asl MOD# 3
 d %0EBMod
 i $sortend(^||%sql.temp(%HOSP20t(1),0))
 s %HOSP20s(22)=""
%0ECk1 s %HOSP20s(22)=$zp(^||%sql.temp(%HOSP20t(1),0,%HOSP20s(22)))
 i %HOSP20s(22)="" g %0ECdun
 s %HOSP20d(22)=$s(%HOSP20s(22)=-1E14:"",1:%HOSP20s(22))
 s %HOSP20s(2)=""
%0ECk2 s %HOSP20s(2)=$o(^||%sql.temp(%HOSP20t(1),0,%HOSP20s(22),%HOSP20s(2)))
 i %HOSP20s(2)="" g %0ECk1
 s %HOSP20d(2)=$s(%HOSP20s(2)=-1E14:"",1:%HOSP20s(2))
 s %HOSP20d(53)=$p(%HOSP20d(2),"||"),%HOSP20d(3)=$p(%HOSP20d(2),"||",2),%HOSP20d(4)=$p(%HOSP20d(2),"||",3)
 i %HOSP20d(53)'="",%HOSP20d(3)'="",%HOSP20d(4)'="",$d(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 e  g %0ECk2
 s %HOSP20d(78)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 s %HOSP20d(5)=$p(%HOSP20d(78),"\",1) s %HOSP20d(6)=$p(%HOSP20d(78),"\",2) s %HOSP20d(7)=$p(%HOSP20d(78),"\",3) s %HOSP20d(8)=$p(%HOSP20d(78),"\",8) s %HOSP20d(9)=$p(%HOSP20d(78),"\",4) s %HOSP20d(15)=$p(%HOSP20d(78),"\",13) s %HOSP20d(16)=$p(%HOSP20d(78),"\",9) s %HOSP20d(17)=$p(%HOSP20d(78),"\",12) s %HOSP20d(18)=$p(%HOSP20d(78),"\",5) s %HOSP20d(19)=$p(%HOSP20d(78),"\",7) s %HOSP20d(20)=$p(%HOSP20d(78),"\",14) s %HOSP20d(21)=$p(%HOSP20d(78),"\",6) s %HOSP20d(23)=$p(%HOSP20d(78),"\",11) s %HOSP20d(25)=$p(%HOSP20d(78),"\",15) s %HOSP20d(27)=$p(%HOSP20d(78),"\",16) s %HOSP20d(28)=$p(%HOSP20d(78),"\",17) s %HOSP20d(29)=$p(%HOSP20d(78),"\",18) s %HOSP20d(33)=$p(%HOSP20d(78),"\",22) s %HOSP20d(34)=$p(%HOSP20d(78),"\",19) s %HOSP20d(35)=$p(%HOSP20d(78),"\",20) s %HOSP20d(36)=$p(%HOSP20d(78),"\",21) s %HOSP20d(37)=$p(%HOSP20d(78),"\",23) s %HOSP20d(38)=$p(%HOSP20d(78),"\",24) s %HOSP20d(39)=$p(%HOSP20d(78),"\",25) s %HOSP20d(40)=$p(%HOSP20d(78),"\",26) s %HOSP20d(41)=$p(%HOSP20d(78),"\",27) s %HOSP20d(42)=$p(%HOSP20d(78),"\",28) s %HOSP20d(43)=$p(%HOSP20d(78),"\",29) s %HOSP20d(44)=$p(%HOSP20d(78),"\",30) s %HOSP20d(45)=$p(%HOSP20d(78),"\",31) s %HOSP20d(46)=$p(%HOSP20d(78),"\",32)
 s %HOSP20d(78)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"ADDR"))
 s %HOSP20d(10)=$p(%HOSP20d(78),"\",1) s %HOSP20d(11)=$p(%HOSP20d(78),"\",2) s %HOSP20d(12)=$p(%HOSP20d(78),"\",3) s %HOSP20d(13)=$p(%HOSP20d(78),"\",4) s %HOSP20d(14)=$p(%HOSP20d(78),"\",5) s %HOSP20d(32)=$p(%HOSP20d(78),"\",6)
 s %HOSP20d(24)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"EXTRA"))
 s %HOSP20d(1)=$p(%HOSP20d(2),"||")
 s %HOSP20d(26)=$g(%HOSP20d(1)) s %HOSP20d(30)=$$CT029^at316($g(%HOSP20d(2))) s %HOSP20d(31)=$$CT030^at316($g(%HOSP20d(2)))
 g:$zu(115,2)=0 %0ECuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP20d(2),"||",1),"PATIENT",$p(%HOSP20d(2),"||",2),$p(%HOSP20d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP20d(55)=1,%HOSP20d(56)=$name(^THOS($p(%HOSP20d(2),"||",1),"PATIENT",$p(%HOSP20d(2),"||",2),$p(%HOSP20d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP20d(2) ztrap "LOCK"  }
 ; asl MOD# 4
 s %HOSP20d(53)=$p(%HOSP20d(2),"||"),%HOSP20d(3)=$p(%HOSP20d(2),"||",2),%HOSP20d(4)=$p(%HOSP20d(2),"||",3)
 i %HOSP20d(53)'="",%HOSP20d(3)'="",%HOSP20d(4)'="",$d(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 e  g %0EDdun
 s %HOSP20d(85)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 s %HOSP20d(5)=$p(%HOSP20d(85),"\",1) s %HOSP20d(6)=$p(%HOSP20d(85),"\",2) s %HOSP20d(7)=$p(%HOSP20d(85),"\",3) s %HOSP20d(8)=$p(%HOSP20d(85),"\",8) s %HOSP20d(9)=$p(%HOSP20d(85),"\",4) s %HOSP20d(15)=$p(%HOSP20d(85),"\",13) s %HOSP20d(16)=$p(%HOSP20d(85),"\",9) s %HOSP20d(17)=$p(%HOSP20d(85),"\",12) s %HOSP20d(18)=$p(%HOSP20d(85),"\",5) s %HOSP20d(19)=$p(%HOSP20d(85),"\",7) s %HOSP20d(20)=$p(%HOSP20d(85),"\",14) s %HOSP20d(21)=$p(%HOSP20d(85),"\",6) s %HOSP20d(22)=$p(%HOSP20d(85),"\",10) s %HOSP20d(23)=$p(%HOSP20d(85),"\",11) s %HOSP20d(25)=$p(%HOSP20d(85),"\",15) s %HOSP20d(27)=$p(%HOSP20d(85),"\",16) s %HOSP20d(28)=$p(%HOSP20d(85),"\",17) s %HOSP20d(29)=$p(%HOSP20d(85),"\",18) s %HOSP20d(33)=$p(%HOSP20d(85),"\",22) s %HOSP20d(34)=$p(%HOSP20d(85),"\",19) s %HOSP20d(35)=$p(%HOSP20d(85),"\",20) s %HOSP20d(36)=$p(%HOSP20d(85),"\",21) s %HOSP20d(37)=$p(%HOSP20d(85),"\",23) s %HOSP20d(38)=$p(%HOSP20d(85),"\",24) s %HOSP20d(39)=$p(%HOSP20d(85),"\",25) s %HOSP20d(40)=$p(%HOSP20d(85),"\",26) s %HOSP20d(41)=$p(%HOSP20d(85),"\",27) s %HOSP20d(42)=$p(%HOSP20d(85),"\",28) s %HOSP20d(43)=$p(%HOSP20d(85),"\",29) s %HOSP20d(44)=$p(%HOSP20d(85),"\",30) s %HOSP20d(45)=$p(%HOSP20d(85),"\",31) s %HOSP20d(46)=$p(%HOSP20d(85),"\",32)
 s %HOSP20d(85)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"ADDR"))
 s %HOSP20d(10)=$p(%HOSP20d(85),"\",1) s %HOSP20d(11)=$p(%HOSP20d(85),"\",2) s %HOSP20d(12)=$p(%HOSP20d(85),"\",3) s %HOSP20d(13)=$p(%HOSP20d(85),"\",4) s %HOSP20d(14)=$p(%HOSP20d(85),"\",5) s %HOSP20d(32)=$p(%HOSP20d(85),"\",6)
 s %HOSP20d(24)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"EXTRA"))
 s %HOSP20d(1)=$p(%HOSP20d(2),"||")
 s %HOSP20d(26)=$g(%HOSP20d(1)) s %HOSP20d(30)=$$CT029^at316($g(%HOSP20d(2))) s %HOSP20d(31)=$$CT030^at316($g(%HOSP20d(2)))
%0ECuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP20d(54)=%HOSP20d(54)+1,%ROWCOUNT=%HOSP20d(54),%ROWID=%HOSP20d(2),%HOSP20c=10 q
%HOSP20f i '$g(%HOSP20c) { s SQLCODE=-102 q  } i %HOSP20c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Eerr" i $d(%0CacheRowLimit)#2,$g(%HOSP20d(54))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP20d(54),%HOSP20c=100 q  } g %0Efirst:%HOSP20c=1
%0EDdun i $zu(115,2)=1,$g(%HOSP20d(55))=1 { l -@%HOSP20d(56) s %HOSP20d(55)=0 }
 g %0ECk2
%0ECdun 
%0EAdun 
 s %ROWCOUNT=%HOSP20d(54),SQLCODE=100,%HOSP20c=100 q
%HOSP20c i '$g(%HOSP20c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP20d(54)),1:0) f %HOSP20d(57)=1 { i $sortend(^||%sql.temp(%HOSP20t(%HOSP20d(57)),0),0) } k ^||%sql.temp(%HOSP20t(1))
 i $zu(115,2)=1,$g(%HOSP20d(55))=1 { l -@%HOSP20d(56) } k %HOSP20c,%HOSP20d,%HOSP20E,%HOSP20l,%HOSP20n,%HOSP20R,%HOSP20s,%HOSP20t,%HOSP20Z s SQLCODE=0 q
%0Eerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP20c=100
 f %HOSP20d(57)=1 i $sortend(^||%sql.temp(%HOSP20t(%HOSP20d(57)),0),0)
 q
%0EBMod ; asl MOD# 2
 s %HOSP20d(51)=%HOSP20d(52)
 s %HOSP20d(3)=%HOSP20d(49)
 i %HOSP20d(51)="" g %0EBdun
 s %HOSP20d(1)=""
%0EBk1 s %HOSP20d(1)=$o(^THOSi("MRN",%HOSP20d(51),%HOSP20d(1)))
 i %HOSP20d(1)="" g %0EBdun
 i '((%HOSP20d(1)=%HOSP20d(47))||(%HOSP20d(48)="")) g %0EBk1
 i %HOSP20d(3)="" g %0EBk1
 s %HOSP20d(4)=""
%0EBk2 s %HOSP20d(4)=$o(^THOSi("MRN",%HOSP20d(51),%HOSP20d(1),%HOSP20d(3),%HOSP20d(4)))
 i %HOSP20d(4)="" g %0EBk1
 s %HOSP20d(2)=(%HOSP20d(1))_"||"_(%HOSP20d(3))_"||"_(%HOSP20d(4))
 s %HOSP20d(53)=$p(%HOSP20d(2),"||"),%HOSP20d(3)=$p(%HOSP20d(2),"||",2),%HOSP20d(4)=$p(%HOSP20d(2),"||",3)
 i %HOSP20d(53)'="",%HOSP20d(3)'="",%HOSP20d(4)'="",$d(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 e  g %0EBk2
 s %HOSP20d(71)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4)))
 s %HOSP20d(5)=$p(%HOSP20d(71),"\",1) s %HOSP20d(6)=$p(%HOSP20d(71),"\",2) s %HOSP20d(7)=$p(%HOSP20d(71),"\",3) s %HOSP20d(8)=$p(%HOSP20d(71),"\",8) s %HOSP20d(9)=$p(%HOSP20d(71),"\",4) s %HOSP20d(15)=$p(%HOSP20d(71),"\",13) s %HOSP20d(16)=$p(%HOSP20d(71),"\",9) s %HOSP20d(17)=$p(%HOSP20d(71),"\",12) s %HOSP20d(18)=$p(%HOSP20d(71),"\",5) s %HOSP20d(19)=$p(%HOSP20d(71),"\",7) s %HOSP20d(20)=$p(%HOSP20d(71),"\",14) s %HOSP20d(21)=$p(%HOSP20d(71),"\",6) s %HOSP20d(22)=$p(%HOSP20d(71),"\",10) s %HOSP20d(23)=$p(%HOSP20d(71),"\",11) s %HOSP20d(25)=$p(%HOSP20d(71),"\",15) s %HOSP20d(27)=$p(%HOSP20d(71),"\",16) s %HOSP20d(28)=$p(%HOSP20d(71),"\",17) s %HOSP20d(29)=$p(%HOSP20d(71),"\",18) s %HOSP20d(33)=$p(%HOSP20d(71),"\",22) s %HOSP20d(34)=$p(%HOSP20d(71),"\",19) s %HOSP20d(35)=$p(%HOSP20d(71),"\",20) s %HOSP20d(36)=$p(%HOSP20d(71),"\",21) s %HOSP20d(37)=$p(%HOSP20d(71),"\",23) s %HOSP20d(38)=$p(%HOSP20d(71),"\",24) s %HOSP20d(39)=$p(%HOSP20d(71),"\",25) s %HOSP20d(40)=$p(%HOSP20d(71),"\",26) s %HOSP20d(41)=$p(%HOSP20d(71),"\",27) s %HOSP20d(42)=$p(%HOSP20d(71),"\",28) s %HOSP20d(43)=$p(%HOSP20d(71),"\",29) s %HOSP20d(44)=$p(%HOSP20d(71),"\",30) s %HOSP20d(45)=$p(%HOSP20d(71),"\",31) s %HOSP20d(46)=$p(%HOSP20d(71),"\",32)
 s %HOSP20d(71)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"ADDR"))
 s %HOSP20d(10)=$p(%HOSP20d(71),"\",1) s %HOSP20d(11)=$p(%HOSP20d(71),"\",2) s %HOSP20d(12)=$p(%HOSP20d(71),"\",3) s %HOSP20d(13)=$p(%HOSP20d(71),"\",4) s %HOSP20d(14)=$p(%HOSP20d(71),"\",5) s %HOSP20d(32)=$p(%HOSP20d(71),"\",6)
 s %HOSP20d(24)=$g(^THOS(%HOSP20d(53),"PATIENT",%HOSP20d(3),%HOSP20d(4),"EXTRA"))
 s %HOSP20d(1)=$p(%HOSP20d(2),"||")
 s %HOSP20d(26)=$g(%HOSP20d(1)) s %HOSP20d(30)=$$CT029^at316($g(%HOSP20d(2))) s %HOSP20d(31)=$$CT030^at316($g(%HOSP20d(2)))
 s %HOSP20s(22)=$s(%HOSP20d(22)'="":%HOSP20d(22),1:-1E14),%HOSP20s(2)=$s(%HOSP20d(2)'="":%HOSP20d(2),1:-1E14),^||%sql.temp(%HOSP20t(1),0,%HOSP20s(22),%HOSP20s(2))=""
 g %0EBk2
%0EBdun 
 q
%0Go n %i,icol,ir
 f icol=0:1:45 i $d(PLIST(icol)) s %i(icol)=PLIST(icol)
 s %ROWID=$$%insert^User.HOSHospitalPatients.T1(.%i,$c(0,0,0,0)),%ROWCOUNT='SQLCODE
 q  // From %0Go
%0Io n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Ierr" s %mmmsqld(7)=0 s %mmmsqld(8)=""
 s %mmmsqld(3)=$g(ROWID)
 n %data,icol,ir
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(2)=%mmmsqld(3)
 s %mmmsqld(4)=$p(%mmmsqld(2),"||"),%mmmsqld(5)=$p(%mmmsqld(2),"||",2),%mmmsqld(6)=$p(%mmmsqld(2),"||",3)
 i %mmmsqld(4)'="",%mmmsqld(5)'="",%mmmsqld(6)'="",$d(^THOS(%mmmsqld(4),"PATIENT",%mmmsqld(5),%mmmsqld(6)))
 e  g %0IBdun
 s %mmmsqld(15)=$$%getlock^User.HOSHospitalPatients.T1(%mmmsqld(2)) i '%mmmsqld(15) s SQLCODE=-110 g %0Ic
 ; asl MOD# 3
 s %mmmsqld(4)=$p(%mmmsqld(2),"||"),%mmmsqld(5)=$p(%mmmsqld(2),"||",2),%mmmsqld(6)=$p(%mmmsqld(2),"||",3)
 i %mmmsqld(4)'="",%mmmsqld(5)'="",%mmmsqld(6)'="",$d(^THOS(%mmmsqld(4),"PATIENT",%mmmsqld(5),%mmmsqld(6)))
 e  g %0ICdun
 k %data
 f icol=0:1:45 i $d(PLIST(icol)) s %data(icol)=PLIST(icol)
 d %update^User.HOSHospitalPatients.T1(%mmmsqld(2),$c(0,2,0,0),.%data,,'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(7))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(15)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(2)) g %0Ic
%0ICdun 
 d:%mmmsqld(15)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(2)) g:SQLCODE<0 %0Ic
%0IBdun 
%0IAdun 
%0Ic s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(7)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Ierr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(15))=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(2)) g %0Ic
%0Ko n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Kerr" s %mmmsqld(6)=0 s %mmmsqld(7)=""
 s %mmmsqld(2)=$g(ROWID)
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(1)=%mmmsqld(2)
 s %mmmsqld(3)=$p(%mmmsqld(1),"||"),%mmmsqld(4)=$p(%mmmsqld(1),"||",2),%mmmsqld(5)=$p(%mmmsqld(1),"||",3)
 i %mmmsqld(3)'="",%mmmsqld(4)'="",%mmmsqld(5)'="",$d(^THOS(%mmmsqld(3),"PATIENT",%mmmsqld(4),%mmmsqld(5)))
 e  g %0KBdun
 s %mmmsqld(14)=$$%getlock^User.HOSHospitalPatients.T1(%mmmsqld(1)) i '%mmmsqld(14) s SQLCODE=-110 g %0Kc
 ; asl MOD# 3
 s %mmmsqld(3)=$p(%mmmsqld(1),"||"),%mmmsqld(4)=$p(%mmmsqld(1),"||",2),%mmmsqld(5)=$p(%mmmsqld(1),"||",3)
 i %mmmsqld(3)'="",%mmmsqld(4)'="",%mmmsqld(5)'="",$d(^THOS(%mmmsqld(3),"PATIENT",%mmmsqld(4),%mmmsqld(5)))
 e  g %0KCdun
 d %delete^User.HOSHospitalPatients.T1(%mmmsqld(1),$c(0,2,0,0),'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(6))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(14)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(1)) g %0Kc
%0KCdun 
 d:%mmmsqld(14)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(1)) g:SQLCODE<0 %0Kc
%0KBdun 
%0KAdun 
%0Kc s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(6)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Kerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(14))=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(1)) g %0Kc
%0Mo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlTS,%mmmsqlTS2,%mmmsqlZ s $zt="%0Merr" s %mmmsqld(7)=0 s %mmmsqld(8)=""
 s %mmmsqld(2)=$g(ROWID)
 s SQLCODE=100
 k:'$TLEVEL %0CacheLock If $zu(115,1)=2,'$TLEVEL { s %mmmsqlTS2=1 TSTART } If $zu(115,1) { s %mmmsqlTS=1 TSTART  }
 ; asl MOD# 2
 s %mmmsqld(1)=%mmmsqld(2)
 i %mmmsqld(1)="" g %0MBdun
 s %mmmsqld(4)=""
%0MBk1 s %mmmsqld(4)=$o(^THOS(%mmmsqld(1),"PATIENT",%mmmsqld(4)))
 i %mmmsqld(4)="" g %0MBdun
 s %mmmsqld(5)=""
%0MBk2 s %mmmsqld(5)=$o(^THOS(%mmmsqld(1),"PATIENT",%mmmsqld(4),%mmmsqld(5)))
 i %mmmsqld(5)="" g %0MBk1
 s %mmmsqld(3)=(%mmmsqld(1))_"||"_(%mmmsqld(4))_"||"_(%mmmsqld(5))
 s %mmmsqld(15)=$$%getlock^User.HOSHospitalPatients.T1(%mmmsqld(3)) i '%mmmsqld(15) s SQLCODE=-110 g %0Mc
 ; asl MOD# 3
 s %mmmsqld(6)=$p(%mmmsqld(3),"||"),%mmmsqld(4)=$p(%mmmsqld(3),"||",2),%mmmsqld(5)=$p(%mmmsqld(3),"||",3)
 i %mmmsqld(6)'="",%mmmsqld(4)'="",%mmmsqld(5)'="",$d(^THOS(%mmmsqld(6),"PATIENT",%mmmsqld(4),%mmmsqld(5)))
 e  g %0MCdun
 s %mmmsqld(1)=$p(%mmmsqld(3),"||")
 d %delete^User.HOSHospitalPatients.T1(%mmmsqld(3),$c(0,2,0,0),'$g(%mmmsqlTS))
 i 'SQLCODE i $i(%mmmsqld(7))'<$g(%0CacheRowLimit,9223372036854775807) d:%mmmsqld(15)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(3)) g %0Mc
%0MCdun 
 d:%mmmsqld(15)=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(3)) g:SQLCODE<0 %0Mc
 g %0MBk2
%0MBdun 
%0MAdun 
%0Mc s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%mmmsqld(7)),1:0)
 If $zu(115,1),$g(%mmmsqlTS) { TCOMMIT:SQLCODE'<0  TROLLBACK:SQLCODE<0 1 } TCOMMIT:SQLCODE=100&&(%ROWCOUNT=0)&&($g(%mmmsqlTS2))&&($zu(115,1)=2)  q
%0Merr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) d:$g(%mmmsqld(15))=1 %ReleaseLock^User.HOSHospitalPatients.T1(%mmmsqld(3)) g %0Mc
%0Ro d %HOSP20f q:SQLCODE'=0
 s PLIST(0)=%HOSP20d(1),PLIST(1)=%HOSP20d(2),PLIST(2)=%HOSP20d(3),PLIST(3)=%HOSP20d(4),PLIST(4)=%HOSP20d(5),PLIST(5)=%HOSP20d(6),PLIST(6)=%HOSP20d(7),PLIST(7)=%HOSP20d(8),PLIST(8)=%HOSP20d(9),PLIST(9)=%HOSP20d(10),PLIST(10)=%HOSP20d(11),PLIST(11)=%HOSP20d(12),PLIST(12)=%HOSP20d(13),PLIST(13)=%HOSP20d(14),PLIST(14)=%HOSP20d(15),PLIST(15)=%HOSP20d(16),PLIST(16)=%HOSP20d(17),PLIST(17)=%HOSP20d(18),PLIST(18)=%HOSP20d(19),PLIST(19)=%HOSP20d(20),PLIST(20)=%HOSP20d(21),PLIST(21)=%HOSP20d(22),PLIST(22)=%HOSP20d(23),PLIST(23)=%HOSP20d(24),PLIST(24)=%HOSP20d(25),PLIST(25)=%HOSP20d(26),PLIST(26)=%HOSP20d(27),PLIST(27)=%HOSP20d(28),PLIST(28)=%HOSP20d(29),PLIST(29)=%HOSP20d(30),PLIST(30)=%HOSP20d(31),PLIST(31)=%HOSP20d(32),PLIST(32)=%HOSP20d(33),PLIST(33)=%HOSP20d(34),PLIST(34)=%HOSP20d(35),PLIST(35)=%HOSP20d(36),PLIST(36)=%HOSP20d(37),PLIST(37)=%HOSP20d(38),PLIST(38)=%HOSP20d(39),PLIST(39)=%HOSP20d(40),PLIST(40)=%HOSP20d(41),PLIST(41)=%HOSP20d(42),PLIST(42)=%HOSP20d(43),PLIST(43)=%HOSP20d(44),PLIST(44)=%HOSP20d(45),PLIST(45)=%HOSP20d(46)
 q
%0So d %HOSP10f q:SQLCODE'=0
 s PLIST(0)=%HOSP10d(1),PLIST(1)=%HOSP10d(2),PLIST(2)=%HOSP10d(3),PLIST(3)=%HOSP10d(4),PLIST(4)=%HOSP10d(5),PLIST(5)=%HOSP10d(6),PLIST(6)=%HOSP10d(7),PLIST(7)=%HOSP10d(8),PLIST(8)=%HOSP10d(9),PLIST(9)=%HOSP10d(10),PLIST(10)=%HOSP10d(11),PLIST(11)=%HOSP10d(12),PLIST(12)=%HOSP10d(13),PLIST(13)=%HOSP10d(14),PLIST(14)=%HOSP10d(15),PLIST(15)=%HOSP10d(16),PLIST(16)=%HOSP10d(17),PLIST(17)=%HOSP10d(18),PLIST(18)=%HOSP10d(19),PLIST(19)=%HOSP10d(20),PLIST(20)=%HOSP10d(21),PLIST(21)=%HOSP10d(22),PLIST(22)=%HOSP10d(23),PLIST(23)=%HOSP10d(24),PLIST(24)=%HOSP10d(25),PLIST(25)=%HOSP10d(26),PLIST(26)=%HOSP10d(27),PLIST(27)=%HOSP10d(28),PLIST(28)=%HOSP10d(29),PLIST(29)=%HOSP10d(30),PLIST(30)=%HOSP10d(31),PLIST(31)=%HOSP10d(32),PLIST(32)=%HOSP10d(33),PLIST(33)=%HOSP10d(34),PLIST(34)=%HOSP10d(35),PLIST(35)=%HOSP10d(36),PLIST(36)=%HOSP10d(37),PLIST(37)=%HOSP10d(38),PLIST(38)=%HOSP10d(39),PLIST(39)=%HOSP10d(40),PLIST(40)=%HOSP10d(41),PLIST(41)=%HOSP10d(42),PLIST(42)=%HOSP10d(43),PLIST(43)=%HOSP10d(44),PLIST(44)=%HOSP10d(45),PLIST(45)=%HOSP10d(46)
 q
%0To d %HOSP00f q:SQLCODE'=0
 s PLIST(0)=%HOSP00d(1),PLIST(1)=%HOSP00d(2),PLIST(2)=%HOSP00d(3),PLIST(3)=%HOSP00d(4),PLIST(4)=%HOSP00d(5),PLIST(5)=%HOSP00d(6),PLIST(6)=%HOSP00d(7),PLIST(7)=%HOSP00d(8),PLIST(8)=%HOSP00d(9),PLIST(9)=%HOSP00d(10),PLIST(10)=%HOSP00d(11),PLIST(11)=%HOSP00d(12),PLIST(12)=%HOSP00d(13),PLIST(13)=%HOSP00d(14),PLIST(14)=%HOSP00d(15),PLIST(15)=%HOSP00d(16),PLIST(16)=%HOSP00d(17),PLIST(17)=%HOSP00d(18),PLIST(18)=%HOSP00d(19),PLIST(19)=%HOSP00d(20),PLIST(20)=%HOSP00d(21),PLIST(21)=%HOSP00d(22),PLIST(22)=%HOSP00d(23),PLIST(23)=%HOSP00d(24),PLIST(24)=%HOSP00d(25),PLIST(25)=%HOSP00d(26),PLIST(26)=%HOSP00d(27),PLIST(27)=%HOSP00d(28),PLIST(28)=%HOSP00d(29),PLIST(29)=%HOSP00d(30),PLIST(30)=%HOSP00d(31),PLIST(31)=%HOSP00d(32),PLIST(32)=%HOSP00d(33),PLIST(33)=%HOSP00d(34),PLIST(34)=%HOSP00d(35),PLIST(35)=%HOSP00d(36),PLIST(36)=%HOSP00d(37),PLIST(37)=%HOSP00d(38),PLIST(38)=%HOSP00d(39),PLIST(39)=%HOSP00d(40),PLIST(40)=%HOSP00d(41),PLIST(41)=%HOSP00d(42),PLIST(42)=%HOSP00d(43),PLIST(43)=%HOSP00d(44),PLIST(44)=%HOSP00d(45),PLIST(45)=%HOSP00d(46)
 q
%0Xo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%0Xerr" s %mmmsqld(51)=0,%mmmsqld(52)=""
 s %mmmsqld(48)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(1)=%mmmsqld(48)
 s %mmmsqld(50)=$p(PLIST(1),"||"),PLIST(2)=$p(PLIST(1),"||",2),PLIST(3)=$p(PLIST(1),"||",3)
 i %mmmsqld(50)'="",PLIST(2)'="",PLIST(3)'="",$d(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 e  g %0XBdun
 s %mmmsqld(59)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 s PLIST(4)=$p(%mmmsqld(59),"\",1) s PLIST(5)=$p(%mmmsqld(59),"\",2) s PLIST(6)=$p(%mmmsqld(59),"\",3) s PLIST(7)=$p(%mmmsqld(59),"\",8) s PLIST(8)=$p(%mmmsqld(59),"\",4) s PLIST(14)=$p(%mmmsqld(59),"\",13) s PLIST(15)=$p(%mmmsqld(59),"\",9) s PLIST(16)=$p(%mmmsqld(59),"\",12) s PLIST(17)=$p(%mmmsqld(59),"\",5) s PLIST(18)=$p(%mmmsqld(59),"\",7) s PLIST(19)=$p(%mmmsqld(59),"\",14) s PLIST(20)=$p(%mmmsqld(59),"\",6) s PLIST(21)=$p(%mmmsqld(59),"\",10) s PLIST(22)=$p(%mmmsqld(59),"\",11) s PLIST(24)=$p(%mmmsqld(59),"\",15) s PLIST(26)=$p(%mmmsqld(59),"\",16) s PLIST(27)=$p(%mmmsqld(59),"\",17) s PLIST(28)=$p(%mmmsqld(59),"\",18) s PLIST(32)=$p(%mmmsqld(59),"\",22) s PLIST(33)=$p(%mmmsqld(59),"\",19) s PLIST(34)=$p(%mmmsqld(59),"\",20) s PLIST(35)=$p(%mmmsqld(59),"\",21) s PLIST(36)=$p(%mmmsqld(59),"\",23) s PLIST(37)=$p(%mmmsqld(59),"\",24) s PLIST(38)=$p(%mmmsqld(59),"\",25) s PLIST(39)=$p(%mmmsqld(59),"\",26) s PLIST(40)=$p(%mmmsqld(59),"\",27) s PLIST(41)=$p(%mmmsqld(59),"\",28) s PLIST(42)=$p(%mmmsqld(59),"\",29) s PLIST(43)=$p(%mmmsqld(59),"\",30) s PLIST(44)=$p(%mmmsqld(59),"\",31) s PLIST(45)=$p(%mmmsqld(59),"\",32)
 s %mmmsqld(59)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"ADDR"))
 s PLIST(9)=$p(%mmmsqld(59),"\",1) s PLIST(10)=$p(%mmmsqld(59),"\",2) s PLIST(11)=$p(%mmmsqld(59),"\",3) s PLIST(12)=$p(%mmmsqld(59),"\",4) s PLIST(13)=$p(%mmmsqld(59),"\",5) s PLIST(31)=$p(%mmmsqld(59),"\",6)
 s PLIST(23)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"EXTRA"))
 s PLIST(0)=$p(PLIST(1),"||")
 s PLIST(25)=$g(PLIST(0)) s PLIST(29)=$$CT029^at316($g(PLIST(1))) s PLIST(30)=$$CT030^at316($g(PLIST(1)))
 g:$zu(115,2)=0 %0XBuncommitted i $zu(115,2)=1 l +^THOS($p(PLIST(1),"||",1),"PATIENT",$p(PLIST(1),"||",2),$p(PLIST(1),"||",3))#"S":$zu(115,4) i $t { s %mmmsqld(51)=1,%mmmsqld(52)=$name(^THOS($p(PLIST(1),"||",1),"PATIENT",$p(PLIST(1),"||",2),$p(PLIST(1),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_PLIST(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %mmmsqld(50)=$p(PLIST(1),"||"),PLIST(2)=$p(PLIST(1),"||",2),PLIST(3)=$p(PLIST(1),"||",3)
 i %mmmsqld(50)'="",PLIST(2)'="",PLIST(3)'="",$d(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 e  g %0XCdun
 s %mmmsqld(66)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 s PLIST(4)=$p(%mmmsqld(66),"\",1) s PLIST(5)=$p(%mmmsqld(66),"\",2) s PLIST(6)=$p(%mmmsqld(66),"\",3) s PLIST(7)=$p(%mmmsqld(66),"\",8) s PLIST(8)=$p(%mmmsqld(66),"\",4) s PLIST(14)=$p(%mmmsqld(66),"\",13) s PLIST(15)=$p(%mmmsqld(66),"\",9) s PLIST(16)=$p(%mmmsqld(66),"\",12) s PLIST(17)=$p(%mmmsqld(66),"\",5) s PLIST(18)=$p(%mmmsqld(66),"\",7) s PLIST(19)=$p(%mmmsqld(66),"\",14) s PLIST(20)=$p(%mmmsqld(66),"\",6) s PLIST(21)=$p(%mmmsqld(66),"\",10) s PLIST(22)=$p(%mmmsqld(66),"\",11) s PLIST(24)=$p(%mmmsqld(66),"\",15) s PLIST(26)=$p(%mmmsqld(66),"\",16) s PLIST(27)=$p(%mmmsqld(66),"\",17) s PLIST(28)=$p(%mmmsqld(66),"\",18) s PLIST(32)=$p(%mmmsqld(66),"\",22) s PLIST(33)=$p(%mmmsqld(66),"\",19) s PLIST(34)=$p(%mmmsqld(66),"\",20) s PLIST(35)=$p(%mmmsqld(66),"\",21) s PLIST(36)=$p(%mmmsqld(66),"\",23) s PLIST(37)=$p(%mmmsqld(66),"\",24) s PLIST(38)=$p(%mmmsqld(66),"\",25) s PLIST(39)=$p(%mmmsqld(66),"\",26) s PLIST(40)=$p(%mmmsqld(66),"\",27) s PLIST(41)=$p(%mmmsqld(66),"\",28) s PLIST(42)=$p(%mmmsqld(66),"\",29) s PLIST(43)=$p(%mmmsqld(66),"\",30) s PLIST(44)=$p(%mmmsqld(66),"\",31) s PLIST(45)=$p(%mmmsqld(66),"\",32)
 s %mmmsqld(66)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"ADDR"))
 s PLIST(9)=$p(%mmmsqld(66),"\",1) s PLIST(10)=$p(%mmmsqld(66),"\",2) s PLIST(11)=$p(%mmmsqld(66),"\",3) s PLIST(12)=$p(%mmmsqld(66),"\",4) s PLIST(13)=$p(%mmmsqld(66),"\",5) s PLIST(31)=$p(%mmmsqld(66),"\",6)
 s PLIST(23)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"EXTRA"))
 s PLIST(0)=$p(PLIST(1),"||")
 s PLIST(25)=$g(PLIST(0)) s PLIST(29)=$$CT029^at316($g(PLIST(1))) s PLIST(30)=$$CT030^at316($g(PLIST(1)))
%0XBuncommitted ;
 s SQLCODE=0 g %0Xc
%0XCdun i $zu(115,2)=1,$g(%mmmsqld(51))=1 { l -@%mmmsqld(52) s %mmmsqld(51)=0 }
%0XBdun 
%0XAdun 
%0Xc s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(51))=1 { l -@%mmmsqld(52) } q
%0Xerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %0Xc
%0Zo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%0Zerr" s %mmmsqld(51)=0,%mmmsqld(52)=""
 s %mmmsqld(48)=$g(ROWID)
 s SQLCODE=100
 ; asl MOD# 2
 s PLIST(3)=%mmmsqld(48)
 i PLIST(3)="" g %0ZBdun
 s PLIST(0)=""
%0ZBk1 s PLIST(0)=$o(^THOSi("VIS",PLIST(3),PLIST(0)))
 i PLIST(0)="" g %0ZBdun
 s PLIST(2)=""
%0ZBk2 s PLIST(2)=$o(^THOSi("VIS",PLIST(3),PLIST(0),PLIST(2)))
 i PLIST(2)="" g %0ZBk1
 s PLIST(1)=(PLIST(0))_"||"_(PLIST(2))_"||"_(PLIST(3))
 s %mmmsqld(50)=$p(PLIST(1),"||"),PLIST(2)=$p(PLIST(1),"||",2),PLIST(3)=$p(PLIST(1),"||",3)
 i %mmmsqld(50)'="",PLIST(2)'="",PLIST(3)'="",$d(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 e  g %0ZBk2
 s %mmmsqld(65)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 s PLIST(4)=$p(%mmmsqld(65),"\",1) s PLIST(5)=$p(%mmmsqld(65),"\",2) s PLIST(6)=$p(%mmmsqld(65),"\",3) s PLIST(7)=$p(%mmmsqld(65),"\",8) s PLIST(8)=$p(%mmmsqld(65),"\",4) s PLIST(14)=$p(%mmmsqld(65),"\",13) s PLIST(15)=$p(%mmmsqld(65),"\",9) s PLIST(16)=$p(%mmmsqld(65),"\",12) s PLIST(17)=$p(%mmmsqld(65),"\",5) s PLIST(18)=$p(%mmmsqld(65),"\",7) s PLIST(19)=$p(%mmmsqld(65),"\",14) s PLIST(20)=$p(%mmmsqld(65),"\",6) s PLIST(21)=$p(%mmmsqld(65),"\",10) s PLIST(22)=$p(%mmmsqld(65),"\",11) s PLIST(24)=$p(%mmmsqld(65),"\",15) s PLIST(26)=$p(%mmmsqld(65),"\",16) s PLIST(27)=$p(%mmmsqld(65),"\",17) s PLIST(28)=$p(%mmmsqld(65),"\",18) s PLIST(32)=$p(%mmmsqld(65),"\",22) s PLIST(33)=$p(%mmmsqld(65),"\",19) s PLIST(34)=$p(%mmmsqld(65),"\",20) s PLIST(35)=$p(%mmmsqld(65),"\",21) s PLIST(36)=$p(%mmmsqld(65),"\",23) s PLIST(37)=$p(%mmmsqld(65),"\",24) s PLIST(38)=$p(%mmmsqld(65),"\",25) s PLIST(39)=$p(%mmmsqld(65),"\",26) s PLIST(40)=$p(%mmmsqld(65),"\",27) s PLIST(41)=$p(%mmmsqld(65),"\",28) s PLIST(42)=$p(%mmmsqld(65),"\",29) s PLIST(43)=$p(%mmmsqld(65),"\",30) s PLIST(44)=$p(%mmmsqld(65),"\",31) s PLIST(45)=$p(%mmmsqld(65),"\",32)
 s %mmmsqld(65)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"ADDR"))
 s PLIST(9)=$p(%mmmsqld(65),"\",1) s PLIST(10)=$p(%mmmsqld(65),"\",2) s PLIST(11)=$p(%mmmsqld(65),"\",3) s PLIST(12)=$p(%mmmsqld(65),"\",4) s PLIST(13)=$p(%mmmsqld(65),"\",5) s PLIST(31)=$p(%mmmsqld(65),"\",6)
 s PLIST(23)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"EXTRA"))
 s PLIST(0)=$p(PLIST(1),"||")
 s PLIST(25)=$g(PLIST(0)) s PLIST(29)=$$CT029^at316($g(PLIST(1))) s PLIST(30)=$$CT030^at316($g(PLIST(1)))
 g:$zu(115,2)=0 %0ZBuncommitted i $zu(115,2)=1 l +^THOS($p(PLIST(1),"||",1),"PATIENT",$p(PLIST(1),"||",2),$p(PLIST(1),"||",3))#"S":$zu(115,4) i $t { s %mmmsqld(51)=1,%mmmsqld(52)=$name(^THOS($p(PLIST(1),"||",1),"PATIENT",$p(PLIST(1),"||",2),$p(PLIST(1),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_PLIST(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %mmmsqld(50)=$p(PLIST(1),"||"),PLIST(2)=$p(PLIST(1),"||",2),PLIST(3)=$p(PLIST(1),"||",3)
 i %mmmsqld(50)'="",PLIST(2)'="",PLIST(3)'="",$d(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 e  g %0ZCdun
 s %mmmsqld(72)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3)))
 s PLIST(4)=$p(%mmmsqld(72),"\",1) s PLIST(5)=$p(%mmmsqld(72),"\",2) s PLIST(6)=$p(%mmmsqld(72),"\",3) s PLIST(7)=$p(%mmmsqld(72),"\",8) s PLIST(8)=$p(%mmmsqld(72),"\",4) s PLIST(14)=$p(%mmmsqld(72),"\",13) s PLIST(15)=$p(%mmmsqld(72),"\",9) s PLIST(16)=$p(%mmmsqld(72),"\",12) s PLIST(17)=$p(%mmmsqld(72),"\",5) s PLIST(18)=$p(%mmmsqld(72),"\",7) s PLIST(19)=$p(%mmmsqld(72),"\",14) s PLIST(20)=$p(%mmmsqld(72),"\",6) s PLIST(21)=$p(%mmmsqld(72),"\",10) s PLIST(22)=$p(%mmmsqld(72),"\",11) s PLIST(24)=$p(%mmmsqld(72),"\",15) s PLIST(26)=$p(%mmmsqld(72),"\",16) s PLIST(27)=$p(%mmmsqld(72),"\",17) s PLIST(28)=$p(%mmmsqld(72),"\",18) s PLIST(32)=$p(%mmmsqld(72),"\",22) s PLIST(33)=$p(%mmmsqld(72),"\",19) s PLIST(34)=$p(%mmmsqld(72),"\",20) s PLIST(35)=$p(%mmmsqld(72),"\",21) s PLIST(36)=$p(%mmmsqld(72),"\",23) s PLIST(37)=$p(%mmmsqld(72),"\",24) s PLIST(38)=$p(%mmmsqld(72),"\",25) s PLIST(39)=$p(%mmmsqld(72),"\",26) s PLIST(40)=$p(%mmmsqld(72),"\",27) s PLIST(41)=$p(%mmmsqld(72),"\",28) s PLIST(42)=$p(%mmmsqld(72),"\",29) s PLIST(43)=$p(%mmmsqld(72),"\",30) s PLIST(44)=$p(%mmmsqld(72),"\",31) s PLIST(45)=$p(%mmmsqld(72),"\",32)
 s %mmmsqld(72)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"ADDR"))
 s PLIST(9)=$p(%mmmsqld(72),"\",1) s PLIST(10)=$p(%mmmsqld(72),"\",2) s PLIST(11)=$p(%mmmsqld(72),"\",3) s PLIST(12)=$p(%mmmsqld(72),"\",4) s PLIST(13)=$p(%mmmsqld(72),"\",5) s PLIST(31)=$p(%mmmsqld(72),"\",6)
 s PLIST(23)=$g(^THOS(%mmmsqld(50),"PATIENT",PLIST(2),PLIST(3),"EXTRA"))
 s PLIST(0)=$p(PLIST(1),"||")
 s PLIST(25)=$g(PLIST(0)) s PLIST(29)=$$CT029^at316($g(PLIST(1))) s PLIST(30)=$$CT030^at316($g(PLIST(1)))
%0ZBuncommitted ;
 s SQLCODE=0 g %0Zc
%0ZCdun i $zu(115,2)=1,$g(%mmmsqld(51))=1 { l -@%mmmsqld(52) s %mmmsqld(51)=0 }
 g %0ZBk2
%0ZBdun 
%0ZAdun 
%0Zc s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(51))=1 { l -@%mmmsqld(52) } q
%0Zerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %0Zc
]]></Routine>
</Export>
