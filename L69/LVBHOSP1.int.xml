<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Routine name="LVBHOSP1" type="INT" languagemode="0" generated="1"><![CDATA[
LVBHOSP1  ; IG 29/4/98 ; MVB Control code access for HOS_HospitalPatients
 ;
 ; supported calls:
 ;
 ; $$select^LVBHOSP1(ROWID)
 ; $$open^LVBHOSP1(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9)
 ; $$fetch^LVBHOSP1(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9)
 ; $$fetchbuffer^LVBHOSP1(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9)
 ; $$fetchall^LVBHOSP1(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9)
 ; $$close^LVBHOSP1()
 ; $$insert^LVBHOSP1(par)
 ; $$update^LVBHOSP1(ROWID)
 ; $$delete^LVBHOSP1(ROWID)
 ;
  ;---&SQL(DECLARE HOSP3 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE HOSP_DOB = :dob)
   ;--- ** SQL PUBLIC Variables: SQLCODE, dob
 ;
  ;---&SQL(DECLARE HOSP4 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE HOSP_Sex_DR = :sex)
   ;--- ** SQL PUBLIC Variables: SQLCODE, sex
 ;        
  ;---&SQL(DECLARE HOSP6 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE ((%ALPHAUP(HOSP_Surname) %STARTSWITH :sname))
   ;---         AND ((%ALPHAUP(HOSP_GivenName) %STARTSWITH :gname))
   ;---         AND ((HOSP_Sex_DR = :sex) OR (:sex IS NULL)))
   ;--- ** SQL PUBLIC Variables: SQLCODE, gname, sex, sname
 ;
  ;---&SQL(DECLARE HOSP7 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE ((%ALPHAUP(HOSP_DebtorNumber) %STARTSWITH :mrn)))
   ;--- ** SQL PUBLIC Variables: SQLCODE, mrn
 ;
  ;---&SQL(DECLARE HOSP8 CURSOR FOR SELECT * FROM HOS_HospitalPatients
   ;---         WHERE HOSP_Visit = :vis)
   ;--- ** SQL PUBLIC Variables: SQLCODE, vis
 ; Open the cursor
open(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9) 
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),mrn=$g(mrn),vis=$g(vis)
 s mrn=$$ALPHAUP^SSUTIL4(mrn)
 s sex=$$ALPHAUP^SSUTIL4(sex)
  ;---i vis'="" &SQL(OPEN HOSP8) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i vis'="" Do %HOSP80o q 0
  ;---i mrn'="" &SQL(OPEN HOSP7) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i mrn'="" Do %HOSP70o q 0
  ;---i dob'="",(sname_gname)="" &SQL(OPEN HOSP3) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i dob'="",(sname_gname)="" Do %HOSP30o q 0
  ;---i (sname_gname)="",sex'="" &SQL(OPEN HOSP4) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i (sname_gname)="",sex'="" Do %HOSP40o q 0
  ;---i par="",(sname_gname)'="" &SQL(OPEN HOSP6) q 0
   ;--- ** SQL PUBLIC Variables: SQLCODE
 i par="",(sname_gname)'="" Do %HOSP60o q 0
 q $$open^LVBHOSP(par,gname,sname,dob,sex,"",$g(p6),$g(p7),$g(p8),$g(p9))
 Q 0
 ;
 ; Fetch the data
fetch(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9) K PLIST 
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex),mrn=$g(mrn),vis=$g(vis)
 s sex=$$ALPHAUP^SSUTIL4(sex)
 s mrn=$$ALPHAUP^SSUTIL4(mrn)
nx d
 . ;---i vis'="" &SQL(FETCH HOSP8 INTO :PLIST() ) q 
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i vis'="" Do %0Po q 
 . ;---i mrn'="" &SQL(FETCH HOSP7 INTO :PLIST()) q 
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i mrn'="" Do %0Qo q 
 . ;---i dob'="",(sname_gname)="" &SQL(FETCH HOSP3 INTO :PLIST()) q 
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i dob'="",(sname_gname)="" Do %0Ro q 
 . ;---i (sname_gname)="",sex'="" &SQL(FETCH HOSP4 INTO :PLIST()) q 
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i (sname_gname)="",sex'="" Do %0So q 
 . ;---i par="",(sname_gname)'="" &SQL(FETCH HOSP6 INTO :PLIST()) q
  . ;--- ** SQL PUBLIC Variables: PLIST, SQLCODE
 .i par="",(sname_gname)'="" Do %0To q
 .s SQLCODE=$$fetch^LVBHOSP(par,gname,sname,dob,sex,"",$g(p6),$g(p7),$g(p8),$g(p9))
 i 'SQLCODE,$$val(par,gname,sname,dob,sex,mrn,vis,$g(PLIST(1))) g nx
 S PLIST=$o(PLIST(""),-1) 
 I 'SQLCODE D adjust 
 q SQLCODE 
 ; Fetch all data
fetchbuffer(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9) k ^TMP($zn,$j)
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex)
 s max=$s($g(PLIST(1)):PLIST(1),1:100) i max>100 s max=100
 f xxx=1:1:max s SQLCODE=$$fetch(par,gname,sname,dob,sex,mrn,vis) q:SQLCODE  d
 .s cnt=$o(^TMP($zn,$j,""),-1)+1 f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 k PLIST m PLIST=^TMP($zn,$j) k ^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 q SQLCODE
fetchall(par,gname,sname,dob,sex,mrn,vis,p7,p8,p9) N (par,gname,sname,dob,sex,PLIST,vis,mrn) K ^TMP($zn,$j)
 s par=$g(par),gname=$$ALPHAUP^SSUTIL4($g(gname)),sname=$$ALPHAUP^SSUTIL4($g(sname)),dob=$g(dob),sex=$g(sex)
 i $$open(par,gname,sname,dob,sex,mrn,vis)
 f cnt=1:1 Q:$$fetch(par,gname,sname,dob,sex,mrn,vis)  s ^TMP($zn,$j,cnt)="" f j=1:1:PLIST s $p(^TMP($zn,$j,cnt),$c(28),j)=$g(PLIST(j))
 i $$close()
 k PLIST M PLIST=^TMP($zn,$j)
 s PLIST=$o(PLIST(""),-1)
 k ^TMP($zn,$j)
 q 0
 ;
 ; Close the cursor 
close()  ;---&SQL(CLOSE HOSP4)
  ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP40c
  ;---&SQL(CLOSE HOSP3) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP30c 
  ;---&SQL(CLOSE HOSP6) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP60c 
  ;---&SQL(CLOSE HOSP7) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP70c 
  ;---&SQL(CLOSE HOSP8) 
   ;--- ** SQL PUBLIC Variables: SQLCODE
 Do %HOSP80c 
 q $$close^LVBHOSP()
 q 0
 ;
 ;
adjust d PostSQL^SSUTIL4("")
 d adjust^LVBHOSP
 q
val(par,gname,sname,dob,sex,mrn,vis,row) ;validate row
 ;0-valid,100-invalid
 n (par,gname,sname,dob,sex,mrn,vis,row)
  ;---&SQL(SELECT HOSP_RowId 
   ;--- FROM HOS_HospitalPatients 
   ;---         WHERE HOSP_RowID=:row
   ;---         AND ((%ALPHAUP(HOSP_Surname) %STARTSWITH :sname))
   ;---         AND ((%ALPHAUP(HOSP_GivenName) %STARTSWITH :gname))
   ;---         AND ((HOSP_DOB = :dob) OR (:dob IS NULL))
   ;---         AND ((HOSP_Sex_DR = :sex) OR (:sex IS NULL))
   ;---         AND ((%ALPHAUP(HOSP_DebtorNumber) %STARTSWITH :mrn))
   ;---         AND ((HOSP_ParRef = :par) OR (:par is NULL))
   ;---         AND ((HOSP_Visit = :vis) OR (:vis is NULL)))
   ;--- ** SQL PUBLIC Variables: SQLCODE, dob, gname, mrn, par, row, sex, sname, vis
 Do %0Zo
 q SQLCODE
%HOSP30o s $zt="%HOSP30E" s SQLCODE=$s($g(%HOSP30c):-101,1:0) q:SQLCODE'=0  s %HOSP30d(49)=0 s %HOSP30d(50)=0,%HOSP30d(51)=""
 s %HOSP30d(44)=$g(dob)
 s %HOSP30c=1 q
%HOSP30E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP30c,%HOSP30d,%HOSP30E,%HOSP30l,%HOSP30n,%HOSP30R,%HOSP30Z q
%0Afirst 
 ; asl MOD# 2
 s %HOSP30d(8)=%HOSP30d(44)
 i %HOSP30d(8)="" g %0ABdun
 i '(%HOSP30d(8)'="") g %0ABdun
 s %HOSP30d(1)=""
%0ABk1 s %HOSP30d(1)=$o(^THOSi("DOB",%HOSP30d(8),%HOSP30d(1)))
 i %HOSP30d(1)="" g %0ABdun
 s %HOSP30d(3)=""
%0ABk2 s %HOSP30d(3)=$o(^THOSi("DOB",%HOSP30d(8),%HOSP30d(1),%HOSP30d(3)))
 i %HOSP30d(3)="" g %0ABk1
 s %HOSP30d(4)=""
%0ABk3 s %HOSP30d(4)=$o(^THOSi("DOB",%HOSP30d(8),%HOSP30d(1),%HOSP30d(3),%HOSP30d(4)))
 i %HOSP30d(4)="" g %0ABk2
 s %HOSP30d(2)=(%HOSP30d(1))_"||"_(%HOSP30d(3))_"||"_(%HOSP30d(4))
 s %HOSP30d(46)=$p(%HOSP30d(2),"||"),%HOSP30d(3)=$p(%HOSP30d(2),"||",2),%HOSP30d(4)=$p(%HOSP30d(2),"||",3)
 i %HOSP30d(46)'="",%HOSP30d(3)'="",%HOSP30d(4)'="",$d(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4)))
 e  g %0ABk3
 s %HOSP30d(65)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4)))
 s %HOSP30d(5)=$p(%HOSP30d(65),"\",1) s %HOSP30d(6)=$p(%HOSP30d(65),"\",2) s %HOSP30d(7)=$p(%HOSP30d(65),"\",3) s %HOSP30d(9)=$p(%HOSP30d(65),"\",4) s %HOSP30d(15)=$p(%HOSP30d(65),"\",13) s %HOSP30d(16)=$p(%HOSP30d(65),"\",9) s %HOSP30d(17)=$p(%HOSP30d(65),"\",12) s %HOSP30d(18)=$p(%HOSP30d(65),"\",5) s %HOSP30d(19)=$p(%HOSP30d(65),"\",7) s %HOSP30d(20)=$p(%HOSP30d(65),"\",14) s %HOSP30d(21)=$p(%HOSP30d(65),"\",6) s %HOSP30d(22)=$p(%HOSP30d(65),"\",10) s %HOSP30d(23)=$p(%HOSP30d(65),"\",11) s %HOSP30d(25)=$p(%HOSP30d(65),"\",15) s %HOSP30d(27)=$p(%HOSP30d(65),"\",16) s %HOSP30d(28)=$p(%HOSP30d(65),"\",17) s %HOSP30d(29)=$p(%HOSP30d(65),"\",18) s %HOSP30d(33)=$p(%HOSP30d(65),"\",22) s %HOSP30d(34)=$p(%HOSP30d(65),"\",19) s %HOSP30d(35)=$p(%HOSP30d(65),"\",20) s %HOSP30d(36)=$p(%HOSP30d(65),"\",21) s %HOSP30d(37)=$p(%HOSP30d(65),"\",23) s %HOSP30d(38)=$p(%HOSP30d(65),"\",24) s %HOSP30d(39)=$p(%HOSP30d(65),"\",25) s %HOSP30d(40)=$p(%HOSP30d(65),"\",26) s %HOSP30d(41)=$p(%HOSP30d(65),"\",27) s %HOSP30d(42)=$p(%HOSP30d(65),"\",28) s %HOSP30d(43)=$p(%HOSP30d(65),"\",29)
 s %HOSP30d(65)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4),"ADDR"))
 s %HOSP30d(10)=$p(%HOSP30d(65),"\",1) s %HOSP30d(11)=$p(%HOSP30d(65),"\",2) s %HOSP30d(12)=$p(%HOSP30d(65),"\",3) s %HOSP30d(13)=$p(%HOSP30d(65),"\",4) s %HOSP30d(14)=$p(%HOSP30d(65),"\",5) s %HOSP30d(32)=$p(%HOSP30d(65),"\",6)
 s %HOSP30d(24)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4),"EXTRA"))
 s %HOSP30d(1)=$p(%HOSP30d(2),"||")
 s %HOSP30d(26)=$g(%HOSP30d(1)) s %HOSP30d(30)=$$CT029^at316($g(%HOSP30d(2))) s %HOSP30d(31)=$$CT030^at316($g(%HOSP30d(2)))
 g:$zu(115,2)=0 %0ABuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP30d(2),"||",1),"PATIENT",$p(%HOSP30d(2),"||",2),$p(%HOSP30d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP30d(50)=1,%HOSP30d(51)=$name(^THOS($p(%HOSP30d(2),"||",1),"PATIENT",$p(%HOSP30d(2),"||",2),$p(%HOSP30d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP30d(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %HOSP30d(47)=$lb(""_%HOSP30d(8))
 s %HOSP30d(46)=$p(%HOSP30d(2),"||"),%HOSP30d(3)=$p(%HOSP30d(2),"||",2),%HOSP30d(4)=$p(%HOSP30d(2),"||",3)
 i %HOSP30d(46)'="",%HOSP30d(3)'="",%HOSP30d(4)'="",$d(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4)))
 e  g %0ACdun
 s %HOSP30d(72)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4)))
 s %HOSP30d(5)=$p(%HOSP30d(72),"\",1) s %HOSP30d(6)=$p(%HOSP30d(72),"\",2) s %HOSP30d(7)=$p(%HOSP30d(72),"\",3) s %HOSP30d(8)=$p(%HOSP30d(72),"\",8) s %HOSP30d(9)=$p(%HOSP30d(72),"\",4) s %HOSP30d(15)=$p(%HOSP30d(72),"\",13) s %HOSP30d(16)=$p(%HOSP30d(72),"\",9) s %HOSP30d(17)=$p(%HOSP30d(72),"\",12) s %HOSP30d(18)=$p(%HOSP30d(72),"\",5) s %HOSP30d(19)=$p(%HOSP30d(72),"\",7) s %HOSP30d(20)=$p(%HOSP30d(72),"\",14) s %HOSP30d(21)=$p(%HOSP30d(72),"\",6) s %HOSP30d(22)=$p(%HOSP30d(72),"\",10) s %HOSP30d(23)=$p(%HOSP30d(72),"\",11) s %HOSP30d(25)=$p(%HOSP30d(72),"\",15) s %HOSP30d(27)=$p(%HOSP30d(72),"\",16) s %HOSP30d(28)=$p(%HOSP30d(72),"\",17) s %HOSP30d(29)=$p(%HOSP30d(72),"\",18) s %HOSP30d(33)=$p(%HOSP30d(72),"\",22) s %HOSP30d(34)=$p(%HOSP30d(72),"\",19) s %HOSP30d(35)=$p(%HOSP30d(72),"\",20) s %HOSP30d(36)=$p(%HOSP30d(72),"\",21) s %HOSP30d(37)=$p(%HOSP30d(72),"\",23) s %HOSP30d(38)=$p(%HOSP30d(72),"\",24) s %HOSP30d(39)=$p(%HOSP30d(72),"\",25) s %HOSP30d(40)=$p(%HOSP30d(72),"\",26) s %HOSP30d(41)=$p(%HOSP30d(72),"\",27) s %HOSP30d(42)=$p(%HOSP30d(72),"\",28) s %HOSP30d(43)=$p(%HOSP30d(72),"\",29)
 s %HOSP30d(72)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4),"ADDR"))
 s %HOSP30d(10)=$p(%HOSP30d(72),"\",1) s %HOSP30d(11)=$p(%HOSP30d(72),"\",2) s %HOSP30d(12)=$p(%HOSP30d(72),"\",3) s %HOSP30d(13)=$p(%HOSP30d(72),"\",4) s %HOSP30d(14)=$p(%HOSP30d(72),"\",5) s %HOSP30d(32)=$p(%HOSP30d(72),"\",6)
 s %HOSP30d(24)=$g(^THOS(%HOSP30d(46),"PATIENT",%HOSP30d(3),%HOSP30d(4),"EXTRA"))
 s %HOSP30d(1)=$p(%HOSP30d(2),"||")
 s %HOSP30d(26)=$g(%HOSP30d(1)) s %HOSP30d(30)=$$CT029^at316($g(%HOSP30d(2))) s %HOSP30d(31)=$$CT030^at316($g(%HOSP30d(2)))
 s %HOSP30d(48)=$lb(""_%HOSP30d(8))
 g:%HOSP30d(47)'=%HOSP30d(48) %0ACdun
%0ABuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP30d(49)=%HOSP30d(49)+1,%ROWCOUNT=%HOSP30d(49),%ROWID=%HOSP30d(2),%HOSP30c=10 q
%HOSP30f i '$g(%HOSP30c) { s SQLCODE=-102 q  } i %HOSP30c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Aerr" i $d(%0CacheRowLimit)#2,$g(%HOSP30d(49))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP30d(49),%HOSP30c=100 q  } g %0Afirst:%HOSP30c=1
%0ACdun i $zu(115,2)=1,$g(%HOSP30d(50))=1 { l -@%HOSP30d(51) s %HOSP30d(50)=0 }
 g %0ABk3
%0ABdun 
%0AAdun 
 s %ROWCOUNT=%HOSP30d(49),SQLCODE=100,%HOSP30c=100 q
%HOSP30c i '$g(%HOSP30c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP30d(49)),1:0)
 i $zu(115,2)=1,$g(%HOSP30d(50))=1 { l -@%HOSP30d(51) } k %HOSP30c,%HOSP30d,%HOSP30E,%HOSP30l,%HOSP30n,%HOSP30R,%HOSP30Z s SQLCODE=0 q
%0Aerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP30c=100 q
%HOSP40o s $zt="%HOSP40E" s SQLCODE=$s($g(%HOSP40c):-101,1:0) q:SQLCODE'=0  s %HOSP40d(49)=0 s %HOSP40d(50)=0,%HOSP40d(51)=""
 s %HOSP40d(44)=$g(sex)
 s %HOSP40c=1 q
%HOSP40E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP40c,%HOSP40d,%HOSP40E,%HOSP40l,%HOSP40n,%HOSP40R,%HOSP40Z q
%0Cfirst 
 ; asl MOD# 2
 s %HOSP40d(9)=%HOSP40d(44)
 i %HOSP40d(9)="" g %0CBdun
 i '(%HOSP40d(9)'="") g %0CBdun
 s %HOSP40d(1)=""
%0CBk1 s %HOSP40d(1)=$o(^THOSi("SEX",%HOSP40d(9),%HOSP40d(1)))
 i %HOSP40d(1)="" g %0CBdun
 s %HOSP40d(3)=""
%0CBk2 s %HOSP40d(3)=$o(^THOSi("SEX",%HOSP40d(9),%HOSP40d(1),%HOSP40d(3)))
 i %HOSP40d(3)="" g %0CBk1
 s %HOSP40d(4)=""
%0CBk3 s %HOSP40d(4)=$o(^THOSi("SEX",%HOSP40d(9),%HOSP40d(1),%HOSP40d(3),%HOSP40d(4)))
 i %HOSP40d(4)="" g %0CBk2
 s %HOSP40d(2)=(%HOSP40d(1))_"||"_(%HOSP40d(3))_"||"_(%HOSP40d(4))
 s %HOSP40d(46)=$p(%HOSP40d(2),"||"),%HOSP40d(3)=$p(%HOSP40d(2),"||",2),%HOSP40d(4)=$p(%HOSP40d(2),"||",3)
 i %HOSP40d(46)'="",%HOSP40d(3)'="",%HOSP40d(4)'="",$d(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4)))
 e  g %0CBk3
 s %HOSP40d(65)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4)))
 s %HOSP40d(5)=$p(%HOSP40d(65),"\",1) s %HOSP40d(6)=$p(%HOSP40d(65),"\",2) s %HOSP40d(7)=$p(%HOSP40d(65),"\",3) s %HOSP40d(8)=$p(%HOSP40d(65),"\",8) s %HOSP40d(15)=$p(%HOSP40d(65),"\",13) s %HOSP40d(16)=$p(%HOSP40d(65),"\",9) s %HOSP40d(17)=$p(%HOSP40d(65),"\",12) s %HOSP40d(18)=$p(%HOSP40d(65),"\",5) s %HOSP40d(19)=$p(%HOSP40d(65),"\",7) s %HOSP40d(20)=$p(%HOSP40d(65),"\",14) s %HOSP40d(21)=$p(%HOSP40d(65),"\",6) s %HOSP40d(22)=$p(%HOSP40d(65),"\",10) s %HOSP40d(23)=$p(%HOSP40d(65),"\",11) s %HOSP40d(25)=$p(%HOSP40d(65),"\",15) s %HOSP40d(27)=$p(%HOSP40d(65),"\",16) s %HOSP40d(28)=$p(%HOSP40d(65),"\",17) s %HOSP40d(29)=$p(%HOSP40d(65),"\",18) s %HOSP40d(33)=$p(%HOSP40d(65),"\",22) s %HOSP40d(34)=$p(%HOSP40d(65),"\",19) s %HOSP40d(35)=$p(%HOSP40d(65),"\",20) s %HOSP40d(36)=$p(%HOSP40d(65),"\",21) s %HOSP40d(37)=$p(%HOSP40d(65),"\",23) s %HOSP40d(38)=$p(%HOSP40d(65),"\",24) s %HOSP40d(39)=$p(%HOSP40d(65),"\",25) s %HOSP40d(40)=$p(%HOSP40d(65),"\",26) s %HOSP40d(41)=$p(%HOSP40d(65),"\",27) s %HOSP40d(42)=$p(%HOSP40d(65),"\",28) s %HOSP40d(43)=$p(%HOSP40d(65),"\",29)
 s %HOSP40d(65)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4),"ADDR"))
 s %HOSP40d(10)=$p(%HOSP40d(65),"\",1) s %HOSP40d(11)=$p(%HOSP40d(65),"\",2) s %HOSP40d(12)=$p(%HOSP40d(65),"\",3) s %HOSP40d(13)=$p(%HOSP40d(65),"\",4) s %HOSP40d(14)=$p(%HOSP40d(65),"\",5) s %HOSP40d(32)=$p(%HOSP40d(65),"\",6)
 s %HOSP40d(24)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4),"EXTRA"))
 s %HOSP40d(1)=$p(%HOSP40d(2),"||")
 s %HOSP40d(26)=$g(%HOSP40d(1)) s %HOSP40d(30)=$$CT029^at316($g(%HOSP40d(2))) s %HOSP40d(31)=$$CT030^at316($g(%HOSP40d(2)))
 g:$zu(115,2)=0 %0CBuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP40d(2),"||",1),"PATIENT",$p(%HOSP40d(2),"||",2),$p(%HOSP40d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP40d(50)=1,%HOSP40d(51)=$name(^THOS($p(%HOSP40d(2),"||",1),"PATIENT",$p(%HOSP40d(2),"||",2),$p(%HOSP40d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP40d(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %HOSP40d(47)=$lb(""_%HOSP40d(9))
 s %HOSP40d(46)=$p(%HOSP40d(2),"||"),%HOSP40d(3)=$p(%HOSP40d(2),"||",2),%HOSP40d(4)=$p(%HOSP40d(2),"||",3)
 i %HOSP40d(46)'="",%HOSP40d(3)'="",%HOSP40d(4)'="",$d(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4)))
 e  g %0CCdun
 s %HOSP40d(72)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4)))
 s %HOSP40d(5)=$p(%HOSP40d(72),"\",1) s %HOSP40d(6)=$p(%HOSP40d(72),"\",2) s %HOSP40d(7)=$p(%HOSP40d(72),"\",3) s %HOSP40d(8)=$p(%HOSP40d(72),"\",8) s %HOSP40d(9)=$p(%HOSP40d(72),"\",4) s %HOSP40d(15)=$p(%HOSP40d(72),"\",13) s %HOSP40d(16)=$p(%HOSP40d(72),"\",9) s %HOSP40d(17)=$p(%HOSP40d(72),"\",12) s %HOSP40d(18)=$p(%HOSP40d(72),"\",5) s %HOSP40d(19)=$p(%HOSP40d(72),"\",7) s %HOSP40d(20)=$p(%HOSP40d(72),"\",14) s %HOSP40d(21)=$p(%HOSP40d(72),"\",6) s %HOSP40d(22)=$p(%HOSP40d(72),"\",10) s %HOSP40d(23)=$p(%HOSP40d(72),"\",11) s %HOSP40d(25)=$p(%HOSP40d(72),"\",15) s %HOSP40d(27)=$p(%HOSP40d(72),"\",16) s %HOSP40d(28)=$p(%HOSP40d(72),"\",17) s %HOSP40d(29)=$p(%HOSP40d(72),"\",18) s %HOSP40d(33)=$p(%HOSP40d(72),"\",22) s %HOSP40d(34)=$p(%HOSP40d(72),"\",19) s %HOSP40d(35)=$p(%HOSP40d(72),"\",20) s %HOSP40d(36)=$p(%HOSP40d(72),"\",21) s %HOSP40d(37)=$p(%HOSP40d(72),"\",23) s %HOSP40d(38)=$p(%HOSP40d(72),"\",24) s %HOSP40d(39)=$p(%HOSP40d(72),"\",25) s %HOSP40d(40)=$p(%HOSP40d(72),"\",26) s %HOSP40d(41)=$p(%HOSP40d(72),"\",27) s %HOSP40d(42)=$p(%HOSP40d(72),"\",28) s %HOSP40d(43)=$p(%HOSP40d(72),"\",29)
 s %HOSP40d(72)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4),"ADDR"))
 s %HOSP40d(10)=$p(%HOSP40d(72),"\",1) s %HOSP40d(11)=$p(%HOSP40d(72),"\",2) s %HOSP40d(12)=$p(%HOSP40d(72),"\",3) s %HOSP40d(13)=$p(%HOSP40d(72),"\",4) s %HOSP40d(14)=$p(%HOSP40d(72),"\",5) s %HOSP40d(32)=$p(%HOSP40d(72),"\",6)
 s %HOSP40d(24)=$g(^THOS(%HOSP40d(46),"PATIENT",%HOSP40d(3),%HOSP40d(4),"EXTRA"))
 s %HOSP40d(1)=$p(%HOSP40d(2),"||")
 s %HOSP40d(26)=$g(%HOSP40d(1)) s %HOSP40d(30)=$$CT029^at316($g(%HOSP40d(2))) s %HOSP40d(31)=$$CT030^at316($g(%HOSP40d(2)))
 s %HOSP40d(48)=$lb(""_%HOSP40d(9))
 g:%HOSP40d(47)'=%HOSP40d(48) %0CCdun
%0CBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP40d(49)=%HOSP40d(49)+1,%ROWCOUNT=%HOSP40d(49),%ROWID=%HOSP40d(2),%HOSP40c=10 q
%HOSP40f i '$g(%HOSP40c) { s SQLCODE=-102 q  } i %HOSP40c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Cerr" i $d(%0CacheRowLimit)#2,$g(%HOSP40d(49))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP40d(49),%HOSP40c=100 q  } g %0Cfirst:%HOSP40c=1
%0CCdun i $zu(115,2)=1,$g(%HOSP40d(50))=1 { l -@%HOSP40d(51) s %HOSP40d(50)=0 }
 g %0CBk3
%0CBdun 
%0CAdun 
 s %ROWCOUNT=%HOSP40d(49),SQLCODE=100,%HOSP40c=100 q
%HOSP40c i '$g(%HOSP40c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP40d(49)),1:0)
 i $zu(115,2)=1,$g(%HOSP40d(50))=1 { l -@%HOSP40d(51) } k %HOSP40c,%HOSP40d,%HOSP40E,%HOSP40l,%HOSP40n,%HOSP40R,%HOSP40Z s SQLCODE=0 q
%0Cerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP40c=100 q
%HOSP60o s $zt="%HOSP60E" s SQLCODE=$s($g(%HOSP60c):-101,1:0) q:SQLCODE'=0  s %HOSP60d(54)=0 s %HOSP60d(55)=0,%HOSP60d(56)=""
 s %HOSP60d(45)=$g(sname),%HOSP60d(47)=$g(gname),%HOSP60d(48)=$g(sex),%HOSP60d(49)=$g(sex)
 s %HOSP60c=1 q
%HOSP60E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP60c,%HOSP60d,%HOSP60E,%HOSP60l,%HOSP60n,%HOSP60R,%HOSP60Z q
%0Efirst 
 ; asl MOD# 2
 s %HOSP60d(1)=""
%0EBk1 s %HOSP60d(1)=$o(^THOS(%HOSP60d(1)))
 i %HOSP60d(1)="" g %0EBdun
 s %HOSP60d(3)=""
%0EBk2 s %HOSP60d(3)=$o(^THOS(%HOSP60d(1),"PATIENT",%HOSP60d(3)))
 i %HOSP60d(3)="" g %0EBk1
 s %HOSP60d(4)=""
%0EBk3 s %HOSP60d(4)=$o(^THOS(%HOSP60d(1),"PATIENT",%HOSP60d(3),%HOSP60d(4)))
 i %HOSP60d(4)="" g %0EBk2
 s %HOSP60d(63)=$g(^THOS(%HOSP60d(1),"PATIENT",%HOSP60d(3),%HOSP60d(4)))
 s %HOSP60d(9)=$p(%HOSP60d(63),"\",4)
 g:'(((%HOSP60d(9)'="")&&(%HOSP60d(9)=%HOSP60d(48)))||(%HOSP60d(49)="")) %0EBk3
 s %HOSP60d(5)=$p(%HOSP60d(63),"\",1) s %HOSP60d(6)=$p(%HOSP60d(63),"\",2) s %HOSP60d(7)=$p(%HOSP60d(63),"\",3) s %HOSP60d(8)=$p(%HOSP60d(63),"\",8) s %HOSP60d(15)=$p(%HOSP60d(63),"\",13) s %HOSP60d(16)=$p(%HOSP60d(63),"\",9) s %HOSP60d(17)=$p(%HOSP60d(63),"\",12) s %HOSP60d(18)=$p(%HOSP60d(63),"\",5) s %HOSP60d(19)=$p(%HOSP60d(63),"\",7) s %HOSP60d(20)=$p(%HOSP60d(63),"\",14) s %HOSP60d(21)=$p(%HOSP60d(63),"\",6) s %HOSP60d(22)=$p(%HOSP60d(63),"\",10) s %HOSP60d(23)=$p(%HOSP60d(63),"\",11) s %HOSP60d(25)=$p(%HOSP60d(63),"\",15) s %HOSP60d(27)=$p(%HOSP60d(63),"\",16) s %HOSP60d(28)=$p(%HOSP60d(63),"\",17) s %HOSP60d(29)=$p(%HOSP60d(63),"\",18) s %HOSP60d(33)=$p(%HOSP60d(63),"\",22) s %HOSP60d(34)=$p(%HOSP60d(63),"\",19) s %HOSP60d(35)=$p(%HOSP60d(63),"\",20) s %HOSP60d(36)=$p(%HOSP60d(63),"\",21) s %HOSP60d(37)=$p(%HOSP60d(63),"\",23) s %HOSP60d(38)=$p(%HOSP60d(63),"\",24) s %HOSP60d(39)=$p(%HOSP60d(63),"\",25) s %HOSP60d(40)=$p(%HOSP60d(63),"\",26) s %HOSP60d(41)=$p(%HOSP60d(63),"\",27) s %HOSP60d(42)=$p(%HOSP60d(63),"\",28) s %HOSP60d(43)=$p(%HOSP60d(63),"\",29)
 s %HOSP60d(63)=$g(^THOS(%HOSP60d(1),"PATIENT",%HOSP60d(3),%HOSP60d(4),"ADDR"))
 s %HOSP60d(10)=$p(%HOSP60d(63),"\",1) s %HOSP60d(11)=$p(%HOSP60d(63),"\",2) s %HOSP60d(12)=$p(%HOSP60d(63),"\",3) s %HOSP60d(13)=$p(%HOSP60d(63),"\",4) s %HOSP60d(14)=$p(%HOSP60d(63),"\",5) s %HOSP60d(32)=$p(%HOSP60d(63),"\",6)
 s %HOSP60d(24)=$g(^THOS(%HOSP60d(1),"PATIENT",%HOSP60d(3),%HOSP60d(4),"EXTRA"))
 s %HOSP60d(2)=(%HOSP60d(1))_"||"_(%HOSP60d(3))_"||"_(%HOSP60d(4))
 s %HOSP60d(1)=$p(%HOSP60d(2),"||")
 s %HOSP60d(26)=$g(%HOSP60d(1)) s %HOSP60d(30)=$$CT029^at316($g(%HOSP60d(2))) s %HOSP60d(31)=$$CT030^at316($g(%HOSP60d(2))) s %HOSP60d(46)=$zu(28,%HOSP60d(5),6) s %HOSP60d(44)=$zu(28,%HOSP60d(6),6)
 g:'(($c(0)[%HOSP60d(45))||(%HOSP60d(45)=$c(32,0)&&($e(%HOSP60d(44))=$c(32)))||(%HOSP60d(45)=$e(%HOSP60d(44),1,$l(%HOSP60d(45))))) %0EBk3
 g:'(($c(0)[%HOSP60d(47))||(%HOSP60d(47)=$c(32,0)&&($e(%HOSP60d(46))=$c(32)))||(%HOSP60d(47)=$e(%HOSP60d(46),1,$l(%HOSP60d(47))))) %0EBk3
 g:'(%HOSP60d(44)'="") %0EBk3
 g:'(%HOSP60d(46)'="") %0EBk3
 g:$zu(115,2)=0 %0EBuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP60d(2),"||",1),"PATIENT",$p(%HOSP60d(2),"||",2),$p(%HOSP60d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP60d(55)=1,%HOSP60d(56)=$name(^THOS($p(%HOSP60d(2),"||",1),"PATIENT",$p(%HOSP60d(2),"||",2),$p(%HOSP60d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP60d(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %HOSP60d(51)=$lb(""_%HOSP60d(46),""_%HOSP60d(44),""_%HOSP60d(9))
 s %HOSP60d(52)=$p(%HOSP60d(2),"||"),%HOSP60d(3)=$p(%HOSP60d(2),"||",2),%HOSP60d(4)=$p(%HOSP60d(2),"||",3)
 i %HOSP60d(52)'="",%HOSP60d(3)'="",%HOSP60d(4)'="",$d(^THOS(%HOSP60d(52),"PATIENT",%HOSP60d(3),%HOSP60d(4)))
 e  g %0ECdun
 s %HOSP60d(70)=$g(^THOS(%HOSP60d(52),"PATIENT",%HOSP60d(3),%HOSP60d(4)))
 s %HOSP60d(5)=$p(%HOSP60d(70),"\",1) s %HOSP60d(6)=$p(%HOSP60d(70),"\",2) s %HOSP60d(7)=$p(%HOSP60d(70),"\",3) s %HOSP60d(8)=$p(%HOSP60d(70),"\",8) s %HOSP60d(9)=$p(%HOSP60d(70),"\",4) s %HOSP60d(15)=$p(%HOSP60d(70),"\",13) s %HOSP60d(16)=$p(%HOSP60d(70),"\",9) s %HOSP60d(17)=$p(%HOSP60d(70),"\",12) s %HOSP60d(18)=$p(%HOSP60d(70),"\",5) s %HOSP60d(19)=$p(%HOSP60d(70),"\",7) s %HOSP60d(20)=$p(%HOSP60d(70),"\",14) s %HOSP60d(21)=$p(%HOSP60d(70),"\",6) s %HOSP60d(22)=$p(%HOSP60d(70),"\",10) s %HOSP60d(23)=$p(%HOSP60d(70),"\",11) s %HOSP60d(25)=$p(%HOSP60d(70),"\",15) s %HOSP60d(27)=$p(%HOSP60d(70),"\",16) s %HOSP60d(28)=$p(%HOSP60d(70),"\",17) s %HOSP60d(29)=$p(%HOSP60d(70),"\",18) s %HOSP60d(33)=$p(%HOSP60d(70),"\",22) s %HOSP60d(34)=$p(%HOSP60d(70),"\",19) s %HOSP60d(35)=$p(%HOSP60d(70),"\",20) s %HOSP60d(36)=$p(%HOSP60d(70),"\",21) s %HOSP60d(37)=$p(%HOSP60d(70),"\",23) s %HOSP60d(38)=$p(%HOSP60d(70),"\",24) s %HOSP60d(39)=$p(%HOSP60d(70),"\",25) s %HOSP60d(40)=$p(%HOSP60d(70),"\",26) s %HOSP60d(41)=$p(%HOSP60d(70),"\",27) s %HOSP60d(42)=$p(%HOSP60d(70),"\",28) s %HOSP60d(43)=$p(%HOSP60d(70),"\",29)
 s %HOSP60d(70)=$g(^THOS(%HOSP60d(52),"PATIENT",%HOSP60d(3),%HOSP60d(4),"ADDR"))
 s %HOSP60d(10)=$p(%HOSP60d(70),"\",1) s %HOSP60d(11)=$p(%HOSP60d(70),"\",2) s %HOSP60d(12)=$p(%HOSP60d(70),"\",3) s %HOSP60d(13)=$p(%HOSP60d(70),"\",4) s %HOSP60d(14)=$p(%HOSP60d(70),"\",5) s %HOSP60d(32)=$p(%HOSP60d(70),"\",6)
 s %HOSP60d(24)=$g(^THOS(%HOSP60d(52),"PATIENT",%HOSP60d(3),%HOSP60d(4),"EXTRA"))
 s %HOSP60d(1)=$p(%HOSP60d(2),"||")
 s %HOSP60d(26)=$g(%HOSP60d(1)) s %HOSP60d(30)=$$CT029^at316($g(%HOSP60d(2))) s %HOSP60d(31)=$$CT030^at316($g(%HOSP60d(2))) s %HOSP60d(46)=$zu(28,%HOSP60d(5),6) s %HOSP60d(44)=$zu(28,%HOSP60d(6),6)
 s %HOSP60d(53)=$lb(""_%HOSP60d(46),""_%HOSP60d(44),""_%HOSP60d(9))
 g:%HOSP60d(51)'=%HOSP60d(53) %0ECdun
%0EBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP60d(54)=%HOSP60d(54)+1,%ROWCOUNT=%HOSP60d(54),%ROWID=%HOSP60d(2),%HOSP60c=10 q
%HOSP60f i '$g(%HOSP60c) { s SQLCODE=-102 q  } i %HOSP60c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Eerr" i $d(%0CacheRowLimit)#2,$g(%HOSP60d(54))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP60d(54),%HOSP60c=100 q  } g %0Efirst:%HOSP60c=1
%0ECdun i $zu(115,2)=1,$g(%HOSP60d(55))=1 { l -@%HOSP60d(56) s %HOSP60d(55)=0 }
 g %0EBk3
%0EBdun 
%0EAdun 
 s %ROWCOUNT=%HOSP60d(54),SQLCODE=100,%HOSP60c=100 q
%HOSP60c i '$g(%HOSP60c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP60d(54)),1:0)
 i $zu(115,2)=1,$g(%HOSP60d(55))=1 { l -@%HOSP60d(56) } k %HOSP60c,%HOSP60d,%HOSP60E,%HOSP60l,%HOSP60n,%HOSP60R,%HOSP60Z s SQLCODE=0 q
%0Eerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP60c=100 q
%HOSP70o s $zt="%HOSP70E" s SQLCODE=$s($g(%HOSP70c):-101,1:0) q:SQLCODE'=0  s %HOSP70d(48)=0 s %HOSP70d(49)=0,%HOSP70d(50)=""
 s %HOSP70d(45)=$g(mrn)
 s %HOSP70t(1)=$i(^||%sql.temp)
 s %HOSP70c=1 q
%HOSP70E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP70c,%HOSP70d,%HOSP70E,%HOSP70l,%HOSP70n,%HOSP70R,%HOSP70s,%HOSP70t,%HOSP70Z q
%0Gfirst 
 k ^||%sql.temp(%HOSP70t(1),0) s ^||%sql.temp(%HOSP70t(1),0)=$H_"^"_$J_"^"_$zu(67,11,$j)_"^"_$zu(67,12,$j)_"^"_$zu(67,15,$j)_"^"_$ZN_"^"_$zu(67,6,$j)
 i $sortbegin(^||%sql.temp(%HOSP70t(1),0))
 ; asl MOD# 3
 d %0GBMod
 i $sortend(^||%sql.temp(%HOSP70t(1),0))
 s %HOSP70s(2)=""
%0GCk1 s %HOSP70s(2)=$o(^||%sql.temp(%HOSP70t(1),0,%HOSP70s(2)))
 i %HOSP70s(2)="" g %0GCdun
 s %HOSP70d(2)=$s(%HOSP70s(2)=-1E14:"",1:%HOSP70s(2))
 s %HOSP70d(47)=$p(%HOSP70d(2),"||"),%HOSP70d(3)=$p(%HOSP70d(2),"||",2),%HOSP70d(4)=$p(%HOSP70d(2),"||",3)
 i %HOSP70d(47)'="",%HOSP70d(3)'="",%HOSP70d(4)'="",$d(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4)))
 e  g %0GCk1
 s %HOSP70d(65)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4)))
 s %HOSP70d(5)=$p(%HOSP70d(65),"\",1) s %HOSP70d(6)=$p(%HOSP70d(65),"\",2) s %HOSP70d(7)=$p(%HOSP70d(65),"\",3) s %HOSP70d(8)=$p(%HOSP70d(65),"\",8) s %HOSP70d(9)=$p(%HOSP70d(65),"\",4) s %HOSP70d(15)=$p(%HOSP70d(65),"\",13) s %HOSP70d(16)=$p(%HOSP70d(65),"\",9) s %HOSP70d(17)=$p(%HOSP70d(65),"\",12) s %HOSP70d(18)=$p(%HOSP70d(65),"\",5) s %HOSP70d(19)=$p(%HOSP70d(65),"\",7) s %HOSP70d(20)=$p(%HOSP70d(65),"\",14) s %HOSP70d(21)=$p(%HOSP70d(65),"\",6) s %HOSP70d(22)=$p(%HOSP70d(65),"\",10) s %HOSP70d(23)=$p(%HOSP70d(65),"\",11) s %HOSP70d(25)=$p(%HOSP70d(65),"\",15) s %HOSP70d(27)=$p(%HOSP70d(65),"\",16) s %HOSP70d(28)=$p(%HOSP70d(65),"\",17) s %HOSP70d(29)=$p(%HOSP70d(65),"\",18) s %HOSP70d(33)=$p(%HOSP70d(65),"\",22) s %HOSP70d(34)=$p(%HOSP70d(65),"\",19) s %HOSP70d(35)=$p(%HOSP70d(65),"\",20) s %HOSP70d(36)=$p(%HOSP70d(65),"\",21) s %HOSP70d(37)=$p(%HOSP70d(65),"\",23) s %HOSP70d(38)=$p(%HOSP70d(65),"\",24) s %HOSP70d(39)=$p(%HOSP70d(65),"\",25) s %HOSP70d(40)=$p(%HOSP70d(65),"\",26) s %HOSP70d(41)=$p(%HOSP70d(65),"\",27) s %HOSP70d(42)=$p(%HOSP70d(65),"\",28) s %HOSP70d(43)=$p(%HOSP70d(65),"\",29)
 s %HOSP70d(65)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4),"ADDR"))
 s %HOSP70d(10)=$p(%HOSP70d(65),"\",1) s %HOSP70d(11)=$p(%HOSP70d(65),"\",2) s %HOSP70d(12)=$p(%HOSP70d(65),"\",3) s %HOSP70d(13)=$p(%HOSP70d(65),"\",4) s %HOSP70d(14)=$p(%HOSP70d(65),"\",5) s %HOSP70d(32)=$p(%HOSP70d(65),"\",6)
 s %HOSP70d(24)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4),"EXTRA"))
 s %HOSP70d(1)=$p(%HOSP70d(2),"||")
 s %HOSP70d(26)=$g(%HOSP70d(1)) s %HOSP70d(30)=$$CT029^at316($g(%HOSP70d(2))) s %HOSP70d(31)=$$CT030^at316($g(%HOSP70d(2))) s %HOSP70d(44)=$zu(28,%HOSP70d(3),6)
 g:$zu(115,2)=0 %0GCuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP70d(2),"||",1),"PATIENT",$p(%HOSP70d(2),"||",2),$p(%HOSP70d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP70d(49)=1,%HOSP70d(50)=$name(^THOS($p(%HOSP70d(2),"||",1),"PATIENT",$p(%HOSP70d(2),"||",2),$p(%HOSP70d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP70d(2) ztrap "LOCK"  }
 ; asl MOD# 4
 s %HOSP70d(47)=$p(%HOSP70d(2),"||"),%HOSP70d(3)=$p(%HOSP70d(2),"||",2),%HOSP70d(4)=$p(%HOSP70d(2),"||",3)
 i %HOSP70d(47)'="",%HOSP70d(3)'="",%HOSP70d(4)'="",$d(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4)))
 e  g %0GDdun
 s %HOSP70d(72)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4)))
 s %HOSP70d(5)=$p(%HOSP70d(72),"\",1) s %HOSP70d(6)=$p(%HOSP70d(72),"\",2) s %HOSP70d(7)=$p(%HOSP70d(72),"\",3) s %HOSP70d(8)=$p(%HOSP70d(72),"\",8) s %HOSP70d(9)=$p(%HOSP70d(72),"\",4) s %HOSP70d(15)=$p(%HOSP70d(72),"\",13) s %HOSP70d(16)=$p(%HOSP70d(72),"\",9) s %HOSP70d(17)=$p(%HOSP70d(72),"\",12) s %HOSP70d(18)=$p(%HOSP70d(72),"\",5) s %HOSP70d(19)=$p(%HOSP70d(72),"\",7) s %HOSP70d(20)=$p(%HOSP70d(72),"\",14) s %HOSP70d(21)=$p(%HOSP70d(72),"\",6) s %HOSP70d(22)=$p(%HOSP70d(72),"\",10) s %HOSP70d(23)=$p(%HOSP70d(72),"\",11) s %HOSP70d(25)=$p(%HOSP70d(72),"\",15) s %HOSP70d(27)=$p(%HOSP70d(72),"\",16) s %HOSP70d(28)=$p(%HOSP70d(72),"\",17) s %HOSP70d(29)=$p(%HOSP70d(72),"\",18) s %HOSP70d(33)=$p(%HOSP70d(72),"\",22) s %HOSP70d(34)=$p(%HOSP70d(72),"\",19) s %HOSP70d(35)=$p(%HOSP70d(72),"\",20) s %HOSP70d(36)=$p(%HOSP70d(72),"\",21) s %HOSP70d(37)=$p(%HOSP70d(72),"\",23) s %HOSP70d(38)=$p(%HOSP70d(72),"\",24) s %HOSP70d(39)=$p(%HOSP70d(72),"\",25) s %HOSP70d(40)=$p(%HOSP70d(72),"\",26) s %HOSP70d(41)=$p(%HOSP70d(72),"\",27) s %HOSP70d(42)=$p(%HOSP70d(72),"\",28) s %HOSP70d(43)=$p(%HOSP70d(72),"\",29)
 s %HOSP70d(72)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4),"ADDR"))
 s %HOSP70d(10)=$p(%HOSP70d(72),"\",1) s %HOSP70d(11)=$p(%HOSP70d(72),"\",2) s %HOSP70d(12)=$p(%HOSP70d(72),"\",3) s %HOSP70d(13)=$p(%HOSP70d(72),"\",4) s %HOSP70d(14)=$p(%HOSP70d(72),"\",5) s %HOSP70d(32)=$p(%HOSP70d(72),"\",6)
 s %HOSP70d(24)=$g(^THOS(%HOSP70d(47),"PATIENT",%HOSP70d(3),%HOSP70d(4),"EXTRA"))
 s %HOSP70d(1)=$p(%HOSP70d(2),"||")
 s %HOSP70d(26)=$g(%HOSP70d(1)) s %HOSP70d(30)=$$CT029^at316($g(%HOSP70d(2))) s %HOSP70d(31)=$$CT030^at316($g(%HOSP70d(2))) s %HOSP70d(44)=$zu(28,%HOSP70d(3),6)
 g:'(($c(0)[%HOSP70d(45))||(%HOSP70d(45)=$c(32,0)&&($e(%HOSP70d(44))=$c(32)))||(%HOSP70d(45)=$e(%HOSP70d(44),1,$l(%HOSP70d(45))))) %0GDdun
%0GCuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP70d(48)=%HOSP70d(48)+1,%ROWCOUNT=%HOSP70d(48),%ROWID=%HOSP70d(2),%HOSP70c=10 q
%HOSP70f i '$g(%HOSP70c) { s SQLCODE=-102 q  } i %HOSP70c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Gerr" i $d(%0CacheRowLimit)#2,$g(%HOSP70d(48))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP70d(48),%HOSP70c=100 q  } g %0Gfirst:%HOSP70c=1
%0GDdun i $zu(115,2)=1,$g(%HOSP70d(49))=1 { l -@%HOSP70d(50) s %HOSP70d(49)=0 }
 g %0GCk1
%0GCdun 
%0GAdun 
 s %ROWCOUNT=%HOSP70d(48),SQLCODE=100,%HOSP70c=100 q
%HOSP70c i '$g(%HOSP70c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP70d(48)),1:0) f %HOSP70d(51)=1 { i $sortend(^||%sql.temp(%HOSP70t(%HOSP70d(51)),0),0) } k ^||%sql.temp(%HOSP70t(1))
 i $zu(115,2)=1,$g(%HOSP70d(49))=1 { l -@%HOSP70d(50) } k %HOSP70c,%HOSP70d,%HOSP70E,%HOSP70l,%HOSP70n,%HOSP70R,%HOSP70s,%HOSP70t,%HOSP70Z s SQLCODE=0 q
%0Gerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP70c=100
 f %HOSP70d(51)=1 i $sortend(^||%sql.temp(%HOSP70t(%HOSP70d(51)),0),0)
 q
%0GBMod ; asl MOD# 2
 s %HOSP70d(44)=$s(%HOSP70d(45)=$c(0):"",%HOSP70d(45)=$c(32,0):" ",1:%HOSP70d(45))
 i %HOSP70d(44)'="",$d(^THOSi("MRN",%HOSP70d(44))) g %0GBg1
%0GBk1 s %HOSP70d(44)=$o(^THOSi("MRN",%HOSP70d(44)))
 i %HOSP70d(44)="" g %0GBdun
%0GBg1 i (%HOSP70d(45)?1n.n),":"']%HOSP70d(44) g %0GBdun
 i '(($c(0)[%HOSP70d(45))||(($c(32,0)[%HOSP70d(45))&&($e(%HOSP70d(44))=" "))||(%HOSP70d(45)=$e(%HOSP70d(44),1,$l(%HOSP70d(45))))) g:(%HOSP70d(45)?1n.n) %0GBk1 g %0GBdun
 s %HOSP70d(1)=""
%0GBk2 s %HOSP70d(1)=$o(^THOSi("MRN",%HOSP70d(44),%HOSP70d(1)))
 i %HOSP70d(1)="" g %0GBk1
 s %HOSP70d(3)=""
%0GBk3 s %HOSP70d(3)=$o(^THOSi("MRN",%HOSP70d(44),%HOSP70d(1),%HOSP70d(3)))
 i %HOSP70d(3)="" g %0GBk2
 s %HOSP70d(4)=""
%0GBk4 s %HOSP70d(4)=$o(^THOSi("MRN",%HOSP70d(44),%HOSP70d(1),%HOSP70d(3),%HOSP70d(4)))
 i %HOSP70d(4)="" g %0GBk3
 s %HOSP70d(2)=(%HOSP70d(1))_"||"_(%HOSP70d(3))_"||"_(%HOSP70d(4))
 s %HOSP70s(2)=$s(%HOSP70d(2)'="":%HOSP70d(2),1:-1E14),^||%sql.temp(%HOSP70t(1),0,%HOSP70s(2))=""
 g %0GBk4
%0GBdun 
 q
%HOSP80o s $zt="%HOSP80E" s SQLCODE=$s($g(%HOSP80c):-101,1:0) q:SQLCODE'=0  s %HOSP80d(47)=0 s %HOSP80d(48)=0,%HOSP80d(49)=""
 s %HOSP80d(44)=$g(vis)
 s %HOSP80c=1 q
%HOSP80E s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) k %HOSP80c,%HOSP80d,%HOSP80E,%HOSP80l,%HOSP80n,%HOSP80R,%HOSP80Z q
%0Ifirst 
 ; asl MOD# 2
 s %HOSP80d(4)=%HOSP80d(44)
 i %HOSP80d(4)="" g %0IBdun
 s %HOSP80d(1)=""
%0IBk1 s %HOSP80d(1)=$o(^THOSi("VIS",%HOSP80d(4),%HOSP80d(1)))
 i %HOSP80d(1)="" g %0IBdun
 s %HOSP80d(3)=""
%0IBk2 s %HOSP80d(3)=$o(^THOSi("VIS",%HOSP80d(4),%HOSP80d(1),%HOSP80d(3)))
 i %HOSP80d(3)="" g %0IBk1
 s %HOSP80d(2)=(%HOSP80d(1))_"||"_(%HOSP80d(3))_"||"_(%HOSP80d(4))
 s %HOSP80d(46)=$p(%HOSP80d(2),"||"),%HOSP80d(3)=$p(%HOSP80d(2),"||",2),%HOSP80d(4)=$p(%HOSP80d(2),"||",3)
 i %HOSP80d(46)'="",%HOSP80d(3)'="",%HOSP80d(4)'="",$d(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4)))
 e  g %0IBk2
 s %HOSP80d(62)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4)))
 s %HOSP80d(5)=$p(%HOSP80d(62),"\",1) s %HOSP80d(6)=$p(%HOSP80d(62),"\",2) s %HOSP80d(7)=$p(%HOSP80d(62),"\",3) s %HOSP80d(8)=$p(%HOSP80d(62),"\",8) s %HOSP80d(9)=$p(%HOSP80d(62),"\",4) s %HOSP80d(15)=$p(%HOSP80d(62),"\",13) s %HOSP80d(16)=$p(%HOSP80d(62),"\",9) s %HOSP80d(17)=$p(%HOSP80d(62),"\",12) s %HOSP80d(18)=$p(%HOSP80d(62),"\",5) s %HOSP80d(19)=$p(%HOSP80d(62),"\",7) s %HOSP80d(20)=$p(%HOSP80d(62),"\",14) s %HOSP80d(21)=$p(%HOSP80d(62),"\",6) s %HOSP80d(22)=$p(%HOSP80d(62),"\",10) s %HOSP80d(23)=$p(%HOSP80d(62),"\",11) s %HOSP80d(25)=$p(%HOSP80d(62),"\",15) s %HOSP80d(27)=$p(%HOSP80d(62),"\",16) s %HOSP80d(28)=$p(%HOSP80d(62),"\",17) s %HOSP80d(29)=$p(%HOSP80d(62),"\",18) s %HOSP80d(33)=$p(%HOSP80d(62),"\",22) s %HOSP80d(34)=$p(%HOSP80d(62),"\",19) s %HOSP80d(35)=$p(%HOSP80d(62),"\",20) s %HOSP80d(36)=$p(%HOSP80d(62),"\",21) s %HOSP80d(37)=$p(%HOSP80d(62),"\",23) s %HOSP80d(38)=$p(%HOSP80d(62),"\",24) s %HOSP80d(39)=$p(%HOSP80d(62),"\",25) s %HOSP80d(40)=$p(%HOSP80d(62),"\",26) s %HOSP80d(41)=$p(%HOSP80d(62),"\",27) s %HOSP80d(42)=$p(%HOSP80d(62),"\",28) s %HOSP80d(43)=$p(%HOSP80d(62),"\",29)
 s %HOSP80d(62)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4),"ADDR"))
 s %HOSP80d(10)=$p(%HOSP80d(62),"\",1) s %HOSP80d(11)=$p(%HOSP80d(62),"\",2) s %HOSP80d(12)=$p(%HOSP80d(62),"\",3) s %HOSP80d(13)=$p(%HOSP80d(62),"\",4) s %HOSP80d(14)=$p(%HOSP80d(62),"\",5) s %HOSP80d(32)=$p(%HOSP80d(62),"\",6)
 s %HOSP80d(24)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4),"EXTRA"))
 s %HOSP80d(1)=$p(%HOSP80d(2),"||")
 s %HOSP80d(26)=$g(%HOSP80d(1)) s %HOSP80d(30)=$$CT029^at316($g(%HOSP80d(2))) s %HOSP80d(31)=$$CT030^at316($g(%HOSP80d(2)))
 g:$zu(115,2)=0 %0IBuncommitted i $zu(115,2)=1 l +^THOS($p(%HOSP80d(2),"||",1),"PATIENT",$p(%HOSP80d(2),"||",2),$p(%HOSP80d(2),"||",3))#"S":$zu(115,4) i $t { s %HOSP80d(48)=1,%HOSP80d(49)=$name(^THOS($p(%HOSP80d(2),"||",1),"PATIENT",$p(%HOSP80d(2),"||",2),$p(%HOSP80d(2),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%HOSP80d(2) ztrap "LOCK"  }
 ; asl MOD# 3
 s %HOSP80d(46)=$p(%HOSP80d(2),"||"),%HOSP80d(3)=$p(%HOSP80d(2),"||",2),%HOSP80d(4)=$p(%HOSP80d(2),"||",3)
 i %HOSP80d(46)'="",%HOSP80d(3)'="",%HOSP80d(4)'="",$d(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4)))
 e  g %0ICdun
 s %HOSP80d(69)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4)))
 s %HOSP80d(5)=$p(%HOSP80d(69),"\",1) s %HOSP80d(6)=$p(%HOSP80d(69),"\",2) s %HOSP80d(7)=$p(%HOSP80d(69),"\",3) s %HOSP80d(8)=$p(%HOSP80d(69),"\",8) s %HOSP80d(9)=$p(%HOSP80d(69),"\",4) s %HOSP80d(15)=$p(%HOSP80d(69),"\",13) s %HOSP80d(16)=$p(%HOSP80d(69),"\",9) s %HOSP80d(17)=$p(%HOSP80d(69),"\",12) s %HOSP80d(18)=$p(%HOSP80d(69),"\",5) s %HOSP80d(19)=$p(%HOSP80d(69),"\",7) s %HOSP80d(20)=$p(%HOSP80d(69),"\",14) s %HOSP80d(21)=$p(%HOSP80d(69),"\",6) s %HOSP80d(22)=$p(%HOSP80d(69),"\",10) s %HOSP80d(23)=$p(%HOSP80d(69),"\",11) s %HOSP80d(25)=$p(%HOSP80d(69),"\",15) s %HOSP80d(27)=$p(%HOSP80d(69),"\",16) s %HOSP80d(28)=$p(%HOSP80d(69),"\",17) s %HOSP80d(29)=$p(%HOSP80d(69),"\",18) s %HOSP80d(33)=$p(%HOSP80d(69),"\",22) s %HOSP80d(34)=$p(%HOSP80d(69),"\",19) s %HOSP80d(35)=$p(%HOSP80d(69),"\",20) s %HOSP80d(36)=$p(%HOSP80d(69),"\",21) s %HOSP80d(37)=$p(%HOSP80d(69),"\",23) s %HOSP80d(38)=$p(%HOSP80d(69),"\",24) s %HOSP80d(39)=$p(%HOSP80d(69),"\",25) s %HOSP80d(40)=$p(%HOSP80d(69),"\",26) s %HOSP80d(41)=$p(%HOSP80d(69),"\",27) s %HOSP80d(42)=$p(%HOSP80d(69),"\",28) s %HOSP80d(43)=$p(%HOSP80d(69),"\",29)
 s %HOSP80d(69)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4),"ADDR"))
 s %HOSP80d(10)=$p(%HOSP80d(69),"\",1) s %HOSP80d(11)=$p(%HOSP80d(69),"\",2) s %HOSP80d(12)=$p(%HOSP80d(69),"\",3) s %HOSP80d(13)=$p(%HOSP80d(69),"\",4) s %HOSP80d(14)=$p(%HOSP80d(69),"\",5) s %HOSP80d(32)=$p(%HOSP80d(69),"\",6)
 s %HOSP80d(24)=$g(^THOS(%HOSP80d(46),"PATIENT",%HOSP80d(3),%HOSP80d(4),"EXTRA"))
 s %HOSP80d(1)=$p(%HOSP80d(2),"||")
 s %HOSP80d(26)=$g(%HOSP80d(1)) s %HOSP80d(30)=$$CT029^at316($g(%HOSP80d(2))) s %HOSP80d(31)=$$CT030^at316($g(%HOSP80d(2)))
%0IBuncommitted ;
 s:$g(SQLCODE)'<0 SQLCODE=0 s %HOSP80d(47)=%HOSP80d(47)+1,%ROWCOUNT=%HOSP80d(47),%ROWID=%HOSP80d(2),%HOSP80c=10 q
%HOSP80f i '$g(%HOSP80c) { s SQLCODE=-102 q  } i %HOSP80c=100 { s SQLCODE=100 q  } s SQLCODE=0
 s $zt="%0Ierr" i $d(%0CacheRowLimit)#2,$g(%HOSP80d(47))'<%0CacheRowLimit { s SQLCODE=100,%ROWCOUNT=%HOSP80d(47),%HOSP80c=100 q  } g %0Ifirst:%HOSP80c=1
%0ICdun i $zu(115,2)=1,$g(%HOSP80d(48))=1 { l -@%HOSP80d(49) s %HOSP80d(48)=0 }
 g %0IBk2
%0IBdun 
%0IAdun 
 s %ROWCOUNT=%HOSP80d(47),SQLCODE=100,%HOSP80c=100 q
%HOSP80c i '$g(%HOSP80c) { s SQLCODE=-102 q  } s %ROWCOUNT=$s($g(SQLCODE)'<0:+$g(%HOSP80d(47)),1:0)
 i $zu(115,2)=1,$g(%HOSP80d(48))=1 { l -@%HOSP80d(49) } k %HOSP80c,%HOSP80d,%HOSP80E,%HOSP80l,%HOSP80n,%HOSP80R,%HOSP80Z s SQLCODE=0 q
%0Ierr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) s %HOSP80c=100 q
%0Po d %HOSP80f q:SQLCODE'=0
 s PLIST(0)=%HOSP80d(1),PLIST(1)=%HOSP80d(2),PLIST(2)=%HOSP80d(3),PLIST(3)=%HOSP80d(4),PLIST(4)=%HOSP80d(5),PLIST(5)=%HOSP80d(6),PLIST(6)=%HOSP80d(7),PLIST(7)=%HOSP80d(8),PLIST(8)=%HOSP80d(9),PLIST(9)=%HOSP80d(10),PLIST(10)=%HOSP80d(11),PLIST(11)=%HOSP80d(12),PLIST(12)=%HOSP80d(13),PLIST(13)=%HOSP80d(14),PLIST(14)=%HOSP80d(15),PLIST(15)=%HOSP80d(16),PLIST(16)=%HOSP80d(17),PLIST(17)=%HOSP80d(18),PLIST(18)=%HOSP80d(19),PLIST(19)=%HOSP80d(20),PLIST(20)=%HOSP80d(21),PLIST(21)=%HOSP80d(22),PLIST(22)=%HOSP80d(23),PLIST(23)=%HOSP80d(24),PLIST(24)=%HOSP80d(25),PLIST(25)=%HOSP80d(26),PLIST(26)=%HOSP80d(27),PLIST(27)=%HOSP80d(28),PLIST(28)=%HOSP80d(29),PLIST(29)=%HOSP80d(30),PLIST(30)=%HOSP80d(31),PLIST(31)=%HOSP80d(32),PLIST(32)=%HOSP80d(33),PLIST(33)=%HOSP80d(34),PLIST(34)=%HOSP80d(35),PLIST(35)=%HOSP80d(36),PLIST(36)=%HOSP80d(37),PLIST(37)=%HOSP80d(38),PLIST(38)=%HOSP80d(39),PLIST(39)=%HOSP80d(40),PLIST(40)=%HOSP80d(41),PLIST(41)=%HOSP80d(42),PLIST(42)=%HOSP80d(43)
 q
%0Qo d %HOSP70f q:SQLCODE'=0
 s PLIST(0)=%HOSP70d(1),PLIST(1)=%HOSP70d(2),PLIST(2)=%HOSP70d(3),PLIST(3)=%HOSP70d(4),PLIST(4)=%HOSP70d(5),PLIST(5)=%HOSP70d(6),PLIST(6)=%HOSP70d(7),PLIST(7)=%HOSP70d(8),PLIST(8)=%HOSP70d(9),PLIST(9)=%HOSP70d(10),PLIST(10)=%HOSP70d(11),PLIST(11)=%HOSP70d(12),PLIST(12)=%HOSP70d(13),PLIST(13)=%HOSP70d(14),PLIST(14)=%HOSP70d(15),PLIST(15)=%HOSP70d(16),PLIST(16)=%HOSP70d(17),PLIST(17)=%HOSP70d(18),PLIST(18)=%HOSP70d(19),PLIST(19)=%HOSP70d(20),PLIST(20)=%HOSP70d(21),PLIST(21)=%HOSP70d(22),PLIST(22)=%HOSP70d(23),PLIST(23)=%HOSP70d(24),PLIST(24)=%HOSP70d(25),PLIST(25)=%HOSP70d(26),PLIST(26)=%HOSP70d(27),PLIST(27)=%HOSP70d(28),PLIST(28)=%HOSP70d(29),PLIST(29)=%HOSP70d(30),PLIST(30)=%HOSP70d(31),PLIST(31)=%HOSP70d(32),PLIST(32)=%HOSP70d(33),PLIST(33)=%HOSP70d(34),PLIST(34)=%HOSP70d(35),PLIST(35)=%HOSP70d(36),PLIST(36)=%HOSP70d(37),PLIST(37)=%HOSP70d(38),PLIST(38)=%HOSP70d(39),PLIST(39)=%HOSP70d(40),PLIST(40)=%HOSP70d(41),PLIST(41)=%HOSP70d(42),PLIST(42)=%HOSP70d(43)
 q
%0Ro d %HOSP30f q:SQLCODE'=0
 s PLIST(0)=%HOSP30d(1),PLIST(1)=%HOSP30d(2),PLIST(2)=%HOSP30d(3),PLIST(3)=%HOSP30d(4),PLIST(4)=%HOSP30d(5),PLIST(5)=%HOSP30d(6),PLIST(6)=%HOSP30d(7),PLIST(7)=%HOSP30d(8),PLIST(8)=%HOSP30d(9),PLIST(9)=%HOSP30d(10),PLIST(10)=%HOSP30d(11),PLIST(11)=%HOSP30d(12),PLIST(12)=%HOSP30d(13),PLIST(13)=%HOSP30d(14),PLIST(14)=%HOSP30d(15),PLIST(15)=%HOSP30d(16),PLIST(16)=%HOSP30d(17),PLIST(17)=%HOSP30d(18),PLIST(18)=%HOSP30d(19),PLIST(19)=%HOSP30d(20),PLIST(20)=%HOSP30d(21),PLIST(21)=%HOSP30d(22),PLIST(22)=%HOSP30d(23),PLIST(23)=%HOSP30d(24),PLIST(24)=%HOSP30d(25),PLIST(25)=%HOSP30d(26),PLIST(26)=%HOSP30d(27),PLIST(27)=%HOSP30d(28),PLIST(28)=%HOSP30d(29),PLIST(29)=%HOSP30d(30),PLIST(30)=%HOSP30d(31),PLIST(31)=%HOSP30d(32),PLIST(32)=%HOSP30d(33),PLIST(33)=%HOSP30d(34),PLIST(34)=%HOSP30d(35),PLIST(35)=%HOSP30d(36),PLIST(36)=%HOSP30d(37),PLIST(37)=%HOSP30d(38),PLIST(38)=%HOSP30d(39),PLIST(39)=%HOSP30d(40),PLIST(40)=%HOSP30d(41),PLIST(41)=%HOSP30d(42),PLIST(42)=%HOSP30d(43)
 q
%0So d %HOSP40f q:SQLCODE'=0
 s PLIST(0)=%HOSP40d(1),PLIST(1)=%HOSP40d(2),PLIST(2)=%HOSP40d(3),PLIST(3)=%HOSP40d(4),PLIST(4)=%HOSP40d(5),PLIST(5)=%HOSP40d(6),PLIST(6)=%HOSP40d(7),PLIST(7)=%HOSP40d(8),PLIST(8)=%HOSP40d(9),PLIST(9)=%HOSP40d(10),PLIST(10)=%HOSP40d(11),PLIST(11)=%HOSP40d(12),PLIST(12)=%HOSP40d(13),PLIST(13)=%HOSP40d(14),PLIST(14)=%HOSP40d(15),PLIST(15)=%HOSP40d(16),PLIST(16)=%HOSP40d(17),PLIST(17)=%HOSP40d(18),PLIST(18)=%HOSP40d(19),PLIST(19)=%HOSP40d(20),PLIST(20)=%HOSP40d(21),PLIST(21)=%HOSP40d(22),PLIST(22)=%HOSP40d(23),PLIST(23)=%HOSP40d(24),PLIST(24)=%HOSP40d(25),PLIST(25)=%HOSP40d(26),PLIST(26)=%HOSP40d(27),PLIST(27)=%HOSP40d(28),PLIST(28)=%HOSP40d(29),PLIST(29)=%HOSP40d(30),PLIST(30)=%HOSP40d(31),PLIST(31)=%HOSP40d(32),PLIST(32)=%HOSP40d(33),PLIST(33)=%HOSP40d(34),PLIST(34)=%HOSP40d(35),PLIST(35)=%HOSP40d(36),PLIST(36)=%HOSP40d(37),PLIST(37)=%HOSP40d(38),PLIST(38)=%HOSP40d(39),PLIST(39)=%HOSP40d(40),PLIST(40)=%HOSP40d(41),PLIST(41)=%HOSP40d(42),PLIST(42)=%HOSP40d(43)
 q
%0To d %HOSP60f q:SQLCODE'=0
 s PLIST(0)=%HOSP60d(1),PLIST(1)=%HOSP60d(2),PLIST(2)=%HOSP60d(3),PLIST(3)=%HOSP60d(4),PLIST(4)=%HOSP60d(5),PLIST(5)=%HOSP60d(6),PLIST(6)=%HOSP60d(7),PLIST(7)=%HOSP60d(8),PLIST(8)=%HOSP60d(9),PLIST(9)=%HOSP60d(10),PLIST(10)=%HOSP60d(11),PLIST(11)=%HOSP60d(12),PLIST(12)=%HOSP60d(13),PLIST(13)=%HOSP60d(14),PLIST(14)=%HOSP60d(15),PLIST(15)=%HOSP60d(16),PLIST(16)=%HOSP60d(17),PLIST(17)=%HOSP60d(18),PLIST(18)=%HOSP60d(19),PLIST(19)=%HOSP60d(20),PLIST(20)=%HOSP60d(21),PLIST(21)=%HOSP60d(22),PLIST(22)=%HOSP60d(23),PLIST(23)=%HOSP60d(24),PLIST(24)=%HOSP60d(25),PLIST(25)=%HOSP60d(26),PLIST(26)=%HOSP60d(27),PLIST(27)=%HOSP60d(28),PLIST(28)=%HOSP60d(29),PLIST(29)=%HOSP60d(30),PLIST(30)=%HOSP60d(31),PLIST(31)=%HOSP60d(32),PLIST(32)=%HOSP60d(33),PLIST(33)=%HOSP60d(34),PLIST(34)=%HOSP60d(35),PLIST(35)=%HOSP60d(36),PLIST(36)=%HOSP60d(37),PLIST(37)=%HOSP60d(38),PLIST(38)=%HOSP60d(39),PLIST(39)=%HOSP60d(40),PLIST(40)=%HOSP60d(41),PLIST(41)=%HOSP60d(42),PLIST(42)=%HOSP60d(43)
 q
%0Zo n %mmmsqlc,%mmmsqld,%mmmsqlE,%mmmsqll,%mmmsqln,%mmmsqlp,%mmmsqlR,%mmmsqls,%mmmsqlt,%mmmsqlZ s $zt="%0Zerr" s %mmmsqld(28)=0,%mmmsqld(29)=""
 s %mmmsqld(2)=$g(row),%mmmsqld(5)=$g(sname),%mmmsqld(8)=$g(gname),%mmmsqld(10)=$g(dob),%mmmsqld(11)=$g(dob),%mmmsqld(13)=$g(sex),%mmmsqld(14)=$g(sex),%mmmsqld(17)=$g(mrn),%mmmsqld(19)=$g(par),%mmmsqld(20)=$g(par),%mmmsqld(22)=$g(vis),%mmmsqld(23)=$g(vis)
 s SQLCODE=100
 ; asl MOD# 2
 s %mmmsqld(1)=%mmmsqld(2)
 s %mmmsqld(25)=$p(%mmmsqld(1),"||"),%mmmsqld(15)=$p(%mmmsqld(1),"||",2),%mmmsqld(21)=$p(%mmmsqld(1),"||",3)
 i %mmmsqld(25)'="",%mmmsqld(15)'="",%mmmsqld(21)'="",$d(^THOS(%mmmsqld(25),"PATIENT",%mmmsqld(15),%mmmsqld(21)))
 e  g %0ZBdun
 s %mmmsqld(36)=$g(^THOS(%mmmsqld(25),"PATIENT",%mmmsqld(15),%mmmsqld(21)))
 s %mmmsqld(9)=$p(%mmmsqld(36),"\",8)
 g:'(((%mmmsqld(9)'="")&&(%mmmsqld(9)=%mmmsqld(10)))||(%mmmsqld(11)="")) %0ZBdun
 s %mmmsqld(12)=$p(%mmmsqld(36),"\",4)
 g:'(((%mmmsqld(12)'="")&&(%mmmsqld(12)=%mmmsqld(13)))||(%mmmsqld(14)="")) %0ZBdun
 s %mmmsqld(3)=$p(%mmmsqld(36),"\",2) s %mmmsqld(6)=$p(%mmmsqld(36),"\",1)
 s %mmmsqld(18)=$p(%mmmsqld(1),"||")
 s %mmmsqld(16)=$zu(28,%mmmsqld(15),6) s %mmmsqld(7)=$zu(28,%mmmsqld(6),6) s %mmmsqld(4)=$zu(28,%mmmsqld(3),6)
 g:'(($c(0)[%mmmsqld(5))||(%mmmsqld(5)=$c(32,0)&&($e(%mmmsqld(4))=$c(32)))||(%mmmsqld(5)=$e(%mmmsqld(4),1,$l(%mmmsqld(5))))) %0ZBdun
 g:'(($c(0)[%mmmsqld(8))||(%mmmsqld(8)=$c(32,0)&&($e(%mmmsqld(7))=$c(32)))||(%mmmsqld(8)=$e(%mmmsqld(7),1,$l(%mmmsqld(8))))) %0ZBdun
 g:'(($c(0)[%mmmsqld(17))||(%mmmsqld(17)=$c(32,0)&&($e(%mmmsqld(16))=$c(32)))||(%mmmsqld(17)=$e(%mmmsqld(16),1,$l(%mmmsqld(17))))) %0ZBdun
 g:'((%mmmsqld(18)=%mmmsqld(19))||(%mmmsqld(20)="")) %0ZBdun
 g:'((%mmmsqld(21)=%mmmsqld(22))||(%mmmsqld(23)="")) %0ZBdun
 g:'(%mmmsqld(4)'="") %0ZBdun
 g:'(%mmmsqld(7)'="") %0ZBdun
 g:$zu(115,2)=0 %0ZBuncommitted i $zu(115,2)=1 l +^THOS($p(%mmmsqld(1),"||",1),"PATIENT",$p(%mmmsqld(1),"||",2),$p(%mmmsqld(1),"||",3))#"S":$zu(115,4) i $t { s %mmmsqld(28)=1,%mmmsqld(29)=$name(^THOS($p(%mmmsqld(1),"||",1),"PATIENT",$p(%mmmsqld(1),"||",2),$p(%mmmsqld(1),"||",3)))_"#""SI""" } else { s SQLCODE=-114,%msg="Unable to acquire shared lock on table SQLUser.HOS_HospitalPatients for RowID value: "_%mmmsqld(1) ztrap "LOCK"  }
 ; asl MOD# 3
 s %mmmsqld(26)=$lb(""_%mmmsqld(16),""_%mmmsqld(7),""_%mmmsqld(4),""_%mmmsqld(9),""_%mmmsqld(12))
 s %mmmsqld(25)=$p(%mmmsqld(1),"||"),%mmmsqld(15)=$p(%mmmsqld(1),"||",2),%mmmsqld(21)=$p(%mmmsqld(1),"||",3)
 i %mmmsqld(25)'="",%mmmsqld(15)'="",%mmmsqld(21)'="",$d(^THOS(%mmmsqld(25),"PATIENT",%mmmsqld(15),%mmmsqld(21)))
 e  g %0ZCdun
 s %mmmsqld(43)=$g(^THOS(%mmmsqld(25),"PATIENT",%mmmsqld(15),%mmmsqld(21)))
 s %mmmsqld(3)=$p(%mmmsqld(43),"\",2) s %mmmsqld(6)=$p(%mmmsqld(43),"\",1) s %mmmsqld(9)=$p(%mmmsqld(43),"\",8) s %mmmsqld(12)=$p(%mmmsqld(43),"\",4)
 s %mmmsqld(18)=$p(%mmmsqld(1),"||")
 s %mmmsqld(16)=$zu(28,%mmmsqld(15),6) s %mmmsqld(7)=$zu(28,%mmmsqld(6),6) s %mmmsqld(4)=$zu(28,%mmmsqld(3),6)
 s %mmmsqld(27)=$lb(""_%mmmsqld(16),""_%mmmsqld(7),""_%mmmsqld(4),""_%mmmsqld(9),""_%mmmsqld(12))
 g:%mmmsqld(26)'=%mmmsqld(27) %0ZCdun
%0ZBuncommitted ;
 s SQLCODE=0 g %0Zc
%0ZCdun i $zu(115,2)=1,$g(%mmmsqld(28))=1 { l -@%mmmsqld(29) s %mmmsqld(28)=0 }
%0ZBdun 
%0ZAdun 
%0Zc s %ROWCOUNT='SQLCODE i $zu(115,2)=1,$g(%mmmsqld(28))=1 { l -@%mmmsqld(29) } q
%0Zerr s $zt="" d SQLRunTimeError^%apiSQL($ze,.SQLCODE,.%msg) g %0Zc
]]></Routine>
</Export>
