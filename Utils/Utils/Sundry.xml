<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="24">
<Class name="Utils.Sundry">
<Super>%RegisteredObject</Super>
<TimeCreated>63019,54574.469467</TimeCreated>

<Method name="exportAllroutines">
<ClassMethod>1</ClassMethod>
<FormalSpec>pNamespace:%String</FormalSpec>
<Implementation><![CDATA[
	kill items
 set rtn=""
 for {
	 set rtn=$order(^rINC(rtn)) if rtn="" quit
	 if ..ExclureRoutine(rtn,"inc") continue
	 set items(rtn_".inc")=""
	 // write !,rtn_".inc" r aaa
	 
 }
 set rtn=""
 for {
	 set rtn=$order(^rMAC(rtn)) if rtn="" quit
	 if ..ExclureRoutine(rtn,"mac") continue
	 set items(rtn_".mac")=""
	 ///write !,rtn_".mac" r aaa
 }
 set rtn=""
 for {
	 set rtn=$order(^ROUTINE(rtn)) if rtn="" quit
	 if $data(^rMAC(rtn)) continue
	 if ..ExclureRoutine(rtn,"int") continue
	 set items(rtn_".int")=""
	 //write !,rtn_".int" r aaa
 }
 	
 do ..CreateFileWithRoutines("c:\temp\all_routines.xml",.items)
]]></Implementation>
</Method>

<Method name="ExclureRoutine">
<ClassMethod>1</ClassMethod>
<FormalSpec>pRoutineName:%String,pRoutineType:%String</FormalSpec>
<Implementation><![CDATA[
	if $extract(pRoutineName,1)="%" quit 1
    if $extract(pRoutineName,1,3)="Ens" quit 1
    if $extract(pRoutineName,1,5)="CSPX." quit 1
    if $extract(pRoutineName,1,8)="Activate" quit 1
    if $extract(pRoutineName,1,8)="CacheSql" quit 1
    quit 0
]]></Implementation>
</Method>

<Method name="CreateFileWithRoutines">
<ClassMethod>1</ClassMethod>
<FormalSpec>fileName:%String,items:%String</FormalSpec>
<Implementation><![CDATA[
 try {
	  if ##class(%File).Exists(fileName) do ##class(%File).Delete(fileName)
	  kill errorlog
	  write !,"Export if file "_fileName
      do $System.OBJ.Export(.items,fileName,"",.errorlog)
      if $data(errorlog) zw errorlog
 } catch(exception) {
	  do $system.OBJ.DisplayError(exception.AsStatus())
 }
  quit
]]></Implementation>
</Method>

<Method name="FindReports1">
<Description>
Получить список названий отчетов по списку программ для отчетов 
pStringRoutines - список программ для отчетов через $c(0)
do ##class(Utils.Sundry).FindReports1(...)
s str="PRTCLNRUS02"_$c(0)_"PRTCLNRUS05"_$c(0)_"PRTCLNRUS07"_$c(0)_"PRTCLNRUS13"_$c(0)_"PRTCLNRUS13c"_$c(0)_"PRTCLNRUS30"_$c(0)_"PRTCLNRUS34"_$c(0)_"PRTCLNRUS35"_$c(0)_"PRTCLNRUS40"_$c(0)_"PRTCLNRUS44"_$c(0)_"PRTCLNRUS48"_$c(0)_"PRTCLNRUS13birlab"_$c(0)_"PRTCLNRUS05birlab"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pStringRoutines:%String</FormalSpec>
<Implementation><![CDATA[
 	kill ^||vsp
 	set id=""
 	for {
	 	set id=$order(^TTAB("REPORT-GENERIC",id),1,rec) if id="" quit
	 	set routine=$piece(rec,"\",1) if routine="" continue
	 	set namereport=$piece(rec,"\",9)
	 	set idmenu=$piece(rec,"\",4)
	 	set namemenu="" if idmenu'="" set namemenu=$piece($get(^TTAB("CTPG",idmenu)),"\",1)
	 	if ($c(0)_pStringRoutines_$c(0))[($c(0)_routine_$c(0)) {
		 	write !,routine," ",namereport," (",namemenu,")"
	 	}
 	}
]]></Implementation>
</Method>
</Class>
</Export>
